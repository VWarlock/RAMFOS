;----------------------------------------------------------------------------
; RAMFOS
; Запуск редатора и отладчика
;
; 2013-11-01 Дизассемблировано vinxru
;----------------------------------------------------------------------------

#if NO_ROM_ENTRY
		; Адрес подпрограммы в ПЗУ
		lxi	h, a_debuger

editorDebuger:	; В режиме выбора файла запускать нельзя
		mov	a, b
		add	a
		rm

		; Запуск		
exec:		call	exec1
		jnz	biosInit
		jmp	exec2
		
a_editor:	.db "Editor   EXE"
a_debuger:	.db "Debuger  EXE"

; ---------------------------------------------------------------------------

startEditor:	; Адрес подпрограммы в ПЗУ
		lxi	h, a_editor
		jmp	editorDebuger

#else ; ---------------------------------------------------------------------

		; Адрес подпрограммы в ПЗУ
		lxi	h, 3

editorDebuger:	; if(b & 0x40) return;
		mov	a, b
		ral
		ral
		rc

		; Помещаем в стек адрес возврата
		xthl

		; Сохраняем выбранный файл
		call	memcpy_fd_fd2

		; Адрес загрузки
		lxi	h, 0E800h

		; Включаем ПЗУ
		sta	IO_PAGE_ROM
		ret

; ---------------------------------------------------------------------------

startEditor:	; Адрес подпрограммы в ПЗУ
		lxi	h, 6
		jmp	editorDebuger

#endif