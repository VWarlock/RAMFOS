0001   0000             ; ===========================================================================
0002   0000             ; НАСТРОЙКА
0003   0000             
0004   0000             STD_RAMFOS = 0				; Скомпилировать стандартный RAMFOS
0005   0000             
0006   0000             #if STD_RAMFOS==0
0007   0000             
0008   0000             DATE_IN_RAM		= 1		; 0      Размещать дату в основной оперативной памяти (возможна работа без ДОЗУ)
0009   0000             NO_ROM_ENTRY		= 1		; 0      Стандартные программы в виде файлов
0010   0000             NO_PRINTER		= 1		; 0 	 Отключить принтер
0011   0000             NO_MXDOS		= 1		; 0 	 Отключить загрузку с дискеты (в частноcти MXDOS)
0012   0000             OPEN_ANY_FILE		= 1		; 0 	 Открывать файл с любым расширением (А не только TXT в редакторе)
0013   0000             ALL_CHARS		= 1		; 0	 Печать всех символов знакогенератора через ESC
0014   0000             RKS_LOADER		= 1		; 0      Запускать RKS файлы
0015   0000             BIG_ROM			= 1		; 0 	 Использовать все 64 Кб ПЗУ Специалиста МХ2 под ROM-диск
0016   0000             WORK_WITHOUT_ARAM	= 32		; 0      Если ДОЗУ не найдено, то использовать буфер в ОЗУ размером с эту переменную
0017   0000             ROM_PAGE_START		= 01880h	; 04000h Первый байт страницы ПЗУ
0018   0000             ROM_PAGE_END		= 0FFFCh	; 0C000h Последний байт страницы ПЗУ + 1
0019   0000             CURSOR_BLINK_SPEED	= 767		; 767    Задержка мигания курсора
0020   0000             ARAM_MAX_PAGE           = 0Fh		; 6      Максимальное кол-во страниц расширенной памяти (максимум 0Fh)
0021   0000             ARAM_PAGE_END		= 0FFBBh        ; 0FFBBh Конец страницы ДОЗУ (36 байт неиспользуемого ОЗУ после)
0022   0000             DLG_START_PAGE		= 80h		; 0      При запуске показать эту страницу
0023   0000             INIT_SCREEN_COLOR	= 0F1h		; 100h	 Цвет, которым заливается экран при инициализации. 100h - заливается текущим цветом, который при теплой перезагрузке может быть любым.
0024   0000             FAST_PRINT		= 1		; 0      Быстрая функция вывода текста. Так же выводит текст строки без разрывов. И не портит цвета символов правее.
0025   0000             TRUE_CHECK_ARAM		= 1		; 0      Испправленная функция определения обьема ДОЗУ
0026   0000             NICE			= 1		; 0	 Новый интерфейс
0027   0000             COLOR_SUPPORT		= 1		; 0	 Установка цвета по умолчанию при очистке служебных строк и экрана
0028   0000             NO_PRINT_STATUS_BUG	= 1		; 0	 Исправить ошибку
0029   0000             DLG_CURSOR_AT_TOP	= 0		; 0	 Курсор на первом файле
0030   0000             NO_ROM_SWITCH_BUG	= 1		; 0	 Можно было выбрать не нулевую страницу ПЗУ
0031   0000             RELOCATE_FILE_FUNCTIONS = 1		; 0      Перенести некоторые функции из F800 в C800, иначе код не влезает
0032   0000             SIZE_OPTIMIZATION	= 1		; 0      Более компактный код
0033   0000             
0034   0000~            #else
0035   0000~            
0036   0000~            DATE_IN_RAM		= 0
0037   0000~            NO_ROM_ENTRY		= 0
0038   0000~            NO_PRINTER		= 0
0039   0000~            NO_MXDOS		= 0
0040   0000~            OPEN_ANY_FILE		= 0
0041   0000~            ALL_CHARS		= 0
0042   0000~            RKS_LOADER		= 0
0043   0000~            BIG_ROM			= 0
0044   0000~            WORK_WITHOUT_ARAM	= 0
0045   0000~            ROM_PAGE_START		= 04000h
0046   0000~            ROM_PAGE_END		= 0C000h
0047   0000~            CURSOR_BLINK_SPEED	= 767
0048   0000~            ARAM_MAX_PAGE           = 6
0049   0000~            ARAM_PAGE_END		= 0FFBBh
0050   0000~            DLG_START_PAGE		= 0
0051   0000~            INIT_SCREEN_COLOR	= 100h
0052   0000~            FAST_PRINT		= 0
0053   0000~            TRUE_CHECK_ARAM		= 0
0054   0000~            NICE			= 0
0055   0000~            COLOR_SUPPORT		= 0
0056   0000~            NO_PRINT_STATUS_BUG	= 0
0057   0000~            DLG_CURSOR_AT_TOP	= 0
0058   0000~            NO_ROM_SWITCH_BUG	= 0
0059   0000~            RELOCATE_FILE_FUNCTIONS = 0
0060   0000~            SIZE_OPTIMIZATION	= 0
0061   0000~            
0062   0000             #endif
0063   0000             
0064   0000             ; ===========================================================================
0065   0000             ; ПОРТЫ ВВОДА-ВЫВОДА
0066   0000             
0067   0000             IO_KEYB_A		= 0FFE0h
0068   0000             IO_KEYB_B		= 0FFE1h
0069   0000             IO_KEYB_C		= 0FFE2h
0070   0000             IO_KEYB_MODE		= 0FFE3h
0071   0000             IO_EXT_A		= 0FFE4h
0072   0000             IO_EXT_B		= 0FFE5h
0073   0000             IO_EXT_C		= 0FFE6h
0074   0000             IO_EXT_MODE		= 0FFE7h
0075   0000             IO_FLOPPY_CMD		= 0FFE8h
0076   0000             IO_FLOPPY_SECTOR	= 0FFEAh
0077   0000             IO_FLOPPY_DATA		= 0FFEBh
0078   0000             IO_TIMER		= 0FFECh
0079   0000             IO_FLOPPY_TRIG		= 0FFF0h
0080   0000             IO_FLOPPY_HEAD		= 0FFF2h
0081   0000             IO_COLOR		= 0FFF8h
0082   0000             IO_PAGE_RAM		= 0FFFCh
0083   0000             IO_PAGE_ARAM		= 0FFFDh
0084   0000             IO_PAGE_ROM		= 0FFFEh
0085   0000             IO_PAGE_STD		= 0FFFFh
0086   0000             
0087   0000             ; ===========================================================================
0088   0000             ; СПЕЦИАЛЬНЫЕ КОДЫ СИМВОЛОВ
0089   0000             
0090   0000             C_BEEP		= 7
0091   0000             C_LEFT		= 8
0092   0000             C_CLEARSCREEN	= 1Fh
0093   0000             C_PUSHCOLOR	= 88h
0094   0000             C_POPCOLOR	= 89h
0095   0000             C_INVERSE	= 8Bh
0096   0000             C_NORMAL	= 8Ch
0097   0000             C_PUSHCURSORL	= 8Dh
0098   0000             C_TOPLINE	= 8Fh
0099   0000             C_POPCURSORL	= 8Eh
0100   0000             C_BOTTOMLINE	= 90h
0101   0000             C_PUSHCURSORS	= 93h
0102   0000             C_POPCURSORS	= 94h
0103   0000             C_SCROLLUPEX	= 9Ah
0104   0000             
0105   0000             ; ===========================================================================
0106   0000             ; КОНСТАНТЫ НЕЛЬЗЯ МЕНЯТЬ
0107   0000             
0108   0000             CHAR_HEIGHT	  	= 8
0109   0000             LINE_HEIGHT	 	= 10
0110   0000             SCREEN_HEIGHT	 	= 250
0111   0000             FILE_HEADER_SIZE	= 30
0112   0000             STACK_TOP		= 0D2FFh
0113   0000             RAM_TOP			= 8FFFh
0114   0000             
0115   0000             ; ===========================================================================
0116   0000             ; ПЕРЕМЕННЫЕ
0117   0000             
0118   C000             .org 0C000h
0119   C000             
0120   C000             charGen:
0121   C000             
0122   C000             .include "chargen.inc"
0001+  C000             ;+---------------------------------------------------------------------------
0002+  C000             ; RAMFOS
0003+  C000             ; ╟эръюухэхЁрЄюЁ
0004+  C000             ;
0005+  C000             ; 2013-11-01 ─шчрёёхьсышЁютрэю ш фюЁрсюЄрэю vinxru
0006+  C000             ;----------------------------------------------------------------------------
0007+  C000             
0008+  C000             ; ═ютр  ЇєэъЎш  т√тюфр ЄхъёЄр шёяюы№чєхЄ °ЁшЇЄ√ т√ёюЄющ т 10 яшъёхыхщ
0009+  C000             #if FAST_PRINT
0010+  C000             #define DY 80h
0011+  C000~            #else
0012+  C000~            #define DY 0
0013+  C000             #endif
0014+  C000             
0015+  C000 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 0
0015+  C004 00 00 00 00 
0016+  C008 B8 38 38 38 	.db DY|038h,038h,038h,038h,000h,000h,000h,DY|000h ; 1
0016+  C00C 00 00 00 80 
0017+  C010 87 07 07 07 	.db DY|007h,007h,007h,007h,000h,000h,000h,DY|000h ; 2
0017+  C014 00 00 00 80 
0018+  C018 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,000h,000h,000h,DY|000h ; 3
0018+  C01C 00 00 00 80 
0019+  C020 80 00 00 00 	.db DY|000h,000h,000h,000h,007h,007h,007h,DY|007h ; 4
0019+  C024 07 07 07 87 
0020+  C028 B8 38 38 38 	.db DY|038h,038h,038h,038h,007h,007h,007h,DY|007h ; 5
0020+  C02C 07 07 07 87 
0021+  C030 87 07 07 07 	.db DY|007h,007h,007h,007h,007h,007h,007h,DY|007h ; 6
0021+  C034 07 07 07 87 
0022+  C038 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,007h,007h,007h,DY|007h ; 7
0022+  C03C 07 07 07 87 
0023+  C040             #if ALL_CHARS
0024+  C040 B0 30 30 30 	.db DY|030h,030h,030h,030h,030h,030h,030h,DY|030h ; 8+
0024+  C044 30 30 30 B0 
0025+  C048~            #else
0026+  C048~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0027+  C048             #endif
0028+  C048 0C 0C 3F 2D 	.db 00Ch,00Ch,03Fh,02Dh,00Ch,00Ch,012h,021h ; 9
0028+  C04C 0C 0C 12 21 
0029+  C050             #if ALL_CHARS
0030+  C050 83 03 03 03 	.db DY|003h,003h,003h,003h,003h,003h,003h,DY|003h ; 10+
0030+  C054 03 03 03 83 
0031+  C058~            #else
0032+  C058~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0033+  C058             #endif
0034+  C058 0C 1E 3F 0C 	.db 00Ch,01Eh,03Fh,00Ch,00Ch,00Ch,00Ch,000h ; 11
0034+  C05C 0C 0C 0C 00 
0035+  C060             #if ALL_CHARS
0036+  C060 B0 30 30 30 	.db DY|030h,030h,030h,030h,030h,030h,030h,DY|03Fh ; 12+
0036+  C064 30 30 30 BF 
0037+  C068~            #else
0038+  C068~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0039+  C068             #endif
0040+  C068             #if ALL_CHARS
0041+  C068 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,DY|03Fh ; 13
0041+  C06C 00 00 00 BF 
0042+  C070~            #else
0043+  C070~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0044+  C070             #endif
0045+  C070 08 0C 3E 3F 	.db 008h,00Ch,03Eh,03Fh,03Eh,00Ch,008h,000h ; 14
0045+  C074 3E 0C 08 00 
0046+  C078 0C 0C 0C 0C 	.db 00Ch,00Ch,00Ch,00Ch,03Fh,01Eh,00Ch,000h ; 15
0046+  C07C 3F 1E 0C 00 
0047+  C080 80 00 00 00 	.db DY|000h,000h,000h,000h,038h,038h,038h,DY|038h ; 16
0047+  C084 38 38 38 B8 
0048+  C088 B8 38 38 38 	.db DY|038h,038h,038h,038h,038h,038h,038h,DY|038h ; 17
0048+  C08C 38 38 38 B8 
0049+  C090 87 07 07 07 	.db DY|007h,007h,007h,007h,038h,038h,038h,DY|038h ; 18
0049+  C094 38 38 38 B8 
0050+  C098 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,038h,038h,038h,DY|038h ; 19
0050+  C09C 38 38 38 B8 
0051+  C0A0 80 00 00 00 	.db DY|000h,000h,000h,000h,03Fh,03Fh,03Fh,DY|03Fh ; 20
0051+  C0A4 3F 3F 3F BF 
0052+  C0A8 B8 38 38 38 	.db DY|038h,038h,038h,038h,03Fh,03Fh,03Fh,DY|03Fh ; 21
0052+  C0AC 3F 3F 3F BF 
0053+  C0B0 87 07 07 07 	.db DY|007h,007h,007h,007h,03Fh,03Fh,03Fh,DY|03Fh ; 22
0053+  C0B4 3F 3F 3F BF 
0054+  C0B8 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,DY|03Fh ; 23
0054+  C0BC 3F 3F 3F BF 
0055+  C0C0             #if ALL_CHARS
0056+  C0C0 83 03 03 03 	.db DY|003h,003h,003h,003h,003h,003h,003h,DY|03Fh ; 24+
0056+  C0C4 03 03 03 BF 
0057+  C0C8~            #else
0058+  C0C8~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0059+  C0C8             #endif
0060+  C0C8             #if ALL_CHARS
0061+  C0C8 A0 20 20 20 	.db DY|020h,020h,020h,020h,020h,020h,020h,DY|020h ; 25+
0061+  C0CC 20 20 20 A0 
0062+  C0D0~            #else
0063+  C0D0~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0064+  C0D0             #endif
0065+  C0D0 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 26
0065+  C0D4 00 00 00 00 
0066+  C0D8 0C 0C 0C 0C 	.db 00Ch,00Ch,00Ch,00Ch,00Ch,00Ch,00Ch,00Ch ; 27
0066+  C0DC 0C 0C 0C 0C 
0067+  C0E0 00 00 00 3F 	.db 000h,000h,000h,03Fh,03Fh,000h,000h,000h ; 28
0067+  C0E4 3F 00 00 00 
0068+  C0E8 04 0C 1F 3F 	.db 004h,00Ch,01Fh,03Fh,01Fh,00Ch,004h,000h ; 29
0068+  C0EC 1F 0C 04 00 
0069+  C0F0 00 3E 3C 3C 	.db 000h,03Eh,03Ch,03Ch,03Eh,027h,002h,000h ; 30
0069+  C0F4 3E 27 02 00 
0070+  C0F8 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 31
0070+  C0FC 00 00 00 00 
0071+  C100 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 32
0071+  C104 00 00 00 00 
0072+  C108 04 04 04 04 	.db 004h,004h,004h,004h,004h,000h,004h,000h ; 33
0072+  C10C 04 00 04 00 
0073+  C110 0A 0A 0A 00 	.db 00Ah,00Ah,00Ah,000h,000h,000h,000h,000h ; 34
0073+  C114 00 00 00 00 
0074+  C118 0A 0A 1F 0A 	.db 00Ah,00Ah,01Fh,00Ah,01Fh,00Ah,00Ah,000h ; 35
0074+  C11C 1F 0A 0A 00 
0075+  C120 00 11 0E 0A 	.db 000h,011h,00Eh,00Ah,00Eh,011h,000h,000h ; 36
0075+  C124 0E 11 00 00 
0076+  C128 18 19 02 04 	.db 018h,019h,002h,004h,008h,013h,003h,000h ; 37
0076+  C12C 08 13 03 00 
0077+  C130 04 0A 0A 0C 	.db 004h,00Ah,00Ah,00Ch,015h,012h,00Dh,000h ; 38
0077+  C134 15 12 0D 00 
0078+  C138 06 06 02 04 	.db 006h,006h,002h,004h,000h,000h,000h,000h ; 39
0078+  C13C 00 00 00 00 
0079+  C140 02 04 08 08 	.db 002h,004h,008h,008h,008h,004h,002h,000h ; 40
0079+  C144 08 04 02 00 
0080+  C148 08 04 02 02 	.db 008h,004h,002h,002h,002h,004h,008h,000h ; 41
0080+  C14C 02 04 08 00 
0081+  C150 00 04 15 0E 	.db 000h,004h,015h,00Eh,015h,004h,000h,000h ; 42
0081+  C154 15 04 00 00 
0082+  C158 00 04 04 1F 	.db 000h,004h,004h,01Fh,004h,004h,000h,000h ; 43
0082+  C15C 04 04 00 00 
0083+  C160 00 00 00 00 	.db 000h,000h,000h,000h,00Ch,00Ch,004h,008h ; 44
0083+  C164 0C 0C 04 08 
0084+  C168 00 00 00 1F 	.db 000h,000h,000h,01Fh,000h,000h,000h,000h ; 45
0084+  C16C 00 00 00 00 
0085+  C170 00 00 00 00 	.db 000h,000h,000h,000h,000h,00Ch,00Ch,000h ; 46
0085+  C174 00 0C 0C 00 
0086+  C178 00 01 02 04 	.db 000h,001h,002h,004h,008h,010h,000h,000h ; 47
0086+  C17C 08 10 00 00 
0087+  C180 0E 11 13 15 	.db 00Eh,011h,013h,015h,019h,011h,00Eh,000h ; 48
0087+  C184 19 11 0E 00 
0088+  C188 04 0C 04 04 	.db 004h,00Ch,004h,004h,004h,004h,00Eh,000h ; 49
0088+  C18C 04 04 0E 00 
0089+  C190 0E 11 01 06 	.db 00Eh,011h,001h,006h,008h,010h,01Fh,000h ; 50
0089+  C194 08 10 1F 00 
0090+  C198 1F 01 02 06 	.db 01Fh,001h,002h,006h,001h,011h,00Eh,000h ; 51
0090+  C19C 01 11 0E 00 
0091+  C1A0 02 06 0A 12 	.db 002h,006h,00Ah,012h,01Fh,002h,002h,000h ; 52
0091+  C1A4 1F 02 02 00 
0092+  C1A8 1F 10 1E 01 	.db 01Fh,010h,01Eh,001h,001h,011h,00Eh,000h ; 53
0092+  C1AC 01 11 0E 00 
0093+  C1B0 07 08 10 1E 	.db 007h,008h,010h,01Eh,011h,011h,00Eh,000h ; 54
0093+  C1B4 11 11 0E 00 
0094+  C1B8 1F 01 02 04 	.db 01Fh,001h,002h,004h,008h,008h,008h,000h ; 55
0094+  C1BC 08 08 08 00 
0095+  C1C0 0E 11 11 0E 	.db 00Eh,011h,011h,00Eh,011h,011h,00Eh,000h ; 56
0095+  C1C4 11 11 0E 00 
0096+  C1C8 0E 11 11 0F 	.db 00Eh,011h,011h,00Fh,001h,002h,01Ch,000h ; 57
0096+  C1CC 01 02 1C 00 
0097+  C1D0 00 0C 0C 00 	.db 000h,00Ch,00Ch,000h,000h,00Ch,00Ch,000h ; 58
0097+  C1D4 00 0C 0C 00 
0098+  C1D8 0C 0C 00 00 	.db 00Ch,00Ch,000h,000h,00Ch,00Ch,004h,008h ; 59
0098+  C1DC 0C 0C 04 08 
0099+  C1E0 02 04 08 10 	.db 002h,004h,008h,010h,008h,004h,002h,000h ; 60
0099+  C1E4 08 04 02 00 
0100+  C1E8 00 00 1F 00 	.db 000h,000h,01Fh,000h,01Fh,000h,000h,000h ; 61
0100+  C1EC 1F 00 00 00 
0101+  C1F0 08 04 02 01 	.db 008h,004h,002h,001h,002h,004h,008h,000h ; 62
0101+  C1F4 02 04 08 00 
0102+  C1F8 0E 11 01 02 	.db 00Eh,011h,001h,002h,004h,000h,004h,000h ; 63
0102+  C1FC 04 00 04 00 
0103+  C200 0E 11 13 15 	.db 00Eh,011h,013h,015h,017h,010h,00Eh,000h ; 64
0103+  C204 17 10 0E 00 
0104+  C208 04 0A 11 11 	.db 004h,00Ah,011h,011h,01Fh,011h,011h,000h ; 65
0104+  C20C 1F 11 11 00 
0105+  C210 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,011h,011h,01Eh,000h ; 66
0105+  C214 11 11 1E 00 
0106+  C218 0E 11 10 10 	.db 00Eh,011h,010h,010h,010h,011h,00Eh,000h ; 67
0106+  C21C 10 11 0E 00 
0107+  C220 1E 09 09 09 	.db 01Eh,009h,009h,009h,009h,009h,01Eh,000h ; 68
0107+  C224 09 09 1E 00 
0108+  C228 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,010h,010h,01Fh,000h ; 69
0108+  C22C 10 10 1F 00 
0109+  C230 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,010h,010h,010h,000h ; 70
0109+  C234 10 10 10 00 
0110+  C238 0E 11 10 10 	.db 00Eh,011h,010h,010h,013h,011h,00Fh,000h ; 71
0110+  C23C 13 11 0F 00 
0111+  C240 11 11 11 1F 	.db 011h,011h,011h,01Fh,011h,011h,011h,000h ; 72
0111+  C244 11 11 11 00 
0112+  C248 0E 04 04 04 	.db 00Eh,004h,004h,004h,004h,004h,00Eh,000h ; 73
0112+  C24C 04 04 0E 00 
0113+  C250 01 01 01 01 	.db 001h,001h,001h,001h,011h,011h,00Eh,000h ; 74
0113+  C254 11 11 0E 00 
0114+  C258 11 12 14 18 	.db 011h,012h,014h,018h,014h,012h,011h,000h ; 75
0114+  C25C 14 12 11 00 
0115+  C260 10 10 10 10 	.db 010h,010h,010h,010h,010h,011h,01Fh,000h ; 76
0115+  C264 10 11 1F 00 
0116+  C268 11 1B 15 15 	.db 011h,01Bh,015h,015h,011h,011h,011h,000h ; 77
0116+  C26C 11 11 11 00 
0117+  C270 11 11 19 15 	.db 011h,011h,019h,015h,013h,011h,011h,000h ; 78
0117+  C274 13 11 11 00 
0118+  C278 0E 11 11 11 	.db 00Eh,011h,011h,011h,011h,011h,00Eh,000h ; 79
0118+  C27C 11 11 0E 00 
0119+  C280 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,010h,010h,010h,000h ; 80
0119+  C284 10 10 10 00 
0120+  C288 0E 11 11 11 	.db 00Eh,011h,011h,011h,015h,012h,00Dh,000h ; 81
0120+  C28C 15 12 0D 00 
0121+  C290 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,014h,012h,011h,000h ; 82
0121+  C294 14 12 11 00 
0122+  C298 0E 11 10 0E 	.db 00Eh,011h,010h,00Eh,001h,011h,00Eh,000h ; 83
0122+  C29C 01 11 0E 00 
0123+  C2A0 1F 04 04 04 	.db 01Fh,004h,004h,004h,004h,004h,004h,000h ; 84
0123+  C2A4 04 04 04 00 
0124+  C2A8 11 11 11 11 	.db 011h,011h,011h,011h,011h,011h,00Eh,000h ; 85
0124+  C2AC 11 11 0E 00 
0125+  C2B0 11 11 11 0A 	.db 011h,011h,011h,00Ah,00Ah,004h,004h,000h ; 86
0125+  C2B4 0A 04 04 00 
0126+  C2B8 11 11 11 15 	.db 011h,011h,011h,015h,015h,015h,00Ah,000h ; 87
0126+  C2BC 15 15 0A 00 
0127+  C2C0 11 11 0A 04 	.db 011h,011h,00Ah,004h,00Ah,011h,011h,000h ; 88
0127+  C2C4 0A 11 11 00 
0128+  C2C8 11 11 0A 04 	.db 011h,011h,00Ah,004h,004h,004h,004h,000h ; 89
0128+  C2CC 04 04 04 00 
0129+  C2D0 1F 01 02 0E 	.db 01Fh,001h,002h,00Eh,008h,010h,01Fh,000h ; 90
0129+  C2D4 08 10 1F 00 
0130+  C2D8 0E 08 08 08 	.db 00Eh,008h,008h,008h,008h,008h,00Eh,000h ; 91
0130+  C2DC 08 08 0E 00 
0131+  C2E0 00 10 08 04 	.db 000h,010h,008h,004h,002h,001h,000h,000h ; 92
0131+  C2E4 02 01 00 00 
0132+  C2E8 0E 02 02 02 	.db 00Eh,002h,002h,002h,002h,002h,00Eh,000h ; 93
0132+  C2EC 02 02 0E 00 
0133+  C2F0 0E 11 00 00 	.db 00Eh,011h,000h,000h,000h,000h,000h,000h ; 94
0133+  C2F4 00 00 00 00 
0134+  C2F8 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,01Fh,000h ; 95
0134+  C2FC 00 00 1F 00 
0135+  C300 00 08 04 02 	.db 000h,008h,004h,002h,000h,000h,000h,000h ; 96
0135+  C304 00 00 00 00 
0136+  C308 00 00 0E 01 	.db 000h,000h,00Eh,001h,00Fh,011h,00Fh,000h ; 97
0136+  C30C 0F 11 0F 00 
0137+  C310 10 10 10 1E 	.db 010h,010h,010h,01Eh,011h,011h,01Eh,000h ; 98
0137+  C314 11 11 1E 00 
0138+  C318 00 00 0F 10 	.db 000h,000h,00Fh,010h,010h,010h,00Fh,000h ; 99
0138+  C31C 10 10 0F 00 
0139+  C320 01 01 01 0F 	.db 001h,001h,001h,00Fh,011h,011h,00Fh,000h ; 100
0139+  C324 11 11 0F 00 
0140+  C328 00 00 0E 11 	.db 000h,000h,00Eh,011h,01Fh,010h,00Fh,000h ; 101
0140+  C32C 1F 10 0F 00 
0141+  C330 03 04 04 1F 	.db 003h,004h,004h,01Fh,004h,004h,004h,000h ; 102
0141+  C334 04 04 04 00 
0142+  C338 00 00 0F 11 	.db 000h,000h,00Fh,011h,00Fh,001h,011h,00Eh ; 103
0142+  C33C 0F 01 11 0E 
0143+  C340 10 10 10 1E 	.db 010h,010h,010h,01Eh,011h,011h,011h,000h ; 104
0143+  C344 11 11 11 00 
0144+  C348 00 04 00 0C 	.db 000h,004h,000h,00Ch,004h,004h,00Eh,000h ; 105
0144+  C34C 04 04 0E 00 
0145+  C350 02 00 02 02 	.db 002h,000h,002h,002h,002h,012h,00Ch,000h ; 106
0145+  C354 02 12 0C 00 
0146+  C358 10 10 12 14 	.db 010h,010h,012h,014h,018h,014h,012h,000h ; 107
0146+  C35C 18 14 12 00 
0147+  C360 0C 04 04 04 	.db 00Ch,004h,004h,004h,004h,004h,00Eh,000h ; 108
0147+  C364 04 04 0E 00 
0148+  C368 00 00 15 1F 	.db 000h,000h,015h,01Fh,015h,015h,015h,000h ; 109
0148+  C36C 15 15 15 00 
0149+  C370 00 00 1E 11 	.db 000h,000h,01Eh,011h,011h,011h,011h,000h ; 110
0149+  C374 11 11 11 00 
0150+  C378 00 00 0E 11 	.db 000h,000h,00Eh,011h,011h,011h,00Eh,000h ; 111
0150+  C37C 11 11 0E 00 
0151+  C380 00 00 1E 11 	.db 000h,000h,01Eh,011h,011h,01Eh,010h,010h ; 112
0151+  C384 11 1E 10 10 
0152+  C388 00 00 0F 11 	.db 000h,000h,00Fh,011h,011h,00Fh,001h,001h ; 113
0152+  C38C 11 0F 01 01 
0153+  C390 00 00 17 18 	.db 000h,000h,017h,018h,010h,010h,010h,000h ; 114
0153+  C394 10 10 10 00 
0154+  C398 00 00 0F 10 	.db 000h,000h,00Fh,010h,00Eh,001h,01Eh,000h ; 115
0154+  C39C 0E 01 1E 00 
0155+  C3A0 08 08 1E 08 	.db 008h,008h,01Eh,008h,008h,008h,007h,000h ; 116
0155+  C3A4 08 08 07 00 
0156+  C3A8 00 00 11 11 	.db 000h,000h,011h,011h,011h,011h,00Fh,000h ; 117
0156+  C3AC 11 11 0F 00 
0157+  C3B0 00 00 11 11 	.db 000h,000h,011h,011h,00Ah,00Ah,004h,000h ; 118
0157+  C3B4 0A 0A 04 00 
0158+  C3B8 00 00 11 11 	.db 000h,000h,011h,011h,015h,015h,00Ah,000h ; 119
0158+  C3BC 15 15 0A 00 
0159+  C3C0 00 00 11 0A 	.db 000h,000h,011h,00Ah,004h,00Ah,011h,000h ; 120
0159+  C3C4 04 0A 11 00 
0160+  C3C8 00 00 11 0A 	.db 000h,000h,011h,00Ah,004h,004h,004h,000h ; 121
0160+  C3CC 04 04 04 00 
0161+  C3D0 00 00 1F 02 	.db 000h,000h,01Fh,002h,004h,008h,01Fh,000h ; 122
0161+  C3D4 04 08 1F 00 
0162+  C3D8 03 04 04 08 	.db 003h,004h,004h,008h,004h,004h,003h,000h ; 123
0162+  C3DC 04 04 03 00 
0163+  C3E0 04 04 04 04 	.db 004h,004h,004h,004h,004h,004h,004h,000h ; 124
0163+  C3E4 04 04 04 00 
0164+  C3E8 18 04 04 02 	.db 018h,004h,004h,002h,004h,004h,018h,000h ; 125
0164+  C3EC 04 04 18 00 
0165+  C3F0 1F 00 00 00 	.db 01Fh,000h,000h,000h,000h,000h,000h,000h ; 126
0165+  C3F4 00 00 00 00 
0166+  C3F8 1F 1F 1F 1F 	.db 01Fh,01Fh,01Fh,01Fh,01Fh,01Fh,01Fh,01Fh ; 127
0166+  C3FC 1F 1F 1F 1F 
0167+  C400 00 00 12 15 	.db 000h,000h,012h,015h,01Dh,015h,012h,000h ; 128
0167+  C404 1D 15 12 00 
0168+  C408 00 00 0C 02 	.db 000h,000h,00Ch,002h,00Eh,012h,00Fh,000h ; 129
0168+  C40C 0E 12 0F 00 
0169+  C410 01 0E 18 1E 	.db 001h,00Eh,018h,01Eh,011h,011h,00Eh,000h ; 130
0169+  C414 11 11 0E 00 
0170+  C418 00 00 12 12 	.db 000h,000h,012h,012h,012h,012h,01Fh,001h ; 131
0170+  C41C 12 12 1F 01 
0171+  C420 00 00 06 0A 	.db 000h,000h,006h,00Ah,00Ah,00Ah,01Fh,011h ; 132
0171+  C424 0A 0A 1F 11 
0172+  C428 00 00 0E 11 	.db 000h,000h,00Eh,011h,01Fh,010h,00Fh,000h ; 133
0172+  C42C 1F 10 0F 00 
0173+  C430 00 04 0E 15 	.db 000h,004h,00Eh,015h,015h,015h,00Eh,004h ; 134
0173+  C434 15 15 0E 04 
0174+  C438 00 00 1F 10 	.db 000h,000h,01Fh,010h,010h,010h,010h,000h ; 135
0174+  C43C 10 10 10 00 
0175+  C440 00 00 11 0A 	.db 000h,000h,011h,00Ah,004h,00Ah,011h,000h ; 136
0175+  C444 04 0A 11 00 
0176+  C448 00 00 11 13 	.db 000h,000h,011h,013h,015h,019h,011h,000h ; 137
0176+  C44C 15 19 11 00 
0177+  C450 00 04 11 13 	.db 000h,004h,011h,013h,015h,019h,011h,000h ; 138
0177+  C454 15 19 11 00 
0178+  C458 00 00 11 12 	.db 000h,000h,011h,012h,014h,01Ch,013h,000h ; 139
0178+  C45C 14 1C 13 00 
0179+  C460 00 00 07 09 	.db 000h,000h,007h,009h,009h,009h,019h,000h ; 140
0179+  C464 09 09 19 00 
0180+  C468 00 00 11 1B 	.db 000h,000h,011h,01Bh,015h,011h,011h,000h ; 141
0180+  C46C 15 11 11 00 
0181+  C470 00 00 11 11 	.db 000h,000h,011h,011h,01Fh,011h,011h,000h ; 142
0181+  C474 1F 11 11 00 
0182+  C478 00 00 0E 11 	.db 000h,000h,00Eh,011h,011h,011h,00Eh,000h ; 143
0182+  C47C 11 11 0E 00 
0183+  C480 00 00 1F 11 	.db 000h,000h,01Fh,011h,011h,011h,011h,000h ; 144
0183+  C484 11 11 11 00 
0184+  C488 00 00 0F 11 	.db 000h,000h,00Fh,011h,00Fh,009h,011h,000h ; 145
0184+  C48C 0F 09 11 00 
0185+  C490 00 00 1E 11 	.db 000h,000h,01Eh,011h,011h,01Eh,010h,010h ; 146
0185+  C494 11 1E 10 10 
0186+  C498 00 00 0E 11 	.db 000h,000h,00Eh,011h,010h,011h,00Eh,000h ; 147
0186+  C49C 10 11 0E 00 
0187+  C4A0 00 00 1F 04 	.db 000h,000h,01Fh,004h,004h,004h,004h,000h ; 148
0187+  C4A4 04 04 04 00 
0188+  C4A8 00 00 11 11 	.db 000h,000h,011h,011h,00Fh,001h,01Eh,000h ; 149
0188+  C4AC 0F 01 1E 00 
0189+  C4B0 00 00 15 15 	.db 000h,000h,015h,015h,00Eh,015h,015h,000h ; 150
0189+  C4B4 0E 15 15 00 
0190+  C4B8 00 00 1C 12 	.db 000h,000h,01Ch,012h,01Eh,011h,01Eh,000h ; 151
0190+  C4BC 1E 11 1E 00 
0191+  C4C0 00 00 10 10 	.db 000h,000h,010h,010h,01Eh,011h,01Eh,000h ; 152
0191+  C4C4 1E 11 1E 00 
0192+  C4C8 00 00 11 11 	.db 000h,000h,011h,011h,01Dh,015h,01Dh,000h ; 153
0192+  C4CC 1D 15 1D 00 
0193+  C4D0 00 00 0E 11 	.db 000h,000h,00Eh,011h,006h,011h,00Eh,000h ; 154
0193+  C4D4 06 11 0E 00 
0194+  C4D8 00 00 15 15 	.db 000h,000h,015h,015h,015h,015h,01Fh,000h ; 155
0194+  C4DC 15 15 1F 00 
0195+  C4E0 00 00 1E 01 	.db 000h,000h,01Eh,001h,00Fh,001h,01Eh,000h ; 156
0195+  C4E4 0F 01 1E 00 
0196+  C4E8 00 00 15 15 	.db 000h,000h,015h,015h,015h,015h,01Fh,001h ; 157
0196+  C4EC 15 15 1F 01 
0197+  C4F0 00 00 11 11 	.db 000h,000h,011h,011h,00Fh,001h,001h,000h ; 158
0197+  C4F4 0F 01 01 00 
0198+  C4F8 00 00 18 08 	.db 000h,000h,018h,008h,00Eh,009h,00Eh,000h ; 159
0198+  C4FC 0E 09 0E 00 
0199+  C500 12 15 15 1D 	.db 012h,015h,015h,01Dh,015h,015h,012h,000h ; 160
0199+  C504 15 15 12 00 
0200+  C508 04 0A 11 11 	.db 004h,00Ah,011h,011h,01Fh,011h,011h,000h ; 161
0200+  C50C 1F 11 11 00 
0201+  C510 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,011h,011h,01Eh,000h ; 162
0201+  C514 11 11 1E 00 
0202+  C518 12 12 12 12 	.db 012h,012h,012h,012h,012h,012h,01Fh,001h ; 163
0202+  C51C 12 12 1F 01 
0203+  C520 06 0A 0A 0A 	.db 006h,00Ah,00Ah,00Ah,00Ah,00Ah,01Fh,011h ; 164
0203+  C524 0A 0A 1F 11 
0204+  C528 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,010h,010h,01Fh,000h ; 165
0204+  C52C 10 10 1F 00 
0205+  C530 04 1F 15 15 	.db 004h,01Fh,015h,015h,01Fh,004h,004h,000h ; 166
0205+  C534 1F 04 04 00 
0206+  C538 1F 11 10 10 	.db 01Fh,011h,010h,010h,010h,010h,010h,000h ; 167
0206+  C53C 10 10 10 00 
0207+  C540 11 11 0A 04 	.db 011h,011h,00Ah,004h,00Ah,011h,011h,000h ; 168
0207+  C544 0A 11 11 00 
0208+  C548 11 11 13 15 	.db 011h,011h,013h,015h,019h,011h,011h,000h ; 169
0208+  C54C 19 11 11 00 
0209+  C550 15 11 13 15 	.db 015h,011h,013h,015h,019h,011h,011h,000h ; 170
0209+  C554 19 11 11 00 
0210+  C558 11 12 14 18 	.db 011h,012h,014h,018h,014h,012h,011h,000h ; 171
0210+  C55C 14 12 11 00 
0211+  C560 03 05 09 09 	.db 003h,005h,009h,009h,009h,009h,019h,000h ; 172
0211+  C564 09 09 19 00 
0212+  C568 11 1B 15 15 	.db 011h,01Bh,015h,015h,011h,011h,011h,000h ; 173
0212+  C56C 11 11 11 00 
0213+  C570 11 11 11 1F 	.db 011h,011h,011h,01Fh,011h,011h,011h,000h ; 174
0213+  C574 11 11 11 00 
0214+  C578 0E 11 11 11 	.db 00Eh,011h,011h,011h,011h,011h,00Eh,000h ; 175
0214+  C57C 11 11 0E 00 
0215+  C580 1F 11 11 11 	.db 01Fh,011h,011h,011h,011h,011h,011h,000h ; 176
0215+  C584 11 11 11 00 
0216+  C588 0F 11 11 0F 	.db 00Fh,011h,011h,00Fh,005h,009h,011h,000h ; 177
0216+  C58C 05 09 11 00 
0217+  C590 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,010h,010h,010h,000h ; 178
0217+  C594 10 10 10 00 
0218+  C598 0E 11 10 10 	.db 00Eh,011h,010h,010h,010h,011h,00Eh,000h ; 179
0218+  C59C 10 11 0E 00 
0219+  C5A0 1F 04 04 04 	.db 01Fh,004h,004h,004h,004h,004h,004h,000h ; 180
0219+  C5A4 04 04 04 00 
0220+  C5A8 11 11 11 0A 	.db 011h,011h,011h,00Ah,004h,008h,010h,000h ; 181
0220+  C5AC 04 08 10 00 
0221+  C5B0 11 15 15 0E 	.db 011h,015h,015h,00Eh,015h,015h,011h,000h ; 182
0221+  C5B4 15 15 11 00 
0222+  C5B8 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,011h,011h,01Eh,000h ; 183
0222+  C5BC 11 11 1E 00 
0223+  C5C0 10 10 10 1E 	.db 010h,010h,010h,01Eh,011h,011h,01Eh,000h ; 184
0223+  C5C4 11 11 1E 00 
0224+  C5C8 11 11 11 19 	.db 011h,011h,011h,019h,015h,015h,019h,000h ; 185
0224+  C5CC 15 15 19 00 
0225+  C5D0 0E 11 01 06 	.db 00Eh,011h,001h,006h,001h,011h,00Eh,000h ; 186
0225+  C5D4 01 11 0E 00 
0226+  C5D8 11 15 15 15 	.db 011h,015h,015h,015h,015h,015h,01Fh,000h ; 187
0226+  C5DC 15 15 1F 00 
0227+  C5E0 0E 11 01 07 	.db 00Eh,011h,001h,007h,001h,011h,00Eh,000h ; 188
0227+  C5E4 01 11 0E 00 
0228+  C5E8 15 15 15 15 	.db 015h,015h,015h,015h,015h,015h,01Fh,001h ; 189
0228+  C5EC 15 15 1F 01 
0229+  C5F0 11 11 11 1F 	.db 011h,011h,011h,01Fh,001h,001h,001h,000h ; 190
0229+  C5F4 01 01 01 00 
0230+  C5F8 3F 3F 3F 3F 	.db 03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,03Fh
0230+  C5FC 3F 3F 3F 3F 
0231+  C600             
0232+  C600             #undef DY0123   C600             
0124   C600 81 0C 19 1A keybMap:	.db 81h, 0ch, 19h, 1ah, 20h, 20h, 20h, 08h, 09h, 18h, 0ah, 0dh ; Нижняя строка клавиатуры
0124   C604 20 20 20 08 
0124   C608 09 18 0A 0D 
0125   C60C 00 C0       v_charGenPtr:	.dw charGen
0126   C60E 00 C6       v_keybMap:	.dw keybMap
0127   C610 51 5E 53 4D 		.db 51h, 5Eh, 53h, 4Dh,	49h, 54h, 58h, 42h, 40h, 2Ch, 2Fh, 5Fh ; Q^SMITXB@,/_
0127   C614 49 54 58 42 
0127   C618 40 2C 2F 5F 
0128   C61C BB FF       v_aramPageEnd:	.dw ARAM_PAGE_END
0129   C61E 00 00       v_aramPageStart:.dw 0
0130   C620 46 59 57 41 		.db 46h, 59h, 57h, 41h,	50h, 52h, 4Fh, 4Ch, 44h, 56h, 5Ch, 2Eh; FYWAPROLDV\.
0130   C624 50 52 4F 4C 
0130   C628 44 56 5C 2E 
0131   C62C 00          v_koi8:		.db 0	; КОИ-7=FF / КОИ-8=00
0132   C62D 00          v_rusLat:	.db 0	; РУС=FF / LAT=00
0133   C62E 00          v_capsLock:	.db 0	; BP=00 / HP=02
0134   C62F 00          v_printerEcho:	.db 0
0135   C630 4A 43 55 4B 		.db 4Ah, 43h, 55h, 4Bh, 45h, 4Eh, 47h, 5Bh, 5Dh, 5Ah, 48h, 3Ah ; JCUKENG[]ZH:
0135   C634 45 4E 47 5B 
0135   C638 5D 5A 48 3A 
0136   C63C B1          v_selColor:	.db 0B1h
0137   C63D 00          v_aramMaxPage:	.db 0			; Номер	последней страницы RAM-диска
0138   C63E 00 00       v_cursorPos:	.dw 0			; Положение курсора в пикселях
0139   C640 3B 31 32 33 		.db 3Bh, 31h, 32h, 33h,	34h, 35h, 36h, 37h, 38h, 39h, 30h, 2Dh ; ;1234567890-
0139   C644 34 35 36 37 
0139   C648 38 39 30 2D 
0140   C64C 05 0A       v_beepConfig:	.dw 0A05h
0141   C64E 00 00       v_oldBeep:	.dw 0
0142   C650 1B 8A 00 01 		.db 1Bh, 8Ah, 0, 1, 2, 3, 4, 5,	6, 8Bh,	8Ch, 1Fh ; Верхняя строка клавиатуры
0142   C654 02 03 04 05 
0142   C658 06 8B 8C 1F 
0143   C65C 00          v_inverse:	.db 0
0144   C65D 00          		.db 0
0145   C65E 0F          v_aramMaxPageI:	.db ARAM_MAX_PAGE
0146   C65F 30          v_tapeMode:	.db '0'
0147   C660 2C 32       v_tapePulseB:	.dw 322Ch	; 1200 Бод
0148   C662 12 18       v_tapePulseA:	.dw 1812h
0149   C664 1B 21       v_tapePulseB2:	.dw 211Bh	; 1800 Бод
0150   C666 09 0F       v_tapePulseA2:	.dw 0F09h
0151   C668 12 18       v_tapePulseB3:	.dw 1812h	; 2400 Бод
0152   C66A 05 0B       v_tapePulseA3:	.dw 0B05h
0153   C66C             v_tapePresets:
0154   C66C             
0155   C66C             ; ===========================================================================
0156   C66C             ; КОД
0157   C66C             
0158   C66C             .org 0C66Ch
0159   C66C             
0160   C66C             .include "tapeReadPilot.inc"
0001+  C66C             ;----------------------------------------------------------------------------
0002+  C66C             ; RAMFOS
0003+  C66C             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C824
0004+  C66C             ; ╫Єхэшх яшыюЄ Єюэр ё ыхэЄ√
0005+  C66C             ;
0006+  C66C             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  C66C             ;----------------------------------------------------------------------------
0008+  C66C             
0009+  C66C E5          tapeReadPilot:	push	h
0010+  C66D D5          		push	d
0011+  C66E C5          		push	b
0012+  C66F             
0013+  C66F             		; ╧ЁюьхцєЄюўэ√щ рфЁхё тючтЁрЄр
0014+  C66F 21 98 CB    		lxi	h, popa_ret
0015+  C672 E5          		push	h
0016+  C673             
0017+  C673             		; ╧юЁЄ ьруэшЄюЇюэр
0018+  C673 21 E1 FF    		lxi	h, IO_KEYB_B
0019+  C676             
0020+  C676 1E 01       		mvi	e, 1		
0021+  C678 16 00       loc_C678:	 mvi	d, 0
0022+  C67A 41          loc_C67A:	 mov	b, c
0023+  C67B CD AB C6    		 call	tapeWaitC3
0024+  C67E 79          		 mov	a, c
0025+  C67F 90          		 sub	b
0026+  C680 D2 84 C6    		 jnc	loc_C684
0027+  C683 2F          		  cma
0028+  C684 FE 03       loc_C684:	 cpi	3
0029+  C686 D2 78 C6    		jnc	loc_C678
0030+  C689 15          		dcr	d
0031+  C68A C2 7A C6    		jnz	loc_C67A
0032+  C68D             
0033+  C68D CD AB C6    		call	tapeWaitC3
0034+  C690             
0035+  C690             		; ╧ютЄюЁшЄ№ D Ёрч
0036+  C690 01 00 01    		lxi	b, 100h		
0037+  C693 CD AD C6    loc_C693:	 call	tapeWait
0038+  C696 03          		 inx	b
0039+  C697 03          		 inx	b
0040+  C698 15          		 dcr	d
0041+  C699 C2 93 C6    		jnz	loc_C693
0042+  C69C             
0043+  C69C 69          		mov	l, c
0044+  C69D 60          		mov	h, b
0045+  C69E B7          		ora	a
0046+  C69F             
0047+  C69F             		; bc >>= 1
0048+  C69F 78          		mov	a, b
0049+  C6A0 1F          		rar
0050+  C6A1 47          		mov	b, a
0051+  C6A2 79          		mov	a, c
0052+  C6A3 1F          		rar
0053+  C6A4 4F          		mov	c, a
0054+  C6A5             
0055+  C6A5 09          		dad	b
0056+  C6A6 6B          		mov	l, e
0057+  C6A7 22 F0 D1    		shld	v_tape
0058+  C6AA C9          		ret
0161   C6AB             .include "tapeWait.inc"
0001+  C6AB             ;+---------------------------------------------------------------------------
0002+  C6AB             ; RAMFOS
0003+  C6AB             ; ╬цшфрэшх шчьхэхэш  яюЁЄр ьруэшЄюЇюэр ш чрьхЁ тЁхьхэш т bё
0004+  C6AB             ;
0005+  C6AB             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  C6AB             ;----------------------------------------------------------------------------
0007+  C6AB             
0008+  C6AB 0E 03       tapeWaitC3:	mvi	c, 3
0009+  C6AD 7B          tapeWait:	mov	a, e
0010+  C6AE EE 01       		xri	1
0011+  C6B0 5F          		mov	e, a		
0012+  C6B1 03          tapeWait_0:	 inx	b
0013+  C6B2 7E          		 mov	a, m
0014+  C6B3 AB          		 xra	e
0015+  C6B4 E2 B1 C6    		jpo	tapeWait_0
0016+  C6B7 0F          		rrc
0017+  C6B8 0F          		rrc
0018+  C6B9 D8          		rc
0019+  C6BA E1          		pop	h
0020+  C6BB C3 0B C7    		jmp	tapeError0162   C6BE             .include "tapeRead.inc"
0001+  C6BE             ;----------------------------------------------------------------------------
0002+  C6BE             ; RAMFOS
0003+  C6BE             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C806
0004+  C6BE             ; ╫Єхэшх срщЄр ё ыхэЄр
0005+  C6BE             ;
0006+  C6BE             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  C6BE             ;----------------------------------------------------------------------------
0008+  C6BE             
0009+  C6BE E5          tapeRead:	push	h
0010+  C6BF D5          		push	d
0011+  C6C0 C5          		push	b
0012+  C6C1             
0013+  C6C1             		; ╧ЁюьхцєЄюўэ√щ рфЁхё тючтЁрЄр
0014+  C6C1 21 98 CB    		lxi	h, popa_ret
0015+  C6C4 E5          		push	h
0016+  C6C5             
0017+  C6C5 2A F0 D1    		lhld	v_tape
0018+  C6C8 EB          		xchg
0019+  C6C9 21 E1 FF    		lxi	h, 0FFE1h
0020+  C6CC             
0021+  C6CC 06 08       		mvi	b, 8
0022+  C6CE CD AB C6    tapeRead_0:	 call	tapeWaitC3
0023+  C6D1 79          		 mov	a, c
0024+  C6D2 BA          		 cmp	d
0025+  C6D3 DA CE C6    		 jc	tapeRead_0
0026+  C6D6 CD AB C6    		 call	tapeWaitC3
0027+  C6D9 79          		 mov	a, c
0028+  C6DA BA          		 cmp	d
0029+  C6DB DA CE C6    		jc	tapeRead_0
0030+  C6DE             
0031+  C6DE CD AB C6    tapeRead_1:	 call	tapeWaitC3
0032+  C6E1 3A F1 D1    		 lda	v_tape+1
0033+  C6E4 B9          		 cmp	c
0034+  C6E5 3F          		 cmc
0035+  C6E6 7A          		 mov	a, d
0036+  C6E7 1F          		 rar
0037+  C6E8 57          		 mov	d, a
0038+  C6E9 CD AB C6    		 call	tapeWaitC3
0039+  C6EC 05          		 dcr	b
0040+  C6ED C2 DE C6    		jnz	tapeRead_1
0041+  C6F0             
0042+  C6F0 CD AB C6    		call	tapeWaitC3
0043+  C6F3 7B          		mov	a, e
0044+  C6F4 EE 01       		xri	1
0045+  C6F6 32 F0 D1    		sta	v_tape
0046+  C6F9 3A F1 D1    		lda	v_tape+1
0047+  C6FC B9          		cmp	c
0048+  C6FD 3F          		cmc
0049+  C6FE 17          		ral
0050+  C6FF 4F          		mov	c, a
0051+  C700 7A          		mov	a, d
0052+  C701 B7          		ora	a
0053+  C702 F5          		push	psw
0054+  C703 D1          		pop	d
0055+  C704 7B          		mov	a, e
0056+  C705 1F          		rar
0057+  C706 1F          		rar
0058+  C707 A9          		xra	c
0059+  C708 1F          		rar
0060+  C709 7A          		mov	a, d
0061+  C70A D0          		rnc
0062+  C70B             
0063+  C70B 3E 3F       tapeError:	mvi	a, 3Fh
0064+  C70D 37          		stc
0065+  C70E C9          		ret
0163   C70F             .include "tapeWritePilot.inc"
0001+  C70F             ;+---------------------------------------------------------------------------
0002+  C70F             ; RAMFOS
0003+  C70F             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C827
0004+  C70F             ; ╟ряшё№ яшыюЄ Єюэр эр ьруэшЄюЇюэ
0005+  C70F             ;
0006+  C70F             ; ╤юїЁрэ хЄ ЁхушёЄЁ√ BC,DE,HL
0007+  C70F             ;
0008+  C70F             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0009+  C70F             ;----------------------------------------------------------------------------
0010+  C70F             
0011+  C70F             tapeWritePilot:	; ╤юїЁрэ хь BC, HL
0012+  C70F E5          		push	h
0013+  C710 C5          		push	b		
0014+  C711             
0015+  C711             		; ─ышЄхы№эюёЄ№ яшыюЄ-Єюэр BC. ╤ЄЁрээ√щ ъєёюъ ъюфр.
0016+  C711             		; bc = (40 - v_tapePulseAL)*514
0017+  C711 2A 62 C6    		lhld	v_tapePulseA
0018+  C714 3E 28       		mvi	a, 40
0019+  C716 94          		sub	h
0020+  C717 87          		add	a
0021+  C718 47          		mov	b, a
0022+  C719 4F          		mov	c, a		
0023+  C71A             
0024+  C71A             tapeWritePilot_0:
0025+  C71A             		 ; ╙ьхэ№°рхь BC 
0026+  C71A 0B          		 dcx	b
0027+  C71B             
0028+  C71B             		 ; ╟рфхЁцър, ЁхушёЄЁ√ эшўхую яюыхчэюую эх ёюфхЁцрЄ
0029+  C71B 29          		 dad	h
0030+  C71C 78          		 mov	a, b
0031+  C71D             
0032+  C71D             		 ; ╚ьяєы№ё └
0033+  C71D CD 66 C7    		 call	tapePulseA		 
0034+  C720             
0035+  C720             		 ; ╧ютЄюЁ Є№ яюър BC эх эєыхтюх
0036+  C720 78          		 mov	a, b
0037+  C721 B1          		 ora	c
0038+  C722 C2 1A C7    		jnz	tapeWritePilot_0
0039+  C725             
0040+  C725             		; ┬юёёЄрэрыштрхь BC, HL
0041+  C725 C1          		pop	b
0042+  C726 E1          		pop	h
0043+  C727 C9          		ret
0164   C728             .include "tapeWrite.inc"
0001+  C728             ;+---------------------------------------------------------------------------
0002+  C728             ; RAMFOS
0003+  C728             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C80╤
0004+  C728             ; ╟ряшё№ срщЄр эр ьруэшЄюЇюэ
0005+  C728             ;
0006+  C728             ; ═р тїюфх
0007+  C728             ;  ╤ - срщЄ
0008+  C728             ;  A - єъюЁюўхэшх яхЁтюую шьяєы№ёр *15 ЄръЄют
0009+  C728             ;
0010+  C728             ; ╤юїЁрэ хЄ ЁхушёЄЁ√ BC,DE,HL
0011+  C728             ;
0012+  C728             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0013+  C728             ;----------------------------------------------------------------------------
0014+  C728             
0015+  C728 E5          tapeWrite:	push	h
0016+  C729 C5          		push	b
0017+  C72A 2A 60 C6    		 lhld	v_tapePulseB
0018+  C72D C6 03       		 adi	3
0019+  C72F 2F          		 cma
0020+  C730 85          		 add	l
0021+  C731 6F          		 mov	l, a
0022+  C732 CD 6C C7    		 call	tapePulse
0023+  C735 B7          		 ora	a
0024+  C736 B7          		 ora	a
0025+  C737 06 08       		 mvi	b, 8				
0026+  C739 CD 4D C7    tapeWrite_0:	  call	tapePulseBit
0027+  C73C 05          		  dcr	b
0028+  C73D C2 39 C7    		 jnz	tapeWrite_0
0029+  C740 CD 59 C7    		 call	tapeWriteEnd
0030+  C743 E5          		 push	h
0031+  C744 E5          		 push	h
0032+  C745 CD 66 C7    		  call	tapePulseA
0033+  C748 E1          		 pop	h
0034+  C749 E1          		 pop	h
0035+  C74A C1          		pop	b
0036+  C74B E1          		pop	h
0037+  C74C C9          		ret
0038+  C74D             
0039+  C74D             ; ---------------------------------------------------------------------------
0040+  C74D             
0041+  C74D 79          tapePulseBit:	mov	a, c
0042+  C74E 0F          		rrc
0043+  C74F 4F          		mov	c, a
0044+  C750 DA 66 C7    		jc	tapePulseA
0045+  C753 2A 60 C6    tapePulseB:	lhld	v_tapePulseB
0046+  C756 C3 6C C7    		jmp	tapePulse
0047+  C759             
0048+  C759             ; ---------------------------------------------------------------------------
0049+  C759             
0050+  C759 79          tapeWriteEnd:	mov	a, c
0051+  C75A B7          		ora	a
0052+  C75B 4F          		mov	c, a
0053+  C75C E2 53 C7    		jpo	tapePulseB
0054+  C75F 2A 62 C6    		lhld	v_tapePulseA
0055+  C762 2D          		dcr	l
0056+  C763 CD 6C C7    		call	tapePulse
0057+  C766 2A 62 C6    tapePulseA:	lhld	v_tapePulseA
0058+  C769 C3 6C C7    		jmp	tapePulse
0165   C76C             .include "tapePulse.inc"
0001+  C76C             ;----------------------------------------------------------------------------
0002+  C76C             ; RAMFOS
0003+  C76C             ; ╟ряшё№ сшЄр эр ьруэшЄюЇюэ
0004+  C76C             ;
0005+  C76C             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  C76C             ;----------------------------------------------------------------------------
0007+  C76C             
0008+  C76C             tapePulse:	; ╟рфхЁцър эр L
0009+  C76C 2D          		dcr	l		
0010+  C76D F2 6C C7    		jp	tapePulse
0011+  C770             
0012+  C770             		; ┬√ёюъшщ єЁютхэ№
0013+  C770 3E 0F       		mvi	a, 0Fh		
0014+  C772 32 E3 FF    		sta	IO_KEYB_MODE	
0015+  C775             
0016+  C775             		; ╟рфхЁцър эр H	
0017+  C775 25          tapePulse_0:	dcr	h		
0018+  C776 F2 75 C7    		jp	tapePulse_0
0019+  C779             
0020+  C779             		; ═шчъшщ єЁютхэ№
0021+  C779 3E 0E       		mvi	a, 0Eh		
0022+  C77B 32 E3 FF    		sta	IO_KEYB_MODE
0023+  C77E C9          		ret0166   C77F             .include "strToHex.inc"
0001+  C77F             ;+---------------------------------------------------------------------------
0002+  C77F             ; RAMFOS
0003+  C77F             ; ╧ЁхюсЁрчтюэшх ёЄЁюъш т 16-Ёшўэюх ўшёыю
0004+  C77F             ;
0005+  C77F             ; ═р тїюфх
0006+  C77F             ;  de - ╤ЄЁюър
0007+  C77F             ;
0008+  C77F             ; ═р т√їюфх
0009+  C77F             ;  bc       - ╤юїЁрэ хЄё 
0010+  C77F             ;  de       - ╤ыхфє■∙шщ ёшьтюы чр чря Єющ шыш ъюэЎюь ёЄЁюъш
0011+  C77F             ;  jz       - ╬°шсър
0012+  C77F             ;  jnz, jc  - ╩юэхЎ ёЄЁюъш
0013+  C77F             ;  jnz, jnc - ╧Ёюсхы шыш чря Єр 
0014+  C77F             ;  hl       - ╫шёыю
0015+  C77F             ;
0016+  C77F             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0017+  C77F             ;----------------------------------------------------------------------------
0018+  C77F             
0019+  C77F             strToHex:
0020+  C77F~            #if SIZE_OPTIMIZATION==0
0021+  C77F~            		push	b
0022+  C77F~            		 call	strToHex2
0023+  C77F~            		pop	b
0024+  C77F~            		ret
0025+  C77F             #endif
0026+  C77F             
0027+  C77F             ; ---------------------------------------------------------------------------
0028+  C77F             
0029+  C77F 21 00 00    strToHex2:	lxi	h, 0		
0030+  C782~            #if SIZE_OPTIMIZATION==0
0031+  C782~            		mvi	b, 0		
0032+  C782             #endif
0033+  C782             
0034+  C782             strToHex2_loop:	; ╫Єхэшх ёшьтюыр
0035+  C782 1A          		ldax	d
0036+  C783 13          		inx	d
0037+  C784             
0038+  C784             		; ┼ёыш ъюэхЎ ёЄЁюъш, т√їюфшь ё Їырурьш NZ, C
0039+  C784 FE 0D       		cpi	0Dh
0040+  C786 CA B0 C8    		jz	ora_a_stc_ret
0041+  C789             
0042+  C789             		; ┼ёыш яЁюсхы шыш чря Єр , т√їюфшь ё Їырурьш NZ, NC
0043+  C789 FE 2C       		cpi	','
0044+  C78B CA 03 CF    		jz	ora_a_ret		
0045+  C78E FE 20       		cpi	' '
0046+  C790 CA 03 CF    		jz	ora_a_ret
0047+  C793             
0048+  C793             		; ┼ёыш эхъюЁЁхъЄэ√щ ёшьтюы, т√їюфшь ё Їырурьш ╤,Z
0049+  C793 D6 30       		sui	'0'
0050+  C795 FA AA C8    		jm	xra_a_stc_ret		
0051+  C798             
0052+  C798             		; ┼ёыш ¤Єю ЎшЇЁр
0053+  C798 FE 0A       		cpi	10
0054+  C79A FA A9 C7    		jm	strToHex2_0
0055+  C79D             
0056+  C79D             		; ┼ёыш эхъюЁЁхъЄэ√щ ёшьтюы, т√їюфшь ё Їырурьш ╤,Z
0057+  C79D FE 11       		cpi	11h
0058+  C79F FA AA C8    		jm	xra_a_stc_ret
0059+  C7A2 FE 17       		cpi	17h
0060+  C7A4 F2 AA C8    		jp	xra_a_stc_ret
0061+  C7A7             
0062+  C7A7             		; ▌Єю сєът√ A..F
0063+  C7A7 D6 07       		sui	'A'-'0'-10
0064+  C7A9             
0065+  C7A9             strToHex2_0:	
0066+  C7A9~            #if SIZE_OPTIMIZATION==0
0067+  C7A9~            		mov	c, a
0068+  C7A9             #endif
0069+  C7A9             		; hl *=	16
0070+  C7A9 29          		dad	h
0071+  C7AA 29          		dad	h
0072+  C7AB 29          		dad	h
0073+  C7AC 29          		dad	h
0074+  C7AD             
0075+  C7AD             		; ┼ёыш яхЁхяюыэхэшх, Єю	т√щЄш c Їырурьш ╤,Z
0076+  C7AD DA AA C8    		jc	xra_a_stc_ret
0077+  C7B0             		
0078+  C7B0             		; hl += bc
0079+  C7B0             #if SIZE_OPTIMIZATION
0080+  C7B0 C5          		push	b
0081+  C7B1 06 00       		mvi	b, 0
0082+  C7B3 4F          		mov	c, a
0083+  C7B4             #endif
0084+  C7B4 09          		dad	b
0085+  C7B5             #if SIZE_OPTIMIZATION
0086+  C7B5 C1          		pop	b
0087+  C7B6             #endif
0088+  C7B6 C3 82 C7    		jmp	strToHex2_loop0167   C7B9             .include "calcCrc.inc"
0001+  C7B9             ;+---------------------------------------------------------------------------
0002+  C7B9             ; RAMFOS
0003+  C7B9             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C82A
0004+  C7B9             ; ╨рёўхЄ ъюэЄЁюы№эющ ёєьь√
0005+  C7B9             ;
0006+  C7B9             ; ═р тїюфх
0007+  C7B9             ;  hl - эрўры№э√щ рфЁхё
0008+  C7B9             ;  de - ъюэхўэ√щ рфЁхё
0009+  C7B9             ;
0010+  C7B9             ; ═р т√їюфх
0011+  C7B9             ;  bc - ёєььр
0012+  C7B9             ;
0013+  C7B9             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0014+  C7B9             ;----------------------------------------------------------------------------
0015+  C7B9             
0016+  C7B9 01 00 00    calcCrc:	lxi	b, 0
0017+  C7BC 7E          calcCrc_0:	 mov	a, m
0018+  C7BD 81          		 add	c
0019+  C7BE 4F          		 mov	c, a
0020+  C7BF F5          		 push	psw
0021+  C7C0 CD 5D C8    		  call	cmp_hl_de
0022+  C7C3 CA 8E CB    		  jz	pop_psw_ret
0023+  C7C6 F1          		 pop	psw
0024+  C7C7 78          		 mov	a, b
0025+  C7C8 8E          		 adc	m
0026+  C7C9 47          		 mov	b, a
0027+  C7CA CD 5D C8    		 call	cmp_hl_de
0028+  C7CD C8          		 rz
0029+  C7CE 23          		 inx	h
0030+  C7CF C3 BC C7    		jmp	calcCrc_0
0168   C7D2             .include "pushPopCursor.inc"
0001+  C7D2             ;+---------------------------------------------------------------------------
0002+  C7D2             ; RAMFOS
0003+  C7D2             ; ╟ряюьшэрэшх ъєЁёюЁр ёЄЁюъш
0004+  C7D2             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 8Dh 
0005+  C7D2             ;
0006+  C7D2             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  C7D2             ;----------------------------------------------------------------------------
0008+  C7D2             
0009+  C7D2 2A 3E C6    pushCursorLine:	lhld	v_cursorPos
0010+  C7D5 22 20 D2    		shld	v_pushCursorLn
0011+  C7D8 C9          		ret
0012+  C7D9              
0013+  C7D9             ;----------------------------------------------------------------------------
0014+  C7D9             ; RAMFOS
0015+  C7D9             ; ┬юёёЄрэютэшх ъюфр ЎтхЄр шч ёЄхър
0016+  C7D9             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 87h
0017+  C7D9             ;
0018+  C7D9             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0019+  C7D9             ;----------------------------------------------------------------------------
0020+  C7D9             
0021+  C7D9 2A 20 D2    popCursorLine:	lhld	v_pushCursorLn
0022+  C7DC C3 E9 C7    		jmp	setCursorPosPx
0023+  C7DF             		
0024+  C7DF             ;----------------------------------------------------------------------------
0025+  C7DF             ; RAMFOS
0026+  C7DF             ; ╟ряюьшэрэшх ъєЁёюЁр ¤ъЁрэр
0027+  C7DF             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 93h
0028+  C7DF             ;
0029+  C7DF             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0030+  C7DF             ;----------------------------------------------------------------------------
0031+  C7DF             
0032+  C7DF 2A 3E C6    pushCursor:	lhld	v_cursorPos
0033+  C7E2 22 22 D2    		shld	v_pushCursor
0034+  C7E5 C9          		ret
0035+  C7E6             
0036+  C7E6             ;----------------------------------------------------------------------------
0037+  C7E6             ; RAMFOS
0038+  C7E6             ; ┬юёёЄрэютыхэшх ъєЁёюЁр ¤ъЁрэр
0039+  C7E6             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 94h 
0040+  C7E6             ;
0041+  C7E6             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0042+  C7E6             ;----------------------------------------------------------------------------
0043+  C7E6             
0044+  C7E6 2A 22 D2    popCursor:	lhld	v_pushCursor
0045+  C7E9 22 3E C6    setCursorPosPx:	shld	v_cursorPos
0046+  C7EC C9          		ret
0047+  C7ED             
0169   C7ED             .include "setGetMemTop.inc"
0001+  C7ED             ;+---------------------------------------------------------------------------
0002+  C7ED             ; RAMFOS
0003+  C7ED             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C830
0004+  C7ED             ; ╧юыєўхэшх тхЁїэхщ уЁрэшЎ√ ╬╟╙
0005+  C7ED             ;
0006+  C7ED             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  C7ED             ;----------------------------------------------------------------------------
0008+  C7ED             
0009+  C7ED 2A 27 D2    getMemTop:	lhld	v_memTop
0010+  C7F0 C9          		ret
0011+  C7F1             
0012+  C7F1             ;----------------------------------------------------------------------------
0013+  C7F1             ; RAMFOS
0014+  C7F1             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C833
0015+  C7F1             ; ╙ёЄрэюър тхЁїэхщ уЁрэшЎ√ ╬╟╙
0016+  C7F1             ;
0017+  C7F1             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0018+  C7F1             ;----------------------------------------------------------------------------
0019+  C7F1             
0020+  C7F1             
0021+  C7F1 22 27 D2    setMemTop:	shld	v_memTop
0022+  C7F4 C9          		ret
0023+  C7F5             
0170   C7F5             .include "pushColor.inc"
0001+  C7F5             ;+---------------------------------------------------------------------------
0002+  C7F5             ; RAMFOS
0003+  C7F5             ; ╟ряюьшэрэшх ъюфр ЎтхЄр яю яЁшэЎшяє ёЄхър (уыєсшэр 2 ЎтхЄр)
0004+  C7F5             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 88h
0005+  C7F5             ;
0006+  C7F5             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  C7F5             ;----------------------------------------------------------------------------
0008+  C7F5             
0009+  C7F5 2A 35 D2    pushColor:	lhld	v_color
0010+  C7F8 22 36 D2    		shld	v_pushColor
0011+  C7FB C9          		ret0171   C7FC             
0172   C7FC~            #if $ > 0C800h
0173   C7FC~            Ошибка_часть_C000_не_влезла
0174   C7FC             #endif
0175   C800             .org 0C800h
0176   C800             
0177   C800             .include "c800.inc"
0001+  C800             ;+---------------------------------------------------------------------------
0002+  C800             ; RAMFOS
0003+  C800             ; ╥юўъш тїюфр
0004+  C800             ;
0005+  C800             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  C800             ;----------------------------------------------------------------------------
0007+  C800             
0008+  C800 C3 E6 C8    j_biosInit:		jmp	biosInit
0009+  C803 C3 F0 CE    j_keyWait:		jmp	keyWait
0010+  C806 C3 BE C6    j_tapeRead:		jmp	tapeRead
0011+  C809 C3 90 CB    j_printChar:		jmp     printChar
0012+  C80C C3 28 C7    j_tapeWrite:		jmp	tapeWrite
0013+  C80F C3 DF C8    j_printCharA:		jmp	printCharA
0014+  C812 C3 3D CF    j_keyCheck:		jmp	keyCheck
0015+  C815 C3 76 CB    j_printHex:		jmp	printHex
0016+  C818 C3 4B C9    j_printString:		jmp	printString
0017+  C81B C3 81 CF    j_keyScan:		jmp	keyScan
0018+  C81E C3 A5 CD    j_getCursorPos:		jmp	getCursorPos
0019+  C821 C3 F3 CA    j_getCharFromScr:	jmp	getCharFromScreen
0020+  C824 C3 6C C6    j_tapeReadPilot:	jmp	tapeReadPilot
0021+  C827 C3 0F C7    j_tapeWritePilot:	jmp     tapeWritePilot
0022+  C82A C3 B9 C7    j_calcCrc:		jmp     calcCrc
0023+  C82D C3 56 CA    j_setBottomLine:	jmp     setBottomLine
0024+  C830 C3 ED C7    j_getMemTop:		jmp	getMemTop
0025+  C833 C3 F1 C7    j_setMemTop:		jmp     setMemTop
0026+  C836 C3 8D CA    j_input:		jmp     input
0027+  C839 C3 7F C7    j_strToHex:		jmp	strToHex
0028+  C83C C3 88 CD    j_setCursorPos:		jmp	setCursorPos
0029+  C83F C3 E6 D0    			jmp	printer
0030+  C842 C3 E6 D0    			jmp	printerHex
0031+  C845 C3 63 C8    j_inputFileName:	jmp     inputFileName
0032+  C848 C3 8F D0    			jmp	beep
0033+  C84B C3 0B D1    			jmp	setColor
0034+  C84E C3 6D CB    			jmp	fullClearScreen
0035+  C851 C3 6B D0    			jmp	oldBeep
0036+  C854 C3 5D C8    j_cmp_hl_de:		jmp     cmp_hl_de
0037+  C857 C3 E6 D0    j_printerEchoMode:	jmp	printerEchoMode
0038+  C85A C3 BE D0    j_tapeMode:		jmp	tapeMode
0178   C85D             .include "cmp_hl_de.inc"
0001+  C85D             ;+---------------------------------------------------------------------------
0002+  C85D             ; RAMFOS
0003+  C85D             ; ╤ЁртэшЄ№ ЁхушёЄЁ√ HL ш DE
0004+  C85D             ;
0005+  C85D             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  C85D             ;----------------------------------------------------------------------------
0007+  C85D             
0008+  C85D 7C          cmp_hl_de:	mov	a, h
0009+  C85E BA          		cmp	d
0010+  C85F C0          		rnz
0011+  C860 7D          		mov	a, l
0012+  C861 BB          		cmp	e
0013+  C862 C9          		ret0179   C863             .include "inputFileName.inc"
0001+  C863             ;+---------------------------------------------------------------------------
0002+  C863             ; RAMFOS
0003+  C863             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C845
0004+  C863             ; ┬тютюф шьхэш Їрщыр ё ъыртшрЄєЁ√ т v_header2_name
0005+  C863             ;
0006+  C863             ; 2013-11-01 vinxru
0007+  C863             ;----------------------------------------------------------------------------
0008+  C863             
0009+  C863 E5          inputFileName:	push	h
0010+  C864 D5          		push	d
0011+  C865 C5          		push	b
0012+  C866             
0013+  C866             		; ╧ЁюьхцєЄюўэ√щ рфЁхё тючтЁрЄр
0014+  C866 21 98 CB    		lxi	h, popa_ret
0015+  C869 E5          		push	h
0016+  C86A             
0017+  C86A              		; ┬√тюфшь ёююс∙хэшх эр ¤ъЁрэ ш ёюїЁрэшь ъєЁёюЁ ёЄЁюъш
0018+  C86A 21 AD D1    		lxi	h, a_inputFileName
0019+  C86D CD 4B C9    		call	printString
0020+  C870             
0021+  C870             		; ╙фрышь шч шьхэш Їрщыр тёх ыхт√х ёшьтюы√
0022+  C870 CD B8 C8    		call	printFileName2
0023+  C873             
0024+  C873             loc_C873:	; ┬юёёЄрэютшЄ№ ъєЁёюЁ ёЄЁюъш
0025+  C873 CD D9 C7    		call	popCursorLine
0026+  C876             
0027+  C876             		; ┬тюф шьхэш Їрщыр
0028+  C876 21 F5 D1    		lxi	h, v_header2_name
0029+  C879 11 FF 0C    		lxi	d, 0CFFh
0030+  C87C CD 8D CA    		call	input
0031+  C87F             
0032+  C87F             		; ═рцрЄ ESC
0033+  C87F C8          		rz
0034+  C880             
0035+  C880             		; ═рцрЄр ыхтр  ъыртш°р, т√тхёЄш чэръ тюяЁюёр ш тхЁэєЄ№ё  ъ ттюфє
0036+  C880 21 73 C8    		lxi	h, loc_C873
0037+  C883 E5          		push	h
0038+  C884 D2 AA C8    		jnc	xra_a_stc_ret
0039+  C887             
0040+  C887             		; ╤фтшэєЄ№ ъєЁёюЁ
0041+  C887 2A 20 D2    		lhld	v_pushCursorLn
0042+  C88A 7C          		mov	a, h
0043+  C88B C6 18       		adi	3*8
0044+  C88D 67          		mov	h, a
0045+  C88E 22 3E C6    		shld	v_cursorPos
0046+  C891             
0047+  C891             		; ╨рчфхышЄхы№ ьхцфє шьхэхь ш Ёрё°шЁхэшхь фюыцхэ с√Є№ яЁюсхыюь
0048+  C891 21 FD D1    		lxi	h, v_header2_ext-1
0049+  C894 06 04       		mvi	b, 4
0050+  C896 7E          		mov	a, m
0051+  C897 FE 20       		cpi	20h
0052+  C899 C2 AA C8    		jnz	xra_a_stc_ret		
0053+  C89C             
0054+  C89C             		; ╨рё°шЁхэшх
0055+  C89C 05          loc_C89C:	 dcr	b
0056+  C89D CD DF C8    		 call	printCharA
0057+  C8A0 CA 02 CF    		 jz	loc_CE8A	; ╧хЁхїюф эр pop h, ora a, ret
0058+  C8A3 23          		 inx	h
0059+  C8A4 7E          		 mov	a, m
0060+  C8A5 FE 20       		 cpi	20h
0061+  C8A7 C2 9C C8    		jnz	loc_C89C
0062+  C8AA             		
0063+  C8AA             xra_a_stc_ret:	; ┬√тюф чэрър тюяЁюёр
0064+  C8AA 3E 3F       		mvi	a, '?'
0065+  C8AC CD DF C8    		call	printCharA
0066+  C8AF AF          		xra	a
0067+  C8B0             
0068+  C8B0 B7          ora_a_stc_ret:	ora	a
0069+  C8B1 37          		stc
0070+  C8B2 C9          		ret
0180   C8B3             .include "printFileName.inc"
0001+  C8B3             ;+---------------------------------------------------------------------------
0002+  C8B3             ; RAMFOS
0003+  C8B3             ; ┬√тхёЄш шь  Їрщыр эр ¤ъЁрэ ш єфрышЄ№ шч эхую тёх эхфюяєёЄшь√х ёшьтюы√
0004+  C8B3             ;
0005+  C8B3             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  C8B3             ;----------------------------------------------------------------------------
0007+  C8B3             
0008+  C8B3             printFileName:	
0009+  C8B3             		; ╨рчфхышЄхы№
0010+  C8B3             #if NICE
0011+  C8B3 0E 20       		mvi	c, ' '
0012+  C8B5~            #else
0013+  C8B5~            		; ╨рчфхышЄхы№
0014+  C8B5~            		mvi	c, 11h
0015+  C8B5             #endif
0016+  C8B5 CD 90 CB    		call	printChar
0017+  C8B8             
0018+  C8B8 21 F5 D1    printFileName2:lxi	h, v_header2_name	; ╚ь 
0019+  C8BB 06 0C       		mvi	b, 12			; ─ышэр шьхэш
0020+  C8BD 7E          printFileNam_1:	 mov	a, m
0021+  C8BE             		 ; ╤шьтюы√ ьхэ№°х 0x20 чрьхэ хь эр яЁюсхы
0022+  C8BE FE 20       		 cpi	20h
0023+  C8C0 DA CD C8    		 jc	printFileNam_2
0024+  C8C3             		 ; ╤шьтюы√ юЄ 0x20 фю 0x7E фюяєёър■Єё 
0025+  C8C3 FE 7F       		 cpi	7Fh
0026+  C8C5 DA D0 C8    		 jc	printFileNam_3
0027+  C8C8             		 ; ╤шьтюы√ юЄ 0xC0 фю 0xFF фюяєёър■Єё 
0028+  C8C8 FE C0       		 cpi	0C0h
0029+  C8CA D2 D0 C8    		 jnc	printFileNam_3		 
0030+  C8CD             printFileNam_2:	 ; ╟рьхэ хь эхфюяєёЄшь√щ ёшьтюы эр яЁюсхы
0031+  C8CD 36 20       		 mvi	m, 20h
0032+  C8CF 7E          		 mov	a, m
0033+  C8D0             printFileNam_3:	 ; ┬√тюфшь ёшьтюы эр ¤ъЁрэ
0034+  C8D0 CD DF C8    		 call	printCharA
0035+  C8D3             		 ; ╤ыхфє■∙шщ ёшьтюы
0036+  C8D3 23          		 inx	h
0037+  C8D4 05          		 dcr	b
0038+  C8D5 C2 BD C8    		jnz	printFileNam_1		
0039+  C8D8             
0040+  C8D8             		; ╨рчфхышЄхы№
0041+  C8D8             #if NICE
0042+  C8D8 0E 20       		mvi	c, ' '
0043+  C8DA C3 90 CB    		jmp	printChar
0044+  C8DD             #endif
0045+  C8DD             		; ╧хЁхїюф эр printChar60181   C8DD             .include "printCharA.inc"
0001+  C8DD             ;+---------------------------------------------------------------------------
0002+  C8DD             ; RAMFOS
0003+  C8DD             ; ┬√тюф ёшьтюыр ё ъюфюь 6 эр ¤ъЁрэ
0004+  C8DD             ;
0005+  C8DD             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  C8DD             ;----------------------------------------------------------------------------
0007+  C8DD             
0008+  C8DD 3E 06       printChar6:	mvi	a, 6
0009+  C8DF             
0010+  C8DF             ;----------------------------------------------------------------------------
0011+  C8DF             ; RAMFOS
0012+  C8DF             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C80F
0013+  C8DF             ; ┬√тюф ёшьтюыр эр ¤ъЁрэ
0014+  C8DF             ;
0015+  C8DF             ; ═р тїюфх
0016+  C8DF             ;  A - ўшёыю
0017+  C8DF             ;
0018+  C8DF             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0019+  C8DF             ;----------------------------------------------------------------------------
0020+  C8DF             
0021+  C8DF C5          printCharA:	push	b
0022+  C8E0 4F          		 mov	c, a
0023+  C8E1 CD 90 CB    		 call	printChar
0024+  C8E4 C1          		pop	b
0025+  C8E5 C9          		ret0182   C8E6             .include "biosInit.inc"
0001+  C8E6             ;+---------------------------------------------------------------------------
0002+  C8E6             ; RAMFOS
0003+  C8E6             ; ╚эшЎшрышчрЎш  BIOS
0004+  C8E6             ; ┬√ч√трхЄё  Єюы№ъю ЇєэъЎшхщ init
0005+  C8E6             ;
0006+  C8E6             ; 2013-11-01 ─шчрёёхьсышЁютрэю ш фюЁрсюЄрэю vinxru
0007+  C8E6             ;----------------------------------------------------------------------------
0008+  C8E6             
0009+  C8E6             biosInit:	; ╬ўшёЄър яхЁхьхээ√ї эрўшэр  ё v_dblClear
0010+  C8E6 21 10 D2    		lxi	h, v_dblClear
0011+  C8E9 06 2F       		mvi	b, 47
0012+  C8EB AF          		xra	a
0013+  C8EC 32 5C C6    		sta	v_inverse
0014+  C8EF 77          loc_C8EA:	 mov	m, a
0015+  C8F0 23          		 inx	h
0016+  C8F1 05          		 dcr	b
0017+  C8F2 C2 EF C8    		jnz	loc_C8EA
0018+  C8F5             
0019+  C8F5             		; ╚эшЎшрышчрЎш 	ъюэЄЁюыыхЁр ЎтхЄр ўхЁэ√ь ЎтхЄюь фы  юўшёЄъш ¤ъЁрэр
0020+  C8F5~            #if INIT_SCREEN_COLOR==100h
0021+  C8F5~            		lda	v_selColor
0022+  C8F5             #else
0023+  C8F5 3E F1       		mvi	a, INIT_SCREEN_COLOR
0024+  C8F7             #endif
0025+  C8F7 CD 0B D1    		call	setColor
0026+  C8FA             
0027+  C8FA             		; ╚эшЎшрышчрЎш 	ъыртшрЄєЁ√
0028+  C8FA CD 8B CF    		call	keyMode82	
0029+  C8FD             
0030+  C8FD             		; ╤ъЁ√трхь эшцэ■■ ёЄЁюъє
0031+  C8FD CD 81 CA    		call	bottomLineHide
0032+  C900             
0033+  C900             		; ╬ўш∙рхь ¤ъЁрэ
0034+  C900 CD 7D CE    		call	clearScreen
0035+  C903             		
0036+  C903             		; ═рёЄЁющър ЄрщьхЁр
0037+  C903 21 EF FF    		lxi	h, IO_TIMER+3
0038+  C906 36 36       		mvi	m, 36h
0039+  C908 36 76       		mvi	m, 76h
0040+  C90A 36 90       		mvi	m, 90h
0041+  C90C 2B          		dcx	h
0042+  C90D 36 10       		mvi	m, 10h
0043+  C90F 2B          		dcx	h
0044+  C910 36 20       		mvi	m, 20h
0045+  C912 36 4E       		mvi	m, 4Eh
0046+  C914 2B          		dcx	h
0047+  C915 36 10       		mvi	m, 10h
0048+  C917 36 15       		mvi	m, 15h
0049+  C919             		
0050+  C919             		; *** ╬яЁхфхыхэшх ЁрчьхЁр ─╬╟╙ ***
0051+  C919             
0052+  C919             #if WORK_WITHOUT_ARAM
0053+  C919             		; ═рфю тхЁэєЄ№ фюёЄєя ъ ─╬╟╙, шэрўх яЁютхЁър эх ЁрсюЄрхЄ
0054+  C919 3E FD       		mvi	a, 0FDh		; ╧юЁЄ т√сюЁр ─╬╟╙		
0055+  C91B 32 CA FF    		sta	disableARAM1+1
0056+  C91E 32 D9 FF    		sta	disableARAM2+1
0057+  C921             #endif
0058+  C921             
0059+  C921             #if TRUE_CHECK_ARAM
0060+  C921 21 BB FF    		lxi	h, ARAM_PAGE_END
0061+  C924~            #else
0062+  C924~            		lhld	v_aramPageEnd	; ▌Єю эх ёютёхь яЁртшы№эю, Єръ ъръ яЁш яЁюуЁрььэюь ёсЁюёх яЁютхЁър сєфхЄ ЁрсюЄрЄ№ эх Єръ, ъръ яЁш ряярЁрЄэюь
0063+  C924             #endif
0064+  C924 3A 5E C6    		lda	v_aramMaxPageI
0065+  C927 CD 66 C9    		call	checkARAM
0066+  C92A             		
0067+  C92A             #if WORK_WITHOUT_ARAM
0068+  C92A 11 00 00    		lxi	d, 0		; ═рўрыю ─╬╟╙
0069+  C92D             #endif
0070+  C92D             		; ┼ёыш ─╬╟╙ эрщфхэю
0071+  C92D             #if TRUE_CHECK_ARAM
0072+  C92D C2 3E C9    		jnz	aramFounded	; ╥ръ ъюЁюўх ъюф шёяЁтрыхээющ ЇєэъЎшш
0073+  C930~            #else
0074+  C930~            		jz	aramFounded		
0075+  C930             #endif
0076+  C930             
0077+  C930             		; ─╬╟╙ эх эрщфхэю
0078+  C930             #if WORK_WITHOUT_ARAM
0079+  C930             		 ; ═рёЄЁрштрхь эхсюы№°ющ фшёъ т юёэютэюь ╬╟╙
0080+  C930 11 64 D1    		 lxi	d, miniPage
0081+  C933 21 A4 D1    		 lxi	h, miniPageEnd
0082+  C936 3E FC       		 mvi	a, 0FCh		; ╧юЁЄ т√сюЁр ╬╟╙
0083+  C938 32 CA FF    		 sta	disableARAM1+1
0084+  C93B 32 D9 FF    		 sta	disableARAM2+1
0085+  C93E~            #else
0086+  C93E~            		 ; ╧√Єрхьё  ЁрсюЄрЄ№ ё 48 ╩с ─╬╟╙
0087+  C93E~            		 lxi	h, 0BFFBh
0088+  C93E             #endif
0089+  C93E             aramFounded:	
0090+  C93E 22 1C C6    		shld	v_aramPageEnd
0091+  C941 22 3C D2    		shld	v_aramPageEnd2
0092+  C944             #if WORK_WITHOUT_ARAM
0093+  C944 EB          		xchg
0094+  C945 22 1E C6    		shld	v_aramPageStart
0095+  C948             #endif
0096+  C948             		; *** ╚эшЎшрышчрЎш  ¤ъЁрэр ***
0097+  C948 21 BD D1    		lxi	h, a_initScreen
0098+  C94B             		; ─рыхх printString
0099+  C94B             
0100+  C94B             
0101+  C94B             		; ▌ЄюЄ ЄхъёЄ сєфхЄ тёЄЁюхэ т ъюэхЎ ъюфр
0102+  C94B             #if NICE
0103+  C94B             #define A_INITSCREEN a_initScreen: .db C_INVERSE, C_TOPLINE, ' ', 0F3h, 0D0h, 0C5h, 0C3h, 0C9h, 0C1h, 0CCh, 0C9h, 0D3h, 0D4h, ' ','M','X','2',' ','R','A','M','F','O','S',C_NORMAL,0
0104+  C94B~            #else                                                                                                                                                                  
0105+  C94B~            #define A_INITSCREEN a_initScreen: .db C_INVERSE, C_TOPLINE, ' ', 0F3h, 0D0h, 0C5h, 0C3h, 0C9h, 0C1h, 0CCh, 0C9h, 0D3h, 0D4h, '_','M','X',92,'R','A','M','F','O','S',92,C_NORMAL,0
0106+  C94B             #endif
0183   C94B             .include "printString.inc"
0001+  C94B             ;+---------------------------------------------------------------------------
0002+  C94B             ; RAMFOS
0003+  C94B             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C818
0004+  C94B             ; ┬√тюф ёЄЁюъш эр ¤ъЁрэ
0005+  C94B             ;
0006+  C94B             ; ═р тїюфх
0007+  C94B             ;  hl - ╤ЄЁюър
0008+  C94B             ;
0009+  C94B             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0010+  C94B             ;----------------------------------------------------------------------------
0011+  C94B             
0012+  C94B 7E          printString:	mov	a, m
0013+  C94C A7          		ana	a
0014+  C94D C8          		rz
0015+  C94E CD DF C8    		call	printCharA
0016+  C951 23          		inx	h
0017+  C952 C3 4B C9    		jmp	printString
0184   C955             .include "parseDate.inc"
0001+  C955             ;+---------------------------------------------------------------------------
0002+  C955             ; RAMFOS
0003+  C955             ; ╧ЁхюсЁрчютрЄ№ ттхфхээє■ ёЄЁюъє ё фрЄющ т ўшёыр
0004+  C955             ;
0005+  C955             ; ═р тїюфх:
0006+  C955             ;  de - ёЄЁюър
0007+  C955             ;
0008+  C955             ; 2013-11-01 ─юЁрсюЄрэю vinxru (ъюЁюўх ш ёюїЁрэ хЄ т ╬╟╙)
0009+  C955             ;----------------------------------------------------------------------------
0010+  C955             
0011+  C955             #if DATE_IN_RAM
0012+  C955             
0013+  C955 01 02 D2    parseDate:	lxi	b, v_header2_date ; 3
0014+  C958             
0015+  C958             parseDate_1:	; ╧ЁхюсЁрчютрэшх ёЄЁюъш т ўшёыю. ╬°шсър эх ъюэЄЁюыышЁєхЄё .
0016+  C958 CD 7F C7    		call	strToHex ; 6
0017+  C95B             
0018+  C95B             		; ╤юїЁрэхэшх
0019+  C95B 7D          		mov	a, l ; 7
0020+  C95C 02          		stax	b ; 8
0021+  C95D 03          		inx	b ; 9
0022+  C95E             	
0023+  C95E             		; ┼ёыш ъюэхЎ ёЄЁюъш, т√їюфшь
0024+  C95E D8          		rc ; 10
0025+  C95F             
0026+  C95F             		; ╓шъы
0027+  C95F 3E 05       		mvi	a, (v_header2_date + 3) & 0FFh ; 12
0028+  C961 B9          		cmp	c ; 13
0029+  C962 C2 58 C9    		jnz	parseDate_1 ; 16
0030+  C965             
0031+  C965             		; ┬√їюфшь ё Їырурьш Z, NC, ўЄю яЁштхфхЄ ъ яютЄюЁьюьє ттюфє фрЄ√
0032+  C965 C9          		ret ; 17
0033+  C966             
0034+  C966~            #else ;---------------------------------------------------------------------
0035+  C966~            
0036+  C966~            parseDate:	; ─хэ№
0037+  C966~            		call	strToHex ; 3
0038+  C966~            		mov	a, l ; 4
0039+  C966~            		sta	parseDate_r1+1 ; 7
0040+  C966~            		rc ; 8
0041+  C966~            		; ╠хё Ў
0042+  C966~            		call	strToHex ; 11
0043+  C966~            		mov	a, l ; 12
0044+  C966~            		sta	parseDate_r2+1 ; 15
0045+  C966~            		rc ; 16
0046+  C966~            		; ├юф
0047+  C966~            		call	strToHex ; 19
0048+  C966~            		mov	a, l ; 20
0049+  C966~            		sta	parseDate_r3+1 ; 23
0050+  C966~            		rc ; 24
0051+  C966~            		; ╤ыш°ъюь ьэюую ярЁрьхЄЁют
0052+  C966~            		jmp	xra_a_stc_ret ; 27
0053+  C966~            
0054+  C966             #endif0185   C966             #if TRUE_CHECK_ARAM
0186   C966             .include "checkARAM_v2.inc"
0001+  C966             ;+---------------------------------------------------------------------------
0002+  C966             ; RAMFOS
0003+  C966             ; ╚ёяЁртыхээр  ЇєэъЎш  юяЁхфхыхэш  ЁрчьхЁр ─╬╟╙
0004+  C966             ;
0005+  C966             ; ═р тїюфх
0006+  C966             ;  р - ьръёшьры№э√щ эюьхЁ ёЄЁрэшЎ√, ъюэёЄрэЄр MAX_ARAM_PAGE
0007+  C966             ;
0008+  C966             ; ═р т√їюфх
0009+  C966             ;  NZ - ─╬╟╙ эрщфхэю (эрюсюЁюЄ юЄэютшЄхы№эю ёЄрэфЁрЄэющ ЇєэъЎшш)
0010+  C966             ;   Z - ─╬╟╙ эх эрщфхэю
0011+  C966             ;
0012+  C966             ; 2013-11-01 ╨рчЁрсюЄрэю vinxru
0013+  C966             ;----------------------------------------------------------------------------
0014+  C966             
0015+  C966             checkARAM:	 ; ╟ряшё√трхь тю тёх ёЄЁрэшЎ√ яюЁ фъют√х эюьхЁр юЄ сюы№°хщ ъ ьхэ№°хщ
0016+  C966 4F          		 mov	c, a		
0017+  C967 0C          		 inr	c
0018+  C968 CD 39 F8    		 call	j_pageWriteAny
0019+  C96B 3D          		 dcr	a
0020+  C96C F2 66 C9    		jp	checkARAM
0021+  C96F             
0022+  C96F             		; ╫шЄрхь эюьхЁр. ┼ёыш эюьхЁ яЁюўшЄрэ ъюЁЁхъЄэю, чэрўшЄ хёЄ№ Єрър  ёЄЁрэшЎр
0023+  C96F             		; a = -1
0024+  C96F             
0025+  C96F             checkARAM_1:	 ; ╫шЄрхь ёыхфє■∙є■ ёЄЁрэшЎє
0026+  C96F 3C          		 inr	a
0027+  C970 CD 36 F8    		 call	j_pageReadAny		
0028+  C973             		 ; ─юыцхэ с√Є№ чряшёрэ эюьхЁ ёЄЁрэшЎ√+1, хёыш эхЄ, Єю т√їюфшь
0029+  C973 0D          		 dcr	c
0030+  C974 B9          		 cmp	c		 
0031+  C975 C2 80 C9    		 jnz	checkARAM_2
0032+  C978                              ; ╤юїЁрэ хь эюьхЁ яюёыхфэхщ ёЄЁрэшЎ√ RAM-фшёър
0033+  C978 32 3D C6    		 sta	v_aramMaxPage
0034+  C97B             		 ; ▌Єю ьръёшьєь, т√їюфшь
0035+  C97B FE 0F       		 cpi	ARAM_MAX_PAGE		; ARAM_MAX_PAGE эх ьюцхЄ с√Є№ эєыхь!
0036+  C97D C2 6F C9    		jnz	checkARAM_1
0037+  C980             		 
0038+  C980             checkARAM_2:	; ┼ёыш ─╬╟╙ эрщфхэю, т√їюфшь т Їыруюь NZ
0039+  C980 B7          		ora	a
0040+  C981 C0          		rnz		
0041+  C982             
0042+  C982             		; ┬ ёыєўрх ю°шсъш чрэюёшь т v_aramPages=0 ш т√їюфшь ё Їыруюь Z
0043+  C982 32 3D C6    		sta	v_aramMaxPage
0044+  C985 C9          		ret		0187   C986~            #else
0188   C986~            .include "checkARAM.inc"
0189   C986             #endif
0190   C986             .include "inputDate.inc"
0001+  C986             ;+---------------------------------------------------------------------------
0002+  C986             ; RAMFOS
0003+  C986             ; ┬тюф Єхъє∙хщ фрЄ√
0004+  C986             ;
0005+  C986             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  C986             ;----------------------------------------------------------------------------
0007+  C986             
0008+  C986             inputDate:	; ┬√тюф яЁшуыр°хэш  "V3.1/фрЄр:" шыш "фрЄр:"
0009+  C986 21 B6 D1    		lxi	h, a_inputDate
0010+  C989 CD 4B C9    		call	printString
0011+  C98C             	
0012+  C98C             		; ┬тюф фрЄ√
0013+  C98C 21 95 D2    		lxi	h, buffer
0014+  C98F 11 FF 09    		lxi	d, 9FFh ; ╠ръёшьєь 9 ёшьтюыют
0015+  C992 CD 8D CA    		call	input
0016+  C995             
0017+  C995             		; ┼ёыш с√ыр ю°шсър
0018+  C995 D2 86 C9    		jnc	inputDate
0019+  C998 77          		mov	m, a
0020+  C999             
0021+  C999             		; ╧ЁхюсЁрчютрэшх ттхфхээющ ёЄЁюъш ш ўшёыр
0022+  C999 FC 55 C9    		cm	parseDate
0023+  C99C             
0024+  C99C             		; ┼ёыш яЁхюсЁрчютрэшх эх єфрыюё№ ттюфшь яютЄюЁэю
0025+  C99C CA 86 C9    		jz	inputDate
0026+  C99F             
0027+  C99F             #if DATE_IN_RAM
0028+  C99F             		; ╤юїЁрэ хь яЁшчэръ Єюую, ўЄю фрЄр ттхфхэр
0029+  C99F 3E 8B       		mvi	a, 8Bh 
0030+  C9A1 32 01 D2    		sta	v_header2_saved
0031+  C9A4             
0032+  C9A4 C9          		ret
0033+  C9A5~            #else
0034+  C9A5~            		; ╚чтыхърхь шч ёЄхър рфЁхё эр фшёъх
0035+  C9A5~            		pop	h
0036+  C9A5~            
0037+  C9A5~            		; ╤юїЁрэ хь 08Bh
0038+  C9A5~            		mvi	c, 8Bh 
0039+  C9A5~            		call	inputDate_1
0040+  C9A5~            		
0041+  C9A5~            		; ╤юїЁрэ хь фхэ№ эр фшёъ
0042+  C9A5~            parseDate_r1:	mvi	c, 22h
0043+  C9A5~            		call	inputDate_1
0044+  C9A5~            
0045+  C9A5~            		; ╤юїЁрэ хь ьхё Ў эр фшёъ
0046+  C9A5~            parseDate_r2:	mvi	c, 09h
0047+  C9A5~            		call	inputDate_1
0048+  C9A5~            
0049+  C9A5~            		; ╤юїЁрэ хь уюф эр фшёъ
0050+  C9A5~            parseDate_r3:	mvi	c, 92h
0051+  C9A5~            inputDate_1:	xra	a
0052+  C9A5~            		call	j_pageWriteAny
0053+  C9A5~            		inx	h
0054+  C9A5~            		inr	a
0055+  C9A5~            		ret
0056+  C9A5             #endif
0057+  C9A5             
0058+  C9A5             #if NICE
0059+  C9A5             #define A_INPUTDATE a_inputDate: .db 0Dh, 0C4h, 0C1h, 0D4h, 0C1h, ':', 0 ; "фрЄр:"
0060+  C9A5~            #else
0061+  C9A5~            #define A_INPUTDATE a_inputDate: .db 0Dh, 'V', '3', '.', '1', '/', 0C4h, 0C1h, 0D4h, 0C1h, ':', 0 ; "V3.1/фрЄр:"
0062+  C9A5             #endif0191   C9A5             .include "topLine.inc"		; продолжается в inverse
0001+  C9A5             ;+---------------------------------------------------------------------------
0002+  C9A5             ; RAMFOS
0003+  C9A5             ; ┬√тюф шфэшърЄюЁют т тхЁїэ■■ ёЄЁюъє
0004+  C9A5             ; ▌Єр ЇєэъЎш  т√ч√трхЄё  Єюы№ъю шч printIndicators ш clearTopLine
0005+  C9A5             ;
0006+  C9A5             ; 2013-11-01 ─шчрёёхьсышЁютрэю ш фюЁрсюЄрэю vinxru
0007+  C9A5             ;----------------------------------------------------------------------------
0008+  C9A5             
0009+  C9A5             #if FAST_PRINT
0010+  C9A5             INDCATORS_SEP = ' '
0011+  C9A5~            #else
0012+  C9A5~            INDCATORS_SEP = 11h
0013+  C9A5             #endif
0014+  C9A5             
0015+  C9A5             printIndicatorsInt:	
0016+  C9A5             		; ┼ёыш фрЄр їЁрэшЄё  т ╬╟╙, яЁютхЁ хЄё , ттхфхэр ыш фрЄр
0017+  C9A5             #if DATE_IN_RAM
0018+  C9A5 3A 01 D2    		lda	v_header2_saved
0019+  C9A8 FE 8B       		cpi	8Bh
0020+  C9AA C4 86 C9    		cnz	inputDate
0021+  C9AD             #endif
0022+  C9AD             		; ╙ёЄрэютър яюыюцхэш  ъєЁёюЁр (0 ёЄюър 45 ёЄюысхЎ)
0023+  C9AD 21 08 87    		lxi	h, 8708h	
0024+  C9B0 22 3E C6    		shld	v_cursorPos
0025+  C9B3             
0026+  C9B3             		; ┼ёыш фрЄр їЁрэшЄё  т ─╬╟╙, яЁютхЁ хЄё , ттхфхэр ыш фрЄр
0027+  C9B3~            #if DATE_IN_RAM==0
0028+  C9B3~            		; ╫шЄрхь шч эєыхтющ ёЄЁрэшЎ√ срщЄ яю рфЁхёє v_aramPageEnd+1
0029+  C9B3~            		lhld	v_aramPageEnd
0030+  C9B3~            		inx	h
0031+  C9B3~            		xra	a
0032+  C9B3~            		call	j_pageReadAny
0033+  C9B3~            		
0034+  C9B3~            		; ┼ёыш Єрь чряшёрэ эх 8B, Єю яхЁхїюфшь ъ ттюфє фрЄ√
0035+  C9B3~            		mov	a, c
0036+  C9B3~            		cpi	8Bh
0037+  C9B3~            		push	h		
0038+  C9B3~            		jnz	inputDate
0039+  C9B3             #endif
0040+  C9B3             
0041+  C9B3             		; ╨рчфхышЄхы№
0042+  C9B3 3E 20       		mvi	a, INDCATORS_SEP
0043+  C9B5 CD DF C8    		call	printCharA
0044+  C9B8             
0045+  C9B8             		; ┬√тюфшь ёъюЁюёЄ№ чряшёш эр ыхэЄє
0046+  C9B8 3A 5F C6    		lda	v_tapeMode
0047+  C9BB CD DF C8    		call	printCharA
0048+  C9BE             
0049+  C9BE             		; ┬√тюфшь Ёхцшь ¤їюяхўрЄш
0050+  C9BE 3A 2F C6    		lda	v_printerEcho
0051+  C9C1 CD DF C8    		call	printCharA
0052+  C9C4             
0053+  C9C4             		; ┬√тюфшь CAPS LOCK
0054+  C9C4 2A 2D C6    		lhld	v_rusLat
0055+  C9C7 25          		dcr	h
0056+  C9C8 3E 0B       		mvi	a, 0Bh
0057+  C9CA FA CF C9    		jm	loc_C9D5
0058+  C9CD 3E 0F       		 mvi	a, 0Fh		 
0059+  C9CF CD DF C8    loc_C9D5:	call	printCharA
0060+  C9D2             
0061+  C9D2             		; ┬√тюфшь ╨╙╤/LAT
0062+  C9D2 2C          		inr	l
0063+  C9D3 21 A5 D1    		lxi	h, a_lat
0064+  C9D6 C2 DC C9    		jnz	loc_C9E2
0065+  C9D9 21 A9 D1    		  lxi	h, a_rus
0066+  C9DC CD 4B C9    loc_C9E2:	call	printString
0067+  C9DF             
0068+  C9DF             		; ┬√тюфшь KOI8/7
0069+  C9DF 3A 2C C6    		lda	v_koi8
0070+  C9E2 B7          		ora	a
0071+  C9E3 3E 38       		mvi	a, '8'
0072+  C9E5 CA E9 C9    		jz	loc_C9EF
0073+  C9E8 3D          		  dcr	a		  
0074+  C9E9 CD DF C8    loc_C9EF:	call	printCharA
0075+  C9EC             
0076+  C9EC             #if FAST_PRINT
0077+  C9EC 3E 20       		mvi	a, ' '
0078+  C9EE CD DF C8    		call	printCharA
0079+  C9F1~            #else
0080+  C9F1~            		call	printChar6
0081+  C9F1             #endif
0082+  C9F1             
0083+  C9F1             #if DATE_IN_RAM
0084+  C9F1             		; ╨рчфхышЄхы№
0085+  C9F1 3E 20       		mvi	a, INDCATORS_SEP
0086+  C9F3 CD DF C8    		call	printCharA
0087+  C9F6             
0088+  C9F6             		; ┬√тюф эр ¤ъЁрэ фрЄ√
0089+  C9F6 3A 02 D2    		lda v_header2_date
0090+  C9F9 CD 76 CB    		call	printHex
0091+  C9FC             
0092+  C9FC             #if NICE
0093+  C9FC 3E 2D       		mvi	a, '-'
0094+  C9FE CD DF C8    		call	printCharA
0095+  CA01             #endif
0096+  CA01             		; ┬√тюф эр ¤ъЁрэ фрЄ√
0097+  CA01 3A 03 D2    		lda	v_header2_date+1
0098+  CA04 CD 76 CB    		call	printHex
0099+  CA07             #if NICE
0100+  CA07 3E 2D       		mvi	a, '-'
0101+  CA09 CD DF C8    		call	printCharA
0102+  CA0C             #endif
0103+  CA0C             		; ┬√тюф эр ¤ъЁрэ фрЄ√
0104+  CA0C 3A 04 D2    		lda v_header2_date+2
0105+  CA0F CD 76 CB    		call	printHex
0106+  CA12~            #else
0107+  CA12~            		pop	h
0108+  CA12~            
0109+  CA12~            		; └фЁхё фы  ёюїЁрэхэш  фрЄ√
0110+  CA12~            		lxi	d, v_header2_saved
0111+  CA12~            
0112+  CA12~            		; ╤юїЁрэ хь C т v_header2_saved <--- ????
0113+  CA12~            		mov	a, c
0114+  CA12~            		stax	d
0115+  CA12~            
0116+  CA12~            		; ╨рчфхышЄхы№
0117+  CA12~            		mvi	a, INDCATORS_SEP
0118+  CA12~            		call	printCharA
0119+  CA12~            
0120+  CA12~            		; ┬√тюф эр ¤ъЁрэ фрЄ√
0121+  CA12~            		mvi	b, 3		; 3 срщЄр
0122+  CA12~            loc_CA02:	 inx	h
0123+  CA12~            		 inx	d
0124+  CA12~            		 ; ╫шЄрхь срщЄ шч эєыхтющ ёЄЁрэшЎ√
0125+  CA12~            		 xra	a
0126+  CA12~            		 call	j_pageReadAny
0127+  CA12~            		 ; ╟ряшё№ т ярь Єш
0128+  CA12~            		 mov	a, c
0129+  CA12~            		 stax	d
0130+  CA12~            		 ; ┬√тюф эр ¤ъЁрэ
0131+  CA12~            		 call	printHex
0132+  CA12~            		 ; ╓шъы 3-1
0133+  CA12~            		 dcr	b
0134+  CA12~            		jnz	loc_CA02
0135+  CA12             #endif
0136+  CA12             
0137+  CA12             #if FAST_PRINT
0138+  CA12 C9          		ret
0139+  CA13~            #else
0140+  CA13~            		jmp	printChar6
0141+  CA13             #endif
0142+  CA13             
0143+  CA13             ;----------------------------------------------------------------------------
0144+  CA13             ; RAMFOS
0145+  CA13             ; ╦ш°эшщ ъюф
0146+  CA13             ;
0147+  CA13             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0148+  CA13             ;----------------------------------------------------------------------------
0149+  CA13             
0150+  CA13~            #if NO_PRINT_STATUS_BUG==0
0151+  CA13~            printIndicatorsEnd:
0152+  CA13~            		pop	psw
0153+  CA13~            		cnz	changeInverse
0154+  CA13             #endif
0155+  CA13             
0156+  CA13             ;----------------------------------------------------------------------------
0157+  CA13             ; RAMFOS
0158+  CA13             ; ╬ўшёЄър тхЁїэхщ ёЄЁюъш ш яхЁхьх∙хэшх Єєфр ъєЁёюЁр
0159+  CA13             ; ┬√ч√трхЄё  яЁш яхўрЄш ёшьтюыр 08Fh
0160+  CA13             ;
0161+  CA13             ; 2013-11-01 ─шчрёёхьсышЁютрэю ш фюЁрсюЄрэю vinxru
0162+  CA13             ;----------------------------------------------------------------------------
0163+  CA13             
0164+  CA13             clearTopLine:	
0165+  CA13             #if COLOR_SUPPORT
0166+  CA13             		; ╓тхЄ яю єьюыўрэш■
0167+  CA13 3E F1       		mvi	a, INIT_SCREEN_COLOR
0168+  CA15 CD 0B D1    		call	setColor
0169+  CA18             #endif
0170+  CA18             
0171+  CA18             		; ╨хры№эр  юўшёЄър тхЁїэхщ ёЄЁюъш
0172+  CA18 CD D5 CE    		call	clearTopLine2
0173+  CA1B             
0174+  CA1B             		; ╙ёЄрэртыштрхь ъєЁёюЁ т тхЁїэ■■ ёЄЁюъє
0175+  CA1B 21 08 00    		lxi	h, 8
0176+  CA1E 22 3E C6    		shld	v_cursorPos
0177+  CA21             
0178+  CA21             		; ?
0179+  CA21 21 0A 14    		lxi	h, 140Ah
0180+  CA24 22 30 D2    		shld	v_topLineHeight
0181+  CA27             
0182+  CA27             ;----------------------------------------------------------------------------
0183+  CA27             ; RAMFOS
0184+  CA27             ; ┬√тюф шфэшърЄюЁют т тхЁїэ■■ ёЄЁюъє ё ёюїЁрэхэшхь ъєЁёюЁр, ЎтхЄр ш шэтхЁёшш
0185+  CA27             ; ▌Єр ЇєэъЎш  т√ч√трхЄё  Єюы№ъю шч keyScan
0186+  CA27             ;
0187+  CA27             ; 2013-11-01 ─шчрёёхьсышЁютрэю ш фюЁрсюЄрэю vinxru
0188+  CA27             ;----------------------------------------------------------------------------
0189+  CA27             
0190+  CA27             printIndicators:
0191+  CA27             		; ═х ЁшёютрЄ№ шэфшърЄюЁ√
0192+  CA27 3A 30 D2    		lda	v_topLineHeight
0193+  CA2A B7          		ora	a
0194+  CA2B C8          		rz
0195+  CA2C             
0196+  CA2C             		; ╟ряюьшэрхь яюыюцхэшх ъєЁёюЁр
0197+  CA2C 2A 3E C6    		lhld	v_cursorPos
0198+  CA2F             
0199+  CA2F             		; ╟ряюьшэрхь шэтхЁёш■ т ёЄхъх
0200+  CA2F 3A 5C C6    		lda	v_inverse
0201+  CA32 B7          		ora	a
0202+  CA33 F5          		push	psw
0203+  CA34             #if FAST_PRINT
0204+  CA34             		; ┼ёыш шэтхЁёш  эх с√ыр тъы■ўхэр, тъы■ўрхь х╕.
0205+  CA34 CC 4E CA    		cz	changeInverse
0206+  CA37~            #else
0207+  CA37~            		; ┼ёыш шэтхЁёш  с√ыр тъы■ўхэр, т√ъы■ўрхь х╕.
0208+  CA37~            		cnz	changeInverse
0209+  CA37             #endif	
0210+  CA37             
0211+  CA37             		; ╤юїЁрэхэшх ЎтхЄр ш єёЄрэютър ёЄрэфрЁЄэюую ЎтхЄр
0212+  CA37             #if COLOR_SUPPORT
0213+  CA37 3A 35 D2    		lda	v_color
0214+  CA3A F5          		push	psw
0215+  CA3B 3E F0       		mvi	a, 0F0h
0216+  CA3D CD 0B D1    		call	setColor
0217+  CA40             #endif
0218+  CA40             
0219+  CA40             		; ┬√тюф ёЄрЄєёэющ ёЄЁюъш
0220+  CA40 E5          		push	h
0221+  CA41 CD A5 C9    		 call	printIndicatorsInt
0222+  CA44 E1          		pop	h
0223+  CA45             
0224+  CA45             		; ┬юёёЄрэютыхэшх ЎтхЄр
0225+  CA45             #if COLOR_SUPPORT
0226+  CA45 F1          		pop	psw
0227+  CA46 CD 0B D1    		call	setColor
0228+  CA49             #endif
0229+  CA49             	
0230+  CA49             		;  ┬юёёЄрэютыхэшх яюыюцхэш  ъєЁёюЁр
0231+  CA49 22 3E C6    		shld	v_cursorPos
0232+  CA4C             		 
0233+  CA4C~            #if NO_PRINT_STATUS_BUG==0
0234+  CA4C~            		jnz	printIndicatorsEnd
0235+  CA4C             #endif
0236+  CA4C             
0237+  CA4C             		;  ┬юёёЄрэютыхэшх шэтхЁёшш
0238+  CA4C F1          		pop	psw
0239+  CA4D             #if FAST_PRINT
0240+  CA4D C0          		rnz
0241+  CA4E~            #else
0242+  CA4E~            		rz
0243+  CA4E             #endif	
0244+  CA4E             		; яЁюфюыцрхЄё  т changeInverse0192   CA4E             .include "inverse.inc"
0001+  CA4E             ;+---------------------------------------------------------------------------
0002+  CA4E             ; RAMFOS
0003+  CA4E             ; ╚этхЁёш  шэтхЁёшш (╚этхЁёш  Їюэр ўхЁэюсхыюую ¤ъЁрэр)
0004+  CA4E             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 8Ah ш яЁюёЄю Єръ
0005+  CA4E             ;
0006+  CA4E             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  CA4E             ;----------------------------------------------------------------------------
0008+  CA4E             
0009+  CA4E 3A 5C C6    changeInverse:	lda	v_inverse
0010+  CA51             
0011+  CA51             ;----------------------------------------------------------------------------
0012+  CA51             ; RAMFOS
0013+  CA51             ; ┬ъы■ўхэшх/т√ъы■ўхэшх шэтхЁёшш
0014+  CA51             ;
0015+  CA51             ; ═р тїюфх
0016+  CA51             ;  A=0    - ┬ъы■ўшЄ№. (┬√ч√трхЄё  яЁш т√тюфх ъюфр 8Bh)
0017+  CA51             ;  A=0FFh - ┬√ъы■ўшЄ№.
0018+  CA51             ;
0019+  CA51             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0020+  CA51             ;----------------------------------------------------------------------------
0021+  CA51             
0022+  CA51 2F          setInverseNeg:	cma
0023+  CA52             
0024+  CA52             ;----------------------------------------------------------------------------
0025+  CA52             ; RAMFOS
0026+  CA52             ; ┬ъы■ўхэшх/т√ъы■ўхэшх шэтхЁёшш
0027+  CA52             ;
0028+  CA52             ; ═р тїюфх
0029+  CA52             ;  A=0FFh - ┬ъы■ўшЄ№. (┬√ч√трхЄё  яЁш т√тюфх ъюфр 8Ch)
0030+  CA52             ;  A=0    - ┬√ъы■ўшЄ№.
0031+  CA52             ;
0032+  CA52             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0033+  CA52             ;----------------------------------------------------------------------------
0034+  CA52             
0035+  CA52 32 5C C6    setInverse:	sta	v_inverse
0036+  CA55 C9          		ret0193   CA56             .include "bottomLine.inc"
0001+  CA56             ;+---------------------------------------------------------------------------
0002+  CA56             ; RAMFOS
0003+  CA56             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C82D
0004+  CA56             ; ╙ёЄрэютър ЄхъёЄр т эшцэ■■ ёЄЁюъє. 
0005+  CA56             ; ═хюсїюфшью яЁхфтрЁшЄхы№эю тъы■ўшЄ№ ёЄЁюъє ё яюью∙№■ clearBottomLine
0006+  CA56             ;
0007+  CA56             ; ═р тїюфх
0008+  CA56             ;  hl - ЄхъёЄютр  ёЄЁюър. ╧хЁт√щ срщЄ ёЄЁюъш - шэфхЁЄшЇшърЄюЁ. ┼ёыш ёЄЁюър
0009+  CA56             ;  ё Єръшь шф т√тюфшырё№ яЁю°ы√щ Ёрч, Єю т ¤ЄюЄ Ёрч юэр т√тюфшЄё  эх сєфхЄ
0010+  CA56             ;
0011+  CA56             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0012+  CA56             ;----------------------------------------------------------------------------
0013+  CA56             
0014+  CA56             setBottomLine:	; ╧хЁт√ь срщЄюь ёЄЁюъш шфхЄ шфхэЄшЇшърЄюЁ. 
0015+  CA56             		; ┼ёыш ¤Єр ёЄЁюър єцх єёЄрэрыштрырё№, Єю т√їюфшь
0016+  CA56 3A 34 D2    		lda	v_bottomLineId
0017+  CA59 BE          		cmp	m
0018+  CA5A C8          		rz
0019+  CA5B 7E          		mov	a, m
0020+  CA5C 23          		inx	h
0021+  CA5D             
0022+  CA5D             		; ─рыхх шфхЄ ЄхъёЄ, т√тюфшь хую
0023+  CA5D F5          		push	psw
0024+  CA5E CD 4B C9    		 call	printString
0025+  CA61 F1          		pop	psw
0026+  CA62             
0027+  CA62             		; bottomLineId = a
0028+  CA62 C3 7D CA    		jmp	setBottomLineId
0029+  CA65             
0030+  CA65             ;----------------------------------------------------------------------------
0031+  CA65             ; RAMFOS
0032+  CA65             ; ┬ъы■ўхэшх ш юўшёЄър эшцэхщ ёЄЁюъш ш яхЁхьх∙хэшх Єєфр ъєЁёюЁр
0033+  CA65             ; ┬√ч√трхЄё  яЁш яхўрЄш ёшьтюыр 090h
0034+  CA65             ;
0035+  CA65             ; 2013-11-01 ─шчрёёхьсышЁютрэю ш фюЁрсюЄрэю vinxru
0036+  CA65             ;----------------------------------------------------------------------------
0037+  CA65             
0038+  CA65             clearBottomLine:
0039+  CA65             #if COLOR_SUPPORT
0040+  CA65             		; ╓тхЄ яю єьюыўрэш■
0041+  CA65 3E F1       		mvi	a, INIT_SCREEN_COLOR
0042+  CA67 CD 0B D1    		call	setColor
0043+  CA6A             #endif	
0044+  CA6A             		; ╬ўшёЄшЄ№ эшцэ■■ ёЄЁюъє (ёЄЁюър d=250, т√ёюЄр e=10)
0045+  CA6A 11 0A FA    		lxi	d, 0FA0Ah
0046+  CA6D CD D8 CE    		call	clearLine
0047+  CA70             
0048+  CA70             		; ╧юыюцхэшх ъєЁёюЁр
0049+  CA70 21 F8 00    		lxi	h, 248
0050+  CA73 22 3E C6    		shld	v_cursorPos
0051+  CA76             
0052+  CA76             		; ╨рчьхЁ ¤ъЁрэр (230-240)
0053+  CA76 21 F0 E6    		lxi	h, 0E6F0h
0054+  CA79             
0055+  CA79 22 32 D2    setScreenHeight:shld	v_screenHeight
0056+  CA7C             
0057+  CA7C AF          		xra	a		
0058+  CA7D 32 34 D2    setBottomLineId:sta	v_bottomLineId
0059+  CA80 C9          		ret
0060+  CA81             
0061+  CA81             ;----------------------------------------------------------------------------
0062+  CA81             ; RAMFOS
0063+  CA81             ; ╬Єъы■ўхэшх эшцэхщ ёЄЁюъш, ёЄЁюър яЁш ¤Єюь эх ёЄшЁрхЄё  ёрьр
0064+  CA81             ; ┬√ч√трхЄё  яЁш т√тюфх 1Fh, 1Fh (ЇєэъЎшхщ clearScreen)
0065+  CA81             ;
0066+  CA81             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0067+  CA81             ;----------------------------------------------------------------------------
0068+  CA81             
0069+  CA81 21 00 0A    bottomLineHide:	lxi	h, 0A00h
0070+  CA84 22 30 D2    		shld	v_topLineHeight
0071+  CA87             		
0072+  CA87             		; ╨рчьхЁ ¤ъЁрэр (240-250)
0073+  CA87 21 FA F0    		lxi	h, 0F0FAh
0074+  CA8A C3 79 CA    		jmp	setScreenHeight
0194   CA8D             .include "input.inc"
0001+  CA8D             ;+---------------------------------------------------------------------------
0002+  CA8D             ; RAMFOS
0003+  CA8D             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C836
0004+  CA8D             ; ┬тюф ъюьрэфэющ ёЄЁюъш
0005+  CA8D             ;
0006+  CA8D             ; ═р тїюфх
0007+  CA8D             ;  hl   - рфЁхё сєЇхЁр
0008+  CA8D             ;  d    - фышэр сєЇхЁр
0009+  CA8D             ;  e=XX - Ёхцшь схч юўшёЄъш чэръюьхёЄр, ьюцэю фтшурЄ№ё  тяЁртю
0010+  CA8D             ;  e=00 - ё юўшёЄъющ чэръюьхёЄр, тяЁртю фтшурЄ№ё  эхы№ч 
0011+  CA8D             ;
0012+  CA8D             ; ═р т√їюфх
0013+  CA8D             ;  a        - ╧юёыхфэ   эрцрЄр  ъыртш°р
0014+  CA8D             ;  jz       - ═рцрЄ ESC
0015+  CA8D             ;  jc       - ═рцрЄ Enter
0016+  CA8D             ;  jnz, jnc - ╬ёЄры№э√х ЇєэъЎшюэры№э√х ъэюяъш
0017+  CA8D             ;  jp       - ╤ЄЁюър яєёЄр 
0018+  CA8D             ;
0019+  CA8D             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0020+  CA8D             ;----------------------------------------------------------------------------
0021+  CA8D             
0022+  CA8D             input:		; ╤юїЁрэ хь BC, HL
0023+  CA8D C5          		push	b
0024+  CA8E E5          		push	h
0025+  CA8F             
0026+  CA8F             		; ╟рўхь, эх яюэ ы
0027+  CA8F 01 00 80    		lxi	b, 8000h
0028+  CA92             
0029+  CA92 0C          input_inrc:	inr	c		; ═шцх ь√ єьхэ№°шь C
0030+  CA93 14          input_inrd:	inr	d		; ═шцх ь√ єьхэ№°шь D
0031+  CA94 CD F0 CE    input_ignore:	call	keyWait
0032+  CA97 FE 7F       		cpi	7Fh
0033+  CA99 CA 94 CA    		jz	input_ignore
0034+  CA9C FE 08       		cpi	8
0035+  CA9E CA DA CA    		jz	input_del	; ╧Ёш яхЁхїюфх эр єфрыхэшх C ш D сюы№°х эр хфшэшЎє
0036+  CAA1 FE 0D       		cpi	0Dh
0037+  CAA3 CA C5 CA    		jz	input_enter	; ┬√їюф ё Їырурьш nz, c
0038+  CAA6 FE 1F       		cpi	1Fh
0039+  CAA8 CA C8 CA    		jz	input_esc	; ┬√їюф ё Їырурьш z, nc
0040+  CAAB             		; ┼ёыш эх ьхёЄр фы  эют√ї ёшьтюыют
0041+  CAAB 15          		dcr	d
0042+  CAAC CA 93 CA    		jz	input_inrd
0043+  CAAF             		; ┬яЁртю
0044+  CAAF FE 18       		cpi	18h
0045+  CAB1 CA CB CA    		jz	input_right	; ═р тїюфх ╤ сюы№°х эр хфшэшЎє
0046+  CAB4             		; ╬ёЄры№э√х ёыєцхсэ√х ъыртш°ш - т√їюф
0047+  CAB4 FE 20       		cpi	20h
0048+  CAB6 14          		inr	d		; ╙ёЄрэртыштрхь Їыруш nz
0049+  CAB7 DA C7 CA    		jc	input_cmc	; ┬√їюф ё Їырурьш nz, nc
0050+  CABA 15          		dcr	d
0051+  CABB             		; ╙тхышўштрхь B
0052+  CABB 04          		inr	b
0053+  CABC             input_chr:	; ┬√тюф ёшьтюыр эр ¤ъЁрэ
0054+  CABC CD DF C8    		call	printCharA
0055+  CABF             		; ╤юїЁрэхэшх ёшьтюыр т ярь Єш
0056+  CABF 77          		mov	m, a
0057+  CAC0 23          		inx	h
0058+  CAC1             		; ╙ьхэ№°рхь ёўхЄўшъ ётюсюфэ√ї срщЄ
0059+  CAC1 15          		dcr	d
0060+  CAC2             		; ╤ыхфє■∙шщ ёшьтюы
0061+  CAC2 C3 92 CA    		jmp	input_inrc
0062+  CAC5             
0063+  CAC5             ; ---------------------------------------------------------------------------
0064+  CAC5             
0065+  CAC5 B7          input_enter:	ora	a	; ╙ёЄрэртыштрхь Їыру - эх эєы№
0066+  CAC6 05          		dcr	b       ; ┼ёыш с√ыш ттхфхэ√ ёшьтюы√, Єю Їыру ьшэєё
0067+  CAC7 3F          input_cmc:	cmc		; ╚этхЁЄшЁєхь CF
0068+  CAC8             input_esc:	; ┬юёёЄрэртыштрхь DE, BC
0069+  CAC8 D1          		pop	d
0070+  CAC9 C1          		pop	b
0071+  CACA C9          		ret
0072+  CACB             
0073+  CACB             ; ---------------------------------------------------------------------------
0074+  CACB             
0075+  CACB             input_right:	; ┼ёыш Ёхцшь 0, Єю тяЁртю фтшурЄ№ё  эхы№ч 
0076+  CACB 1C          		inr	e
0077+  CACC 1D          		dcr	e
0078+  CACD CA 93 CA    		jz	input_inrd
0079+  CAD0             
0080+  CAD0             		; ┼ёыш т сєЇхЁх ёыєцхсэ√х ёшьтюы√, чьхэ хь шї эр яЁюсхы ш т√тюфшь
0081+  CAD0 3E 20       		mvi	a, ' ' 
0082+  CAD2 BE          		cmp	m
0083+  CAD3 D2 BC CA    		jnc	input_chr
0084+  CAD6             
0085+  CAD6             		; ┼ёыш юс√ўэ√х ёшьтюы√, т√тюфь
0086+  CAD6 7E          		mov	a, m
0087+  CAD7 C3 BC CA    		jmp	input_chr
0088+  CADA             
0089+  CADA             ; ---------------------------------------------------------------------------
0090+  CADA             
0091+  CADA             input_del:	; ╧хЁхф т√чютюь D с√ыр єтхышўхэр эр хфшэшЎє, эрфю єьхэ№°шЄ№
0092+  CADA 15          		dcr	d
0093+  CADB             
0094+  CADB             		; ┼ёыш эш юфэюую срщЄр эх ттхфхэю, т√їюфшь ш єтхышўштрхь ╤ юсЁрЄэю
0095+  CADB 0D          		dcr	c
0096+  CADC CA 92 CA    		jz	input_inrc
0097+  CADF             
0098+  CADF                             ; ┼ёыш Ёхцшь 0, Єю тьхёЄю єфрыхээюую ёшьтюыр ёЄртшь яЁюсхы
0099+  CADF 1D          		dcr	e
0100+  CAE0 1C          		inr	e
0101+  CAE1 CC DF C8    		cz	printCharA	; ═р тїюфх A=8
0102+  CAE4 3E 20       		mvi	a, ' '
0103+  CAE6 CC DF C8    		cz	printCharA
0104+  CAE9             
0105+  CAE9             		; ╩єЁёюЁ тыхтю
0106+  CAE9 3E 08       		mvi	a, 8
0107+  CAEB CD DF C8    		call	printCharA
0108+  CAEE             
0109+  CAEE             		; ╙ьхэ№°рхь єърчрЄхы№
0110+  CAEE 2B          		dcx	h
0111+  CAEF             
0112+  CAEF             		; ╙тхышўштрхь фышэє
0113+  CAEF 14          		inr	d
0114+  CAF0 C3 93 CA    		jmp	input_inrd0195   CAF3             .include "getCharFromScreen.inc"
0001+  CAF3             ;----------------------------------------------------------------------------
0002+  CAF3             ; RAMFOS
0003+  CAF3             ; ╧юыєўшЄ№ ъюф ёшьтюыр эр ¤ъЁрэх
0004+  CAF3             ;
0005+  CAF3             ; 2013-11-01 vinxru
0006+  CAF3             ;----------------------------------------------------------------------------                   
0007+  CAF3             
0008+  CAF3             getCharFromScreen:
0009+  CAF3 E5          		push	h
0010+  CAF4 D5          		push	d
0011+  CAF5 C5          		push	b
0012+  CAF6             
0013+  CAF6             		; └фЁхё тючтЁрЄр
0014+  CAF6 21 98 CB    		lxi	h, popa_ret
0015+  CAF9 E5          		push	h
0016+  CAFA             
0017+  CAFA             		; ╧юыюцхэшх ъєЁёюЁр т яшъёхы ї
0018+  CAFA 2A 3E C6    		lhld	v_cursorPos	
0019+  CAFD             
0020+  CAFD             		; ╨рёўхЄ рфЁхёр
0021+  CAFD EB          		xchg
0022+  CAFE CD 17 CD    		call	calcCharAddr
0023+  CB01 EB          		xchg
0024+  CB02             		
0025+  CB02             		; ё - ёьх∙хэшх т сшЄрї
0026+  CB02             		; hl - рфЁхё ё тшфхюярь Єш
0027+  CB02             
0028+  CB02 06 08       		mvi	b, 8 ; ┬√ёюЄр ёшьтюыр
0029+  CB04 11 1A D2    		lxi	d, unk_D21A ; ╤■фр сєфхЄ ёъюяшЁютрэ ёшьтюы ё ¤ъЁрэр
0030+  CB07 D5          		push	d		
0031+  CB08 E5          loc_CAF9:	 push	h
0032+  CB09             		  ; ╟руЁєчшЄ№ т HL шч ярь Єш яю рфЁхёє HL
0033+  CB09 7E          		  mov	a, m		
0034+  CB0A 24          		  inr	h
0035+  CB0B 6E          		  mov	l, m
0036+  CB0C 67          		  mov	h, a
0037+  CB0D             		  ; ╤фтшурхь HL эр c*2 сшЄ
0038+  CB0D 79          		  mov	a, c
0039+  CB0E F5          loc_CAFF:	   push	psw
0040+  CB0F CD 64 CB    		    call	hl_div_2
0041+  CB12 CD 64 CB    		    call	hl_div_2
0042+  CB15 F1          		   pop 	psw
0043+  CB16 3D          		   dcr	a
0044+  CB17 C2 0E CB    		  jnz	loc_CAFF
0045+  CB1A             		  ; ╤юїЁрэ хь Єюы№ъю эшцэшх 6 сшЄ яю рфЁхёє de
0046+  CB1A 7D          		  mov	a, l
0047+  CB1B E6 3F       		  ani	3Fh
0048+  CB1D 12          		  stax	d
0049+  CB1E 1B          		  dcx	d
0050+  CB1F E1          		 pop	h
0051+  CB20 2D          		 dcr	l
0052+  CB21 05          		 dcr	b
0053+  CB22 C2 08 CB    		jnz	loc_CAF9
0054+  CB25             
0055+  CB25             		; ┼ёыш v_inverse эх эюы№
0056+  CB25 3A 5C C6    		lda	v_inverse
0057+  CB28 B7          		ora	a
0058+  CB29 CA 38 CB    		jz	loc_CB29
0059+  CB2C             		 ; ╚этхЁЄшЁєхь срщЄ яю рфЁхёє de
0060+  CB2C 06 08       		 mvi	b, 8
0061+  CB2E             loc_CB1F:	  ; de++
0062+  CB2E 13          		  inx	d
0063+  CB2F             		  ; *de = (*de ^ 0xFF) & 0x3F;
0064+  CB2F 1A          		  ldax	d
0065+  CB30 2F          		  cma
0066+  CB31 E6 3F       		  ani	3Fh
0067+  CB33 12          		  stax	d
0068+  CB34             		  ; ╓шъы
0069+  CB34 05          		  dcr	b
0070+  CB35 C2 2E CB    		 jnz	loc_CB1F
0071+  CB38 D1          loc_CB29:	pop	d
0072+  CB39             
0073+  CB39             		; de - рфЁхё эр ¤ъЁрэх
0074+  CB39             
0075+  CB39             		; ╤Ёртэштрхь ърцф√щ ёшьтюы шч чэръюухэхЁрЄюЁр ё ¤ъЁрэюь
0076+  CB39             
0077+  CB39 3E FF       		mvi	a, -1
0078+  CB3B 2A 0C C6    		lhld	v_charGenPtr	; ╟эръюухэхЁрЄюЁ
0079+  CB3E 01 08 00    		lxi	b, 8		; т√ёюЄр ёшьтюыр
0080+  CB41             loc_CB32:	 ; ╤ыхфє■∙шщ ёшьтюы
0081+  CB41 09          		 dad	b		
0082+  CB42 C5          		 push	b
0083+  CB43 D5          		 push	d
0084+  CB44 E5          		 push	h
0085+  CB45 47          		  mov	b, a
0086+  CB46 CD 56 CB    		  call	compareChar
0087+  CB49 78          		  mov	a, b
0088+  CB4A E1          		 pop	h
0089+  CB4B D1          		 pop	d
0090+  CB4C C1          		 pop	b
0091+  CB4D C2 41 CB    		jnz	loc_CB32
0092+  CB50             
0093+  CB50             		; ╟эръюухэхЁрЄюЁ эх ёюфхЁцшЄ ёшьтюыют 80-BF
0094+  CB50 FE 80       		cpi	80h
0095+  CB52 D8          		rc
0096+  CB53 C6 40       		adi	40h		
0097+  CB55 C9          		ret
0098+  CB56             
0099+  CB56             ; ---------------------------------------------------------------------------
0100+  CB56             
0101+  CB56             compareChar:	; if(a == 0xBF) return true;
0102+  CB56 FE BF       		cpi	0BFh
0103+  CB58 C8          		rz
0104+  CB59             		; ╙тхышўштрх эюьхЁ ёшьтюыр
0105+  CB59 04          		inr	b
0106+  CB5A             		; ─рыхх memcmp_hl1_de_c
0196   CB5A             .include "memcmp_hl1_de_c.inc"
0001+  CB5A             ;+---------------------------------------------------------------------------
0002+  CB5A             ; RAMFOS
0003+  CB5A             ; ╤ЁртэшЄ№ ╬╟╙ т юсЁрЄэюь эряЁртыхэшш
0004+  CB5A             ;
0005+  CB5A             ; ═р тїюфх
0006+  CB5A             ;  hl - рфЁхё 1 (ёЁртэхэшх эрўшэрхЄё  ё hl-1)
0007+  CB5A             ;  de - рфЁхё 2 (ёЁртэхэшх эрўшэрхЄё  ё de)
0008+  CB5A             ;  ё  - ЁрчьхЁ
0009+  CB5A             ; 
0010+  CB5A             ; ═р т√їюфх
0011+  CB5A             ;  z  - хёыш сыюъш Ёртэ√
0012+  CB5A             ; 
0013+  CB5A             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0014+  CB5A             ;----------------------------------------------------------------------------
0015+  CB5A             
0016+  CB5A             memcmp_hl1_de_c: ; if(*de-- != *--hl) return;
0017+  CB5A 1A          		 ldax	d
0018+  CB5B 1B          		 dcx	d
0019+  CB5C 2B          		 dcx	h
0020+  CB5D BE          		 cmp	m
0021+  CB5E C0          		 rnz
0022+  CB5F             		 ; c--
0023+  CB5F 0D          		 dcr	c
0024+  CB60 C8          		 rz
0025+  CB61 C3 5A CB    		jmp	memcmp_hl1_de_c
0197   CB64             .include "hl_div_2.inc"
0001+  CB64             ;+---------------------------------------------------------------------------
0002+  CB64             ; RAMFOS
0003+  CB64             ; ─хыхэшх HL эр фтр
0004+  CB64             ;
0005+  CB64             ; 2013-11-01 vinxru
0006+  CB64             ;----------------------------------------------------------------------------                   
0007+  CB64             
0008+  CB64             hl_div_2:	; ╬сэєы хь Їыру C
0009+  CB64 AF          		xra	a
0010+  CB65 0F          		rrc
0011+  CB66                             ; ╤фтшурхь H		
0012+  CB66 7C          		mov	a, h
0013+  CB67 1F          		rar
0014+  CB68 67          		mov	h, a
0015+  CB69                             ; ╤фтшурхь L
0016+  CB69 7D          		mov	a, l
0017+  CB6A 1F          		rar
0018+  CB6B 6F          		mov	l, a
0019+  CB6C C9          		ret0198   CB6D             .include "fullClearScreen.inc"
0001+  CB6D             ;+---------------------------------------------------------------------------
0002+  CB6D             ; RAMFOS
0003+  CB6D             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C84E
0004+  CB6D             ; ╬ўшёЄър тёхую ¤ъЁрэр ё юЄъы■ўхэшхь ёыєцхсэ√ї ёЄЁюъ
0005+  CB6D             ;
0006+  CB6D             ; ╤юїЁрэ хЄ тёх ЁхушёЄЁ√
0007+  CB6D             ;
0008+  CB6D             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0009+  CB6D             ;----------------------------------------------------------------------------                   
0010+  CB6D             
0011+  CB6D             fullClearScreen:
0012+  CB6D F5          		push	psw
0013+  CB6E             
0014+  CB6E             		; ▌Єр яхЁхьхээр  тъы■ўрхЄ юўшёЄъє тёхую ¤ъЁрэр
0015+  CB6E 3E 1F       		mvi	a, 1Fh
0016+  CB70 32 10 D2    		sta	v_dblClear
0017+  CB73             
0018+  CB73             		; ╧хўрЄ№ ёшьтюыр 1Fh ш юётюсюцфхэшх ёЄхър
0019+  CB73             		; call	printCharA
0020+  CB73             		; pop	psw
0021+  CB73             		; ret		
0022+  CB73 C3 8B CB    		jmp	printCharA_popret0199   CB76             .include "printHex.inc"
0001+  CB76             ;+---------------------------------------------------------------------------
0002+  CB76             ; RAMFOS
0003+  CB76             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C815
0004+  CB76             ; ┬√тюф 16-Ёшўэюую ўшёыр эр ¤ъЁрэх
0005+  CB76             ;
0006+  CB76             ; ═р тїюфх
0007+  CB76             ;  A - ўшёыю
0008+  CB76             ;
0009+  CB76             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0010+  CB76             ;----------------------------------------------------------------------------
0011+  CB76             
0012+  CB76 F5          printHex:	push	psw
0013+  CB77 0F          		rrc
0014+  CB78 0F          		rrc
0015+  CB79 0F          		rrc
0016+  CB7A 0F          		rrc
0017+  CB7B CD 7F CB    		call	printHex_1
0018+  CB7E F1          		pop	psw
0019+  CB7F F5          printHex_1:	push	psw
0020+  CB80 E6 0F       		ani	0Fh
0021+  CB82 FE 0A       		cpi	10
0022+  CB84 FA 89 CB    		jm	printHex_2
0023+  CB87 C6 07       		 adi	7
0024+  CB89 C6 30       printHex_2:	adi	'0'
0025+  CB8B             printCharA_popret:
0026+  CB8B CD DF C8    		call	printCharA
0027+  CB8E F1          pop_psw_ret:	pop	psw
0028+  CB8F C9          		ret
0200   CB90             #if FAST_PRINT
0201   CB90             .include "printChar_fast.inc"
0001+  CB90             ;----------------------------------------------------------------------------
0002+  CB90             ; RAMFOS
0003+  CB90             ; ╙ёъюЁхээр  ЇєэъЎш  т√тюфх ёшьтюыр эр ¤ъЁрэ.
0004+  CB90             ;
0005+  CB90             ; ═р тїюфх:
0006+  CB90             ;  ё - ёшьтюы
0007+  CB90             ;
0008+  CB90             ; 2013-11-01 ╨рчЁрсюЄрэю vinxru
0009+  CB90             ;----------------------------------------------------------------------------
0010+  CB90             
0011+  CB90 E5          printChar:	push	h
0012+  CB91 D5          		push	d
0013+  CB92 C5          		push	b
0014+  CB93 F5          		push	psw
0015+  CB94 CD A2 CB    printChar_pol:	 call	printChar_int
0016+  CB97 F1          		pop	psw
0017+  CB98 C1          popa_ret:	pop	b
0018+  CB99 D1          		pop	d
0019+  CB9A E1          		pop	h
0020+  CB9B C9          		ret
0021+  CB9C             
0022+  CB9C             ; ---------------------------------------------------------------------------
0023+  CB9C             
0024+  CB9C 2A 3E C6    printCharAll:	lhld	v_cursorPos		
0025+  CB9F C3 02 CC    		jmp	printChar_0
0026+  CBA2             
0027+  CBA2             ; ---------------------------------------------------------------------------
0028+  CBA2             
0029+  CBA2             printChar_int:	
0030+  CBA2~            #if NO_PRINTER==0
0031+  CBA2~            		; ┼ёыш тъы■ўхэ ¤їю Ёхцшь эр яЁшэЄхЁ
0032+  CBA2~            		lda	v_printerEcho
0033+  CBA2~            		cpi	0D2h
0034+  CBA2~            		cz	doPrinterEcho
0035+  CBA2             #endif
0036+  CBA2             		; hl - яюыюцхэшх ъєЁёюЁр т яшъёхы ї		
0037+  CBA2 2A 3E C6    		lhld	v_cursorPos		
0038+  CBA5             
0039+  CBA5             		; ╤ыєцхсэ√х ёшьтюы√
0040+  CBA5 79          		mov	a, c		; ╤шьтюы		
0041+  CBA6 FE 1F       		cpi	1Fh
0042+  CBA8 CA 7D CE    		jz	clearScreen
0043+  CBAB             
0044+  CBAB             		; ┼ёыш ёшьтюы >0x1F, яЁюяєёърхь яЁютхЁъш эшцх
0045+  CBAB D2 DB CB    		jnc	fast		
0046+  CBAE             
0047+  CBAE FE 18       		cpi	18h
0048+  CBB0 CA FC CD    		jz	cursorRight
0049+  CBB3 FE 08       		cpi	8
0050+  CBB5 CA 18 CE    		jz	cursorLeft
0051+  CBB8 FE 19       		cpi	19h
0052+  CBBA CA 24 CE    		jz	cursorUp
0053+  CBBD FE 1A       		cpi	1Ah
0054+  CBBF CA 0A CE    		jz	cursorDown
0055+  CBC2 FE 0C       		cpi	0Ch
0056+  CBC4 CA C3 CE    		jz	loc_CE4B
0057+  CBC7 FE 0A       		cpi	0Ah
0058+  CBC9 CA 08 CE    		jz	cursorCrLf
0059+  CBCC FE 1B       		cpi	1Bh
0060+  CBCE CA CF CC    		jz	printChar_esc
0061+  CBD1 FE 07       		cpi	7
0062+  CBD3 CA 50 D0    		jz	keySound
0063+  CBD6 FE 0D       		cpi	0Dh
0064+  CBD8 CA EA CD    		jz	saveCursorPosX0
0065+  CBDB             				
0066+  CBDB             fast:		; ┼ёыш ьхэ№°х 0x60, яхЁхїюфшь ъ яхўрЄш
0067+  CBDB FE 60       		cpi	60h
0068+  CBDD DA 02 CC    		jc	printChar_0
0069+  CBE0             
0070+  CBE0             		; ╤шьтюы√ ьхэ№°х 0x80 
0071+  CBE0 FE 80       		cpi	80h
0072+  CBE2 DA F7 CB    		jc	printChar_koi
0073+  CBE5             
0074+  CBE5             		; ╧ЁюьхцєЄюъ C0-FF яЁхюсЁрчютрЄ№ т 80-BF
0075+  CBE5 D6 40       		sui	40h
0076+  CBE7 FA 01 CC    		jm	loc_CBF1
0077+  CBEA             
0078+  CBEA             		; ╧ЁюьхцєЄюъ 80-BF яЁхюсЁрчютрЄ№ т 1-40
0079+  CBEA D6 3F       		sui	3Fh		
0080+  CBEC             
0081+  CBEC             		; ╬сЁрсрЄ√трхь яЁюьхцєЄюъ 87-BF
0082+  CBEC FE 08       		cpi	8
0083+  CBEE D2 28 CD    		jnc	printChar2
0084+  CBF1 4F          		mov	c, a
0085+  CBF2             
0086+  CBF2             		; ╧ЁюьхцєЄюъ 80-86 яЁхюсЁрчютрЄ№ т ёшьтюы√ 1-7
0087+  CBF2             		
0088+  CBF2             loc_CBE2:	; ┼ёыш ьхэ№°х 0x60, яхЁхїюфшь ъ яхўрЄш
0089+  CBF2 FE 60       		cpi	60h
0090+  CBF4 DA 02 CC    		jc	printChar_0
0091+  CBF7             
0092+  CBF7             		; ╥Ёрэёы Ўш  шч KOI-7 т KOI-8
0093+  CBF7 3A 2C C6    printChar_koi:	lda	v_koi8
0094+  CBFA B7          		ora	a
0095+  CBFB CA 02 CC    		jz	printChar_0
0096+  CBFE 79          		mov	a, c
0097+  CBFF C6 40       		adi	40h		
0098+  CC01             
0099+  CC01 4F          loc_CBF1:	mov	c, a
0100+  CC02             
0101+  CC02             printChar_0:	; ┼ёыш cursorX >= 190, Єю яхЁхтюф ёЄЁюъш
0102+  CC02 7C          		mov	a, h
0103+  CC03 FE BE       		cpi	190
0104+  CC05 D4 08 CE    		cnc	cursorCrLf
0105+  CC08             
0106+  CC08             		; ═х яючтюы хь ёэшьрЄ№ шэтхЁёш■ т ёыєцхсэ√ї ёЄЁюърї
0107+  CC08 3A 32 D2                    lda	v_screenHeight
0108+  CC0B BD          		cmp	l
0109+  CC0C DA 19 CC    		jc	printChar_u
0110+  CC0F 3A 30 D2                    lda	v_topLineHeight
0111+  CC12 BD          		cmp	l
0112+  CC13 3A 5C C6    		lda	v_inverse
0113+  CC16 DA 1B CC    		jc	printChar_i
0114+  CC19 3E FF       printChar_u:	 mvi	a, -1
0115+  CC1B 32 05 CD    printChar_i:    sta	v_inverse2
0116+  CC1E             
0117+  CC1E             		; ╙тхышўштрхь яюыюцхэшх ъєЁёюЁр
0118+  CC1E 7C          		mov	a, h
0119+  CC1F C6 03       		adi	3
0120+  CC21 32 3F C6    		sta	v_cursorPos+1	; ╧юыюцхэшх ъєЁёюЁр т яшъёхы ї
0121+  CC24             
0122+  CC24             		; ╧юыюцхэшх ъєЁёюЁр т DE
0123+  CC24 EB          		xchg
0124+  CC25             
0125+  CC25             		; ╨рёўхЄ рфЁхёр ёшьтюыр ш чэръюьхёЄр
0126+  CC25 CD 07 CD    		call	calcCharAddr3
0127+  CC28             
0128+  CC28             		; ╩юё ъ т ъююЁфшэрЄрї
0129+  CC28 7B          		mov	a, e
0130+  CC29 DE 08       		sbi	8
0131+  CC2B 5F          		mov	e, a
0132+  CC2C             
0133+  CC2C 06 09       		mvi	b, 9
0134+  CC2E             
0135+  CC2E             		; ─єсышЁютрЄ№ ёЄЁюъє?
0136+  CC2E AF          		XRA	A
0137+  CC2F B6          		ORA	M
0138+  CC30 3A 05 CD    		LDA	v_inverse2
0139+  CC33 F2 37 CC    		JP	drawCharDbl		
0140+  CC36 AE          		 XRA	M
0141+  CC37             drawCharDbl:
0142+  CC37             		 		 
0143+  CC37 2B          		dcx	h
0144+  CC38 0D          		dcr c
0145+  CC39 0D          		dcr c
0146+  CC3A 0D          		dcr c
0147+  CC3B CA 9F CC    		jz printCharS4
0148+  CC3E 0D          		dcr c
0149+  CC3F CA 87 CC    		jz printCharS2
0150+  CC42 0D          		dcr c
0151+  CC43 CA 6F CC    		jz printCharS0
0152+  CC46             
0153+  CC46             ;----------------------------------------------------------------------------
0154+  CC46             ; ╤фтшу эр 6
0155+  CC46             
0156+  CC46 CD 49 CC    printCharS6:	CALL	printCharS6_0
0157+  CC49 1F          printCharS6_0:	 RAR
0158+  CC4A 1F          		 RAR
0159+  CC4B 1F          		 RAR
0160+  CC4C 1F          		 RAR
0161+  CC4D F5          		 PUSH	PSW
0162+  CC4E E6 03       		  ANI	00000011b
0163+  CC50 4F          		  MOV	C, A
0164+  CC51 1A          		  LDAX	D
0165+  CC52 E6 FC       		  ANI	11111100b
0166+  CC54 A9          		  XRA	C
0167+  CC55 12          		  STAX	D
0168+  CC56 14          		  INR	D
0169+  CC57 F1          		 POP	PSW
0170+  CC58 1F          		 RAR
0171+  CC59 E6 F0       		 ANI	11110000b
0172+  CC5B 4F          		 MOV	C, A
0173+  CC5C 1A          		 LDAX	D
0174+  CC5D E6 0F       		 ANI	00001111b
0175+  CC5F A9          		 XRA	C
0176+  CC60 12          		 STAX	D
0177+  CC61 15          		 DCR	D
0178+  CC62 13          		 INX	D
0179+  CC63 23          		 INX	H
0180+  CC64 3A 05 CD    		 LDA	v_inverse2
0181+  CC67 AE          		 XRA	M
0182+  CC68 05          		 DCR	B
0183+  CC69 C2 49 CC    		JNZ	printCharS6_0
0184+  CC6C C3 C3 CC    		JMP	drawChar_ll
0185+  CC6F             
0186+  CC6F             ;----------------------------------------------------------------------------
0187+  CC6F             ; ╤фтшу эр 0
0188+  CC6F             
0189+  CC6F CD 72 CC    printCharS0:    CALL	printCharS0_0
0190+  CC72             printCharS0_0:
0191+  CC72 87          		 ADD	A
0192+  CC73 87          		 ADD	A
0193+  CC74 4F          		 MOV	C, A
0194+  CC75 1A          		 LDAX	D
0195+  CC76 E6 03       		 ANI	00000011b
0196+  CC78 A9          		 XRA	C
0197+  CC79 12          		 STAX	D
0198+  CC7A 13          		 INX	D
0199+  CC7B 23          		 INX	H
0200+  CC7C 3A 05 CD    		 LDA	v_inverse2
0201+  CC7F AE          		 XRA	M
0202+  CC80 05          		 DCR	B
0203+  CC81 C2 72 CC    		JNZ	printCharS0_0
0204+  CC84 C3 C3 CC    		JMP	drawChar_ll
0205+  CC87             	
0206+  CC87             ;----------------------------------------------------------------------------
0207+  CC87             ; ╤фтшу эр 2
0208+  CC87             
0209+  CC87 CD 8A CC    printCharS2:    CALL	printCharS2_0
0210+  CC8A E6 3F       printCharS2_0:	 ANI	03Fh
0211+  CC8C 4F          		 MOV	C, A
0212+  CC8D 1A          		 LDAX	D
0213+  CC8E E6 C0       		 ANI	11000000b
0214+  CC90 A9          		 XRA	C
0215+  CC91 12          		 STAX	D
0216+  CC92 13          		 INX	D
0217+  CC93 23          		 INX	H
0218+  CC94 3A 05 CD    		 LDA	v_inverse2
0219+  CC97 AE          		 XRA	M
0220+  CC98 05          		 DCR	B
0221+  CC99 C2 8A CC    		JNZ	printCharS2_0
0222+  CC9C C3 C3 CC    		JMP	drawChar_ll
0223+  CC9F             
0224+  CC9F             ;----------------------------------------------------------------------------
0225+  CC9F             ; ╤фтшу эр 4
0226+  CC9F             
0227+  CC9F CD A2 CC    printCharS4:	CALL	printCharS4_0
0228+  CCA2 1F          printCharS4_0:	 RAR
0229+  CCA3 1F          		 RAR
0230+  CCA4 F5          		 PUSH	PSW
0231+  CCA5 E6 0F       		  ANI	00001111b
0232+  CCA7 4F          		  MOV	C, A
0233+  CCA8 1A          		  LDAX	D
0234+  CCA9 E6 F0       		  ANI	11110000b
0235+  CCAB A9          		  XRA	C
0236+  CCAC 12          		  STAX	D
0237+  CCAD 14          		  INR	D
0238+  CCAE F1          		 POP	PSW
0239+  CCAF 1F          		 RAR
0240+  CCB0 E6 C0       		 ANI	011000000b
0241+  CCB2 4F          		 MOV	C, A
0242+  CCB3 1A          		 LDAX	D
0243+  CCB4 E6 3F       		 ANI	000111111b
0244+  CCB6 A9          		 XRA	C
0245+  CCB7 12          		 STAX	D
0246+  CCB8 15          		 DCR	D
0247+  CCB9 13          		 INX	D
0248+  CCBA 23          		 INX	H
0249+  CCBB 3A 05 CD    		 LDA	v_inverse2
0250+  CCBE AE          		 XRA	M
0251+  CCBF 05          		 DCR	B
0252+  CCC0 C2 A2 CC    		JNZ	printCharS4_0
0253+  CCC3             
0254+  CCC3             ;----------------------------------------------------------------------------
0255+  CCC3             
0256+  CCC3 2B          drawChar_ll:	DCX	H
0257+  CCC4 AF          		XRA	A
0258+  CCC5 B6          		ORA	M
0259+  CCC6 3A 05 CD    		LDA	v_inverse2
0260+  CCC9 F2 CD CC    		JP	drawCharDbl2
0261+  CCCC AE          		 XRA	M
0262+  CCCD 04          drawCharDbl2:	INR	B
0263+  CCCE C9          		RET
0264+  CCCF             
0265+  CCCF             ; ---------------------------------------------------------------------------
0266+  CCCF             
0267+  CCCF 21 D5 CC    printChar_esc:	lxi	h, printChar_esc1		
0268+  CCD2 C3 E7 CC    		jmp	setEscMode
0269+  CCD5             		
0270+  CCD5             ; ---------------------------------------------------------------------------
0271+  CCD5             
0272+  CCD5             printChar_esc1:	; ╬сЁрсюЄър яхЁтюую ёшьтюыр ESC-яюёыхфютрЄхы№эюёЄш
0273+  CCD5             
0274+  CCD5             		; ┼ёыш ёшьтюы Y, яхЁхщЄш ъ юсЁрсюЄъх тЄюЁюую ёшьтюыр
0275+  CCD5 79          		mov	a, c
0276+  CCD6 FE 59       		cpi	'Y'
0277+  CCD8 21 EB CC    		lxi	h, printChar_esc2
0278+  CCDB CA E7 CC    		jz	setEscMode
0279+  CCDE             
0280+  CCDE 2A 3E C6    		lhld	v_cursorPos
0281+  CCE1 CD 02 CC    		call	printChar_0
0282+  CCE4             
0283+  CCE4 21 A2 CB    setEscMode0:	lxi	h, printChar_int
0284+  CCE7 22 95 CB    setEscMode:	shld	printChar_pol+1
0285+  CCEA C9          		ret
0286+  CCEB             
0287+  CCEB             ; ---------------------------------------------------------------------------
0288+  CCEB             
0289+  CCEB             printChar_esc2:	; ┬√ўхёЄ№ шч сєът√ 20h
0290+  CCEB 79          		mov	a, c
0291+  CCEC D6 20       		sui	20h
0292+  CCEE 32 3E D2    		sta	v_escRow
0293+  CCF1 21 F7 CC    		lxi	h, printChar_esc3
0294+  CCF4 C3 E7 CC    		jmp	setEscMode		
0295+  CCF7             
0296+  CCF7             ; ---------------------------------------------------------------------------
0297+  CCF7             
0298+  CCF7             printChar_esc3:	; ┬√ўхёЄ№ шч сєът√ 20h
0299+  CCF7 79          		mov	a, c
0300+  CCF8 D6 20       		sui	20h
0301+  CCFA 6F          		mov	l, a
0302+  CCFB 3A 3E D2    		lda	v_escRow
0303+  CCFE 67          		mov	h, a
0304+  CCFF CD 88 CD    		call	setCursorPos
0305+  CD02 C3 E4 CC    		jmp	setEscMode0
0306+  CD05             		
0307+  CD05 00          v_inverse2:	.db 00202   CD06~            #else
0203   CD06~            .include "printChar.inc"
0204   CD06             #endif
0205   CD06             .include "calcCharAddr.inc"
0001+  CD06             ;----------------------------------------------------------------------------
0002+  CD06             ; RAMFOS
0003+  CD06             ; ╨рёўхЄ рЁхёр ёшьтюыр т тшфхюярь Єш ярь Єш ш чэръюухэхЁрЄюЁх
0004+  CD06             ;
0005+  CD06             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CD06             ;----------------------------------------------------------------------------
0007+  CD06             
0008+  CD06             calcCharAddr2:	; ╩рър  Єю їЁхэ№
0009+  CD06 41          		mov	b, c
0010+  CD07 32 10 D2    calcCharAddr3:	sta	v_dblClear
0011+  CD0A             
0012+  CD0A             		; hl = charGen + c * 8
0013+  CD0A D5          		push	d
0014+  CD0B 2A 0C C6    		 lhld	v_charGenPtr
0015+  CD0E EB          		 xchg
0016+  CD0F 69          		 mov	l, c
0017+  CD10 26 00       		 mvi	h, 0
0018+  CD12 29          		 dad	h
0019+  CD13 29          		 dad	h
0020+  CD14 29          		 dad	h
0021+  CD15 19          		 dad	d
0022+  CD16 D1          		pop	d
0023+  CD17             
0024+  CD17             ; ╧юыєўшЄ№ рфЁхё ш ёьх∙хэшх ёшьтюыр эр ¤ъЁрэх яю ъююЁфшэрЄрь
0025+  CD17             ; ┬їюф: de - ъююЁфшэрЄ√
0026+  CD17             ; ┬√їюф: de - рфЁхё, c - ёьх∙хэшх
0027+  CD17             		
0028+  CD17             calcCharAddr:	; c = (d & 3)
0029+  CD17 7A          		mov	a, d		
0030+  CD18 E6 03       		ani	3
0031+  CD1A 4F          		mov	c, a
0032+  CD1B 3E 05       		mvi	a, 5
0033+  CD1D 91          		sub	c
0034+  CD1E 4F          		mov	c, a
0035+  CD1F             	
0036+  CD1F             		; d = d / 4 + 0x90		
0037+  CD1F 7A          		mov	a, d		
0038+  CD20 E6 FC       		ani	0FCh
0039+  CD22 0F          		rrc
0040+  CD23 0F          		rrc
0041+  CD24 C6 90       		adi	90h
0042+  CD26 57          		mov	d, a
0043+  CD27 C9          		ret
0206   CD28             .include "printChar2.inc"
0001+  CD28             ;+---------------------------------------------------------------------------
0002+  CD28             ; RAMFOS
0003+  CD28             ; ╬сЁрсюЄър ёяхЎшры№э√ї ъюфют ёшьтюыют
0004+  CD28             ;
0005+  CD28             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CD28             ;----------------------------------------------------------------------------
0007+  CD28             
0008+  CD28 D6 21       printChar2:	sui	21h
0009+  CD2A D2 E7 D0    		jnc	setColorChar
0010+  CD2D C6 19       		adi	19h
0011+  CD2F CA 12 D1    		jz	popColor	; 87h ┬юёёЄрэютэшх ъюфр ЎтхЄр шч ёЄхър
0012+  CD32 3D          		dcr	a
0013+  CD33 CA F5 C7    		jz	pushColor	; 88h ╟ряюьшэрэшх ъюфр ЎтхЄр яю яЁшэЎшяє ёЄхър (уыєсшэр 2 ЎтхЄр)
0014+  CD36 3D          		dcr	a
0015+  CD37 CA 07 D1    		jz	inverseColor	; 89h ╚этхЁёш  ъюфр ЎтхЄр
0016+  CD3A 3D          		dcr	a
0017+  CD3B CA 4E CA    		jz	changeInverse	; 8Ah ╚этхЁёш  Їюэр ўхЁэюсхыюую ¤ъЁрэр (шэтхЁёш  шэтхЁёшш)
0018+  CD3E 3D          		dcr	a
0019+  CD3F CA 51 CA    		jz	setInverseNeg	; 8Bh ╙ёЄрэютър ётхЄыюую Їюэр ўхЁэю-схыюую ¤ъЁрэр (яюЄюьє ўЄю A=0 сєфхЄ шэтхЁЄшЁютрэю)
0020+  CD42 3D          		dcr	a
0021+  CD43 CA 52 CA    		jz	setInverse	; 8╤h ╙ёЄрэютър Єхьэюую Їюэр ўхЁэю-схыюую ¤ъЁрэр (яюЄюьє ўЄю A=0)
0022+  CD46 3D          		dcr	a
0023+  CD47 CA D2 C7    		jz	pushCursorLine	; 8Dh ╟ряюьшэрэшх ъєЁёюЁр ёЄЁюъш
0024+  CD4A 3D          		dcr	a
0025+  CD4B CA D9 C7    		jz	popCursorLine	; 8Eh ┬юёёЄрэютыхэшх ъєЁёюЁр ёЄЁюъш
0026+  CD4E 3D          		dcr	a
0027+  CD4F CA 13 CA    		jz	clearTopLine	; 8Fh ╬ўшёЄър тхЁїэхщ ёыєцхсэющ ёЄЁюъш
0028+  CD52 3D          		dcr	a
0029+  CD53 CA 65 CA    		jz	clearBottomLine	; 90h ╬ўшёЄър эшцэхщ ёыєцхсэющ ёЄЁюъш
0030+  CD56 3D          		dcr	a
0031+  CD57 CA 34 CE    		jz	scrollDown	; 91h ╤фтшшу ¤ъЁрэр тэшї юЄ ъєЁёюЁр
0032+  CD5A 3D          		dcr	a
0033+  CD5B CA BD CD    		jz	scrollUp	; 92h ╤фтшэ ¤ъЁрэр ттхЁї юЄ ъєЁёюЁр
0034+  CD5E 3D          		dcr	a
0035+  CD5F CA DF C7    		jz	pushCursor	; 93h ╟ряюьшэрэшх ъєЁёюЁр ¤ъЁрэр
0036+  CD62 3D          		dcr	a
0037+  CD63 CA E6 C7    		jz	popCursor	; 94h ┬юёёЄрэютыхэшх ъєЁёюЁр ¤ъЁрэр
0038+  CD66 3D          		dcr	a
0039+  CD67 CA B3 C8    		jz	printFileName	; 95h ┬√тюф шьхэш Їрщыр чруЁєцхээюую ё фшёър
0040+  CD6A 3D          		dcr	a
0041+  CD6B EB          		xchg
0042+  CD6C 2A 2C C6    		lhld	v_koi8
0043+  CD6F 3D          		dcr	a
0044+  CD70 CA 36 D0    		jz	c_koi7		; 97h ┬ъы■ўхэшх Ёхцшьх KOI-7
0045+  CD73 3D          		dcr	a
0046+  CD74 CA 31 D0    		jz	c_koi8		; 98h ┬ъы■ўхэшх Ёхцшьх KOI-8
0047+  CD77 3D          		dcr	a
0048+  CD78 3D          		dcr	a
0049+  CD79 C0          		rnz			; ┬√їюф, р фры№°х 9Ah ╤фтшу ¤ъЁрэр ттхЁї юЄ эшцэхщ ёыєцх■эющ ёЄЁюъш фю Єхъє∙хщ ёЄЁюъш ъєЁёюЁр
0050+  CD7A EB          		xchg
0051+  CD7B E5          		push	h
0052+  CD7C 2C          		inr	l
0053+  CD7D 2C          		inr	l
0054+  CD7E 7D          		mov	a, l
0055+  CD7F C6 0A       		adi	10
0056+  CD81 5F          		mov	e, a
0057+  CD82 3A 32 D2    		lda	v_screenHeight
0058+  CD85 C3 C5 CD    		jmp	c_scrolUpEx0207   CD88~            #if FAST_PRINT!=1
0208   CD88~            .include "printChar3.inc"	; продолжается в setCursorPos
0209   CD88             #endif
0210   CD88             .include "setCursorPos.inc"
0001+  CD88             ;+---------------------------------------------------------------------------
0002+  CD88             ; RAMFOS
0003+  CD88             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C83C
0004+  CD88             ; ╙ёЄрэтюър/яюыєўхэш  яюыюцхэш  ъєЁёюЁр. ╩ююЁфшэрЄ√ т ёшьтюырї.
0005+  CD88             ;
0006+  CD88             ; ═р тїюфх
0007+  CD88             ;  H - эюьхЁ ёЄЁюъш
0008+  CD88             ;  L - эюьхЁ ъюыюэъш
0009+  CD88             ;
0010+  CD88             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0011+  CD88             ;----------------------------------------------------------------------------
0012+  CD88             
0013+  CD88 E5          setCursorPos:	push	h
0014+  CD89 F5          		push	psw
0015+  CD8A             
0016+  CD8A             		; ╧юьхэ Є№ H L ьхёЄрьш
0017+  CD8A 7D          		mov	a, l
0018+  CD8B 6C          		mov	l, h
0019+  CD8C 67          		mov	h, a
0020+  CD8D             
0021+  CD8D             		; l = l * 10 - 2
0022+  CD8D 3E FE       		mvi	a, -2
0023+  CD8F C6 0A       loc_CD1C:	 adi	10
0024+  CD91 2D          		 dcr	l
0025+  CD92 F2 8F CD    		jp	loc_CD1C
0026+  CD95 6F          		mov	l, a
0027+  CD96             
0028+  CD96             		; h *= 3
0029+  CD96 3E FD       		mvi	a, -3
0030+  CD98 C6 03       loc_CD25:	 adi	3
0031+  CD9A 25          		 dcr	h
0032+  CD9B F2 98 CD    		jp	loc_CD25
0033+  CD9E 67          		mov	h, a
0034+  CD9F             
0035+  CD9F             		; ╤юїЁрэшЄ№ яюыюцхэшх ъєЁёюЁр
0036+  CD9F 22 3E C6    		shld	v_cursorPos
0037+  CDA2             
0038+  CDA2 F1          		pop	psw
0039+  CDA3 E1          		pop	h
0040+  CDA4 C9          		ret0211   CDA5             .include "getCursorPos.inc"
0001+  CDA5             ;+---------------------------------------------------------------------------
0002+  CDA5             ; RAMFOS
0003+  CDA5             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F81E	
0004+  CDA5             ; ╧юыєўшЄ№ ъююЁфшэрЄ√ ъєЁёюЁр т ёшьтюырї
0005+  CDA5             ;
0006+  CDA5             ; ═р т√їюфх
0007+  CDA5             ;  h - ёЄЁюър (Y)
0008+  CDA5             ;  l - ёЄюысхЎ (X)
0009+  CDA5             ;  ╤юїЁрэ хЄ юёЄры№э√х ЁхушёЄЁ√
0010+  CDA5             ;
0011+  CDA5             ; 2013-11-01 vinxru
0012+  CDA5             ;----------------------------------------------------------------------------                   
0013+  CDA5             
0014+  CDA5 F5          getCursorPos:	push	psw
0015+  CDA6 21 FF FF    		lxi	h, -1
0016+  CDA9             
0017+  CDA9             		; h = v_cursorPosY / 10
0018+  CDA9 3A 3E C6    		lda	v_cursorPos	
0019+  CDAC 24          getCursorPos_0:	 inr	h
0020+  CDAD D6 0A       		 sui	0Ah
0021+  CDAF D2 AC CD    		jnc	getCursorPos_0
0022+  CDB2             
0023+  CDB2             		; l = v_cursorPosX / 3
0024+  CDB2 3A 3F C6    		lda	v_cursorPos+1			
0025+  CDB5 2C          getCursorPos_1:  inr	l
0026+  CDB6 D6 03       		 sui	3
0027+  CDB8 D2 B5 CD    		jnc	getCursorPos_1
0028+  CDBB             
0029+  CDBB F1          		pop	psw
0030+  CDBC C9          		ret0212   CDBD             .include "scrollUp.inc"
0001+  CDBD             ;----------------------------------------------------------------------------
0002+  CDBD             ; RAMFOS
0003+  CDBD             ; ╤фтшу ¤ъЁрэр ттхЁї
0004+  CDBD             ;
0005+  CDBD             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CDBD             ;----------------------------------------------------------------------------
0007+  CDBD             
0008+  CDBD E5          scrollUp:	push	h
0009+  CDBE 7D          		mov	a, l		; c =  (l + 2 -	word_D231)/2
0010+  CDBF             
0011+  CDBF 2A 30 D2    		lhld	v_topLineHeight
0012+  CDC2 5C          		mov	e, h		; e = word_D231
0013+  CDC3 3C          		inr	a
0014+  CDC4 3C          		inr	a
0015+  CDC5 93          c_scrolUpEx:	sub	e
0016+  CDC6 1F          		rar
0017+  CDC7 4F          		mov	c, a
0018+  CDC8             		; └фЁхё тшфхю
0019+  CDC8 26 90       		mvi	h, 90h
0020+  CDCA 54          		mov	d, h
0021+  CDCB             		; ╩юыюэъш		
0022+  CDCB 06 30       		mvi	b, 48
0023+  CDCD E5          loc_CD5A:	 push	h
0024+  CDCE D5          		 push	d
0025+  CDCF C5          		 push	b
0026+  CDD0             		  ; ╩юяшЁєхь C срщЄ
0027+  CDD0 0C          		  inr	c
0028+  CDD1 0D          		  dcr	c
0029+  CDD2 C4 EF CD    		  cnz	memcpy_hl_de_c2
0030+  CDD5             		  ; ╬ўш∙рхь яюёыхфэшх 10 срщЄ
0031+  CDD5 3A 5C C6    		  lda	v_inverse
0032+  CDD8 0E 0A       		  mvi	c, 10
0033+  CDDA 77          loc_CD67:	   mov	m, a
0034+  CDDB 2C          		   inr	l
0035+  CDDC 0D          		   dcr	c
0036+  CDDD C2 DA CD    		  jnz	loc_CD67
0037+  CDE0 C1          		 pop	b
0038+  CDE1 D1          		 pop	d
0039+  CDE2 E1          		 pop	h
0040+  CDE3             		 ; ╤ыхфє■∙р  ъюыюэър
0041+  CDE3 24          		 inr	h
0042+  CDE4 14          		 inr	d
0043+  CDE5 05          		 dcr	b
0044+  CDE6 C2 CD CD    		jnz	loc_CD5A
0045+  CDE9 E1          		pop	h
0046+  CDEA             		; ╙ёЄрэютър яюыюцхэш  ъєЁёюЁр	
0047+  CDEA 26 00       saveCursorPosX0:mvi	h, 0
0048+  CDEC C3 CB CE    		jmp	saveCursorPos
0213   CDEF             .include "memcpy_hl_de_c2.inc"
0001+  CDEF             ;+---------------------------------------------------------------------------
0002+  CDEF             ; RAMFOS
0003+  CDEF             ; ╩юяшЁютрэшх ╬╟╙
0004+  CDEF             ;
0005+  CDEF             ; ═р тїюфх
0006+  CDEF             ;  de - юЄъєфр
0007+  CDEF             ;  hl - ъєфр
0008+  CDEF             ;  ё  - ЁрчьхЁ / 2
0009+  CDEF             ; 
0010+  CDEF             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0011+  CDEF             ;----------------------------------------------------------------------------
0012+  CDEF             
0013+  CDEF 1A          memcpy_hl_de_c2:ldax	d
0014+  CDF0 77          		mov	m, a
0015+  CDF1 2C          		inr	l
0016+  CDF2 1C          		inr	e
0017+  CDF3 1A          		ldax	d
0018+  CDF4 77          		mov	m, a
0019+  CDF5 2C          		inr	l
0020+  CDF6 1C          		inr	e
0021+  CDF7 0D          		dcr	c
0022+  CDF8 C2 EF CD    		jnz	memcpy_hl_de_c2
0023+  CDFB C9          		ret
0214   CDFC             .include "cursor.inc"
0001+  CDFC             ;+---------------------------------------------------------------------------
0002+  CDFC             ; RAMFOS
0003+  CDFC             ; ╘єэъЎшш яхЁхьх∙хэш  ъєЁёюЁр
0004+  CDFC             ;
0005+  CDFC             ; ═р тїюфх т ърцфє■ ЇєэъЎш■ HL фюыцхэ ёюфхЁцрЄ№ v_cursorPos
0006+  CDFC             ;
0007+  CDFC             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0008+  CDFC             ;----------------------------------------------------------------------------
0009+  CDFC             
0010+  CDFC             cursorRight:	; ┼ёыш v_cursorX >= 190, Єю яхЁхщЄш эр эютє■ ёЄЁюъє
0011+  CDFC 7C          		mov	a, h
0012+  CDFD FE BE       		cpi	190
0013+  CDFF D2 08 CE    		jnc	cursorCrLf
0014+  CE02             
0015+  CE02             		; v_cursorX += 3
0016+  CE02 C6 03       		adi	3
0017+  CE04 67          		mov	h, a
0018+  CE05             
0019+  CE05             		; ╤юїЁрэшЄ№ эютюх яюыюцхэшх ъєЁёюЁр (shld v_cursorPos, ret)
0020+  CE05 C3 CB CE    		jmp	saveCursorPos
0021+  CE08             
0022+  CE08             ; ---------------------------------------------------------------------------
0023+  CE08             
0024+  CE08             cursorCrLf:	; v_cursorX = 0
0025+  CE08 26 00       		mvi	h, 0
0026+  CE0A             
0027+  CE0A             cursorDown:	; ┼ёыш v_cursorY > screenHeight+10, ёфтшэєЄ№ ¤ъЁрэ ттхЁї
0028+  CE0A 3A 33 D2    		lda	v_screenHeight+1
0029+  CE0D BD          		cmp	l
0030+  CE0E DA BD CD    		jc	scrollUp
0031+  CE11             
0032+  CE11             		; cursorY += 10
0033+  CE11 7D          		mov	a, l
0034+  CE12 C6 0A       		adi	10
0035+  CE14 6F          		mov	l, a
0036+  CE15             
0037+  CE15             		; ╤юїЁрэшЄ№ эютюх яюыюцхэшх ъєЁёюЁр (shld v_cursorPos, ret)
0038+  CE15 C3 CB CE    		jmp	saveCursorPos
0039+  CE18             
0040+  CE18             ; ---------------------------------------------------------------------------
0041+  CE18             
0042+  CE18             cursorLeft:	; ┼ёыш ъєЁёюЁ є ыхтюую ъЁр  ¤ъЁрэр, эшўхую эх фхырЄ№
0043+  CE18 7C          		mov	a, h
0044+  CE19 FE 02       		cpi	2
0045+  CE1B DA CB CE    		jc	saveCursorPos
0046+  CE1E             
0047+  CE1E             		; v_cursorX -= 3
0048+  CE1E D6 03       		sui	3
0049+  CE20 67          		mov	h, a
0050+  CE21             
0051+  CE21             		; ╤юїЁрэшЄ№ эютюх яюыюцхэшх ъєЁёюЁр (shld v_cursorPos, ret)
0052+  CE21 C3 CB CE    		jmp	saveCursorPos
0053+  CE24             
0054+  CE24             ; ---------------------------------------------------------------------------
0055+  CE24             
0056+  CE24             cursorUp:	; ┼ёыш ъєЁёюЁ эх эр тхЁїэхщ ёыєцхсэющ ёЄЁюъх, Єю ёфтшэєЄ№ ¤ъЁрэ ттхЁї
0057+  CE24 3A 31 D2    		lda	v_topLineHeight+1
0058+  CE27 BD          		cmp	l
0059+  CE28 D2 32 CE    		jnc	scrollDownX0
0060+  CE2B             
0061+  CE2B             		; v_cursorY -= 10
0062+  CE2B 7D          		mov	a, l
0063+  CE2C D6 0A       		sui	10
0064+  CE2E 6F          		mov	l, a
0065+  CE2F             
0066+  CE2F             		; ╤юїЁрэшЄ№ эютюх яюыюцхэшх ъєЁёюЁр (shld v_cursorPos, ret)
0067+  CE2F C3 CB CE    		jmp	saveCursorPos0215   CE32             .include "scrollDown.inc"
0001+  CE32             ;----------------------------------------------------------------------------
0002+  CE32             ; RAMFOS
0003+  CE32             ; ╤фтшу ¤ъЁрэр тэшч
0004+  CE32             ;
0005+  CE32             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CE32             ;----------------------------------------------------------------------------
0007+  CE32             
0008+  CE32             scrollDownX0:	; x = 0
0009+  CE32 26 00       		mvi	h, 0	; ┬ыш хЄ эр ЁрёўхЄ C, ёьюЄЁш эшцх
0010+  CE34             
0011+  CE34 E5          scrollDown:	push	h
0012+  CE35             		; c = cursorY - 8
0013+  CE35 7D          		mov	a, l
0014+  CE36 D6 08       		sui	8
0015+  CE38             		; if(v_cursorX != 0) c += 10
0016+  CE38 25          		dcr	h
0017+  CE39 24          		inr	h
0018+  CE3A CA 3F CE    		jz	scrollDown_0
0019+  CE3D C6 0A       		  adi	10		  
0020+  CE3F 4F          scrollDown_0:	mov	c, a
0021+  CE40             
0022+  CE40             		; l = v_screenHeight, e = h = v_screenHeight-10
0023+  CE40 2A 32 D2    		lhld	v_screenHeight
0024+  CE43 5C          		mov	e, h
0025+  CE44             
0026+  CE44             		; if(v_screenHeight < c) goto CDF9
0027+  CE44 7B          		mov	a, e
0028+  CE45 91          		sub	c
0029+  CE46 DA 6C CE    		jc	scrollDown_1
0030+  CE49             
0031+  CE49             		; ё = (v_screenHeight - c) / 2
0032+  CE49 1F          		rar
0033+  CE4A 4F          		mov	c, a
0034+  CE4B             
0035+  CE4B             		; └фЁхё эр ¤ъЁрэх. ─ы  DE, HL шфхэЄшўэ√щ, яюёъюы№ъє сєфхЄ юЄышўрЄ№ё  E, L
0036+  CE4B 26 90       		mvi	h, 90h
0037+  CE4D 54          		mov	d, h
0038+  CE4E             
0039+  CE4E             		; 48 ёЄюысЎют
0040+  CE4E 06 30       		mvi	b, 48
0041+  CE50 E5          scrollDown_2:	 push	h
0042+  CE51 D5          		 push	d
0043+  CE52 C5          		 push	b
0044+  CE53             		  ; ╩юяшЁєхь C ышэшщ
0045+  CE53 0C          		  inr	c
0046+  CE54 0D          		  dcr	c
0047+  CE55 C4 70 CE    		  cnz	memcpyb_hl_de_c2
0048+  CE58             		  ; ┬хЁїэшх 10 ышэшщ юўш∙рхь
0049+  CE58 3A 5C C6    		  lda	v_inverse
0050+  CE5B 0E 0A       		  mvi	c, 10		
0051+  CE5D 2D          scrollDown_3:	   dcr	l
0052+  CE5E 77          		   mov	m, a
0053+  CE5F 0D          		   dcr	c
0054+  CE60 C2 5D CE    		  jnz	scrollDown_3
0055+  CE63 C1          		 pop	b
0056+  CE64 D1          		 pop	d
0057+  CE65 E1          		 pop	h
0058+  CE66             		 ; ╤ыхфє■∙шщ ёЄюысхЎ
0059+  CE66 24          		 inr	h
0060+  CE67 14          		 inr	d
0061+  CE68 05          		 dcr	b
0062+  CE69 C2 50 CE    		jnz	scrollDown_2
0063+  CE6C             
0064+  CE6C             scrollDown_1:	; ┬юёёЄрэртыштрь L, юэ цх cursorY
0065+  CE6C             		; cursorX, юэ цх H сєфхЄ чрьхэхэ 0 т ЇєэъЎшш saveCursorPosX0
0066+  CE6C E1          		pop	h
0067+  CE6D C3 EA CD    		jmp	saveCursorPosX0
0216   CE70             .include "memcpyb_hl_de_c2.inc"
0001+  CE70             ;+---------------------------------------------------------------------------
0002+  CE70             ; RAMFOS
0003+  CE70             ; ╩юяшЁютрэшх ╬╟╙ т юсЁрЄэюь эряЁртыхэшш
0004+  CE70             ;
0005+  CE70             ; ═р тїюфх
0006+  CE70             ;  de - юЄъєфр
0007+  CE70             ;  hl - ъєфр
0008+  CE70             ;  ё  - ЁрчьхЁ/2
0009+  CE70             ; 
0010+  CE70             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0011+  CE70             ;----------------------------------------------------------------------------
0012+  CE70             
0013+  CE70             memcpyb_hl_de_c2:
0014+  CE70 2D          		dcr	l
0015+  CE71 1D          		dcr	e
0016+  CE72 1A          		ldax	d
0017+  CE73 77          		mov	m, a
0018+  CE74             
0019+  CE74 2D          		dcr	l
0020+  CE75 1D          		dcr	e
0021+  CE76 1A          		ldax	d
0022+  CE77 77          		mov	m, a
0023+  CE78             
0024+  CE78 0D          		dcr	c
0025+  CE79 C2 70 CE    		jnz	memcpyb_hl_de_c2
0026+  CE7C C9          		ret
0217   CE7D             .include "clearScreen.inc"
0001+  CE7D             ;----------------------------------------------------------------------------
0002+  CE7D             ; RAMFOS
0003+  CE7D             ; ╬ўшёЄшЄ№ ¤ъЁрэ
0004+  CE7D             ;
0005+  CE7D             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CE7D             ;----------------------------------------------------------------------------
0007+  CE7D             
0008+  CE7D             clearScreen:	
0009+  CE7D             #if COLOR_SUPPORT
0010+  CE7D             		; ╓тхЄ яю єьюыўрэш■
0011+  CE7D 3E F1       		mvi	a, INIT_SCREEN_COLOR
0012+  CE7F CD 0B D1    		call	setColor
0013+  CE82             #endif
0014+  CE82             clearScreen2:
0015+  CE82             		; ╤юїЁрэ хь SP
0016+  CE82 21 00 00    		lxi	h, 0
0017+  CE85 39          		dad	sp
0018+  CE86 22 2D D2    		shld	v_oldSP
0019+  CE89             
0020+  CE89             		; ╩юыюэъш
0021+  CE89 06 30       		mvi	b, 48
0022+  CE8B             
0023+  CE8B             		; ┴рщЄ фы  чрыштъш ¤ъЁрэр
0024+  CE8B 3A 5C C6    		lda	v_inverse
0025+  CE8E 57          		mov	d, a
0026+  CE8F 5F          		mov	e, a
0027+  CE90             
0028+  CE90             		; ╟рыштрхь ¤ъЁрэ. ═рўшэрхь ё 383,240.
0029+  CE90 21 F0 BF    		lxi	h, 0BFF0h
0030+  CE93 F9          loc_CE1B:	 sphl
0031+  CE94 0E 17       		 mvi	c, 17h		; 230 ёЄЁюъ
0032+  CE96 D5          loc_CE1E:	  push	d
0033+  CE97 D5          		  push	d
0034+  CE98 D5          		  push	d
0035+  CE99 D5          		  push	d
0036+  CE9A D5          		  push	d
0037+  CE9B 0D          		  dcr	c
0038+  CE9C C2 96 CE    		 jnz	loc_CE1E
0039+  CE9F 25          		dcr	h
0040+  CEA0 05          		dcr	b
0041+  CEA1 C2 93 CE    		jnz	loc_CE1B
0042+  CEA4             
0043+  CEA4             		; ┬юёёЄрэрыштрхь SP
0044+  CEA4 2A 2D D2    		lhld	v_oldSP
0045+  CEA7 F9          		sphl
0046+  CEA8             
0047+  CEA8             		; ─ры№°х ьруш  ё яхЁхьхээ√ьш ш ёЄЁюърьш ёюёЄю эш 
0048+  CEA8             
0049+  CEA8             		; ╧Ёш яхўрЄш фтющэюую ёшьтюыр 1F ёъЁ√трхь эшцэ■■ ёЄЁюъє
0050+  CEA8 21 10 D2    		lxi	h, v_dblClear
0051+  CEAB 3E 1F       		mvi	a, 1Fh
0052+  CEAD BE          		cmp	m
0053+  CEAE CC 81 CA    		cz	bottomLineHide	; ┼ёыш т√чтрэр, Єю эр т√їюфх A=0		
0054+  CEB1 32 10 D2    		sta	v_dblClear
0055+  CEB4             
0056+  CEB4 3A 30 D2    		lda	v_topLineHeight
0057+  CEB7 B7          		ora	a
0058+  CEB8 CC D5 CE    		cz	clearTopLine2
0059+  CEBB             
0060+  CEBB 3A 32 D2    		lda	v_screenHeight
0061+  CEBE FE FA       		cpi	250
0062+  CEC0 CC CF CE    		cz	sub_CE57
0063+  CEC3             
0064+  CEC3             loc_CE4B:	; cursorX = 0
0065+  CEC3 26 00       		mvi	h, 0
0066+  CEC5             
0067+  CEC5             		; cursorY = byte_D231 - 2
0068+  CEC5 3A 31 D2    		lda	v_topLineHeight+1
0069+  CEC8 3D          		dcr	a
0070+  CEC9 3D          		dcr	a
0071+  CECA 6F          		mov	l, a
0072+  CECB             		
0073+  CECB             saveCursorPos:	; ╤юїЁрэшЄ№ яюыюцхэшх ъєЁёюЁр
0074+  CECB 22 3E C6    		shld	v_cursorPos
0075+  CECE C9          		ret
0076+  CECF             
0077+  CECF             ; ---------------------------------------------------------------------------
0078+  CECF             
0079+  CECF 11 10 00    sub_CE57:	lxi	d, 10h
0080+  CED2 C3 D8 CE    		jmp	clearLine	; d - ёЄЁюър, e	- т√ёюЄр
0081+  CED5             
0082+  CED5             ; ---------------------------------------------------------------------------
0218   CED5             .include "clearLine.inc"
0001+  CED5             ;+---------------------------------------------------------------------------
0002+  CED5             ; RAMFOS
0003+  CED5             ; ╬ўшёЄшЄ№ тхЁїэ■■ ёЄЁюъє
0004+  CED5             ;
0005+  CED5             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CED5             ;----------------------------------------------------------------------------
0007+  CED5             
0008+  CED5 11 0A 0A    clearTopLine2:	lxi	d, 0A0Ah	; ёЄЁюър 10, т√ёюЄр 10
0009+  CED8             
0010+  CED8             ;----------------------------------------------------------------------------
0011+  CED8             ; RAMFOS
0012+  CED8             ; ╬ўшёЄшЄ№ яЁюшчтюы№эюх ъюы-тю ёЄЁюъ
0013+  CED8             ;
0014+  CED8             ; ═р тїюфх
0015+  CED8             ;  d - эюьхЁ ёЄЁюъш, т√°х ъюЄюЁющ ёЄЁюъш сєфєЄ юўш∙хэ√. ╤рьр ёЄЁюър эх юўш∙рхЄё 
0016+  CED8             ;  e - ъюы-тю ёЄЁюъ
0017+  CED8             ;
0018+  CED8             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0019+  CED8             ;----------------------------------------------------------------------------
0020+  CED8             
0021+  CED8 3A 5C C6    clearLine:	lda	v_inverse
0022+  CEDB 26 90       		mvi	h, 90h			; └фЁхё
0023+  CEDD 06 30       		mvi	b, 48			; ╩юы-тю ёЄюысЎют
0024+  CEDF 6A          clearRect_0:	 mov	l, d
0025+  CEE0 4B          		 mov	c, e		
0026+  CEE1 2D          clearRect_1:	  dcr	l
0027+  CEE2 0D          		  dcr	c		
0028+  CEE3 77          		  mov	m, a
0029+  CEE4 2D          		  dcr	l
0030+  CEE5 0D          		  dcr	c
0031+  CEE6 77          		  mov	m, a
0032+  CEE7 C2 E1 CE    		 jnz	clearRect_1
0033+  CEEA 24          		 inr	h
0034+  CEEB 05          		 dcr	b
0035+  CEEC C2 DF CE    		jnz	clearRect_0
0036+  CEEF C9          		ret		0219   CEF0             .include "keyWait.inc"
0001+  CEF0             ;+---------------------------------------------------------------------------
0002+  CEF0             ; RAMFOS
0003+  CEF0             ; ╬цшфрэшх эрцрЄш  ъыртш°ш ё ъєЁёюЁюь
0004+  CEF0             ;
0005+  CEF0             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CEF0             ;----------------------------------------------------------------------------
0007+  CEF0             
0008+  CEF0 E5          keyWait:	push	h
0009+  CEF1 D5          		push	d
0010+  CEF2 C5          		push	b
0011+  CEF3             		 ; ═рцрЄр ыш ъыртш°р
0012+  CEF3 CD 3D CF    		 call	keyCheck
0013+  CEF6             		 ; ┼ёыш ъыртш°р эх эрцрЄр, ьшурхь ъєЁёюЁюь, яюър эх эрцьєЄ
0014+  CEF6 CC 05 CF    		 cz	keyCursor
0015+  CEF9             		 ; ╤сЁрё√рхь Їыру v_key2
0016+  CEF9 AF          		 xra	a
0017+  CEFA 32 25 D2    		 sta	v_key2
0018+  CEFD             		 ; ═рцрЄр  ъыртш°р т v_key1
0019+  CEFD 3A 2B D2    		 lda	v_key1
0020+  CF00 C1          		pop	b		
0021+  CF01 D1          popa_ora_a_ret:	pop	d
0022+  CF02 E1          loc_CE8A:	pop	h
0023+  CF03 B7          ora_a_ret:	ora	a
0024+  CF04 C9          		ret
0220   CF05             .include "keyCursor.inc"		
0001+  CF05             ;+---------------------------------------------------------------------------
0002+  CF05             ; RAMFOS
0003+  CF05             ; ╬цшфрэшх эрцрЄш  ъыртш°ш ё ъєЁёюЁюь
0004+  CF05             ;
0005+  CF05             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CF05             ;----------------------------------------------------------------------------
0007+  CF05             
0008+  CF05             keyCursor:	; ╨шёєхь ъєЁёюЁ XOR-юь
0009+  CF05 CD 0F CF    		call	keyCursor1
0010+  CF08             		; ╤ЄшЁрхь ъєЁёюЁ XOR-юь
0011+  CF08 CD 0F CF    		call	keyCursor1
0012+  CF0B             		; ┼ёыш с√ыр эрцрЄр ъыртшр°р, т√їюфшь
0013+  CF0B C0          		rnz
0014+  CF0C             		; ┴хёъюэхўэюх юцшфрэшх
0015+  CF0C C3 05 CF    		jmp	keyCursor
0016+  CF0F             
0017+  CF0F             ;----------------------------------------------------------------------------
0018+  CF0F             
0019+  CF0F             keyCursor1:	
0020+  CF0F~            #if FAST_PRINT != 1
0021+  CF0F~            		; ╩юф ёшьтюыр ъєЁёюЁр
0022+  CF0F~            		mvi	c, 17h
0023+  CF0F~            
0024+  CF0F~            		; ╧юыюцхэшх ъєЁёюЁр т яшъёхы ї 		
0025+  CF0F~            		lhld	v_cursorPos
0026+  CF0F~            		xchg
0027+  CF0F~            
0028+  CF0F~            		; ╧юыєўхэшх шчюсЁрцхэш  ёшьтюыр hl ш рфЁхёр т тшфхюярь Єш de
0029+  CF0F~            		call	calcCharAddr2
0030+  CF0F~            
0031+  CF0F~            		; ╩юЁЁхъЄшЁютър рфЁхёр
0032+  CF0F~            		mov	a, e
0033+  CF0F~            		sui	7
0034+  CF0F~            		mov	e, a
0035+  CF0F~            
0036+  CF0F~            		; ╨шёютрэшх ъєЁёюЁр
0037+  CF0F~            		call	drawChar
0038+  CF0F             #else ;----------------------------------------------------------------------
0039+  CF0F             		; ╧юыюцхэшх ъєЁёюЁр т яшъёхы ї 		
0040+  CF0F 2A 3E C6    		lhld	v_cursorPos
0041+  CF12 EB          		xchg
0042+  CF13             
0043+  CF13             		; ╧юыєўхэшх рфЁхёр т тшфхюярь Єш de
0044+  CF13 CD 17 CD    		call calcCharAddr
0045+  CF16             
0046+  CF16             		; ╚ёїюфэ√щ ёшьтюы
0047+  CF16 21 3F 00    		lxi	h, 3Fh		 
0048+  CF19             
0049+  CF19             		; ╤фтшурхь
0050+  CF19 79          		mov	a, c		
0051+  CF1A 29          drawCursor_0:	 dad	h
0052+  CF1B 29          		 dad	h
0053+  CF1C 3D          		 dcr	a
0054+  CF1D C2 1A CF    		jnz	drawCursor_0
0055+  CF20             
0056+  CF20             		; ╓шъы b
0057+  CF20 06 08       		mvi	b, 8
0058+  CF22             drawCursor_1:	 ; *de++ ^= hl
0059+  CF22 1A          		 ldax	d
0060+  CF23 AC          		 xra	h
0061+  CF24 12          		 stax	d		 
0062+  CF25 14          		 inr	d		 
0063+  CF26 1A          		 ldax	d
0064+  CF27 AD          		 xra	l
0065+  CF28 12          		 stax	d
0066+  CF29 15          		 dcr	d
0067+  CF2A 1D          		 dcr	e		
0068+  CF2B             		 ; ╓шъы
0069+  CF2B 05          		 dcr	b
0070+  CF2C C2 22 CF    		jnz	drawCursor_1
0071+  CF2F             #endif ;---------------------------------------------------------------------
0072+  CF2F             		; ╞фхь эрцрЄш  ъыртш°ш
0073+  CF2F 21 FF 02    		lxi	h, CURSOR_BLINK_SPEED
0074+  CF32 CD 3D CF    keyCursor1_0:	 call	keyCheck
0075+  CF35 C0          		 rnz
0076+  CF36 2B          		 dcx	h
0077+  CF37 7C          		 mov	a, h
0078+  CF38 B5          		 ora	l
0079+  CF39 C2 32 CF    		jnz	keyCursor1_0
0080+  CF3C C9          		ret0221   CF3D             .include "keyCheck.inc"
0001+  CF3D             ;----------------------------------------------------------------------------
0002+  CF3D             ; RAMFOS
0003+  CF3D             ; └тЄюяютЄюЁ ъыртшрЄєЁ√ ш ¤їюяхўрЄ№ (юсхЁЄър эрф ёърэшЁютрэшх ъыртшрЄєЁ√)
0004+  CF3D             ;
0005+  CF3D             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CF3D             ;----------------------------------------------------------------------------
0007+  CF3D             
0008+  CF3D~            #if FAST_PRINT==0
0009+  CF3D~            keyScanWhilePrint:
0010+  CF3D~            		; ╬сЁрсюЄър ъыртш° тю тЁхь  т√тюфр ш ¤їюяхўрЄ№
0011+  CF3D~            
0012+  CF3D~            		; ┼ёыш v_cursorY=8 шыш 248, т√їюфшь 
0013+  CF3D~            		mov	a, e
0014+  CF3D~            		cpi	8
0015+  CF3D~            		rz
0016+  CF3D~            		cpi	248
0017+  CF3D~            		rz
0018+  CF3D~            
0019+  CF3D~            		; ┼ёыш тъы■ўхэ ¤їю Ёхцшь эр яЁшэЄхЁ
0020+  CF3D~            		lda	v_printerEcho
0021+  CF3D~            		cpi	0D2h
0022+  CF3D~            		jz	doPrinterEcho
0023+  CF3D             #endif
0024+  CF3D             		
0025+  CF3D             keyCheck:
0026+  CF3D             		; ╩ръющ Єю Їыру
0027+  CF3D 3A 25 D2    		lda	v_key2
0028+  CF40 B7          		ora	a
0029+  CF41 C0          		rnz
0030+  CF42             
0031+  CF42             		; ╫Єю Єю ёўшЄрхь
0032+  CF42 E5          		push	h
0033+  CF43 D5          		push	d
0034+  CF44 2A 29 D2    		 lhld	v_key0
0035+  CF47 EB          		 xchg
0036+  CF48 2A 2B D2    		 lhld	v_key1
0037+  CF4B CD 5B CF    		 call	sub_CEE2
0038+  CF4E 22 2B D2    		 shld	v_key1	; ═рцрЄр  ъыртш°р т L
0039+  CF51 EB          		 xchg
0040+  CF52 22 29 D2    		 shld	v_key0
0041+  CF55 32 25 D2    		 sta	v_key2
0042+  CF58             
0043+  CF58             		; pop d
0044+  CF58             		; pop h
0045+  CF58             		; ora a
0046+  CF58             		; ret
0047+  CF58 C3 01 CF    		jmp	popa_ora_a_ret
0048+  CF5B             
0049+  CF5B             ; ---------------------------------------------------------------------------
0050+  CF5B             
0051+  CF5B             sub_CEE2:	; ╧юыєўшЄ№ ъюф эрцрЄющ ъыртш°ш
0052+  CF5B CD 81 CF    		call	keyScan
0053+  CF5E             
0054+  CF5E             		; ┼ёыш эрцрЄр  ъыртш°р эх L
0055+  CF5E BD          		cmp	l
0056+  CF5F 6F          		mov	l, a
0057+  CF60 C2 7A CF    		jnz	loc_CF01
0058+  CF63             
0059+  CF63             		; ┼ёыш ъыртш°р эх с√ыр эрцрЄр, т√їюфшь ё ъюфюь 0
0060+  CF63 3C          		inr	a
0061+  CF64 C8          		rz
0062+  CF65             
0063+  CF65             		; ╙ьхэ№°рхь DE, ш хёыш юэ эх эєыхтющ, т√їюфшь ё ъюфюь 0
0064+  CF65 1B          		dcx	d
0065+  CF66 7A          		mov	a, d
0066+  CF67 B3          		ora	e
0067+  CF68 3E 00       		mvi	a, 0
0068+  CF6A C0          		rnz
0069+  CF6B             
0070+  CF6B             		; ╟тєъютющ ёшуэры
0071+  CF6B CD 50 D0    		call	keySound
0072+  CF6E             
0073+  CF6E             		; ╚эшЎшрышчшЁєхь ёўхЄўшъ
0074+  CF6E 11 7C 01    		lxi	d, 17Ch
0075+  CF71             
0076+  CF71             		; ┼ёыш H=0, т√їюфшь ё ъюфюь 0FFh
0077+  CF71 25          		dcr	h
0078+  CF72 3E FF       		mvi	a, 0FFh
0079+  CF74 C8          		rz
0080+  CF75             
0081+  CF75             		; ┬ючтЁр∙рхь H
0082+  CF75 24          		inr	h
0083+  CF76             
0084+  CF76             		; ╚эшЎшрышчшЁєхь ёўхЄўшъ
0085+  CF76 11 1C 00    		lxi	d, 1Ch
0086+  CF79 C9          		ret
0087+  CF7A             ; ---------------------------------------------------------------------------
0088+  CF7A             
0089+  CF7A             loc_CF01:	; ╟ряшё√трхь H=1
0090+  CF7A 26 01       		mvi	h, 1
0091+  CF7C             
0092+  CF7C             		; ┬√їюфшь ё ъюфюь 0
0093+  CF7C AF          		xra	a        	
0094+  CF7D             
0095+  CF7D             		; ╚эшЎшрышчшЁєхь ёўхЄўшъ
0096+  CF7D 11 30 00    		lxi	d, 30h
0097+  CF80 C9          		ret
0098+  CF81             
0099+  CF81             ; ---------------------------------------------------------------------------
0222   CF81             .include "keyScan.inc"		; продолжается в keySound
0001+  CF81             ;----------------------------------------------------------------------------
0002+  CF81             ; RAMFOS
0003+  CF81             ; ╤ърэшЁютрэшх ъыртшрЄєЁ√
0004+  CF81             ;
0005+  CF81             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  CF81             ;----------------------------------------------------------------------------
0007+  CF81             
0008+  CF81             keyScan:		; ╤юїЁрэ хь ЁхушёЄЁ√ BC, DE, HL
0009+  CF81 E5          		push	h
0010+  CF82 D5          		push	d
0011+  CF83 C5          		push	b
0012+  CF84 CD 9D CF    		 call	keyScan_0
0013+  CF87 C1          		pop	b
0014+  CF88 D1          		pop	d
0015+  CF89 E1          		pop	h
0016+  CF8A             
0017+  CF8A             		; ╘ыру Z
0018+  CF8A B7          		ora	a
0019+  CF8B             		
0020+  CF8B             keyMode82:	; ┬юёёЄрэрыштрхь шэфшърЄюЁ ╨╙╤/LAT
0021+  CF8B             		; ┬√ч√трхЄё  шч biosinit.inc
0022+  CF8B             
0023+  CF8B             		; ╤юїЁрэ хь Ёхчєы№ЄрЄ
0024+  CF8B F5          		push	psw
0025+  CF8C             		 ; ─рыхх єёЄрэрыштрхь Ёхцшь ъыртшрЄєЁ√ 82h
0026+  CF8C 3E 82       		 mvi	a, 82h
0027+  CF8E 32 E3 FF    		 sta	IO_KEYB_MODE
0028+  CF91             		 ; ╙ёЄрэрыштрхь ётхЄюфшюф ╨╙╤/╦└╥
0029+  CF91 3A 2D C6    		 lda	v_rusLat
0030+  CF94 E6 01       		 ani	1
0031+  CF96 F6 0C       		 ori	0Ch
0032+  CF98 32 E3 FF    		 sta	IO_KEYB_MODE
0033+  CF9B F1          		pop	psw
0034+  CF9C             
0035+  CF9C C9          		ret
0036+  CF9D             
0037+  CF9D             ; ---------------------------------------------------------------------------
0038+  CF9D             
0039+  CF9D             keyScan_0:	; ╧юыєўрхь эюьхЁ Ё фр эрцрЄющ ъыртш°ш т B
0040+  CF9D CD 8B CF    		call	keyMode82
0041+  CFA0 3A E1 FF    		lda	IO_KEYB_B
0042+  CFA3 47          		mov	b, a
0043+  CFA4             
0044+  CFA4             		; ┼ёыш эш юфэр ъыртш°р эх эрцрЄр, т√їюфшь
0045+  CFA4 F6 03       		ori	3
0046+  CFA6 FE FF       		cpi	0FFh
0047+  CFA8 C8          		rz
0048+  CFA9             
0049+  CFA9             		; ╧юыєўрхь эюьхЁ ъюыюэъш эрцрЄющ ъыртш°ш т HL
0050+  CFA9 3E 91       		mvi	a, 91h
0051+  CFAB 32 E3 FF    		sta	IO_KEYB_MODE
0052+  CFAE 3A E0 FF    		lda	IO_KEYB_A
0053+  CFB1 6F          		mov	l, a		
0054+  CFB2 3A E2 FF    		lda	IO_KEYB_C
0055+  CFB5 F6 F0       		ori	0F0h
0056+  CFB7 67          		mov	h, a
0057+  CFB8             
0058+  CFB8             		; ┼ёыш ъюыюэър эх эрцрЄр шыш эрцрЄр юёюср  ъюьсшэрЎш , т√їюфшь.
0059+  CFB8             		; ╧Ёш ¤Єюь ьюцхЄ с√Є№ тючтЁр∙хэр хЁєэфр!
0060+  CFB8 BD          		cmp	l
0061+  CFB9 C8          		rz
0062+  CFBA             		
0063+  CFBA             		; ╧юьх∙рхь т L эюьхЁ яхЁтюую эєыхтюую сшЄр шч HL
0064+  CFBA 3E FB       		mvi	a, 0FBh
0065+  CFBC 3C          keyScan_1:	 inr	a
0066+  CFBD 29          		 dad	h
0067+  CFBE DA BC CF    		 jc	keyScan_1
0068+  CFC1 6F          		mov	l, a
0069+  CFC2             
0070+  CFC2             		; ╧юьх∙рхь т ╤ эюьхЁ яхЁтюую эєыхтюую сшЄр шч B
0071+  CFC2 78          		mov	a, b
0072+  CFC3 F6 03       		ori	3
0073+  CFC5 37          		stc
0074+  CFC6 0E FD       		mvi	c, 0FDh
0075+  CFC8 0C          keyScan_2:	 inr	c
0076+  CFC9 1F          		 rar
0077+  CFCA DA C8 CF    		jc	keyScan_2
0078+  CFCD             
0079+  CFCD             		; ┼ёыш эрцрЄю сюыхх юфэющ ъэюяъш
0080+  CFCD 3C          		inr	a
0081+  CFCE C2 3F D0    		jnz	specialKeysRet
0082+  CFD1             
0083+  CFD1             		; b = !b & 2
0084+  CFD1 78          		mov	a, b
0085+  CFD2 2F          		cma
0086+  CFD3 E6 02       		ani	2
0087+  CFD5 47          		mov	b, a
0088+  CFD6             
0089+  CFD6 79          		mov	a, c
0090+  CFD7 07          		rlc
0091+  CFD8 07          		rlc
0092+  CFD9 07          		rlc
0093+  CFDA 07          		rlc
0094+  CFDB B5          		ora	l
0095+  CFDC             
0096+  CFDC             		; a = keybMap[a]
0097+  CFDC 5F          		mov	e, a		
0098+  CFDD 16 00       		mvi	d, 0
0099+  CFDF 2A 0E C6    		lhld	v_keybMap
0100+  CFE2 19          		dad	d
0101+  CFE3 7E          		mov	a, m
0102+  CFE4             
0103+  CFE4             		; ╤юїЁрэ хь эр сєфє∙хх
0104+  CFE4 4F          		mov	c, a		; c = a
0105+  CFE5             
0106+  CFE5             		; if(a < 0x21) return;
0107+  CFE5 FE 21       		cpi	21h
0108+  CFE7 D8          		rc
0109+  CFE8             
0110+  CFE8             		; ╤яхЎшры№э√х ъыртш°ш
0111+  CFE8 FE 8B       		cpi	8Bh
0112+  CFEA CA 5A C8    		jz	j_tapeMode
0113+  CFED FE 8C       		cpi	8Ch
0114+  CFEF CA 57 C8    		jz	j_printerEchoMode
0115+  CFF2             
0116+  CFF2 2A 2C C6    		lhld	v_koi8
0117+  CFF5             
0118+  CFF5 FE 81       		cpi	81h
0119+  CFF7 CA A9 D0    		jz	capsLock
0120+  CFFA FE 8A       		cpi	8Ah
0121+  CFFC CA 39 D0    		jz	inverseVideo
0122+  CFFF FE 40       		cpi	40h
0123+  D001 DA 27 D0    		jc	pressed40
0124+  D004             
0125+  D004 3A 2E C6    		lda	v_capsLock
0126+  D007 A8          		xra	b
0127+  D008 47          		mov	b, a
0128+  D009 79          		mov	a, c
0129+  D00A 24          		inr	h
0130+  D00B CA 1C D0    		jz	loc_CFA3
0131+  D00E 05          		dcr	b
0132+  D00F F8          		rm
0133+  D010 C6 20       		adi	20h ; ' '
0134+  D012 2C          		inr	l
0135+  D013 C0          		rnz
0136+  D014 C6 A0       		adi	0A0h ; 'р'
0137+  D016 FE 08       		cpi	8
0138+  D018 D0          		rnc
0139+  D019 C6 7F       		adi	7Fh ; ''
0140+  D01B C9          		ret
0141+  D01C             
0142+  D01C             ; ---------------------------------------------------------------------------
0143+  D01C             
0144+  D01C C6 20       loc_CFA3:	adi	20h ; ' '
0145+  D01E 2C          		inr	l
0146+  D01F C8          		rz
0147+  D020 C6 60       		adi	60h ; '`'
0148+  D022 05          		dcr	b
0149+  D023 F0          		rp
0150+  D024 C6 20       		adi	20h ; ' '
0151+  D026 C9          		ret
0152+  D027             
0153+  D027             ; ---------------------------------------------------------------------------
0154+  D027             
0155+  D027 05          pressed40:	dcr	b
0156+  D028 F8          		rm
0157+  D029 D6 10       		sui	10h
0158+  D02B FE 20       		cpi	20h ; ' '
0159+  D02D D0          		rnc
0160+  D02E C6 20       		adi	20h ; ' '
0161+  D030 C9          		ret
0162+  D031             
0163+  D031             ; ---------------------------------------------------------------------------
0164+  D031             
0165+  D031             c_koi8:					; CODE XREF: ROM:CCD3j
0166+  D031 7D          		mov	a, l
0167+  D032 2F          		cma
0168+  D033 C3 37 D0    		jmp	loc_CFBE
0169+  D036             ; ---------------------------------------------------------------------------
0170+  D036             
0171+  D036             c_koi7:					; CODE XREF: ROM:CCCFj
0172+  D036 7D          		mov	a, l
0173+  D037             
0174+  D037 B7          loc_CFBE:	ora	a
0175+  D038 C0          		rnz
0176+  D039             
0177+  D039 7D          inverseVideo:	mov	a, l		; l = ~l;
0178+  D03A 2F          		cma
0179+  D03B 6F          		mov	l, a
0180+  D03C             
0181+  D03C 22 2C C6    capsLockRet:    shld	v_koi8
0182+  D03F             
0183+  D03F             specialKeysRet:	; ┼ёыш эх эх т√тюфшь т ёЄЁъює ёЄрЄєёр, юсэютшЄ№ х╕
0184+  D03F 3A 3E C6    		lda	v_cursorPos
0185+  D042 FE 08       		cpi	8
0186+  D044 C4 27 CA    		cnz	printIndicators
0187+  D047             
0188+  D047             		; ╟рфхцър
0189+  D047 21 00 40    		lxi	h, 4000h	
0190+  D04A 2B          keyScan_delay:	 dcx	h
0191+  D04B 7C          		 mov	a, h
0192+  D04C B5          		 ora	l
0193+  D04D C2 4A D0    		jnz	keyScan_delay
0194+  D050             
0195+  D050             		; ╧хЁхїюф эр keySound
0223   D050             .include "keySound.inc"
0001+  D050             ;+---------------------------------------------------------------------------
0002+  D050             ; RAMFOS
0003+  D050             ; ╟тєъютющ ёшуэры яЁш эрцрЄшш ъыртш°ш
0004+  D050             ;
0005+  D050             ; 2013-11-01 vinxru
0006+  D050             ;----------------------------------------------------------------------------
0007+  D050             
0008+  D050 C5          keySound:	push	b
0009+  D051             		 ; ╫рёЄюЄр
0010+  D051 EB          		 xchg
0011+  D052 2A 4C C6    		 lhld	v_beepConfig
0012+  D055 EB          		 xchg
0013+  D056             
0014+  D056             		 ; ╧юэшцрхь ўрёЄюЄє т фтр Ёрчр, хёыш эрцрЄр ╨╙╤/LAT
0015+  D056 3A 2D C6    		 lda	v_rusLat
0016+  D059 E6 01       		 ani	1
0017+  D05B 7A          		 mov	a, d
0018+  D05C C2 60 D0    		 jnz	keySound_0
0019+  D05F 0F          		  rrc			; ╚эЄхЁхёэю, р тфЁєу CF?
0020+  D060 57          keySound_0:	 mov	d, a
0021+  D061             
0022+  D061             		 ; ╙ёЄрэрыштрхь ЄрщьхЁ (чтєъ)
0023+  D061 43          		 mov	b, e
0024+  D062 4B          		 mov	c, e
0025+  D063 B7          		 ora	a
0026+  D064 CD 92 D0    		 call	setTimer
0027+  D067 C1          		pop	b
0028+  D068             
0029+  D068             		; ─ы  ЇєэъЎшш keyScan
0030+  D068 3E FF       		mvi	a, 0FFh
0031+  D06A C9          		ret
0224   D06B             .include "oldbeep.inc"
0001+  D06B             ;+---------------------------------------------------------------------------
0002+  D06B             ; RAMFOS
0003+  D06B             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C851
0004+  D06B             ; ┬юёяЁюшчтхёЄш чтєъютющ ёшуэры ўхЁхч ┬┬55
0005+  D06B             ;
0006+  D06B             ; ╫рёЄюЄр чрфрхЄё  т v_oldBeep
0007+  D06B             ;
0008+  D06B             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0009+  D06B             ;----------------------------------------------------------------------------
0010+  D06B             
0011+  D06B F5          oldBeep:	push	psw
0012+  D06C C5          		push	b
0013+  D06D E5          		push	h
0014+  D06E 2A 4E C6    		 lhld	v_oldBeep
0015+  D071 3E 0B       oldBeep_0:	 mvi	a, 0Bh
0016+  D073 32 E3 FF    		  sta	IO_KEYB_MODE
0017+  D076 CD 89 D0    		  call	delay_l
0018+  D079 3E 0A       		  mvi	a, 0Ah
0019+  D07B 32 E3 FF    		  sta	IO_KEYB_MODE
0020+  D07E CD 89 D0    		  call	delay_l
0021+  D081 25          		  dcr	h
0022+  D082 C2 71 D0    		 jnz	oldBeep_0
0023+  D085 E1          		pop	h
0024+  D086 C1          		pop	b
0025+  D087 F1          		pop	psw
0026+  D088 C9          		ret
0225   D089             .include "delay_l.inc"
0001+  D089             ;+---------------------------------------------------------------------------
0002+  D089             ; RAMFOS
0003+  D089             ; ╟рфхЁцър
0004+  D089             ;
0005+  D089             ; ═р тїюфх
0006+  D089             ;  L - фышЄхы№эюёЄ№
0007+  D089             ;
0008+  D089             ; ═р т√їюфх
0009+  D089             ;  B - 0
0010+  D089             ;
0011+  D089             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0012+  D089             ;----------------------------------------------------------------------------
0013+  D089             
0014+  D089 45          delay_l:	mov	b, l
0015+  D08A 05          delay_l_0:	 dcr	b
0016+  D08B C2 8A D0    		jnz	delay_l_0
0017+  D08E C9          		ret
0226   D08F             .include "beep.inc"
0001+  D08F             ;+---------------------------------------------------------------------------
0002+  D08F             ; RAMFOS
0003+  D08F             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C848
0004+  D08F             ; ┬юёяЁюшчтхёЄш чтєъютющ ёшуэры ўхЁхч ┬╚53
0005+  D08F             ;
0006+  D08F             ; ═р тїюфх:
0007+  D08F             ;  de - ўрёЄюЄр
0008+  D08F             ;  bё - фышЄхы№эюёЄ№
0009+  D08F             ;  ё  - цфрЄ№ чртхЁ°хэш  яЁхф√фє∙хую чтєъютюую ёшуэрыр
0010+  D08F             ;  z  - цфрЄ№ чртхЁ°хэш  ¤Єюую чтєъютюую ёшуэрыр
0011+  D08F             ;
0012+  D08F             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0013+  D08F             ;----------------------------------------------------------------------------
0014+  D08F             
0015+  D08F             beep:		; ╬цшфрэшх чртхЁхэш  яЁю°ыюую чтєъютюую ёшуэрыр, хёыш C
0016+  D08F DC 9E D0    		cc	waitBeep		
0017+  D092             
0018+  D092             		; de-ўрёЄюЄр, bё-фышЄхы№эюёЄ№, z-цфрЄ№
0019+  D092 E5          setTimer:	push	h
0020+  D093 21 EC FF    		 lxi	h, IO_TIMER
0021+  D096 73          		 mov	m, e
0022+  D097 72          		 mov	m, d
0023+  D098 23          		 inx	h
0024+  D099 23          		 inx	h
0025+  D09A 71          		 mov	m, c
0026+  D09B 70          		 mov	m, b
0027+  D09C E1          		pop	h
0028+  D09D             
0029+  D09D             		; ╬цшфрэшх чртхЁхэш  ¤Єюую чтєъютюую ёшуэрыр, хёыш Z
0030+  D09D C0          		rnz
0031+  D09E             
0032+  D09E             waitBeep:	; ╬цшфрэшх чртхЁхэш  чтєъютюую ёшуэрыр
0033+  D09E F5          		push	psw		
0034+  D09F 3A E4 FF    waitBeep_0:	 lda	IO_EXT_A
0035+  D0A2 E6 01       		 ani	1
0036+  D0A4 CA 9F D0    		jz	waitBeep_0
0037+  D0A7 F1          		pop	psw
0038+  D0A8 C9          		ret0227   D0A9             .include "capsLock.inc"
0001+  D0A9             ;+---------------------------------------------------------------------------
0002+  D0A9             ; RAMFOS
0003+  D0A9             ; ═рцрЄшх эр ъыртш°є CAPS LOCK
0004+  D0A9             ;
0005+  D0A9             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  D0A9             ;----------------------------------------------------------------------------
0007+  D0A9             
0008+  D0A9 05          capsLock:	dcr	b
0009+  D0AA F2 B3 D0    		jp	capsLock1
0010+  D0AD 7C          		 mov	a, h
0011+  D0AE 2F          		 cma
0012+  D0AF 67          		 mov	h, a
0013+  D0B0 C3 3C D0    		jmp	capsLockRet
0014+  D0B3             
0015+  D0B3             ; ---------------------------------------------------------------------------
0016+  D0B3             
0017+  D0B3 3A 2E C6    capsLock1:	lda	v_capsLock
0018+  D0B6 EE 02       		xri	2
0019+  D0B8 32 2E C6    		sta	v_capsLock
0020+  D0BB C3 3F D0    		jmp	specialKeysRet
0228   D0BE             .include "tapeMode.inc"
0001+  D0BE             ;+---------------------------------------------------------------------------
0002+  D0BE             ; RAMFOS
0003+  D0BE             ; ╧хЁхъы■ўхэшх ёъюЁюёЄш чряшёш эр ьруэшЄюЇюэ ш Ёхцшьр яЁшэЄхЁр
0004+  D0BE             ; ┬√ч√трхЄё  яЁш эрцрЄшш эр ёююЄтхЄёЄтє■∙є■ ъыртш°є
0005+  D0BE             ;
0006+  D0BE             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  D0BE             ;----------------------------------------------------------------------------
0008+  D0BE             
0009+  D0BE             tapeMode:	; ▌Єр їшЄЁр  яЁюуЁрььр яЁюёЄю юсьхэштрхЄ ьхёЄрьш
0010+  D0BE             		; v_tapePulseB,A -> v_tapePulseB1,A1 -> v_tapePulseB2,A2
0011+  D0BE 16 04       		mvi	d, 4			; ═рфю ёфтшэєЄ№ 4 срщЄр
0012+  D0C0 1E 0B       tapeMode_0:	 mvi	e, 11			; ─ышэр тёхую ьрёёштр 12 срщЄ
0013+  D0C2 21 6B C6    		 lxi	h, v_tapePresets-1	; ╩юэхЎ ьрёёштр
0014+  D0C5 3A 60 C6    		 lda	v_tapePulseB		; ╟руЁєцрхь яхЁтюх чэрўхэшх, ъюЄюЁюх ёЁрчє цх яюьхёЄшь т ъюэхЎ
0015+  D0C8 4F          tapeMode_1:	  mov	c, a			; ╤фтшурхь 11 срщЄ
0016+  D0C9 7E          		  mov	a, m
0017+  D0CA 71          		  mov	m, c
0018+  D0CB 2B          		  dcx	h
0019+  D0CC 1D          		  dcr	e
0020+  D0CD C2 C8 D0    		 jnz	tapeMode_1
0021+  D0D0 77          		 mov	m, a			; ╚ ёюїЁрэ хь 12 срщЄ. ╧Ёю°ыюх чэрўхэшх ь√ єцх яюьхёЄшыш т эрўрыю ьрёёштр
0022+  D0D1 15          		 dcr	d			; ╧ютЄюЁ хь ¤Єю 4 Ёрчр
0023+  D0D2 C2 C0 D0    		jnz	tapeMode_0
0024+  D0D5             
0025+  D0D5             		; ╠хэ хь яхЁхьхээє■ v_tapeMode '0'->'1'->'2'->'0'
0026+  D0D5 3A 5F C6    		lda	v_tapeMode
0027+  D0D8 3C          		inr	a
0028+  D0D9 FE 33       		cpi	'3'
0029+  D0DB C2 E0 D0    		jnz	tapeMode_2
0030+  D0DE 3E 30       		 mvi	a, '0'
0031+  D0E0 32 5F C6    tapeMode_2:	sta	v_tapeMode
0032+  D0E3             
0033+  D0E3             		; ┬ючтЁр∙рхьё  т ЇєэъЎш■ юяЁюёр ъыртшрЄєЁ√
0034+  D0E3 C3 3F D0    		jmp	specialKeysRet
0229   D0E6             .include "printerEchoMode.inc"
0001+  D0E6             ;+---------------------------------------------------------------------------
0002+  D0E6             ; RAMFOS
0003+  D0E6             ; ┬ъы■ўхэшх/т√ъы■ўхэшх ¤їюяхўрЄш эр яЁшэЄхЁ
0004+  D0E6             ; ┬√ч√трхЄё  яЁш эрцрЄшш эр ёююЄтхЄёЄтє■∙є■ ъыртш°є
0005+  D0E6             ;
0006+  D0E6             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  D0E6             ;----------------------------------------------------------------------------
0008+  D0E6             
0009+  D0E6~            #if NO_PRINTER==0
0010+  D0E6~            
0011+  D0E6~            printerEchoMode:lxi	h, v_printerEcho
0012+  D0E6~            		mvi	a, 0D2h
0013+  D0E6~            		cmp	m
0014+  D0E6~            		jnz	printerEchoMode_0
0015+  D0E6~            		 xra	a
0016+  D0E6~            printerEchoMode_0:
0017+  D0E6~            		mov	m, a
0018+  D0E6~            		jmp	specialKeysRet
0019+  D0E6             #endif0230   D0E6             .include "printerHex.inc"
0001+  D0E6             ;+---------------------------------------------------------------------------
0002+  D0E6             ; RAMFOS
0003+  D0E6             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C842
0004+  D0E6             ; ╧хўрЄ№ 16-Ёшўэюую ўшёыр эр яЁшэЄхЁх
0005+  D0E6             ;
0006+  D0E6             ; ═р тїюфх
0007+  D0E6             ;  A - ўшёыю
0008+  D0E6             ;
0009+  D0E6             ; ┬ёх ЁхушёЄЁ√ ёюїЁрэ ■Єё 
0010+  D0E6             ;
0011+  D0E6             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0012+  D0E6             ;----------------------------------------------------------------------------
0013+  D0E6             
0014+  D0E6~            #if NO_PRINTER==0
0015+  D0E6~            
0016+  D0E6~            printerHex:	push	psw
0017+  D0E6~            		 rrc
0018+  D0E6~            		 rrc
0019+  D0E6~            		 rrc
0020+  D0E6~            		 rrc
0021+  D0E6~            		 call	printerHex_1
0022+  D0E6~            		pop	psw
0023+  D0E6~            printerHex_1:	push	psw
0024+  D0E6~            		 ani	0Fh
0025+  D0E6~            		 cpi	10
0026+  D0E6~            		 jm	printerHex_2
0027+  D0E6~            		  adi	'A'-'0'-10		  
0028+  D0E6~            printerHex_2:	 adi	'0'
0029+  D0E6~            		 push	b
0030+  D0E6~            		  mov	c, a
0031+  D0E6~            		  call	printer
0032+  D0E6~            		 pop	b
0033+  D0E6~            		pop	psw
0034+  D0E6~            		ret
0035+  D0E6~            
0036+  D0E6             #endif0231   D0E6             .include "printerEcho.inc"
0001+  D0E6             ;+---------------------------------------------------------------------------
0002+  D0E6             ; RAMFOS
0003+  D0E6             ; ▌їюяхўрЄ№ эр яЁшэЄхЁх
0004+  D0E6             ;
0005+  D0E6             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  D0E6             ;----------------------------------------------------------------------------
0007+  D0E6             
0008+  D0E6~            #if NO_PRINTER==0
0009+  D0E6~            
0010+  D0E6~            printerEcho_crLf:
0011+  D0E6~            		; ┬ ёєььх ъюф эшцх чрьхэ хЄ 0A шыш 0D эр ярЁє 0A, 0D. 
0012+  D0E6~            		; ═ю т ёыєўрх "0A ы■с√х ёшьтюы√ 0D", яюёыхэшщ эх фєсышЁєхЄё 
0013+  D0E6~            
0014+  D0E6~            		; ┬ьхёЄю 0A, Єю яхўрЄрхь ярЁє ёшьтюыют 0A, 0D.
0015+  D0E6~            		lxi	h, v_printerCrLf
0016+  D0E6~            		cpi	0Ah
0017+  D0E6~            		jz	printerEcho_0
0018+  D0E6~            
0019+  D0E6~            		; ┬ьхёЄю 0D, Єю яхўрЄрхь ярЁє ёшьтюыют 0A, 0D, Єюы№ъю хёыш яЁю°ы√щ яхЁхэюё с√ы 0D.
0020+  D0E6~            		; ╚эрўх т√тюфшь 0D ъръ хёЄ№, схч тЄюЁюую ёштюыр.
0021+  D0E6~            		cpi	0Dh
0022+  D0E6~            		jnz	printerEcho_spc
0023+  D0E6~            		cmp	m
0024+  D0E6~            
0025+  D0E6~            printerEcho_0:	mvi	c, 0Ah
0026+  D0E6~            		cz	printer
0027+  D0E6~            		mvi	c, 0Dh
0028+  D0E6~            		mov	m, a
0029+  D0E6~            		jmp	printer
0030+  D0E6~            
0031+  D0E6~            ; ---------------------------------------------------------------------------
0032+  D0E6~            
0033+  D0E6~            loc_D0B1:	; ┼ёыш ёшьтюы >= 0x87
0034+  D0E6~            		cpi	87h ; '╟'
0035+  D0E6~            		jnc	printerEcho_1
0036+  D0E6~            
0037+  D0E6~            printerEcho_spc:; ╟рьхэ хь ёшьтюы эр яЁюсхы
0038+  D0E6~            		mvi	c, ' '
0039+  D0E6~            
0040+  D0E6~            doPrinterEcho:	; ┼ёыш ¤Єю єфрыхэшх, т√їюфшь
0041+  D0E6~            		mov	a, c
0042+  D0E6~            		cpi	8
0043+  D0E6~            		rz
0044+  D0E6~            		; ╧хЁхтюф ъєЁёюЁр т эрўрыю ¤ъЁрэр - т√їюфшь
0045+  D0E6~            		cpi	0Ch
0046+  D0E6~            		rz
0047+  D0E6~            		; ┼ёыш <= 0x18
0048+  D0E6~            		cpi	18h
0049+  D0E6~            		jc	printerEcho_crLf
0050+  D0E6~            		; ┼ёыш <= 0x1C т√їюфшь
0051+  D0E6~            		cpi	1Ch
0052+  D0E6~            		rc
0053+  D0E6~            		; ┼ёыш юўшёЄър ¤ъЁрэр - т√їюфшь
0054+  D0E6~            		cpi	1Fh
0055+  D0E6~            		rz
0056+  D0E6~            		; ╬ёЄры№э√х ёыєцхсэ√х ъюф√ чрьхэ хь эр яЁюсхы
0057+  D0E6~            		jc	printerEcho_spc
0058+  D0E6~            		; ┼ёыш <= 0x60, яхўрЄрхь
0059+  D0E6~            		cpi	60h
0060+  D0E6~            		jc	printer
0061+  D0E6~            		; ?
0062+  D0E6~            		lhld	v_koi8
0063+  D0E6~            		cpi	7Fh
0064+  D0E6~            		jnc	 loc_D0B1 ;+
0065+  D0E6~            		inr	l
0066+  D0E6~            		jnz	printer
0067+  D0E6~            		ori	80h
0068+  D0E6~            		mov	c, a
0069+  D0E6~            
0070+  D0E6~            printerEcho_1:  ; ┼ёыш ёшьтюы ьхэ№°х 0xC0, т√їюфшь
0071+  D0E6~            		cpi	0C0h
0072+  D0E6~            		rc
0073+  D0E6~            
0074+  D0E6~            		; ┼ёыш v_tapeMode = '0', т√тюфшь ёшьтюы схч шчьхэхэшщ
0075+  D0E6~            		lda	v_tapeMode
0076+  D0E6~            		sui	'0'
0077+  D0E6~            		jz	printer
0078+  D0E6~            
0079+  D0E6~            		; ┼ёыш v_tapeMode = '1', т√тюфшь ё яЁхюсЁрчютрэшь
0080+  D0E6~            		dcr	a
0081+  D0E6~            		jnz	printerXlat
0082+  D0E6~            
0083+  D0E6~            		; ╚эрўх яхЁхф т√тюфюь ърцфюую ёшьютюыр т√тюфшь 27, 82, 1
0084+  D0E6~            		; ╚ч фюъєьхэЄрЎшшш ъ яЁшэЄхЁрь Epson
0085+  D0E6~            		; Select International character set France
0086+  D0E6~            		lxi	h, 1B52h
0087+  D0E6~            		mvi	a, 1
0088+  D0E6~            		call	printerEsc
0089+  D0E6~            
0090+  D0E6~            		; ┬√тюф C эр яЁшэЄхЁ
0091+  D0E6~            		call	printer		; ┬√тюф	срщЄр эр яЁшэЄхЁ
0092+  D0E6~            
0093+  D0E6~            		; ┬√тюфшь 27, 82, 0
0094+  D0E6~            		; Select International character set USA
0095+  D0E6~            		xra	a
0096+  D0E6~            
0097+  D0E6~            printerEsc:	push	b
0098+  D0E6~            		 mov	c, h
0099+  D0E6~            		 call	printer		; ┬√тюф	срщЄр эр яЁшэЄхЁ
0100+  D0E6~            		 mov	c, l
0101+  D0E6~            		 call	printer		; ┬√тюф	срщЄр эр яЁшэЄхЁ
0102+  D0E6~            		 mov	c, a
0103+  D0E6~            		 call	printer		; ┬√тюф	срщЄр эр яЁшэЄхЁ
0104+  D0E6~            		pop	b
0105+  D0E6~            		ret
0106+  D0E6~            
0107+  D0E6             #endif0232   D0E6             .include "printer.inc"
0001+  D0E6             ;+---------------------------------------------------------------------------
0002+  D0E6             ; RAMFOS
0003+  D0E6             ; ╧хўрЄ№ эр яЁшэЄхЁх
0004+  D0E6             ;
0005+  D0E6             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  D0E6             ;----------------------------------------------------------------------------
0007+  D0E6             
0008+  D0E6~            #if NO_PRINTER==0
0009+  D0E6~            
0010+  D0E6~            printerXlat:	; c = v_printerXlat[c % 64];
0011+  D0E6~            		mov	a, c		
0012+  D0E6~            		ani	63
0013+  D0E6~            		lxi	h, v_printerXlat
0014+  D0E6~            		mov	c, a
0015+  D0E6~            		mvi	b, 0
0016+  D0E6~            		dad	b
0017+  D0E6~            		mov	c, m
0018+  D0E6~            
0019+  D0E6~            printer:	push	psw
0020+  D0E6~            
0021+  D0E6~            		; ╨хцшь ╩╨580┬┬55
0022+  D0E6~            		mvi	a, 90h
0023+  D0E6~            		sta	IO_EXT_MODE
0024+  D0E6~            
0025+  D0E6~            		; ╚этхЁЄшЁєхь ш чряшё√трхь фрээ√х
0026+  D0E6~            		mov	a, c
0027+  D0E6~            		cma
0028+  D0E6~            		sta	IO_EXT_B
0029+  D0E6~            
0030+  D0E6~            printer_0:	 ; ╧юы№чютрЄхы№ ьюцхЄ яЁхЁтрЄ№ юцшфрэшх
0031+  D0E6~            		 lda	IO_KEYB_B		
0032+  D0E6~            		 ani	2
0033+  D0E6~            		 jz	printer_break
0034+  D0E6~            
0035+  D0E6~            		 ; ╞фхь яюър 6-ющ сшЄ эх эєыхтющ
0036+  D0E6~            		 lda	IO_EXT_A
0037+  D0E6~            		 ani	40h
0038+  D0E6~            		jnz	printer_0
0039+  D0E6~            
0040+  D0E6~            		; ╤ЄЁюс
0041+  D0E6~            		mvi	a, 3
0042+  D0E6~            		sta	IO_EXT_C
0043+  D0E6~            
0044+  D0E6~            		; ╧рєчр
0045+  D0E6~            		nop
0046+  D0E6~            		nop
0047+  D0E6~            		nop
0048+  D0E6~            		nop
0049+  D0E6~            		nop
0050+  D0E6~            		nop
0051+  D0E6~            		nop
0052+  D0E6~            
0053+  D0E6~            		; ╤ЄЁюс
0054+  D0E6~            		xra	a
0055+  D0E6~            		sta	IO_EXT_C
0056+  D0E6~            
0057+  D0E6~            printer_break:	pop	psw
0058+  D0E6~            		ret
0059+  D0E6~            
0060+  D0E6~            		.db    0
0061+  D0E6             #else
0062+  D0E6             
0063+  D0E6             printer:
0064+  D0E6             printerHex:
0065+  D0E6             printerEchoMode: 
0066+  D0E6             doPrinterEcho:
0067+  D0E6 C9          		ret
0068+  D0E7             #endif0233   D0E7             .include "setColorChar.inc"
0001+  D0E7             ;+---------------------------------------------------------------------------
0002+  D0E7             ; RAMFOS
0003+  D0E7             ; ╙ёЄрэтюър ЎтхЄр Їюэр шыш ёшьтюыют
0004+  D0E7             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфют A0-BFh
0005+  D0E7             ;
0006+  D0E7             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  D0E7             ;----------------------------------------------------------------------------
0008+  D0E7             
0009+  D0E7             setColorChar:   ; ╧хЁхїюфшь, хёыш ¤Єю ёшьтюы√ B0-BFh
0010+  D0E7 FE 10       		cpi	10h
0011+  D0E9 D2 FB D0    		jnc	setColorChar_1
0012+  D0EC             
0013+  D0EC             		; ▌Єю ёшьтюы√ └0-└Fh
0014+  D0EC             
0015+  D0EC             		; ╠ырф°шх 4 сшЄр сєфєЄ ЎтхЄюь ёшьтюыют (B = A << 4)
0016+  D0EC E6 0F       		ani	0Fh
0017+  D0EE 07          		rlc
0018+  D0EF 07          		rlc
0019+  D0F0 07          		rlc
0020+  D0F1 07          		rlc
0021+  D0F2 47          		mov	b, a
0022+  D0F3             
0023+  D0F3             		; ╬ёЄрты хь ЎтхЄ Їюэр (A = v_color & 0xF)
0024+  D0F3 3A 35 D2    		lda	v_color
0025+  D0F6 E6 0F       		ani	0Fh
0026+  D0F8             
0027+  D0F8             		; ╙ёЄрэрытшрхь ЎтхЄ (A | B)
0028+  D0F8 C3 03 D1    		jmp	setColorChar_2
0029+  D0FB             
0030+  D0FB             ; ---------------------------------------------------------------------------
0031+  D0FB             
0032+  D0FB             setColorChar_1:	; ╠ырф°шх 4 сшЄр сєфєЄ ЎтхЄюь Їюэр (B = A & 0x0F)
0033+  D0FB E6 0F       		ani	0Fh
0034+  D0FD 47          		mov	b, a
0035+  D0FE             
0036+  D0FE             		; ╬ёЄрты хь ЎтхЄ ёшьтюыют (A = v_color & 0xF0)
0037+  D0FE 3A 35 D2    		lda	v_color
0038+  D101 E6 F0       		ani	0F0h
0039+  D103             
0040+  D103             setColorChar_2:	; ╙ёЄрэрытшрхь ЎтхЄ (A | B)
0041+  D103 B0          		ora	b
0042+  D104 C3 0B D1    		jmp	setColor		0234   D107             .include "setColor.inc"
0001+  D107             ;+---------------------------------------------------------------------------
0002+  D107             ; RAMFOS
0003+  D107             ; ╚этхЁёш  ъюфр ЎтхЄр
0004+  D107             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 89
0005+  D107             ;
0006+  D107             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  D107             ;----------------------------------------------------------------------------
0008+  D107             
0009+  D107 3A 35 D2    inverseColor:	lda	v_color
0010+  D10A 2F          		cma
0011+  D10B             
0012+  D10B             ;+---------------------------------------------------------------------------
0013+  D10B             ; RAMFOS
0014+  D10B             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр C84B
0015+  D10B             ; ╙ёЄрэютър ЎтхЄр Їюэр ш сєът
0016+  D10B             ;
0017+  D10B             ; ═р тїюфх
0018+  D10B             ;  ╠ырф°шх сшЄ√ A - ЎтхЄр Їюэр
0019+  D10B             ;  ╤ЄрЁ°шх сшЄ√ A - ЎтхЄ сєът
0020+  D10B             ;
0021+  D10B             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0022+  D10B             ;----------------------------------------------------------------------------
0023+  D10B             
0024+  D10B 32 35 D2    setColor:	sta	v_color
0025+  D10E 32 F8 FF    		sta	IO_COLOR
0026+  D111 C9          		ret0235   D112             .include "popColor.inc"
0001+  D112             ;+---------------------------------------------------------------------------
0002+  D112             ; RAMFOS
0003+  D112             ; ┬юёёЄрэютыхэшх ЎтхЄр шч ёЄхър
0004+  D112             ; ┬√ч√трхЄё  яЁш т√тюфх ъюфр 87h
0005+  D112             ;
0006+  D112             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  D112             ;----------------------------------------------------------------------------
0008+  D112             
0009+  D112 2A 36 D2    popColor:	lhld	v_pushColor
0010+  D115 22 35 D2    		shld	v_color
0011+  D118 7D          		mov	a, l
0012+  D119 C3 0B D1    		jmp	setColor0236   D11C             .include "bigRom.inc"
0001+  D11C             ;+---------------------------------------------------------------------------
0002+  D11C             ; RAMFOS
0003+  D11C             ; ╫Єхэшх ╧╟╙ ╤яхЎшрышёЄр MX
0004+  D11C             ;
0005+  D11C             ; 2013-11-01 ╨рчЁрсюЄрэю vinxru
0006+  D11C             ;----------------------------------------------------------------------------
0007+  D11C             
0008+  D11C             #if BIG_ROM
0009+  D11C F5          bigRom:		push	psw
0010+  D11D             
0011+  D11D             		; ┼ёыш т HL с√ыю ўшёыю < 8000h, Єю яхЁхїюфшь ъ ўЄхэш■ ╧╟╙ MX
0012+  D11D 7C          		mov	a, h
0013+  D11E EE 80       		xri	80h
0014+  D120 FA 3D D1    		jm	bigRom_0
0015+  D123             
0016+  D123             		; ╤юїЁрэ хь HL ш т√ўшЄрхь шч эхую 8000h
0017+  D123 E5          		push	h
0018+  D124 67          		 mov	h, a		 
0019+  D125             		 ; ╧хЁт√х 4 срщЄр т ╧╟╙ ╤╥─ ¤Єю яЁюуЁрььр шэшЎшршчрЎшш
0020+  D125 23          		 inx	h
0021+  D126 23          		 inx	h
0022+  D127 23          		 inx	h
0023+  D128 23          		 inx	h
0024+  D129             		 ; ┬ъы■ўрхь ╧╟╙ ╤╥─
0025+  D129 32 FF FF    		 sta	IO_PAGE_STD
0026+  D12C AF          		 xra	a
0027+  D12D 32 F8 F7    		 sta	IO_COLOR-800h
0028+  D130             		 ; ╫Єхэшх срщЄр
0029+  D130 4E          		 mov	c, m
0030+  D131             		 ; ┬ъы■ўхэшх ╬╟╙ MX ш тюёёЄрэютыхэшх ЎтхЄр
0031+  D131 32 FC F7    		 sta	IO_PAGE_RAM-800h
0032+  D134 3A 35 D2    		 lda	v_color
0033+  D137 32 F8 FF    		 sta	IO_COLOR
0034+  D13A E1          		pop	h
0035+  D13B             		; ┬юёёЄрэртыштрхь т A чэрўхэшх
0036+  D13B F1          		pop	psw
0037+  D13C C9          		ret
0038+  D13D             		
0039+  D13D             bigRom_0:	; ┬ъы■ўхэшх ╧╟╙ MX
0040+  D13D 32 FE FF    		sta	IO_PAGE_ROM
0041+  D140             		; ╫Єхэшх срщЄр
0042+  D140 4E          		mov	c, m
0043+  D141             		; ┬ъы■ўхэшх ╬╟╙ MX
0044+  D141 32 FC FF    		sta	IO_PAGE_RAM
0045+  D144             		; ┬юёёЄрэртыштрхь т A чэрўхэшх
0046+  D144 F1          		pop	psw
0047+  D145 C9          		ret      
0048+  D146             #endif0237   D146             #if RELOCATE_FILE_FUNCTIONS
0238   D146             .include "fileSaveHeader.inc"	; продолжение в pageWriteBlock
0001+  D146             ;+---------------------------------------------------------------------------
0002+  D146             ; RAMFOS
0003+  D146             ; ╟ряшёрЄ№ чруютыюъ Єхъє∙хую Їрщыр эр фшёъ
0004+  D146             ;
0005+  D146             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  D146             ;----------------------------------------------------------------------------
0007+  D146             
0008+  D146             fileSaveHeader:
0009+  D146             		; ╙ёЄрэртыштрхь Їыру "Їрщы эх с√ы ёюїЁрэхэ"
0010+  D146 3E 8B       		mvi	a, 8Bh
0011+  D148 32 61 D2    		sta	v_header_saved
0012+  D14B             
0013+  D14B             		; ╤юїЁрэхэшх чруюыютър эр фшёъ
0014+  D14B 01 52 D2    		lxi	b, v_header
0015+  D14E             		
0016+  D14E             ;----------------------------------------------------------------------------
0017+  D14E             ; RAMFOS
0018+  D14E             ; ╟ряшёрЄ№ ры№ЄхЁэрЄштэ√щ чруютыюъ Їрщыр эр фшёъ
0019+  D14E             ; ╚ёяюы№чєхЄё  фы  чряшёш чруютыюър v_header2 яЁш ёючфрэшш эютюую Їрщыр
0020+  D14E             ;
0021+  D14E             ; ═р тїюфх
0022+  D14E             ;  b - чруюыютюъ
0023+  D14E             ;
0024+  D14E             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0025+  D14E             ;----------------------------------------------------------------------------
0026+  D14E             
0027+  D14E             fileSaveHeaderAny:
0028+  D14E 11 1D 00    		lxi	d, FILE_HEADER_SIZE-1
0029+  D151 2A 70 D2    		lhld	v_curFile
0030+  D154             
0031+  D154             		; ╧Ёюфюыцхэшх эр pageWriteBlock
0032+  D154             		0239   D154             .include "pageWriteBlock.inc"
0001+  D154             ;+---------------------------------------------------------------------------
0002+  D154             ; RAMFOS
0003+  D154             ; ╟ряшё№ сыюър фрээ√ї т ─╬╟╙/╧╟╙
0004+  D154             ;
0005+  D154             ; ═р тїюфх:
0006+  D154             ;  bc - юЄъєфр, рфЁхё т ярь Єш
0007+  D154             ;  hl - ъєфр, рфЁхё т ─╬╟╙/╧╟╙
0008+  D154             ;  de - фышэр-1
0009+  D154             ;
0010+  D154             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0011+  D154             ;----------------------------------------------------------------------------
0012+  D154             
0013+  D154             pageWriteBlock:	; ╫Єхэшх срщЄр
0014+  D154 0A          		ldax	b
0015+  D155             		; ╟ряшё№ срщЄр
0016+  D155 C5          		push	b
0017+  D156 4F          		 mov	c, a
0018+  D157 CD D1 FF    		 call	pageWrite
0019+  D15A C1          		pop	b
0020+  D15B             		; ╙тхышўхэшх рфЁхёют
0021+  D15B 23          		inx	h
0022+  D15C 03          		inx	b
0023+  D15D             		; if(de == 0) break;
0024+  D15D 7B          		mov	a, e
0025+  D15E B2          		ora	d
0026+  D15F             		; de--
0027+  D15F 1B          		dcx	d
0028+  D160 C2 54 D1    		jnz	pageWriteBlock
0029+  D163 C9          		ret
0240   D164             #endif
0241   D164             
0242   D164             .include "v_printerXlat.inc"
0001+  D164             ;+---------------------------------------------------------------------------
0002+  D164             ; RAMFOS
0003+  D164             ; ╥рсышЎр яЁхюсЁрчютрэш  ъюфшЁютъш ёшьтюыют фы  яЁшэЄхЁр
0004+  D164             ;
0005+  D164             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  D164             ;----------------------------------------------------------------------------
0007+  D164             
0008+  D164~            #if NO_PRINTER==0
0009+  D164~            
0010+  D164~            v_printerXlat:	.db 0EEh, 0D0h, 0D1h, 0E6h, 0D4h, 0D5h, 0E4h, 0D3h 
0011+  D164~            		.db 0E5h, 0D8h, 0D9h, 0DAh, 0DBh, 0DCh, 0DDh, 0DEh
0012+  D164~            		.db 0DFh, 0EFh, 0E0h, 0E1h, 0E2h, 0E3h, 0D6h, 0D2h
0013+  D164~            		.db 0ECh, 0EBh, 0D7h, 0E8h, 0EDh, 0E9h, 0E7h, 0EAh
0014+  D164~            		.db 0CEh, 0B0h, 0B1h, 0C6h, 0B4h, 0B5h, 0C4h, 0B3h 
0015+  D164~            		.db 0C5h, 0B8h, 0B9h, 0BAh, 0BBh, 0BCh, 0BDh, 0BEh
0016+  D164~            		.db 0BFh, 0CFh, 0C0h, 0C1h, 0C2h, 0C3h, 0B6h, 0B2h
0017+  D164~            		.db 0CCh, 0CBh, 0B7h, 0C8h, 0CDh, 0C9h, 0C7h, 0CAh
0018+  D164~            
0019+  D164             #endif0243   D164             
0244   D164             ; Если нет ДОЗУ, то используется этот небольшой буфер, что бы хоть что то
0245   D164             ; работало.
0246   D164             
0247   D164             #if WORK_WITHOUT_ARAM != 0
0248   D164             miniPage:
0249   D1A4             .org $ + FILE_HEADER_SIZE + WORK_WITHOUT_ARAM + 2	; Сохранение файла в WORK_WITHOUT_ARAM байт
0250   D1A4             miniPageEnd:
0251   D1A4 08          .db 8							; Сюда записывается байт терминатор.
0252   D1A5             #endif
0253   D1A5             
0254   D1A5 4C 41 54 00 a_lat:		.db 04Ch, 041h, 054h, 0 ; "LAT"
0255   D1A9 F2 F5 F3 00 a_rus:		.db 0F2h, 0F5h,	0F3h, 0	; "РУС"
0256   D1AD             
0257   D1AD             #if NICE
0258   D1AD 20 C6 C1 CA a_inputFileName:.db ' ', 0C6h, 0C1h, 0CAh, 0CCh, 3Ah, ' ', C_PUSHCURSORL, 0 ; "файл" + запоминание курсора строки
0258   D1B1 CC 3A 20 8D 
0258   D1B5 00 
0259   D1B6~            #else
0260   D1B6~            a_inputFileName:.db 11h, 0C6h, 0C1h, 0CAh, 0CCh, 3Ah, C_PUSHCURSORL, C_BEEP, 0 ; "файл" + запоминание курсора строки
0261   D1B6             #endif
0262   D1B6             
0263   D1B6 0D C4 C1 D4 A_INPUTDATE
0263   D1BA C1 3A 00 
0264   D1BD 8B 8F 20 F3 A_INITSCREEN
0264   D1C1 D0 C5 C3 C9 
0264   D1C5 C1 CC C9 D3 
0264   D1C9 D4 20 4D 58 
0264   D1CD 32 20 52 41 
0264   D1D1 4D 46 4F 53 
0264   D1D5 8C 00 
0265   D1D7             
0266   D1D7             ; ===========================================================================
0267   D1D7             ; ПЕРЕМЕННЫЕ
0268   D1D7             
0269   D1D7~            #if $ > 0D1F0h
0270   D1D7~            Ошибка_часть_C800_не_влезла
0271   D1D7             #endif
0272   D1F0             .org 0D1F0h
0273   D1F0             
0274   D1F0 00 00       v_tape:		.dw 0
0275   D1F2             
0276   D1F2             ; Заголовок файла 2
0277   D1F2             
0278   D1F2 D3 D3 D3    v_header2:	.db 0D3h, 0D3h, 0D3h		; тут должно быть 0D3h, 0D3h, 0D3h, иначе функция загрузки файла не рабоатет. Никто не инициализщирует эти переменные!
0279   D1F5 20 20 20 20 v_header2_name:	.db ' ',' ',' ',' ',' ',' ',' ',' ',' '
0279   D1F9 20 20 20 20 
0279   D1FD 20 
0280   D1FE 20 20 20    v_header2_ext:	.db ' ',' ',' '
0281   D201 8B          v_header2_saved:.db 8Bh			; Признак не сохраненности 8B, 8C
0282   D202 01 11 13    v_header2_date:	.db 01h, 11h, 13h	; Дата
0283   D205 00 00 00 00 		.db 0, 0, 0, 0, 0	; Резерв MXDOS
0283   D209 00 
0284   D20A 00 00       v_header2_start:.dw 0
0285   D20C 00 00       v_header2_end:	.dw 0
0286   D20E 00 00       v_header2_crc:	.dw 0
0287   D210             
0288   D210             ; Конец заголовка файла
0289   D210             
0290   D210 00          v_dblClear:	.db 0
0291   D211 00 00 00 00 		.db 0,0,0,0,0,0,0,0,0
0291   D215 00 00 00 00 
0291   D219 00 
0292   D21A 00 00 00 00 unk_D21A:	.db 0,0,0,0,0,0
0292   D21E 00 00 
0293   D220 00 00       v_pushCursorLn:	.dw 0
0294   D222 00 00       v_pushCursor:	.dw 0
0295   D224 00          v_escMode:	.db 0
0296   D225 00          v_key2:		.db 0
0297   D226 00          v_printerCrLf:	.db 0		
0298   D227 00 00       v_memTop:	.dw 0
0299   D229 00 00       v_key0:		.dw 0
0300   D22B 00 00       v_key1:		.dw 0
0301   D22D 00 00       v_oldSP:	.dw 0
0302   D22F 00          		.db 0
0303   D230 00 00       v_topLineHeight:.dw 0
0304   D232 00          v_screenHeight:	.db 0		; Высота экрана
0305   D233 00          v_screenHeight1:.db 0		; Высота экрана - 10
0306   D234 00          v_bottomLineId:	.db 0
0307   D235 00          v_color:	.db 0		; Текущий цвет фона и букв
0308   D236 00 00       v_pushColor:	.dw 0
0309   D238 00 00 00 00 		.db 0,0,0,0
0310   D23C 00 00       v_aramPageEnd2:	.dw 0
0311   D23E 00          v_escRow:	.db 0
0312   D23F 00          		.db 0
0313   D240 00          v_lastKey:	.db 0
0314   D241 00          		.db 0
0315   D242 00          		.db 0
0316   D243 00 00       v_pageStart:	.dw 0		; Начало текущей страницы
0317   D245 00          v_page:		.db 0		; Текущая страница
0318   D246             
0319   D246 00 00 00 00 		.db 0,0,0,0, 0,0,0,0, 0,0,0,0
0319   D24A 00 00 00 00 
0319   D24E 00 00 00 00 
0320   D252             
0321   D252             ; Заголовок файла
0322   D252             ; Первые 15 байт (v_header, v_header_name, v_header_ext) читается функцией fileFromTapeCom
0323   D252             ; Первые 30 байт читаются функцией fileLoadHeader
0324   D252             
0325   D252             
0326   D252 D3 D3 D3    v_header:	.db 0D3h, 0D3h, 0D3h	; Идентификатор, должен быть 0D3h, 0D3h, 0D3h
0327   D255 20 20 20 20 v_header_name:	.db ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '
0327   D259 20 20 20 20 
0328   D25D 20          v_header_spc:	.db ' '
0329   D25E 20 20 20    v_header_ext:	.db ' ', ' ', ' '
0330   D261 00          v_header_saved:	.db 0
0331   D262 00 00 00    v_header_date:	.db 0, 0, 0
0332   D265 00 00 00 00 v_header_unused:.db 0, 0, 0, 0, 0
0332   D269 00 
0333   D26A 00 00       v_header_start:	.dw 0
0334   D26C 00 00       v_header_stop:	.dw 0
0335   D26E 00 00       v_header_crc:	.dw 0
0336   D270             
0337   D270             ; Конец заголовка файла
0338   D270             
0339   D270 00 00       v_curFile:	.dw 0
0340   D272 00 00       v_printedFile:	.dw 0
0341   D274 00 00       f_nextFile:	.dw 0
0342   D276 00 00       f_fileBodySize:	.dw 0
0343   D278 00 00       f_fileSize:	.dw 0
0344   D27A 00 00       v_pageFreeTotal:.dw 0
0345   D27C 00 00       v_pageFreePtr:	.dw 0
0346   D27E             
0347   D27E F0 77 23 1B 		.db 0F0h, 77h, 23h, 1Bh, 7Ah, 0B3h, 0CAh, 95h, 0D2h, 0Ch, 0C2h, 78h, 0D2h, 22h, 0, 8Fh, 0EBh, 22h, 2, 8Fh, 0C3h, 52h, 0D2h
0347   D282 7A B3 CA 95 
0347   D286 D2 0C C2 78 
0347   D28A D2 22 00 8F 
0347   D28E EB 22 02 8F 
0347   D292 C3 52 D2 
0348   D295             
0349   D295 00 00 00 00 buffer:		.db 0,0,0,0,0,0,0,0,0	; Используется максимум 9 символов для ввода даты. Последний байт для контроля переполнения
0349   D299 00 00 00 00 
0349   D29D 00 
0350   D29E             
0351   D29E             ; ===========================================================================
0352   D29E             ; КОД
0353   D29E             
0354   F800             .org 0F800h
0355   F800             
0356   F800             .include "f800.inc"
0001+  F800             ;+---------------------------------------------------------------------------
0002+  F800             ; RAMFOS
0003+  F800             ; ╥юўъш тїюфр
0004+  F800             ;
0005+  F800             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  F800             ;----------------------------------------------------------------------------
0007+  F800             
0008+  F800 C3 2A F9    			jmp	init
0009+  F803 C3 03 C8    			jmp	j_keyWait
0010+  F806 C3 06 C8    			jmp	j_tapeRead
0011+  F809 C3 09 C8    			jmp	j_printChar
0012+  F80C C3 0C C8    			jmp	j_tapeWrite
0013+  F80F C3 0F C8    			jmp	j_printCharA
0014+  F812 C3 12 C8    			jmp	j_keyCheck
0015+  F815 C3 15 C8    			jmp	j_printHex
0016+  F818 C3 18 C8    			jmp	j_printString
0017+  F81B C3 1B C8    			jmp	j_keyScan
0018+  F81E C3 1E C8    			jmp	j_getCursorPos
0019+  F821 C3 21 C8    			jmp	j_getCharFromScr
0020+  F824 C3 95 F8    			jmp	dlg_loadFile
0021+  F827 C3 B0 F8    			jmp	fileSaveDlg
0022+  F82A C3 2A C8    			jmp	j_calcCrc
0023+  F82D C3 4D FF    			jmp	fileSetType
0024+  F830 C3 30 C8    			jmp	j_getMemTop
0025+  F833 C3 33 C8    			jmp	j_setMemTop
0026+  F836 C3 C5 FF    j_pageReadAny:		jmp	pageReadAny
0027+  F839 C3 D4 FF    j_pageWriteAny:		jmp	pageWriteAny
0028+  F83C C3 3C C8    			jmp	j_setCursorPos
0029+  F83F C3 A9 F8    			jmp	fileSave
0030+  F842 C3 A0 F8    			jmp	fileSetAddr
0031+  F845 C3 38 FF    			jmp	fileGetName
0032+  F848 C3 42 FF    			jmp	fileSetName
0033+  F84B C3 5A F8    			jmp	fileFind
0034+  F84E C3 1F FB    			jmp	fileLoad
0035+  F851 C3 FA FD    			jmp	fileDelete
0036+  F854             #if NO_ROM_ENTRY | RKS_LOADER
0037+  F854             #if NO_MXDOS
0038+  F854 C3 2A F9    			jmp	init
0039+  F857~            #else
0040+  F857~            			jmp	loadMxDos
0041+  F857             #endif
0042+  F857 C3 5E FF    			jmp	exec
0043+  F85A             #endif0357   F85A             .include "loadMXDOS.inc"
0001+  F85A             ;+---------------------------------------------------------------------------
0002+  F85A             ; RAMFOS
0003+  F85A             ; ╟руЁєчър ш чряєёъ MXDOS ё фшёъхЄ√
0004+  F85A             ; ┬√ч√трхЄё  яЁш эрцрЄшш эр F6 шч Їрщыютющ ярэхыш
0005+  F85A             ;
0006+  F85A             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  F85A             ;----------------------------------------------------------------------------
0008+  F85A             
0009+  F85A~            #if NO_MXDOS==0
0010+  F85A~            
0011+  F85A~            MXDOS_ADDR = 0E400h
0012+  F85A~            
0013+  F85A~            loadMxDos:	mov	b, a
0014+  F85A~            
0015+  F85A~            		; ╙ёЄрэютър уюыютъш ш ёхъЄюЁр
0016+  F85A~            		mvi	a, 1
0017+  F85A~            		sta	IO_FLOPPY_HEAD
0018+  F85A~            		sta	IO_FLOPPY_SECTOR
0019+  F85A~            
0020+  F85A~            		; ╧рєчр
0021+  F85A~            		mvi	h, 13h
0022+  F85A~            loadMxDos_0:	 dcx	h
0023+  F85A~            		 mov	a, l
0024+  F85A~            		 ora	h
0025+  F85A~            		jnz	loadMxDos_0
0026+  F85A~            
0027+  F85A~            		; ╙ёЄрэртыштрхь уюыютъє
0028+  F85A~            		sta	IO_FLOPPY_HEAD
0029+  F85A~            
0030+  F85A~            		; └фЁхё чруЁєчъш
0031+  F85A~            		lxi	h, MXDOS_ADDR
0032+  F85A~            
0033+  F85A~            		; ╫Єхэш  ёхъЄюЁр
0034+  F85A~            		mvi	a, 90h
0035+  F85A~            		sta	IO_FLOPPY_CMD
0036+  F85A~            
0037+  F85A~            		; ╬цшфрэшх уюЄютэюёЄш
0038+  F85A~            loadMxDos_1:	 lda	IO_FLOPPY_CMD
0039+  F85A~            		 ral
0040+  F85A~            		 rc
0041+  F85A~            		 rar
0042+  F85A~            		 rar
0043+  F85A~            		jnc	loadMxDos_1
0044+  F85A~            
0045+  F85A~            		; ╧юыєўхэшх фрээ√ї
0046+  F85A~            		mvi	c, 13h 
0047+  F85A~            loadMxDos_2:	  sta	IO_FLOPPY_TRIG
0048+  F85A~            		  lda	IO_FLOPPY_DATA
0049+  F85A~            		  mov	m, a
0050+  F85A~            		  inr	l
0051+  F85A~            		 jnz	loadMxDos_2
0052+  F85A~            		 inr	h
0053+  F85A~            		 dcr	c
0054+  F85A~            		jp	loadMxDos_2
0055+  F85A~            
0056+  F85A~            		; ╧ЁютхЁър
0057+  F85A~            		lda	IO_FLOPPY_CMD
0058+  F85A~            		xri	1
0059+  F85A~            		ora	a
0060+  F85A~            		mvi	a, 0D0h
0061+  F85A~            		sta	IO_FLOPPY_CMD
0062+  F85A~            		jnz	dlg_error
0063+  F85A~            
0064+  F85A~            		; ╧ЁютхЁър
0065+  F85A~            		dcx	h
0066+  F85A~            		mov	a, m
0067+  F85A~            		dcx	h
0068+  F85A~            		inr	m
0069+  F85A~            		cmp	m
0070+  F85A~            		jnz	dlg_error
0071+  F85A~            
0072+  F85A~            		; ╟ряєёъ MXDOS
0073+  F85A~            		.db 078h
0074+  F85A~            		call	MXDOS_ADDR
0075+  F85A~            
0076+  F85A~            		; ╧Ёш т√їюфх шч MXDOS т√сшЁрхь ROM-фшёъ
0077+  F85A~            		mvi	b, 80h
0078+  F85A~            		ret
0079+  F85A             #endif0358   F85A             .include "fileFind.inc"
0001+  F85A             ;+---------------------------------------------------------------------------
0002+  F85A             ; RAMFOS
0003+  F85A             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F84B
0004+  F85A             ; ╧юшёъ Їрщыр шь  ъюЄюЁюую чрфрэю ЇєэъЎшхщ fileSetName (F848)
0005+  F85A             ;
0006+  F85A             ; ═р тїюфх
0007+  F85A             ;   v_header2_name  - ╚ь  Їрщыр фы  яюшёър
0008+  F85A             ;
0009+  F85A             ; ═р т√їюфх
0010+  F85A             ;   v_curFile       - └фЁхё Єхъє∙хую Їрщыр т ─╬╟╙
0011+  F85A             ;   v_header        - ╟руюыютюъ Їрщыр
0012+  F85A             ;   f_fileBodySize  - ─ышэр Їрщыр схч чруюыютър -1
0013+  F85A             ;   f_fileSize      - ─ышэр Їрщыр ё чруюыютъюь
0014+  F85A             ;   f_nextFile      - └фЁхё ёыхфє■∙хую Їрщыр т ─╬╟╙
0015+  F85A             ;   ┬ ─╬╟╙ яю рфЁхёє v_curFile + f_fileSize чряшё√трхЄё  v_curFile
0016+  F85A             ;
0017+  F85A             ; ╚чьхэ хЄ яхЁхьхээ√х т ёыєўрх ю°шсъш т ─╬╟╙. ─╬╟╙ эх шчьхэ хЄё .
0018+  F85A             ;   v_pageFreePtr   - ╙ърчрЄхы№ эр яхЁт√щ ётюсюфэ√щ срщЄ
0019+  F85A             ;   v_pageFreeTotal - ╤тюсюфэю срщЄ
0020+  F85A             ;
0021+  F85A             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0022+  F85A             ;----------------------------------------------------------------------------
0023+  F85A             
0024+  F85A             fileFind:	; ═рўры№эр  ёЄЁрэшЎр
0025+  F85A 06 00       		mvi	b, 0
0026+  F85C             fileFindEx:	 ; ╚∙хь Їрщы т ёЄЁрэшЎх шч ЁхушёЄЁр B
0027+  F85C CD 78 F8    		 call	fileFind1
0028+  F85F             
0029+  F85F             		 ; ?
0030+  F85F CA B5 FB    		 jz	fileLoadHeader2
0031+  F862             
0032+  F862             		 ; ╤ыхфє■∙р  ёЄЁрэшЎр (ЁхушёЄЁ B), хёыш хёЄ№
0033+  F862 CD 69 F8    		 call	pageNext
0034+  F865 D2 5C F8    		jnc	fileFindEx
0035+  F868 C9          		ret0359   F869             .include "pageNext.inc"
0001+  F869             ;+---------------------------------------------------------------------------
0002+  F869             ; RAMFOS
0003+  F869             ; ╤ыхфє■∙р  ёЄЁрэшЎр
0004+  F869             ;
0005+  F869             ; ═р тїюфх
0006+  F869             ;  b - ёЄЁрэшЎр
0007+  F869             ;
0008+  F869             ; ═р т√їюфх
0009+  F869             ;  jc - ю°шсър
0010+  F869             ;  b  - ёЄЁрэшЎр
0011+  F869             ;
0012+  F869             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0013+  F869             ;----------------------------------------------------------------------------
0014+  F869             
0015+  F869             pageNext:	; ╙ ROM-фшёър (ъюф 0x80) ьюцхЄ с√Є№ Єюы№ъю юфэр ёЄЁрэшЎр, т√їюфшь ё Їыруюь C
0016+  F869 78          		mov	a, b
0017+  F86A 17          		ral
0018+  F86B D8          		rc
0019+  F86C 1F          		rar
0020+  F86D             
0021+  F86D             		; ╬ЄЇшы№ЄЁют√трхь Їыруш
0022+  F86D~            #if ARAM_MAX_PAGE <= 7
0023+  F86D~            		ani	7
0024+  F86D             #else
0025+  F86D E6 0F       		ani	0Fh
0026+  F86F             #endif
0027+  F86F             		; ╠ръёшьєь ёЄЁрэшЎ
0028+  F86F 4F          		mov	c, a
0029+  F870 0C          		inr	c
0030+  F871 3A 3D C6    		lda	v_aramMaxPage
0031+  F874 B9          		cmp	c
0032+  F875 D8          		rc
0033+  F876             
0034+  F876             		; ╙тхышўштрхь ёЄЁрэшЎє
0035+  F876 04          		inr	b
0036+  F877 C9          		ret0360   F878             .include "fileFind1.inc"
0001+  F878             ;----------------------------------------------------------------------------
0002+  F878             ; RAMFOS
0003+  F878             ; ╧юшёъ Їрщыр т ёЄЁрэшЎх шь  ъюЄюЁюую чрфрэю ЇєэъЎшхщ F848
0004+  F878             ;
0005+  F878             ; ═р тїюфх
0006+  F878             ;   v_header2_name  - ╚ь  Їрщыр фы  яюшёър
0007+  F878             ;   b, v_page       - ═юьхЁ Єхъє∙хщ ёЄЁрэшЎ√
0008+  F878             ;
0009+  F878             ; ═р т√їюфх
0010+  F878             ;   v_curFile       - └фЁхё Єхъє∙хую Їрщыр т ─╬╟╙
0011+  F878             ;   v_header        - ╟руюыютюъ Їрщыр
0012+  F878             ;   f_fileBodySize  - ─ышэр Їрщыр схч чруюыютър - 1
0013+  F878             ;   f_fileSize      - ─ышэр Їрщыр ё чруюыютъюь
0014+  F878             ;   f_nextFile      - └фЁхё ёыхфє■∙хую Їрщыр т ─╬╟╙
0015+  F878             ;   ┬ ─╬╟╙ яю рфЁхёє v_curFile + f_fileSize чряшё√трхЄё  v_curFile
0016+  F878             ;   v_pageFreePtr   - ╙ърчрЄхы№ эр яхЁт√щ ётюсюфэ√щ срщЄ
0017+  F878             ;   v_pageFreeTotal - ╤тюсюфэю срщЄ
0018+  F878             ;
0019+  F878             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0020+  F878             ;----------------------------------------------------------------------------
0021+  F878             
0022+  F878             fileFind1:      ; ╧юшёъ яЁюшёїюфшЄ т фтр ¤Єряр
0023+  F878             		; ╤эрўрыр ь√ ЁрёўшЄ√трхь v_pageFreePtr, v_pageFreeTotal
0024+  F878 C5          		push	b
0025+  F879 78          		 mov	a, b
0026+  F87A F6 10       		 ori	10h
0027+  F87C 47          		 mov	b, a
0028+  F87D CD 81 F8    		 call	fileFind1_0
0029+  F880 C1          		pop	b
0030+  F881             
0031+  F881             		; └ яЁш тЄюЁюь яЁюїюфх ёЁртэштрхь шь  Їрщыр
0032+  F881             
0033+  F881             fileFind1_0:	; ╧юыєўрхь B - Єхъє∙р  ёЄЁрэшЎр, HL - эрўрыю ёЄЁрэшЎ√
0034+  F881 CD B3 FC    		call	fileSetPage
0035+  F884             fileFind2_1:	 ; ╟руЁєцрхь ёыхфє■∙шщ чруюыютюъ Їрщыр
0036+  F884 CD 63 FB    		 call	fileLoadHeader
0037+  F887             		 ; ═хЄ Їрщыют, т√їюфшь ё Їыруюь NZ
0038+  F887 C0          		 rnz
0039+  F888             		 ; ┬ю тЄюЁюь яЁюїюфх (b & 0x10 == 0) ёЁртэштрхь шь  Їрщыр
0040+  F888 78          		 mov	a, b
0041+  F889 E6 10       		 ani	10h
0042+  F88B CC EA FD    		 cz	compareFileName
0043+  F88E             		 ; ┼ёыш Їрщы эрщфхэ, т√їюфшь ё Їыруюь Z
0044+  F88E C8          		 rz
0045+  F88F             		 ; ╧Ёюфюыцрхь яюшёъ ёю ёыхфє■∙хую Їрщыр
0046+  F88F 2A 74 D2    		 lhld	f_nextFile
0047+  F892 C3 84 F8    		jmp	fileFind2_1
0361   F895             .include "dialog.inc"		; продолжение в fileSaveHeader
0001+  F895             ;----------------------------------------------------------------------------
0002+  F895             ; RAMFOS
0003+  F895             ; ╘рщыютр  ярэхы№
0004+  F895             ;
0005+  F895             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006+  F895             ;----------------------------------------------------------------------------
0007+  F895             
0008+  F895             #if ALL_CHARS
0009+  F895             #define BORDER_BL  27,12
0010+  F895             #define BORDER_BL1 12
0011+  F895             #define BORDER_B   27,13
0012+  F895             #define BORDER_B1  13
0013+  F895             #define BORDER_BR  27,24
0014+  F895             #define BORDER_BR1 24
0015+  F895             #define BORDER_L   27, 8
0016+  F895             #define BORDER_L1  8
0017+  F895             #define BORDER_R   27, 10
0018+  F895             #define BORDER_R1  10
0019+  F895             #define BORDER_H   27, 25
0020+  F895             #define BORDER_H1  25
0021+  F895~            #else
0022+  F895~            BORDER_BL  = 15h
0023+  F895~            BORDER_BL1 = 15h
0024+  F895~            BORDER_B   = 14h
0025+  F895~            BORDER_B1  = 14h
0026+  F895~            BORDER_BR  = 16h
0027+  F895~            BORDER_BR1 = 16h
0028+  F895~            BORDER_L   = 11h
0029+  F895~            BORDER_L1  = 11h
0030+  F895~            BORDER_R   = 6
0031+  F895~            BORDER_R1  = 6
0032+  F895~            BORDER_H   = 6
0033+  F895~            BORDER_H1  = 6
0034+  F895             #endif
0035+  F895             
0036+  F895             dlg_loadFile:	; └ъЄштэр  ёЄЁрэшЎр
0037+  F895 3A 45 D2    		lda	v_page
0038+  F898 E6 0F       		ani	0Fh
0039+  F89A             		; ╨хцшь т√сюЁр Їрщыр (6 ющ сшЄ)
0040+  F89A F6 40       		ori	40h
0041+  F89C 47          		mov	b, a
0042+  F89D C3 41 F9    		jmp	dlg_main
0043+  F8A0             
0044+  F8A0             ; ---------------------------------------------------------------------------
0045+  F8A0             
0046+  F8A0             .include "fileSetAddr.inc"
0001++ F8A0             ;+---------------------------------------------------------------------------
0002++ F8A0             ; RAMFOS
0003++ F8A0             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F842
0004++ F8A0             ; ╙ёЄрэютър рфЁхёр чруЁєчъш т ярь Є№ Єхъє∙хую Їрщыр
0005++ F8A0             ;
0006++ F8A0             ; ═р тїюфх
0007++ F8A0             ;   v_header2_name - шь  Їрщыр
0008++ F8A0             ;   hl             - эют√щ рфЁхё
0009++ F8A0             ;
0010++ F8A0             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0011++ F8A0             ;----------------------------------------------------------------------------
0012++ F8A0             
0013++ F8A0             fileSetAddr:	; ╚∙хь Їрщы
0014++ F8A0 E5          		push	h
0015++ F8A1 CD 5A F8    		 call	fileFind
0016++ F8A4 E1          		pop	h
0017++ F8A5             
0018++ F8A5             		; ╘рщы эх эрщфхэ
0019++ F8A5 C0          		rnz
0020++ F8A6             
0021++ F8A6             		; ╙ёЄрэрыштрхь рфЁхё чруЁєчъш
0022++ F8A6 C3 F3 FA    		jmp	fileLoadSetAddr
0047+  F8A9             .include "fileSave.inc"	; ╧Ёюфюыцхэшх
0001++ F8A9             ;+---------------------------------------------------------------------------
0002++ F8A9             ; RAMFOS
0003++ F8A9             ; ╤юїЁрэшЄ№ Їрщы
0004++ F8A9             ;
0005++ F8A9             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006++ F8A9             ;----------------------------------------------------------------------------
0007++ F8A9             
0008++ F8A9             fileSave:	; ═рщЄш ётюсюфэє■ ёЄЁрэшЎє ш ЁрёёўшЄрЄ№ ъюэЄЁюы№эє■ ёєььє
0009++ F8A9 CD EB F8    		call	fileFindFree
0010++ F8AC D8          		rc
0011++ F8AD             
0012++ F8AD             		; ╬с∙р  ЇєэъЎш 
0013++ F8AD C3 CC F8    		jmp	fileSaveCom		
0014++ F8B0             
0015++ F8B0             ;----------------------------------------------------------------------------
0016++ F8B0             ; RAMFOS
0017++ F8B0             ; ╤юїЁрэшЄ№ Їрщы ё ттюфюь шьхэш ё ъыртшрЄєЁ√
0018++ F8B0             ;
0019++ F8B0             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0020++ F8B0             ; ---------------------------------------------------------------------------
0021++ F8B0             
0022++ F8B0             fileSaveDlg:	; ┬√тюф ЄхъёЄр "╤юїЁрэшЄ№?"
0023++ F8B0 CD C2 FE    		call	printStringEx
0024++ F8B3 8B 90 20 F3 		.db C_INVERSE, C_BOTTOMLINE, ' ', 0F3h, 0CFh, 0C8h, 0D2h, 0C1h, 0CEh, 0C9h, 0D4h, 0D8h, 3Fh, C_NORMAL, 0
0024++ F8B7 CF C8 D2 C1 
0024++ F8BB CE C9 D4 D8 
0024++ F8BF 3F 8C 00 
0025++ F8C2             
0026++ F8C2             		; ┬тюф шьхэш Їрщыр
0027++ F8C2 CD 45 C8    		call	j_inputFileName
0028++ F8C5 C8          		rz
0029++ F8C6             
0030++ F8C6             		; ╧юшёъ яюфїюф ∙хщ ёЄЁрэшЎ√
0031++ F8C6 CD EB F8    		call	fileFindFree
0032++ F8C9             
0033++ F8C9             		; ┬ ёыєўрх ю°шсъш т√тхёЄш "ьры фшёъ" ш цфрЄ№ эрцрэш  ESC
0034++ F8C9 DA B3 FE    		jc	outOfSpace
0035++ F8CC             
0036++ F8CC             fileSaveCom:	; ╟ряшё№ чруюыютър Їрщыр эр фшёъ
0037++ F8CC 01 F2 D1    		lxi	b, v_header2
0038++ F8CF CD 4E D1    		call	fileSaveHeaderAny
0039++ F8D2             
0040++ F8D2             		; BC = эрўрыю Їрщыр, DE = фышэр Їрщыр - 1
0041++ F8D2 E5          		push	h
0042++ F8D3 CD CC FD    		 call	fileGetStartAndSize2
0043++ F8D6 EB          		 xchg
0044++ F8D7 4D          		 mov	c, l
0045++ F8D8 44          		 mov	b, h
0046++ F8D9 E1          		pop	h
0047++ F8DA             
0048++ F8DA             		; ╟ряшё№ Єхыр Їрщыр (чряшё№ эр фшёъ яю рфЁхёє HL шч ярь Єш BC фышэющ DE+1)
0049++ F8DA CD 54 D1    		call	pageWriteBlock 
0050++ F8DD             
0051++ F8DD             		; ╧Ёюфюыцхэшх т fileChanged		0048+  F8DD             .include "fileChanged.inc"
0001++ F8DD             ;+---------------------------------------------------------------------------
0002++ F8DD             ; RAMFOS
0003++ F8DD             ; ┬√ч√трхЄё  яюёых ёючфрэш /єфрыхэш  Їрщыр
0004++ F8DD             ;
0005++ F8DD             ; ┬їюф
0006++ F8DD             ;  hl - ╧хЁт√щ срщЄ яюёых Єхыр Їрщыр. ╙ тЄюЁющ ЇєэъЎшш ёююЄтхЄёЄтхээю +2.
0007++ F8DD             ;
0008++ F8DD             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0009++ F8DD             ;----------------------------------------------------------------------------                   
0010++ F8DD             
0011++ F8DD             fileChanged2: 	; ╧Ёюяєёърхь фтр срщЄр, юэш сєфєЄ чряюыэхэ√ яЁш яЁюёьюЄЁх.
0012++ F8DD 23          		inx	h
0013++ F8DE 23          		inx	h
0014++ F8DF             
0015++ F8DF             fileChanged:    ; ╬сэюты хь єърчрЄхы№ ётюсюфэюую ьхёЄр
0016++ F8DF 22 7C D2    		shld	v_pageFreePtr
0017++ F8E2             
0018++ F8E2             		; ╟ряшё√трхь чэрўхэшх 8 яю ¤Єюьє рфЁхёє, ўЄю с√ Єрь эш 
0019++ F8E2             		; т ъюхь ёыєўрх эх с√ыю D3, D3, D3
0020++ F8E2 0E 08       		mvi	c, 8
0021++ F8E4 CD D1 FF    		call	pageWrite
0022++ F8E7             
0023++ F8E7             		; ╟тєъютющ ёшуэры
0024++ F8E7 0D          		dcr	c
0025++ F8E8 C3 09 C8    		jmp	j_printChar
0049+  F8EB             .include "fileFindFree.inc"
0001++ F8EB             ;+---------------------------------------------------------------------------
0002++ F8EB             ; RAMFOS
0003++ F8EB             ; ╨рёўхЄ ъюэЄЁюы№эющ ёєьь√ ёюїЁрэ хьюую Їрщыр, яюшёъ ёЄЁрэшЎ√
0004++ F8EB             ; ё яюфїюф ∙шь cтюсюфэ√ь юс·хьюь, єфрыхэшх Їрщыр ё шьхэхь v_header2_name
0005++ F8EB             ;
0006++ F8EB             ; ═р тїюфх
0007++ F8EB             ;  v_header2_name  - ╚ь  Їрщыр фы  єфрыхэш 
0008++ F8EB             ;  f_header2_start - └фЁхё эрўрыр Їрщыр
0009++ F8EB             ;  f_header2_stop  - └фЁхё ъюэЎр Їрщыр
0010++ F8EB             ;
0011++ F8EB             ; ═р т√їюфх
0012++ F8EB             ;  jnc             - ╤ЄЁрэшЎр эрщфхэр
0013++ F8EB             ;  f_header2_crc   - ╩юэЄЁюы№эр  ёєььр
0014++ F8EB             ;  v_page, b       - ╤ЄЁрэшЎр
0015++ F8EB             ;
0016++ F8EB             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0017++ F8EB             ;----------------------------------------------------------------------------
0018++ F8EB             
0019++ F8EB             fileFindFree:	; ╨рёўшЄ√трхь ъюэЄЁюы№эє■ ёєььє т v_header2_crc
0020++ F8EB 22 0A D2    		shld	v_header2_start	
0021++ F8EE EB          		xchg
0022++ F8EF 22 0C D2    		shld	v_header2_end		
0023++ F8F2 EB          		xchg
0024++ F8F3 CD 2A C8    		call	j_calcCrc
0025++ F8F6 60          		mov	h, b
0026++ F8F7 69          		mov	l, c
0027++ F8F8 22 0E D2    		shld	v_header2_crc
0028++ F8FB             
0029++ F8FB             		; ╧юшёъ яю тёхь ёЄЁрэшЎрь ш єфрыхэшх Їрщыр
0030++ F8FB 06 20       		mvi	b, 20h
0031++ F8FD CD 5C F8    		call	fileFindEx
0032++ F900             
0033++ F900             		; ╧юшёъ Їрщыр эрўшэр  ё эєыхтющ ёЄЁрэшЎ√
0034++ F900 06 20       		mvi	b, 20h
0035++ F902             fileFindFree_0:	 ; ╬яЁхфхы хь ётюсюфэюх ьхёЄю эр ёЄЁрэшЎх
0036++ F902 CD 78 F8    		 call	fileFind1
0037++ F905             		 
0038++ F905             		 ; de = ЁрёўшЄ√трхь ЄЁхсєхь√щ ЁрчьхЁ Їрщыр, яюўхьє Єю т Ўшъых.
0039++ F905 CD CC FD    		 call	fileGetStartAndSize2
0040++ F908 11 21 00    		 lxi	d, FILE_HEADER_SIZE + 3
0041++ F90B 19          		 dad	d
0042++ F90C EB          		 xchg		
0043++ F90D             
0044++ F90D             		 ; ┬√їюфшь ё Їыруюь NC, хёыш ьхёЄр фюёЄрЄюўэю
0045++ F90D 2A 7A D2    		 lhld	v_pageFreeTotal
0046++ F910 D4 54 C8    		 cnc	j_cmp_hl_de
0047++ F913 D0          		 rnc		
0048++ F914             
0049++ F914             		 ; ╤ыхфє■∙р  ёЄЁрэшЎр
0050++ F914 CD 69 F8    		 call	pageNext
0051++ F917 D2 02 F9    		jnc	fileFindFree_0
0052++ F91A C9          		ret0050+  F91B             
0051+  F91B             ; ---------------------------------------------------------------------------
0052+  F91B             ; ╙─└╦┼═╚┼ ─└╥█
0053+  F91B             
0054+  F91B             dlg_f2_alt:	; ┼ёыш Ёхцшь т√сюЁр Їрщыр, Єю т√їюфшь
0055+  F91B 78          		mov	a, b
0056+  F91C 17          		ral
0057+  F91D 17          		ral
0058+  F91E D8          		rc
0059+  F91F             
0060+  F91F             		; ┬√тюф ёююс∙хэш  "фрЄє єфрышЄ№"
0061+  F91F 11 98 FF    		lxi	d, a_deleteDate
0062+  F922 CD 7D F9    		call	dlg_msgYesNo
0063+  F925             
0064+  F925             .include "deleteDate.inc"
0001++ F925             ;+---------------------------------------------------------------------------
0002++ F925             ; RAMFOS
0003++ F925             ; ╙фрыхэшх Єхъє∙хщ фрЄ√
0004++ F925             ; ╧юёыхфє■∙р  яхЁхЁшёютър тхЁїэхщ ёЄЁюъш т init яЁштхфхЄ т т√чютє ЇєэъЎшш 
0005++ F925             ; ттюфр фрЄ√
0006++ F925             ;
0007++ F925             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0008++ F925             ;----------------------------------------------------------------------------
0009++ F925             
0010++ F925             #if DATE_IN_RAM
0011++ F925             		; ╤юїЁрэ хь яЁшчэръ Єюую, ўЄю фрЄр эх ттхфхэр
0012++ F925 3E 8C       		mvi	a, 8Ch 
0013++ F927 32 01 D2    		sta	v_header2_saved
0014++ F92A~            #else
0015++ F92A~            		; ╤юїЁрэ хь яЁшчэръ Єюую, ўЄю фрЄр эх ттхфхэр т ─╬╟╙
0016++ F92A~            		; ═р тїюфх A != 8Bh
0017++ F92A~            		lhld	v_aramPageEnd
0018++ F92A~            		inx	h
0019++ F92A~            		call	pageWrite
0020++ F92A             #endif
0021++ F92A             		; ╘єэъЎш  яЁюфюыцрхЄё  т init0065+  F92A             
0066+  F92A             		; ─рыхх init
0067+  F92A             
0068+  F92A             ; ---------------------------------------------------------------------------
0069+  F92A             
0070+  F92A             .include "init.inc"	; ╧Ёюфюыцхэшх т dlg_main
0001++ F92A             ;+---------------------------------------------------------------------------
0002++ F92A             ; RAMFOS
0003++ F92A             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F800
0004++ F92A             ; ╚эшЎшрышчрЎш 
0005++ F92A             ;
0006++ F92A             ; 2013-11-01 vinxru
0007++ F92A             ;----------------------------------------------------------------------------
0008++ F92A             
0009++ F92A             init:		; ┬ъы■ўхэшх ╬╟╙
0010++ F92A 32 FC FF    		sta	IO_PAGE_RAM
0011++ F92D             	
0012++ F92D             		; ╚эшЎшрышчрЎш 	ёЄхър
0013++ F92D 31 FF D2    		lxi	sp, STACK_TOP
0014++ F930             
0015++ F930             		; ╚эшЎшрышчрЎш  BIOS
0016++ F930 CD 00 C8    		call	j_biosInit
0017++ F933             
0018++ F933             		; ┬хЁїє°ър ярь Єш
0019++ F933 21 FF 8F    		lxi	h, RAM_TOP
0020++ F936 CD 33 C8    		call	j_setMemTop
0021++ F939             
0022++ F939             		; ╘шы№ЄЁ
0023++ F939 21 84 FF    		lxi	h, a_12spaces + 9
0024++ F93C CD 4D FF    		call	fileSetType
0025++ F93F             
0026++ F93F             		; ─шёъ
0027++ F93F 06 80       		mvi	b, DLG_START_PAGE
0028++ F941             
0029++ F941             		; ╧ЁюфюыцрхЄё  т dlg_main0071+  F941             
0072+  F941             ; ---------------------------------------------------------------------------
0073+  F941             
0074+  F941             dlg_main:	
0075+  F941             		; ╬ўш∙рхь ¤ъЁрэ, яхЁхЁшёют√трхь чруюыютюъ ш эшцэ■■ ёЄЁюъє
0076+  F941 CD D8 FC    		call	dlg_pageChanged
0077+  F944             	
0078+  F944             dlg_main_0:
0079+  F944             		; ╤юїЁрэ хь Єхъє∙шщ Їрщы ш яюыюцхэшх ъєЁёюЁр
0080+  F944~            #if DLG_CURSOR_AT_TOP
0081+  F944~            		xchg
0082+  F944~            		lhld	v_curFile
0083+  F944~            		push	h
0084+  F944~            		lhld	v_cursorPos
0085+  F944~            		push	h
0086+  F944~            		xchg
0087+  F944             #endif	
0088+  F944             		; ┬√тюфшь тёх Їрщы√ эр ¤ъЁрэ
0089+  F944 CD 63 FB    dlg_main_1:	 call	fileLoadHeader
0090+  F947 F5          		 push	psw
0091+  F948 CD 02 FC    		  call	dlg_printFile
0092+  F94B F1          		 pop	psw
0093+  F94C 2A 74 D2    		 lhld	f_nextFile
0094+  F94F CA 44 F9    		jz	dlg_main_1
0095+  F952             
0096+  F952             #if NICE
0097+  F952             dlg_z1:
0098+  F952 CD A5 CD    		call	getCursorPos
0099+  F955 7C          		mov	a, h
0100+  F956 D6 16       		sui	16h
0101+  F958 D2 67 F9    		jnc	dlg_z0
0102+  F95B             		; 46 яЁюсхыют
0103+  F95B 01 20 2E    		lxi	b, (46 << 8) + ' '
0104+  F95E CD 9C FC    		call	printChars	
0105+  F961             		; ╧Ёртр  уЁрэшЎр
0106+  F961 CD 5F FC    		call	dlg_rightEdge
0107+  F964 C3 52 F9    		jmp	dlg_z1
0108+  F967             dlg_z0:		
0109+  F967             #endif		
0110+  F967             
0111+  F967             		; ╨шёєхь эшцэ■■ уЁрэшЎє
0112+  F967 CD 9C F9    		call	dlg_bottomEdge
0113+  F96A             		; ┬юёёЄрэртыштрхь яюыюцхэшх ъєЁёюЁр
0114+  F96A~            #if DLG_CURSOR_AT_TOP
0115+  F96A~            		pop	h
0116+  F96A~            		shld	v_cursorPos
0117+  F96A~            		pop	h
0118+  F96A~            		shld	v_curFile
0119+  F96A             #else
0120+  F96A 2A 72 D2    		lhld    v_printedFile
0121+  F96D             #endif	
0122+  F96D CD FF F9    		call    dlg_reloadItem
0123+  F970             
0124+  F970 CD C2 FE    		call    printStringEx
0125+  F973~            #if NICE==0
0126+  F973~            		.db C_BEEP
0127+  F973             #endif
0128+  F973 8E 93 8C 00 		.db C_POPCURSORL, C_PUSHCURSORS, C_NORMAL, 0
0129+  F977             
0130+  F977 2A 70 D2    		lhld	v_curFile
0131+  F97A C3 44 F9    		jmp	dlg_main_0
0132+  F97D             
0133+  F97D             ; ---------------------------------------------------------------------------
0134+  F97D             
0135+  F97D             dlg_msgYesNo:	; ┬√тюф ёююс∙хэш 
0136+  F97D CD 9D FD    		call	dlg_msg
0137+  F980             
0138+  F980             dlg_yesNo:	; ┬тюф ёЄЁюъш шч 4-ї ёштюыют
0139+  F980 21 95 D2    		lxi	h, buffer
0140+  F983 11 FF 04    		lxi	d, 4FFh
0141+  F986 CD 36 C8    		call	j_input
0142+  F989 77          		mov	m, a
0143+  F98A             
0144+  F98A             		; ┼ёыш эрцрЄ ENTER, яхўрЄрхь ёшьтюы 0E ш т√їюфшь
0145+  F98A 3E 0E       		mvi	a, 0Eh
0146+  F98C DA 0F C8    		jc	j_printCharA	; ┬√їюф
0147+  F98F             
0148+  F98F             		; ┼ёыш эрцрЄ эх ESC, яютЄюЁ хь
0149+  F98F C2 80 F9    		jnz	dlg_yesNo
0150+  F992             
0151+  F992             		; ┬√ъшф√трхь рфЁхё тючЁрЄр
0152+  F992 E1          		pop	h
0153+  F993             		
0154+  F993             loc_F9D0:	; ╤ЄшЁрхь Єю, ўЄю эрЁшёютрыш
0155+  F993 CD 9C F9    		call	dlg_bottomEdge
0156+  F996             
0157+  F996             		; ╧хЁхчруЁєчшЄ№ ш яхЁхЁшёютрЄ№ т√сЁрээ√щ Їрщы
0158+  F996 2A 70 D2    		lhld    v_curFile
0159+  F999 C3 FF F9    		jmp     dlg_reloadItem
0160+  F99C             
0161+  F99C             ; ---------------------------------------------------------------------------
0162+  F99C             ; ╨шёютрэшх эшцэхщ уЁрэшЎ√
0163+  F99C             
0164+  F99C             dlg_bottomEdge:
0165+  F99C             		; ╥хьэ√щ Їюэ, тюёёЄрэютыхэшх ъєЁёюЁр ¤ъЁрэр, єфрыхэшх, ъръющ Єю ёшьтюы
0166+  F99C CD C2 FE    		call	printStringEx
0167+  F99F 8C 94 08 1B 		.db 8Ch, 94h, 8, BORDER_BL, 0
0167+  F9A3 0C 00 
0168+  F9A5             	
0169+  F9A5             		; 46 ёшьтюыют 0x14
0170+  F9A5 01 0D 2E    		lxi	b, 2E00h | BORDER_B1
0171+  F9A8             
0172+  F9A8 CD 9C FC    		call	printChars
0173+  F9AB             
0174+  F9AB             		; ╤шьтюы 16, тюёёЄрэютыхэшх ъєЁёюЁр ёЄЁюъш
0175+  F9AB CD C2 FE    		call	printStringEx
0176+  F9AE 1B 18 8E 00 		.db BORDER_BR, 8Eh, 0
0177+  F9B2             
0178+  F9B2 C9          		ret
0179+  F9B3             
0180+  F9B3             ; ---------------------------------------------------------------------------
0181+  F9B3             ; ╩ыртш°р тэшч.
0182+  F9B3             
0183+  F9B3             dlg_down:	; ┼ёыш ¤Єю яюёыхфэшщ Їрщы, яхЁхїюфшь эр ёыхфє■∙є■ ёЄЁрэшЎє
0184+  F9B3 CD C2 FD    		call	dlg_isLastLine
0185+  F9B6 D2 CB F9    		jnc	dlg_nextPage
0186+  F9B9             
0187+  F9B9             		; ┼ёыш ¤Єю яюёыхфэ   ёЄЁюър эр ¤ъЁрэх, яхЁхЁшёют√трхь ¤ъЁрэ
0188+  F9B9             		; Єръ ўЄю эр°р ёЄЁюър юърч√трхЄё  ётхЁїє.
0189+  F9B9 3A 08 FC    		lda	v_dlgOffset+1
0190+  F9BC 3D          		dcr	a
0191+  F9BD B9          		cmp	c
0192+  F9BE CA DB FC    		jz	dlg_drawItems
0193+  F9C1             
0194+  F9C1             		; ╧юьх∙рхь т ёЄхъ рфЁхё ёыхфє■∙хую Їрщыр
0195+  F9C1 2A 74 D2    		lhld	f_nextFile
0196+  F9C4 E5          		push	h
0197+  F9C5             
0198+  F9C5             		; ╤ЄшЁрхь ъєЁёюЁ
0199+  F9C5 CD E0 FB    		call	printFileHeaderDark
0200+  F9C8             		
0201+  F9C8 C3 F5 F9    		jmp	dlg_upDownInt
0202+  F9CB             		
0203+  F9CB             ; ---------------------------------------------------------------------------
0204+  F9CB             
0205+  F9CB             dlg_nextPage:	; ╤ыхфє■∙р  ёЄЁрэшЎр (т ЁхушёЄЁх b)
0206+  F9CB CD 69 F8    		call	pageNext
0207+  F9CE             
0208+  F9CE             		; ▌Єю с√ыр яюёыхфэ   ёЄЁрэшЎр
0209+  F9CE D8          		rc
0210+  F9CF             
0211+  F9CF             		; ╤ЄЁрэшЎр с√ыр шчьхэхэр
0212+  F9CF C3 D8 FC    		jmp	dlg_pageChanged
0213+  F9D2             
0214+  F9D2             ; ---------------------------------------------------------------------------
0215+  F9D2             
0216+  F9D2             dlg_prevPage:	; ┼ёыш ¤Єю эєыхтр  ёЄЁрэшЎр, т√їюфшь
0217+  F9D2 78          		mov	a, b
0218+  F9D3~            #if ARAM_MAX_PAGE <= 7
0219+  F9D3~            		ani	7
0220+  F9D3             #else
0221+  F9D3 E6 0F       		ani	0Fh	; ╤ЄрЁ°шх сшЄ√ т√яюыэ ■Є ёяхЎ ЇєэъЎшш
0222+  F9D5             #endif
0223+  F9D5 CA 02 FA    		jz	dlg_drawItem
0224+  F9D8             
0225+  F9D8             		; ╙ьхэ№°рхь ёЄЁрэшЎє
0226+  F9D8 05          		dcr	b
0227+  F9D9 C3 D8 FC    		jmp	dlg_pageChanged
0228+  F9DC             
0229+  F9DC             ; ---------------------------------------------------------------------------
0230+  F9DC             
0231+  F9DC             dlg_up:		; ┼ёыш ¤Єю яхЁтр  ёЄЁюър, Єю яхЁхщЄш эр яЁхф√фє∙є■ ёЄЁрэшЎє
0232+  F9DC 2A 70 D2    		lhld	v_curFile
0233+  F9DF CD 54 C8    		call	j_cmp_hl_de
0234+  F9E2 CA D2 F9    		jz	dlg_prevPage
0235+  F9E5             
0236+  F9E5             		; ═хяюэ Єэю ўЄю т ё
0237+  F9E5 79          		mov	a, c
0238+  F9E6 FE 03       		cpi	3
0239+  F9E8 CA D8 FC    		jz	dlg_pageChanged
0240+  F9EB             
0241+  F9EB             .include	"filePrev.inc"
0001++ F9EB             ;+---------------------------------------------------------------------------
0002++ F9EB             ; RAMFOS
0003++ F9EB             ; ╧юыєўшЄ№ рфЁхё яЁхф√фє∙хую Їрщыр
0004++ F9EB             ;
0005++ F9EB             ; ═р тїюфх
0006++ F9EB             ;  hl - рфЁхё Їрщыр
0007++ F9EB             ;
0008++ F9EB             ; ═р т√їюфх
0009++ F9EB             ;  bc - рфЁхё яЁхф√фє∙хую Їрщыр
0010++ F9EB             ;
0011++ F9EB             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0012++ F9EB             ;----------------------------------------------------------------------------
0013++ F9EB             
0014++ F9EB             		; ╧юёыхфэшх фтр срщЄр Їрщыр ¤Єю єърчрЄхы№ эр эрўрыю.
0015++ F9EB 2B          		dcx	h
0016++ F9EC CD C2 FF    		call	pageRead
0017++ F9EF 41          		mov	b, c
0018++ F9F0 2B          		dcx	h
0019++ F9F1 CD C2 FF    		call	pageRead
0242+  F9F4             
0243+  F9F4             		; ╤юїЁрэ хь рфЁхё Їрщыр
0244+  F9F4 C5          		push	b
0245+  F9F5             
0246+  F9F5             dlg_upDownInt:	; ╤ЄшЁрхь ъєЁёюЁ
0247+  F9F5 CD E0 FB    		call	printFileHeaderDark
0248+  F9F8             
0249+  F9F8             dlg_upDownInt2:
0250+  F9F8             		; ╧хЁхьх∙рхь ъєЁёюЁ ттхЁї шыш тэшч
0251+  F9F8 3A 40 D2    		lda	v_lastKey
0252+  F9FB CD 0F C8    		call	j_printCharA
0253+  F9FE             
0254+  F9FE             		; ┬юёёЄрэрытрхь HL
0255+  F9FE E1          		pop	h
0256+  F9FF             
0257+  F9FF             dlg_reloadItem:	; ╟руЁєчшЄ№ чруюыютюъ Їрщыр
0258+  F9FF CD 63 FB    		call	fileLoadHeader
0259+  FA02             
0260+  FA02             dlg_drawItem:	; ┬√тхёЄш эрчтрэшх Їрщыр
0261+  FA02 CD DB FB    		call	printFileHeaderLight
0262+  FA05 4A          		mov	c, d
0263+  FA06             
0264+  FA06             		; ╞фхь ёшьтюы ё ъюфюь <0x20
0265+  FA06 CD 6C FA    dlg_0:		call	keyWaitNoCursor
0266+  FA09 FE 20       		cpi	20h
0267+  FA0B D2 06 FA    		jnc	dlg_0
0268+  FA0E             
0269+  FA0E 32 40 D2    		sta	v_lastKey
0270+  FA11             
0271+  FA11             		; de - эрўрыю фшёър
0272+  FA11 2A 43 D2    		lhld	v_pageStart
0273+  FA14 EB          		xchg
0274+  FA15             
0275+  FA15 FE 19       		cpi	19h
0276+  FA17 CA DC F9    		jz	dlg_up
0277+  FA1A FE 1A       		cpi	1Ah
0278+  FA1C CA B3 F9    		jz	dlg_down
0279+  FA1F FE 0D       		cpi	0Dh
0280+  FA21 CA 84 FA    		jz	dlg_enter
0281+  FA24 FE 1B       		cpi	1Bh
0282+  FA26 CA 5C FB    		jz	dlg_esc		; ESC
0283+  FA29 B7          		ora	a
0284+  FA2A CA E0 FA    		jz	dlg_f1		; F1
0285+  FA2D 3D          		dcr	a
0286+  FA2E CA DA FD    		jz	dlg_f2		; F2
0287+  FA31 3D          		dcr	a
0288+  FA32 CA 45 FE    		jz	dlg_f3		; F3
0289+  FA35 3D          		dcr	a
0290+  FA36 CA C8 FE    		jz	dlg_f4		; F4
0291+  FA39 3D          		dcr	a
0292+  FA3A CA 19 FF    		jz	dlg_f5		; F5
0293+  FA3D 3D          		dcr	a
0294+  FA3E CA D2 FC    		jz	dlg_f6		; F6
0295+  FA41 3D          		dcr	a
0296+  FA42 C2 02 FA    		jnz	dlg_drawItem
0297+  FA45             		; ╧Ёюфюыцхэшх т startDebuger
0298+  FA45             
0299+  FA45             ; ---------------------------------------------------------------------------
0300+  FA45             
0301+  FA45             .include "startEditorDebuger.inc"
0001++ FA45             ;+---------------------------------------------------------------------------
0002++ FA45             ; RAMFOS
0003++ FA45             ; ╟ряєёъ ЁхфрЄюЁр ш юЄырфўшър
0004++ FA45             ;
0005++ FA45             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006++ FA45             ;----------------------------------------------------------------------------
0007++ FA45             
0008++ FA45             #if NO_ROM_ENTRY
0009++ FA45             		; └фЁхё яюфяЁюуЁрьь√ т ╧╟╙
0010++ FA45 21 5A FA    		lxi	h, a_debuger
0011++ FA48             
0012++ FA48             editorDebuger:	; ┬ Ёхцшьх т√сюЁр Їрщыр чряєёърЄ№ эхы№ч 
0013++ FA48 78          		mov	a, b
0014++ FA49 87          		add	a
0015++ FA4A F8          		rm
0016++ FA4B             
0017++ FA4B             		; ╟ряєёъ
0018++ FA4B C3 5E FF    		jmp	exec		
0019++ FA4E             		
0020++ FA4E 45 64 69 74 a_editor:	.db "Editor   EXE"
0020++ FA52 6F 72 20 20 
0020++ FA56 20 45 58 45 
0021++ FA5A 44 65 62 75 a_debuger:	.db "Debuger  EXE"
0021++ FA5E 67 65 72 20 
0021++ FA62 20 45 58 45 
0022++ FA66             
0023++ FA66             ; ---------------------------------------------------------------------------
0024++ FA66             
0025++ FA66             startEditor:	; └фЁхё яюфяЁюуЁрьь√ т ╧╟╙
0026++ FA66 21 4E FA    		lxi	h, a_editor
0027++ FA69 C3 48 FA    		jmp	editorDebuger
0028++ FA6C             
0029++ FA6C~            #else ; ---------------------------------------------------------------------
0030++ FA6C~            
0031++ FA6C~            		; └фЁхё яюфяЁюуЁрьь√ т ╧╟╙
0032++ FA6C~            		lxi	h, 3
0033++ FA6C~            
0034++ FA6C~            editorDebuger:	; if(b & 0x40) return;
0035++ FA6C~            		mov	a, b
0036++ FA6C~            		ral
0037++ FA6C~            		ral
0038++ FA6C~            		rc
0039++ FA6C~            
0040++ FA6C~            		; ╧юьх∙рхь т ёЄхъ рфЁхё тючтЁрЄр
0041++ FA6C~            		xthl
0042++ FA6C~            
0043++ FA6C~            		; ╤юїЁрэ хь т√сЁрээ√щ Їрщы
0044++ FA6C~            		call	memcpy_fd_fd2
0045++ FA6C~            
0046++ FA6C~            		; └фЁхё чруЁєчъш
0047++ FA6C~            		lxi	h, 0E800h
0048++ FA6C~            
0049++ FA6C~            		; ┬ъы■ўрхь ╧╟╙
0050++ FA6C~            		sta	IO_PAGE_ROM
0051++ FA6C~            		ret
0052++ FA6C~            
0053++ FA6C~            ; ---------------------------------------------------------------------------
0054++ FA6C~            
0055++ FA6C~            startEditor:	; └фЁхё яюфяЁюуЁрьь√ т ╧╟╙
0056++ FA6C~            		lxi	h, 6
0057++ FA6C~            		jmp	editorDebuger
0058++ FA6C~            
0059++ FA6C             #endif0302+  FA6C             .include "keyWaitNoCursor.inc"
0001++ FA6C             ;+---------------------------------------------------------------------------
0002++ FA6C             ; RAMFOS
0003++ FA6C             ; ╬цшфрэшх эрцрЄш  ъыртш°ш схч ъєЁёюЁр
0004++ FA6C             ;
0005++ FA6C             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006++ FA6C             ;----------------------------------------------------------------------------
0007++ FA6C             
0008++ FA6C             ; ╥єЄ ю°шсър, ъєЁёюЁ тё╕Єръш ьюцхЄ яЁюьхы№ъэєЄ№
0009++ FA6C             
0010++ FA6C CD 12 C8    keyWaitNoCursor:call	j_keyCheck
0011++ FA6F C2 03 C8    		jnz	j_keyWait
0012++ FA72 C3 6C FA    		jmp	keyWaitNoCursor0303+  FA75             .include "memcmp_hl_de_c.inc"
0001++ FA75             ;+---------------------------------------------------------------------------
0002++ FA75             ; RAMFOS
0003++ FA75             ; ╤ЁртэшЄ№ ё Ёрё°шЁхэшх Єхъє∙хую Їрщыр
0004++ FA75             ;
0005++ FA75             ; ═р тїюфх
0006++ FA75             ;  hl - рфЁхё
0007++ FA75             ; 
0008++ FA75             ; ═р т√їюфх
0009++ FA75             ;  z  - хёыш сыюъш Ёртэ√
0010++ FA75             ; 
0011++ FA75             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0012++ FA75             ;----------------------------------------------------------------------------
0013++ FA75             
0014++ FA75 11 5E D2    memcmp_ext:	lxi	d, v_header_ext
0015++ FA78             
0016++ FA78             ;----------------------------------------------------------------------------
0017++ FA78             ; RAMFOS
0018++ FA78             ; ╤ЁртэшЄ№ 3 срщЄр ╬╟╙
0019++ FA78             ;
0020++ FA78             ; ═р тїюфх
0021++ FA78             ;  hl - рфЁхё 1
0022++ FA78             ;  de - рфЁхё 2
0023++ FA78             ; 
0024++ FA78             ; ═р т√їюфх
0025++ FA78             ;  z  - хёыш сыюъш Ёртэ√
0026++ FA78             ; 
0027++ FA78             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0028++ FA78             ;----------------------------------------------------------------------------
0029++ FA78             
0030++ FA78 0E 03       memcmp_hl_de_3:	mvi	c, 3
0031++ FA7A             
0032++ FA7A             ;----------------------------------------------------------------------------
0033++ FA7A             ; RAMFOS
0034++ FA7A             ; ╤ЁртэшЄ№ ╬╟╙
0035++ FA7A             ;
0036++ FA7A             ; ═р тїюфх
0037++ FA7A             ;  hl - рфЁхё 1
0038++ FA7A             ;  de - рфЁхё 2
0039++ FA7A             ;  ё  - ЁрчьхЁ
0040++ FA7A             ; 
0041++ FA7A             ; ═р т√їюфх
0042++ FA7A             ;  z  - хёыш сыюъш Ёртэ√
0043++ FA7A             ; 
0044++ FA7A             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0045++ FA7A             ;----------------------------------------------------------------------------
0046++ FA7A             
0047++ FA7A             memcmp_hl_de_c:	 ; if(*de-- != *hl--) return;
0048++ FA7A 1A          		 ldax	d
0049++ FA7B BE          		 cmp	m
0050++ FA7C 23          		 inx	h
0051++ FA7D C0          		 rnz
0052++ FA7E 13          		 inx	d
0053++ FA7F 0D          		 dcr	c
0054++ FA80 C2 7A FA    		jnz	memcmp_hl_de_c
0055++ FA83 C9          		ret
0304+  FA84             
0305+  FA84             ; ---------------------------------------------------------------------------
0306+  FA84             
0307+  FA84 CD C2 FD    dlg_enter:	call	dlg_isLastLine
0308+  FA87 CA 02 FA    		jz	dlg_drawItem
0309+  FA8A             
0310+  FA8A~            #if OPEN_ANY_FILE==0
0311+  FA8A~            		; ╤ЁртэшЄ№ Ёрё°шЁхэшх т√сЁрээюую Їрщыр ё єёЄрэютыхээ√ь Ёрё°шЁхэшхь
0312+  FA8A~            		lxi	h, v_header2_ext
0313+  FA8A~            		call	memcmp_ext
0314+  FA8A             #endif
0315+  FA8A             		; ┼ёыш ¤Єю Ёхцшь т√сюЁр Їрщыр
0316+  FA8A 78          		mov	a, b
0317+  FA8B 17          		ral
0318+  FA8C 17          		ral
0319+  FA8D             #if OPEN_ANY_FILE
0320+  FA8D DA CF FA    		jc	dlg_enter_1
0321+  FA90~            #else
0322+  FA90~            		jc	dlg_enter_0
0323+  FA90             #endif	
0324+  FA90             
0325+  FA90             .include "rks.inc"
0001++ FA90             ;+---------------------------------------------------------------------------
0002++ FA90             ; RAMFOS
0003++ FA90             ; ╟ряєёъ RKS Їрщыр
0004++ FA90             ;
0005++ FA90             ; 2013-11-01 ╨рчЁрсюЄрэю vinxru
0006++ FA90             ;----------------------------------------------------------------------------
0007++ FA90             
0008++ FA90             #if RKS_LOADER
0009++ FA90             		; ▌Єю RKS Їрщы
0010++ FA90 21 B1 FA    		lxi	h, a_rks
0011++ FA93 CD 75 FA    		call	memcmp_ext
0012++ FA96 C2 C0 FA    		jnz	defExec2
0013++ FA99             		
0014++ FA99             		; ╟руЁєчшЄ№ хую т ярь Є№
0015++ FA99 CD 34 FB    		call	fileLoad2
0016++ FA9C C2 9E FE    		jnz	dlg_error
0017++ FA9F             
0018++ FA9F             		; ═рщЄш Їрщы Monitor2.sys
0019++ FA9F E5          		push	h
0020++ FAA0 21 B4 FA    		 lxi	h, a_monitor2_sys
0021++ FAA3 CD 6C FF    		 call	exec1
0022++ FAA6 E1          		pop	h
0023++ FAA7 C2 9E FE    		jnz	dlg_error
0024++ FAAA             		
0025++ FAAA             		; ╧Ёш чруЁєчъх ьюэшЄюЁр ёЄрэфрЁЄэ√щ ёЄхъ сєфхЄ єэшўЄюцхэ
0026++ FAAA 31 FF 8F    		lxi	sp, 8FFFh
0027++ FAAD             
0028++ FAAD             		; └фЁхё яЁюуЁрьь√
0029++ FAAD E5          		push	h
0030++ FAAE C3 64 FF    		jmp	exec2
0031++ FAB1             
0032++ FAB1 52 4B 53    a_rks:		.db "RKS"
0033++ FAB4 4D 6F 6E 69 a_monitor2_sys:	.db "Monitor2 SYS"
0033++ FAB8 74 6F 72 32 
0033++ FABC 20 53 59 53 
0034++ FAC0             
0035++ FAC0             defExec2:
0036++ FAC0             #endif0326+  FAC0             
0327+  FAC0             		; ─юяєёър■Єё  Єюы№ъю Ёрё°шЁхэш  EXE ш COM
0328+  FAC0 21 87 FF    		lxi	h, a_exe		; "EXE"
0329+  FAC3 CD 75 FA    		call	memcmp_ext
0330+  FAC6 21 8A FF    		lxi	h, a_com		; "COM"
0331+  FAC9 C4 75 FA    		cnz	memcmp_ext
0332+  FACC             
0333+  FACC             		; ═хфюяєёЄшьюх Ёрё°шЁхэшх, яхЁхїюфшь т юёэютэющ Ўшъы
0334+  FACC C2 02 FA    dlg_enter_0:	jnz	dlg_drawItem
0335+  FACF             
0336+  FACF 2A 6A D2    dlg_enter_1:	lhld	v_header_start
0337+  FAD2 EB          		xchg
0338+  FAD3             
0339+  FAD3             		; ╨хцшь т√сюЁр
0340+  FAD3 DA FC FA    		jc	dlg_select
0341+  FAD6             
0342+  FAD6 CD 38 FB    		call	fileLoadComEx
0343+  FAD9 C2 9E FE    		jnz	dlg_error
0344+  FADC             
0345+  FADC             		;
0346+  FADC E3          		xthl
0347+  FADD C3 03 FB    		jmp	loc_FB05
0348+  FAE0             
0349+  FAE0             ; ---------------------------------------------------------------------------
0350+  FAE0             
0351+  FAE0             dlg_f1:		; ┬√тюфшь ёююс∙хэшх
0352+  FAE0 11 8D FF    		lxi	d, a_copy
0353+  FAE3 CD 97 FD    		call	dlg_checkMsg
0354+  FAE6 C8          		rz
0355+  FAE7             
0356+  FAE7             		; ┬тюф ўшёыр т v_header_start
0357+  FAE7 CD 80 F9    		call	dlg_yesNo
0358+  FAEA 2A 6A D2    		lhld	v_header_start	; ╟рўхь?
0359+  FAED FC 39 C8    		cm	j_strToHex	; ╧ЁхюсЁрчютрЄ№ ёЄЁюъє DE т ўшёыю HL
0360+  FAF0 CA 9E FE    		jz	dlg_error
0361+  FAF3             
0362+  FAF3             fileLoadSetAddr:; ╙ёЄрэютшЄ№ эют√щ рфЁхё чруЁєчъш
0363+  FAF3             		; de = v_header_start = hl; 
0364+  FAF3             		; hl = v_header_stop  = f_fileBodySize + hl;
0365+  FAF3 CD 13 FB    		call	fileChangeAddr
0366+  FAF6             
0367+  FAF6             		; ┼ёыш Ёхцшь т√сюЁр Їрщыр, Єю ёюїЁрэ хь чруюыютюъ Їрщыр.
0368+  FAF6             		; ┬ чруюыютъх ь√ Єюы№ъю ўЄю шчьхэшыш рфЁхё чруЁєчъш
0369+  FAF6 78          		mov	a, b
0370+  FAF7 17          		ral
0371+  FAF8 17          		ral
0372+  FAF9 D2 46 D1    		jnc	fileSaveHeader
0373+  FAFC             		
0374+  FAFC             dlg_select:	; ╟руЁєчшЄ№ Їрщы т ярь Є№
0375+  FAFC CD 38 FB    		call	fileLoadComEx
0376+  FAFF C2 9E FE    		jnz	dlg_error
0377+  FB02 E1          		pop	h
0378+  FB03             
0379+  FB03 C5          loc_FB05:	push	b
0380+  FB04             		 ; ┬√тхёЄш шь  Їрщыр
0381+  FB04 CD EF FB    		 call	printFileHeaderName
0382+  FB07             		 ; ╤юїЁрэшЄ№ шэЇюЁьрЎш■ ю чруЁєцхээюь Їрщых
0383+  FB07 CD A4 FB    		 call	memcpy_fd_fd2
0384+  FB0A C1          		pop	b
0385+  FB0B             
0386+  FB0B             loadDStartDStop:; de=v_header_stop, hl=v_header_start
0387+  FB0B 2A 6C D2    		lhld	v_header_stop
0388+  FB0E EB          		xchg
0389+  FB0F 2A 6A D2    		lhld	v_header_start
0390+  FB12 C9          		ret
0391+  FB13             
0392+  FB13             ; ---------------------------------------------------------------------------
0393+  FB13             
0394+  FB13             ; de = v_header_start = hl; v_header_stop = f_fileBodySize+hl;
0395+  FB13             
0396+  FB13 22 6A D2    fileChangeAddr: shld	v_header_start
0397+  FB16 EB          		xchg
0398+  FB17 2A 76 D2    		lhld	f_fileBodySize
0399+  FB1A 19          		dad	d
0400+  FB1B 22 6C D2    		shld	v_header_stop
0401+  FB1E C9          		ret
0402+  FB1F             
0403+  FB1F             ; ---------------------------------------------------------------------------
0404+  FB1F             
0405+  FB1F             .include "fileLoad.inc"
0001++ FB1F             ;+---------------------------------------------------------------------------
0002++ FB1F             ; RAMFOS
0003++ FB1F             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F84E
0004++ FB1F             ; ╟руЁєчшЄ№ Єхъє∙шщ Їрщы яю рфЁхёє HL
0005++ FB1F             ;
0006++ FB1F             ; ═р тїюфх
0007++ FB1F             ;   hl     - └фЁхё чруЁєчъш Їрщыр
0008++ FB1F             ;
0009++ FB1F             ; ═р т√їюфх
0010++ FB1F             ;   z      - ╘рщы чруЁєцхэ схч ю°шсюъ
0011++ FB1F             ;
0012++ FB1F             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0013++ FB1F             ;----------------------------------------------------------------------------
0014++ FB1F             
0015++ FB1F             fileLoad:	; ╧юфьхэ хь рфЁхё чруЁєчъш т чруюыютъх Їрщыр
0016++ FB1F             		; de = v_header_start = hl; v_header_stop = f_fileBodySize + hl;
0017++ FB1F CD 13 FB    		call	fileChangeAddr
0018++ FB22             
0019++ FB22 C3 47 FB    		jmp	fileLoadCom
0020++ FB25             
0021++ FB25             ;----------------------------------------------------------------------------
0022++ FB25             ; RAMFOS
0023++ FB25             ; ╟руЁєчшЄ№ Єхъє∙шщ Їрщы схч яЁютхЁъш ъюэЄЁюы№эющ ёєьь√
0024++ FB25             ;
0025++ FB25             ; ═р тїюфх
0026++ FB25             ;   de     - └фЁхё чруЁєчъш Їрщыр
0027++ FB25             ;
0028++ FB25             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0029++ FB25             ;----------------------------------------------------------------------------
0030++ FB25             
0031++ FB25             #if RKS_LOADER
0032++ FB25             fileLoadNoCheck:; bc - фышэр Їрщыр
0033++ FB25             		; hl - рфЁхё Єхыр Їрщыр т ─╬╟╙
0034++ FB25 2A 76 D2    		lhld	f_fileBodySize
0035++ FB28 E5          		push	h
0036++ FB29 2A 70 D2    		 lhld	v_curFile ; єърчрЄхы№ эр чруюыютюъ
0037++ FB2C 01 1E 00    		 lxi	b, 30	; фышэр чруюыютър
0038++ FB2F 09          		 dad	b
0039++ FB30 C1          		pop	b
0040++ FB31             
0041++ FB31             		; ╫шЄрхь bc срщЄ шч ─╬╟╙ яю рфЁхёє hl т ╬╟╙ яю рфЁхёє de
0042++ FB31 C3 87 FD    		jmp	pageReadBlock ; hl-фшёъ,de-ярь Є№,bc-фышэр-1
0043++ FB34             
0044++ FB34             ;----------------------------------------------------------------------------
0045++ FB34             ; RAMFOS
0046++ FB34             ; ╟руЁєчшЄ№ Єхъє∙шщ Їрщы яю рфЁхёє єърчрээюьє т чруюыютъх
0047++ FB34             ; ╤ т√тюфюь ёююс∙хэш  "╞фшЄх!"
0048++ FB34             ;
0049++ FB34             ; ═р т√їюфх
0050++ FB34             ;   z      - ╘рщы чруЁєцхэ схч ю°шсюъ
0051++ FB34             ;
0052++ FB34             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0053++ FB34             ;----------------------------------------------------------------------------
0054++ FB34             	
0055++ FB34 2A 6A D2    fileLoad2:	lhld	v_header_start
0056++ FB37 EB          		xchg
0057++ FB38             #endif
0058++ FB38             
0059++ FB38             ;----------------------------------------------------------------------------
0060++ FB38             ; RAMFOS
0061++ FB38             ; ╟руЁєчшЄ№ Єхъє∙шщ Їрщыяю рфЁхёє т DE
0062++ FB38             ; ╤ т√тюфюь ёююс∙хэш  "╞фшЄх!"
0063++ FB38             ;
0064++ FB38             ; ═р тїюфх
0065++ FB38             ;   de     - └фЁхё чруЁєчъш Їрщыр
0066++ FB38             ;
0067++ FB38             ; ═р т√їюфх
0068++ FB38             ;   z      - ╘рщы чруЁєцхэ схч ю°шсюъ
0069++ FB38             ;
0070++ FB38             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0071++ FB38             ;----------------------------------------------------------------------------
0072++ FB38             	
0073++ FB38             ; ─юыцхэ с√Є№ чруЁєцхэ чруюыютюъ
0074++ FB38             ; ═р т√їюфх фюыцэю с√Є№ de = v_header_start
0075++ FB38             
0076++ FB38             fileLoadComEx:	; ┬√тюф ёююс∙хэш  "╞фшЄх!"
0077++ FB38 CD C2 FE    		call	printStringEx
0078++ FB3B 8E 8B 20 D6 		.db 8Eh, 8Bh, 20h, 0D6h, 0C4h, 0C9h, 0D4h, 0C5h, 21h, 20h, 8Eh, 0
0078++ FB3F C4 C9 D4 C5 
0078++ FB43 21 20 8E 00 
0079++ FB47             
0080++ FB47             fileLoadCom:
0081++ FB47             #if RKS_LOADER
0082++ FB47 CD 25 FB    		call	fileLoadNoCheck
0083++ FB4A~            #else
0084++ FB4A~            		; bc - фышэр Їрщыр
0085++ FB4A~            		; hl - рфЁхё Єхыр Їрщыр т ─╬╟╙
0086++ FB4A~            		lhld	f_fileBodySize
0087++ FB4A~            		push	h
0088++ FB4A~            		 lhld	v_curFile ; єърчрЄхы№ эр чруюыютюъ
0089++ FB4A~            		 lxi	b, 30	; фышэр чруюыютър
0090++ FB4A~            		 dad	b
0091++ FB4A~            		pop	b
0092++ FB4A~            
0093++ FB4A~            		; ╫шЄрхь bc срщЄ шч ─╬╟╙ яю рфЁхёє hl т ╬╟╙ яю рфЁхёє de
0094++ FB4A~            		call	pageReadBlock ; hl-фшёъ,de-ярь Є№,bc-фышэр-1#endif
0095++ FB4A             #endif
0096++ FB4A             		; ╨рёўшЄ√трхь ъюэЄЁюы№эє■ ёєььє юЄ v_header_start фю v_header_stop
0097++ FB4A 1B          		dcx	d
0098++ FB4B 2A 6A D2    		lhld	v_header_start
0099++ FB4E CD 2A C8    		call	j_calcCrc
0100++ FB51             
0101++ FB51             		; ╤ЁртэшЄ№ bc ш v_header_crc
0102++ FB51 C5          		push	b
0103++ FB52 D1          		pop	d		
0104++ FB53 2A 6E D2    		lhld	v_header_crc
0105++ FB56 CD 54 C8    		call	j_cmp_hl_de
0106++ FB59             
0107++ FB59             		; de=v_header_stop, hl=v_header_start
0108++ FB59 C3 0B FB    		jmp	loadDStartDStop0406+  FB5C             
0407+  FB5C             ; ---------------------------------------------------------------------------
0408+  FB5C             
0409+  FB5C             dlg_esc:	; ┼ёыш ¤Єю эх Ёхцшь т√сюЁр Їрщыр, эшўхую эх фхырхь
0410+  FB5C 78          		mov	a, b
0411+  FB5D 17          		ral
0412+  FB5E 17          		ral
0413+  FB5F D0          		rnc
0414+  FB60             
0415+  FB60             		; ┬ючтЁр∙рхьё  т яЁюуЁрььє		
0416+  FB60 E1          		pop	h
0417+  FB61 3F          		cmc
0418+  FB62 C9          		ret
0419+  FB63             
0420+  FB63             ; ---------------------------------------------------------------------------
0421+  FB63             
0422+  FB63             .include "fileLoadHeader.inc"
0001++ FB63             ;----------------------------------------------------------------------------
0002++ FB63             ; RAMFOS
0003++ FB63             ; ╟руЁєчшЄ№ чруюыютюъ Їрщыр
0004++ FB63             ;
0005++ FB63             ; ═р тїюфх
0006++ FB63             ;   v_page          - ═юьхЁ Єхъє∙хщ ёЄЁрэшЎ√
0007++ FB63             ;   hl              - └фЁхё Єхъє∙хую Їрщыр т ─╬╟╙
0008++ FB63             ;
0009++ FB63             ; ═р т√їюфх, хёыш Їрщы эрщфхэ
0010++ FB63             ;   b               - ╥хъє∙р  ёЄЁрэшЎр ─╬╟╙
0011++ FB63             ;   v_curFile       - └фЁхё Єхъє∙хую Їрщыр т ─╬╟╙
0012++ FB63             ;   v_header        - ╟руюыютюъ Їрщыр
0013++ FB63             ;   f_fileBodySize  - ─ышэр Їрщыр схч чруюыютър - 1
0014++ FB63             ;   f_fileSize      - ─ышэр Їрщыр ё чруюыютъюь
0015++ FB63             ;   f_nextFile      - └фЁхё ёыхфє■∙хую Їрщыр т ─╬╟╙
0016++ FB63             ;
0017++ FB63             ;   ┼ёыш эх тъы■ўхэю т ─╬╟╙ яю рфЁхёє v_curFile + f_fileSize 
0018++ FB63             ;   чряшё√трхЄё  v_curFile
0019++ FB63             ;
0020++ FB63             ; ═р т√їюфх, хёыш Їрщы эх эрщфхэ
0021++ FB63             ;   v_pageFreePtr, v_curFile - └фЁхё яхЁтюую ётюсюфэюую срщЄр
0022++ FB63             ;   v_pageFreeTotal      - ╤тюсюфэю срщЄ
0023++ FB63             ;
0024++ FB63             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0025++ FB63             ;----------------------------------------------------------------------------
0026++ FB63             
0027++ FB63             fileLoadHeader:	; ╤юїЁрэ хь ёьх∙хэшх Єхъє∙хую Їрщыр т v_curFile
0028++ FB63 22 70 D2    		shld	v_curFile
0029++ FB66             
0030++ FB66             		; ╫шЄрхь чруюыютюъ Їрщыр ё фшёър т v_header
0031++ FB66 11 52 D2    		lxi	d, v_header
0032++ FB69 D5          		push	d
0033++ FB6A 01 1D 00    		 lxi	b, FILE_HEADER_SIZE-1
0034++ FB6D CD 87 FD    		 call	pageReadBlock
0035++ FB70 D1          		pop	d
0036++ FB71             
0037++ FB71             		; ╧юьх∙рхь т ┬ Єхъє∙є■ ёЄЁрэшЎє
0038++ FB71 3A 45 D2    		lda	v_page
0039++ FB74 47          		mov	b, a
0040++ FB75             
0041++ FB75             		; ┬ эрўрых Їрщыр фюыцэю с√Є№ D3,D3,D3
0042++ FB75 21 78 FF    		lxi	h, a_defHeader
0043++ FB78 CD 78 FA    		call	memcmp_hl_de_3	; b эх шчьхэ хЄ
0044++ FB7B             
0045++ FB7B             		; ┼ёыш ьрЁъхЁ эрщфхэ, Єю яхЁхїюфшь ъ fileLoadHeader2
0046++ FB7B CA B5 FB    		jz	fileLoadHeader2
0047++ FB7E             
0048++ FB7E             		; ═х эрщфхэ ьрЁъхЁ эрўрыр Їрщыр!
0049++ FB7E             
0050++ FB7E             		; ┬юёёЄрэрыштрхь чруюыютюъ т ярь Єш
0051++ FB7E 21 78 FF    		lxi	h, a_defHeader
0052++ FB81 11 52 D2    		lxi	d, v_header
0053++ FB84 CD AA FB    		call	memcpy_de_hl_15
0054++ FB87             
0055++ FB87             		; ╙ёЄрэрыштрхь ъюэхЎ ёЄЁрэшЎ√
0056++ FB87 2A 74 D2    		lhld	f_nextFile	
0057++ FB8A 22 7C D2    		shld	v_pageFreePtr
0058++ FB8D EB          		xchg
0059++ FB8E             
0060++ FB8E             		; ╧юыєўрхь т HL ЁрчьхЁ ёЄЁрэшЎ√
0061++ FB8E 2A 1C C6    		lhld	v_aramPageEnd
0062++ FB91 3A 42 FD    		lda	a_panelOA
0063++ FB94 FE 4F       		cpi	'O'
0064++ FB96 C2 9C FB    		jnz	fileLoadHeader_0
0065++ FB99 21 FC FF    		 lxi	h, ROM_PAGE_END
0066++ FB9C             fileLoadHeader_0:	
0067++ FB9C                             ; ╨рёёўшЄ√трхь ётюсюфэюх ьхёЄю эр фшёъх
0068++ FB9C CD D3 FD    		call	sub_hl_de
0069++ FB9F 22 7A D2    		shld	v_pageFreeTotal
0070++ FBA2             
0071++ FBA2             		; ?
0072++ FBA2 0D          		dcr	c
0073++ FBA3 C9          		ret0423+  FBA4             
0424+  FBA4             ; ---------------------------------------------------------------------------
0425+  FBA4             ; ╤ъюяшЁютрЄ№ шь  т√сЁрээюую Їрщыр ё v_header2_name
0426+  FBA4             
0427+  FBA4 21 52 D2    memcpy_fd_fd2:	lxi	h, v_header
0428+  FBA7 11 F2 D1    		lxi	d, v_header2
0429+  FBAA 0E 0E       memcpy_de_hl_15:mvi	c, 14
0430+  FBAC             
0431+  FBAC             .include "memcpy_de_hl_c.inc"
0001++ FBAC             ;+---------------------------------------------------------------------------
0002++ FBAC             ; RAMFOS
0003++ FBAC             ; ╩юяшЁютрэшх ╬╟╙
0004++ FBAC             ;
0005++ FBAC             ; ═р тїюфх
0006++ FBAC             ;  hl - юЄъєфр
0007++ FBAC             ;  de - ъєфр
0008++ FBAC             ;  ё  - ЁрчьхЁ-1
0009++ FBAC             ; 
0010++ FBAC             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0011++ FBAC             ;----------------------------------------------------------------------------
0012++ FBAC             
0013++ FBAC 7E          memcpy_de_hl_c: mov	a, m
0014++ FBAD 12          		stax	d
0015++ FBAE 23          		inx	h
0016++ FBAF 13          		inx	d
0017++ FBB0 0D          		dcr	c
0018++ FBB1 F2 AC FB    		jp	memcpy_de_hl_c
0019++ FBB4 C9          		ret
0432+  FBB5             .include "fileLoadHeader2.inc"
0001++ FBB5             ;+---------------------------------------------------------------------------
0002++ FBB5             ; RAMFOS
0003++ FBB5             ; ╨рёўшЄрЄ№ фюя яхЁхьхээ√х чруЁєцхээюую чруюыютър Їрщыр
0004++ FBB5             ;
0005++ FBB5             ; ═р тїюфх
0006++ FBB5             ;   v_curFile      - └фЁхё Єхъє∙хую Їрщыр т ─╬╟╙
0007++ FBB5             ;   f_header       - ╟руюыютюъ Їрщыр
0008++ FBB5             ;
0009++ FBB5             ; ═р т√їюфх
0010++ FBB5             ;   f_fileBodySize - ─ышэр Їрщыр схч чруюыютър - 1
0011++ FBB5             ;   f_fileSize     - ─ышэр Їрщыр ё чруюыютъюь
0012++ FBB5             ;   f_nextFile     - └фЁхё ёыхфє■∙хую Їрщыр т ─╬╟╙
0013++ FBB5             ;
0014++ FBB5             ;   ┼ёыш эх тъы■ўхэю т ─╬╟╙ яю рфЁхёє v_curFile + f_fileSize 
0015++ FBB5             ;   чряшё√трхЄё  v_curFile
0016++ FBB5             ;
0017++ FBB5             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0018++ FBB5             ;----------------------------------------------------------------------------
0019++ FBB5             
0020++ FBB5             fileLoadHeader2:; ─ышэр Їрщыр схч чруюыютър
0021++ FBB5             		; f_fileBodySize = v_header_stop - v_header_start
0022++ FBB5 CD 0B FB    		call	loadDStartDStop	
0023++ FBB8 EB          		xchg
0024++ FBB9 CD D3 FD    		call	sub_hl_de
0025++ FBBC 22 76 D2    		shld	f_fileBodySize
0026++ FBBF             
0027++ FBBF             		; ─ышэр Їрщыр ё чруюыютюь
0028++ FBBF             		; f_fileSize = f_fileBodySize+1
0029++ FBBF 11 1F 00    		lxi	d, FILE_HEADER_SIZE+1
0030++ FBC2 19          		dad	d
0031++ FBC3 22 78 D2    		shld	f_fileSize
0032++ FBC6             
0033++ FBC6             		; ╩юэхЎ Їрщыр
0034++ FBC6             		; de = v_curFile + f_fileSize
0035++ FBC6 EB          		xchg
0036++ FBC7 2A 70 D2    		lhld	v_curFile
0037++ FBCA EB          		xchg
0038++ FBCB 19          		dad	d
0039++ FBCC             
0040++ FBCC             		; ╬сэюты хь т ─╬╟╙ єърчрЄхы№ эр эр° Їрщы, ъюЄюЁ√щ эрїюфшЄё 
0041++ FBCC             		; яхЁхф ёыхфє■∙шь Їрщыюь.
0042++ FBCC 4B          		mov	c, e
0043++ FBCD CD D1 FF    		call	pageWrite
0044++ FBD0 23          		inx	h
0045++ FBD1 4A          		mov	c, d
0046++ FBD2 CD D1 FF    		call	pageWrite
0047++ FBD5 23          		inx	h
0048++ FBD6             
0049++ FBD6             		; └фЁхё ёыхфє■∙хую Їрщыр
0050++ FBD6             		; f_nextFile =  v_curFile + f_fileSize + 2
0051++ FBD6 22 74 D2    		shld	f_nextFile
0052++ FBD9             
0053++ FBD9             		; ┬ючтЁр∙рхь эюы№ ш Z
0054++ FBD9 AF          		xra	a
0055++ FBDA C9          		ret0433+  FBDB             
0434+  FBDB             ; ---------------------------------------------------------------------------
0435+  FBDB             
0436+  FBDB             printFileHeaderLight:
0437+  FBDB             		; ┼ёыш ёфхырЄ№ ъєЁёюЁ ЎтхЄэ√ь, Єю ЎтхЄ сєфхЄ чрфхтрЄ№ Ёрьъє. 
0438+  FBDB             
0439+  FBDB             		; ╚этхЁёш 
0440+  FBDB 3E 8B       		mvi	a, C_INVERSE
0441+  FBDD CD 0F C8    		call	j_printCharA
0442+  FBE0             
0443+  FBE0             printFileHeaderDark:
0444+  FBE0             		; ╘єэъЎш  ёюїЁрэшЄ яюыюцхэшх ъєЁёюЁр ёЄЁюъш, эю эх тюёёЄрэютшЄ хую
0445+  FBE0             		; ┬√тхфхЄ эр ¤ъЁрэ шь  Їрщыр
0446+  FBE0             		; ╧юёых т√тюфр шьхэш ЇєэъЎш  єёЄрэютшЄ Єхьэ√щ Їюэ
0447+  FBE0 CD E8 FB    		call	printFileHeaderName2
0448+  FBE3             
0449+  FBE3             popCursorLine2:	; ┬юёёЄрэютшЄ№ ъєЁёюЁ ёЄЁюъш
0450+  FBE3 3E 8E       		mvi	a, C_POPCURSORL
0451+  FBE5 C3 0F C8    		jmp	j_printCharA
0452+  FBE8             
0453+  FBE8             ; ---------------------------------------------------------------------------
0454+  FBE8             ; ╘єэъЎш  ёюїЁрэшЄ яюыюцхэшх ъєЁёюЁр ёЄЁюъш, эю эх тюёёЄрэютшЄ хую
0455+  FBE8             ; ┬√тхфхЄ эр ¤ъЁрэ шь  Їрщыр
0456+  FBE8             ; ╧юёых т√тюфр шьхэш ЇєэъЎш  єёЄрэютшЄ Єхьэ√щ Їюэ
0457+  FBE8             
0458+  FBE8             printFileHeaderName2:
0459+  FBE8 CD 79 FD    		call	pushCursorLine2
0460+  FBEB CD 1E C8    		call	j_getCursorPos
0461+  FBEE EB          		xchg
0462+  FBEF             
0463+  FBEF             printFileHeaderName:
0464+  FBEF 0E 0C       		mvi	c, 12
0465+  FBF1 21 55 D2    		lxi	h, v_header_name
0466+  FBF4             printFileHeaderName_0:
0467+  FBF4 7E          		 mov	a, m
0468+  FBF5 23          		 inx	h
0469+  FBF6 CD 0F C8    		 call	j_printCharA
0470+  FBF9 0D          		 dcr	c
0471+  FBFA C2 F4 FB    		jnz	printFileHeaderName_0
0472+  FBFD             
0473+  FBFD             		; ╙ёЄрэютър Єхьэюую Їюэр
0474+  FBFD 3E 8C       		mvi	a, C_NORMAL
0475+  FBFF C3 0F C8    		jmp	j_printCharA
0476+  FC02             
0477+  FC02             ; ---------------------------------------------------------------------------
0478+  FC02             
0479+  FC02 F5          dlg_printFile:	push	psw
0480+  FC03 CD 1E C8    		 call	j_getCursorPos
0481+  FC06 7C          		 mov	a, h
0482+  FC07 D6 16       v_dlgOffset:	 sui	16h
0483+  FC09 E1          		pop	h
0484+  FC0A             
0485+  FC0A             		; if(a >= 0x16)	return;
0486+  FC0A D0          		rnc			
0487+  FC0B             		
0488+  FC0B             		; D272 = v_curFile
0489+  FC0B E5          		push	h
0490+  FC0C             #if DLG_CURSOR_AT_TOP==0
0491+  FC0C 2A 70 D2    		 lhld	v_curFile
0492+  FC0F 22 72 D2    		 shld	v_printedFile
0493+  FC12             #endif		
0494+  FC12 F1          		pop	psw
0495+  FC13             
0496+  FC13             		; ┼ёыш эр тїюфх т ЇєэъЎш■ с√ы NZ
0497+  FC13 C2 8D FC    		jnz	loc_FC7A
0498+  FC16             
0499+  FC16             		; ┬√тхёЄш шь  Їрщыр
0500+  FC16 CD E8 FB    		call	printFileHeaderName2
0501+  FC19             
0502+  FC19             		; ╨рчфхышЄхы№
0503+  FC19 CD 7E FD    		call	dlg_printSep
0504+  FC1C             
0505+  FC1C             		; ┼ёыш Їрщы шчьхэхэ
0506+  FC1C 7E          		mov	a, m
0507+  FC1D CD 0F C8    		call	j_printCharA
0508+  FC20 23          		inx	h
0509+  FC21             
0510+  FC21             		; ─рЄр
0511+  FC21 0E 03       		mvi	c, 3
0512+  FC23 7E          loc_FC1E:        mov	a, m
0513+  FC24 23          		 inx	h
0514+  FC25 CD 15 C8    		 call	j_printHex
0515+  FC28 0D          		 dcr	c
0516+  FC29             #if NICE
0517+  FC29 CA 34 FC    		 jz	loc_FC1E_
0518+  FC2C 3E 2D       		 mvi	a, '-'
0519+  FC2E CD 0F C8    		 call	j_printCharA
0520+  FC31 C3 23 FC    		jmp	loc_FC1E
0521+  FC34             loc_FC1E_:
0522+  FC34~            #else
0523+  FC34~            		jnz	loc_FC1E
0524+  FC34             #endif
0525+  FC34             		
0526+  FC34             		; ╨рчфхышЄхы№
0527+  FC34 CD 7E FD    		call	dlg_printSep
0528+  FC37             
0529+  FC37             		; ╚эЇюЁьрЎш  ю Їрщых
0530+  FC37 CD 6A FC    		call	dlg_printFileInfo
0531+  FC3A             
0532+  FC3A             		; ┬√тюфшь фышэє
0533+  FC3A 2A 76 D2    		lhld	f_fileBodySize
0534+  FC3D 23          		inx	h
0535+  FC3E             
0536+  FC3E             printNumber:			
0537+  FC3E             		; ╨рчфхышЄхы№
0538+  FC3E CD 7E FD    		call	dlg_printSep
0539+  FC41             
0540+  FC41             		; ┬√тюф	HL эр ¤ъЁрэ т 10ўэюь тшфх
0541+  FC41 11 10 27    		lxi	d, 10000	
0542+  FC44 CD A6 FC    		call	divAndPrint
0543+  FC47 11 E8 03    		lxi	d, 1000
0544+  FC4A CD A6 FC    		call	divAndPrint
0545+  FC4D 11 64 00    		lxi	d, 100
0546+  FC50 CD A6 FC    		call	divAndPrint
0547+  FC53 11 0A 00    		lxi	d, 10
0548+  FC56 CD A6 FC    		call	divAndPrint
0549+  FC59 7D          		mov	a, l
0550+  FC5A C6 30       		adi	'0'
0551+  FC5C CD 0F C8    		call	j_printCharA
0552+  FC5F             		
0553+  FC5F             		; ╧Ёртр  уЁрэшЎр
0554+  FC5F             dlg_rightEdge:
0555+  FC5F             #if ALL_CHARS
0556+  FC5F 0E 0A       		mvi	c, BORDER_R1
0557+  FC61 CD 9C CB    		call	printCharAll
0558+  FC64~            #else
0559+  FC64~            		mvi	a, BORDER_R1
0560+  FC64~            		call	j_printCharA
0561+  FC64             #endif	
0562+  FC64             		; ╧Ёрт√щ ъЁрщ
0563+  FC64 21 72 FD    		lxi	h, a_rightEdge
0564+  FC67 C3 18 C8    		jmp	j_printString
0565+  FC6A             
0566+  FC6A             ; ---------------------------------------------------------------------------
0567+  FC6A             
0568+  FC6A             dlg_printFileInfo:		
0569+  FC6A CD 0B FB    		call	loadDStartDStop	; de=v_header_stop, hl=v_header_start
0570+  FC6D             #if NICE
0571+  FC6D 0E 2D       		mvi	c, '-'
0572+  FC6F~            #else
0573+  FC6F~            		mvi	c, ','
0574+  FC6F             #endif
0575+  FC6F CD 82 FC    		call	printHexWord	; printHexWord(v_header_start)
0576+  FC72 EB          		xchg
0577+  FC73             #if NICE
0578+  FC73 0E 20       		mvi	c, ' '
0579+  FC75~            #else
0580+  FC75~            		inr	c		; c = '-'
0581+  FC75             #endif
0582+  FC75 CD 82 FC    		call	printHexWord	; printHexWord(v_header_stop)
0583+  FC78             #if NICE
0584+  FC78 0E 19       		mvi	c, BORDER_H1
0585+  FC7A CD 9C CB    		call	printCharAll
0586+  FC7D             #endif
0587+  FC7D 2A 6E D2    		lhld	v_header_crc	; c = ?
0588+  FC80 0E 8C       		mvi	c, C_NORMAL
0589+  FC82             		; ╧Ёюфюыцхэшх эр printHexWord
0590+  FC82             
0591+  FC82             ; ---------------------------------------------------------------------------
0592+  FC82             
0593+  FC82             .include "printHexWord.inc"
0001++ FC82             ;+---------------------------------------------------------------------------
0002++ FC82             ; RAMFOS
0003++ FC82             ; ┬√тхёЄш HL т 16-Ёшўэюь тшфх эр ¤ъЁрэ ш ёшьтюы шч C
0004++ FC82             ;
0005++ FC82             ; ═р тїюфх
0006++ FC82             ;  hl - ўшёыю
0007++ FC82             ;  ё  - ёшьтюы
0008++ FC82             ;
0009++ FC82             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0010++ FC82             ;----------------------------------------------------------------------------
0011++ FC82             
0012++ FC82 7C          printHexWord:	mov	a, h
0013++ FC83 CD 15 C8    		call	j_printHex
0014++ FC86 7D          		mov	a, l
0015++ FC87 CD 15 C8    		call	j_printHex
0016++ FC8A C3 09 C8    		jmp	j_printChar0594+  FC8D             
0595+  FC8D             ; ---------------------------------------------------------------------------
0596+  FC8D             
0597+  FC8D             loc_FC7A:	; ╘єэъЎш  ёюїЁрэшЄ яюыюцхэшх ъєЁёюЁр ёЄЁюъш, эю эх тюёёЄрэютшЄ хую
0598+  FC8D             		; ┬√тхфхЄ эр ¤ъЁрэ шь  Їрщыр
0599+  FC8D             		; ╧юёых т√тюфр шьхэш ЇєэъЎш  єёЄрэютшЄ Єхьэ√щ Їюэ
0600+  FC8D CD E8 FB    		call	printFileHeaderName2
0601+  FC90             
0602+  FC90             #if NICE
0603+  FC90             		; 27 яЁюсхыют
0604+  FC90 01 20 1B    		lxi	b, 1B20h	; b-ъюытю, ё-ёшьтюы
0605+  FC93~            #else
0606+  FC93~            		; 26 яЁюсхыют
0607+  FC93~            		lxi	b, 1A20h	; b-ъюытю, ё-ёшьтюы
0608+  FC93             #endif
0609+  FC93 CD 9C FC    		call	printChars	
0610+  FC96             		
0611+  FC96             		; ╤тюсюфэюх ьхёЄю
0612+  FC96 2A 7A D2    		lhld	v_pageFreeTotal
0613+  FC99 C3 3E FC    		jmp	printNumber
0614+  FC9C             
0615+  FC9C             ; ---------------------------------------------------------------------------
0616+  FC9C             
0617+  FC9C             .include "printChars.inc"
0001++ FC9C             ;+---------------------------------------------------------------------------
0002++ FC9C             ; RAMFOS
0003++ FC9C             ; ┬√тюф эр ¤ъЁрэ эхёъюы№ъшї ёшьтюыют
0004++ FC9C             ;
0005++ FC9C             ; ═р тїюфх:
0006++ FC9C             ;  b - ъюы-тю
0007++ FC9C             ;  ё - ёшьтюы
0008++ FC9C             ;
0009++ FC9C             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0010++ FC9C             ;----------------------------------------------------------------------------
0011++ FC9C             
0012++ FC9C             #if ALL_CHARS
0013++ FC9C                              
0014++ FC9C C5          printChars:	 push	b
0015++ FC9D CD 9C CB    		  call	printCharAll
0016++ FCA0 C1          		 pop	b
0017++ FCA1 05          		 dcr	b
0018++ FCA2 C2 9C FC    		jnz	printChars
0019++ FCA5 C9          		ret
0020++ FCA6             
0021++ FCA6~            #else
0022++ FCA6~            
0023++ FCA6~            printChars:	 call	j_printChar
0024++ FCA6~            		 dcr	b
0025++ FCA6~            		 rz
0026++ FCA6~            		jmp	printChars
0027++ FCA6~            
0028++ FCA6             #endif
0618+  FCA6             
0619+  FCA6             ; ---------------------------------------------------------------------------
0620+  FCA6             
0621+  FCA6 0E 2F       divAndPrint:	mvi	c, '0'-1
0622+  FCA8 0C          loc_FC93:	 inr	c
0623+  FCA9 CD D3 FD    		 call	sub_hl_de
0624+  FCAC D2 A8 FC    		jnc	loc_FC93
0625+  FCAF 19          		dad	d
0626+  FCB0 C3 09 C8    		jmp	j_printChar
0627+  FCB3             		
0628+  FCB3             ; ---------------------------------------------------------------------------
0629+  FCB3             
0630+  FCB3             .include "filesetpage.inc"
0001++ FCB3             ;+---------------------------------------------------------------------------
0002++ FCB3             ; RAMFOS
0003++ FCB3             ; ╙ёЄрэютшЄ№ ръЄштэє■ ёЄЁрэшЎє
0004++ FCB3             ;
0005++ FCB3             ; ═р тїюфх
0006++ FCB3             ;  b - фшёъ
0007++ FCB3             ;
0008++ FCB3             ; ═р т√їюфх
0009++ FCB3             ;  v_pageStart = v_curFile = f_nextFile = эрўрыю ёЄЁрэшЎ√, чруюыютюъ яхЁтюую Їрщыр
0010++ FCB3             ;  hl - эрўрыю ёЄЁрэшЎ√
0011++ FCB3             ;
0012++ FCB3             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0013++ FCB3             ;----------------------------------------------------------------------------
0014++ FCB3             
0015++ FCB3             fileSetPage:	; ═рўрыю RAM-фшёър
0016++ FCB3 2A 1E C6    		lhld	v_aramPageStart
0017++ FCB6             
0018++ FCB6             		; ─шёъ
0019++ FCB6 78          		mov	a, b
0020++ FCB7 32 45 D2    		sta	v_page
0021++ FCBA             
0022++ FCBA             		; ╙ ROM-фшёър фЁєуюх эрўрыю
0023++ FCBA             		; ╬сэюты хь эрфяшё№ RAM/ROM т чруюыютъх Їрщыютющ ярэхыш
0024++ FCBA B7          		ora	a
0025++ FCBB 3E 41       		mvi	a, 'A'
0026++ FCBD F2 C5 FC    		jp	fileSetPage_1
0027++ FCC0 3E 4F       		 mvi	a, 'O'
0028++ FCC2             		 ; ═рўрыю ROM-фшёър
0029++ FCC2 21 80 18    		 lxi	h, ROM_PAGE_START
0030++ FCC5 32 42 FD    fileSetPage_1:	sta	a_panelOA
0031++ FCC8             
0032++ FCC8                             ; ╧рЁрьхЄЁ√ фшёър
0033++ FCC8 22 43 D2    		shld	v_pageStart
0034++ FCCB 22 70 D2    		shld	v_curFile
0035++ FCCE 22 74 D2    		shld	f_nextFile
0036++ FCD1 C9          		ret		0631+  FCD2             
0632+  FCD2             ; ---------------------------------------------------------------------------
0633+  FCD2             
0634+  FCD2             dlg_f6:		
0635+  FCD2~            #if NO_MXDOS==0
0636+  FCD2~            		; ┼ёыш т эюьхЁх фшёър 7, 6 сшЄ√ эх єёЄрэютыхэ√, чряєёърхь MXDOS
0637+  FCD2~            		mov	a, b
0638+  FCD2~            		ani	0C0h
0639+  FCD2~            		cz	loadMxDos
0640+  FCD2             #endif
0641+  FCD2             		; ╟ряєёЄшЄ№ эх єфрыюё№, ьхэ хь эр яЁюЄштюяюыюцэ√щ 7 сшЄ
0642+  FCD2 78          		mov	a, b
0643+  FCD3             #if NO_ROM_SWITCH_BUG
0644+  FCD3 E6 F0       		ani	0F0h
0645+  FCD5             #endif
0646+  FCD5 EE 80       		xri	80h
0647+  FCD7 47          		mov	b, a
0648+  FCD8             
0649+  FCD8             dlg_pageChanged:; ╙ёЄрэрыштрхь ръЄштэє■ ёЄЁрэшЎє
0650+  FCD8 CD B3 FC    		call	fileSetPage
0651+  FCDB             
0652+  FCDB             dlg_drawItems:				; CODE XREF: dlg_down+Bj
0653+  FCDB E5          		push	h
0654+  FCDC             		 ; ╩юяшЁєхь т чруюыютюъ єёЄрэютыхээ√щ Їшы№ЄЁ
0655+  FCDC 21 FE D1    		 lxi	h, v_header2_ext
0656+  FCDF 11 47 FD    		 lxi	d, a_panelFilter
0657+  FCE2 0E 02       		 mvi	c, 2
0658+  FCE4 CD AC FB    		 call	memcpy_de_hl_c	; memcpy(de, hl, c+1)
0659+  FCE7             
0660+  FCE7             		 ; ╩юяшЁєхь Єєфр цх ръЄштэє■ ёЄЁрэшЎє
0661+  FCE7 78          		 mov	a, b
0662+  FCE8~            #if ARAM_MAX_PAGE <= 7
0663+  FCE8~            		 ani	7
0664+  FCE8             #else
0665+  FCE8 E6 0F       		 ani	0Fh	; ╤ЄрЁ°шх сшЄ√ т√яюыэ ■Є ёяхЎ ЇєэъЎшш
0666+  FCEA FE 09       		 cpi	9
0667+  FCEC DA F1 FC    		 jc	correct
0668+  FCEF C6 07       		  adi	'A'-9-'1'
0669+  FCF1             correct:
0670+  FCF1             #endif
0671+  FCF1 C6 31       		 adi	'1'
0672+  FCF3             #if NICE
0673+  FCF3 32 45 FD    		 sta	p_pageNum
0674+  FCF6~            #else
0675+  FCF6~            		 inx	d
0676+  FCF6~            		 stax	d
0677+  FCF6             #endif
0678+  FCF6 E1          		pop	h
0679+  FCF7             
0680+  FCF7             dlg_redraw:
0681+  FCF7             	        ; ┬√тюфшь ярэхы№
0682+  FCF7 CD C2 FE    		call	printStringEx
0683+  FCFA             
0684+  FCFA 8B 90       		.db C_INVERSE, C_BOTTOMLINE
0685+  FCFC 20 46 31 2D 		.text " F1-COPY F2-DELETE F3-MLOAD F4-MSAVE F5-EDIT F6-DOS F7-DEBUG"
0685+  FD00 43 4F 50 59 
0685+  FD04 20 46 32 2D 
0685+  FD08 44 45 4C 45 
0685+  FD0C 54 45 20 46 
0685+  FD10 33 2D 4D 4C 
0685+  FD14 4F 41 44 20 
0685+  FD18 46 34 2D 4D 
0685+  FD1C 53 41 56 45 
0685+  FD20 20 46 35 2D 
0685+  FD24 45 44 49 54 
0685+  FD28 20 46 36 2D 
0685+  FD2C 44 4F 53 20 
0685+  FD30 46 37 2D 44 
0685+  FD34 45 42 55 47 
0686+  FD38 8C          		.db C_NORMAL
0687+  FD39             #if NICE
0688+  FD39 B0          		.db 0B0h				; ╩юэЄЁрёЄэю
0689+  FD3A~            #else
0690+  FD3A~            		.db C_CLEARSCREEN			; юўшёЄър ¤ъЁрэр
0691+  FD3A             #endif
0692+  FD3A             #if NICE
0693+  FD3A 1B 59 22 28 		.db 1Bh, 'Y', 20h+2, 20h+8		; яюыюцхэшх ярэхыш
0694+  FD3E~            #else
0695+  FD3E~            		.db 1Bh, 'Y', 20h+2, 20h+7		; яюыюцхэшх ярэхыш
0696+  FD3E             #endif
0697+  FD3E 17 93 8B    		.db 17h, 93h, 8Bh
0698+  FD41 52          		.db 'R'
0699+  FD42 41 4D       a_panelOA:	.db "AM"
0700+  FD44             #if NICE
0701+  FD44 5C          		.db '\'
0702+  FD45 30 20       p_pageNum	.text "0 "
0703+  FD47 20 20 20 20 a_panelFilter:	.text "          "
0703+  FD4B 20 20 20 20 
0703+  FD4F 20 20 
0704+  FD51~            #else
0705+  FD51~            		.text "_V6.0"
0706+  FD51~            		.db 92
0707+  FD51~            a_panelFilter:	.db 92,92,92
0708+  FD51~            		.db '\'
0709+  FD51~            p_pageNum	.db "0  "
0710+  FD51             #endif
0711+  FD51 C4 C1 D4 C1 		.db 0C4h, 0C1h,	0D4h, 0C1h ; фрЄр
0712+  FD55 20 20 20 20 		.db  ' ', ' ', ' ', ' '
0713+  FD59 C1 C4 CE    		.db 0C1h, 0C4h, 0CEh ; "рфэ"
0714+  FD5C 20          		.db ' '
0715+  FD5D             #if NICE
0716+  FD5D 20          		.db ' '
0717+  FD5E C1 C4 CB    		.db 0C1h, 0C4h, 0CBh ; "рфъ"
0718+  FD61 20 20 20    		.db ' ', ' ', ' '
0719+  FD64 D3 D5 CD CD 		.db 0D3h, 0D5h, 0CDh, 0CDh, 0C1h ; "ёєььр"
0719+  FD68 C1 
0720+  FD69 20          		.db ' '
0721+  FD6A~            #else
0722+  FD6A~            		.db 2Ch
0723+  FD6A~            		.db 0C1h, 0C4h, 0CBh ; "рфъ"
0724+  FD6A~            		.db ' '
0725+  FD6A~            		.db 2Dh
0726+  FD6A~            		.db 0D3h, 0D5h, 0CDh, 0CDh, 0C1h ; "ёєььр"
0727+  FD6A~            		.db ' '
0728+  FD6A~            		.db ' '
0729+  FD6A             #endif
0730+  FD6A C4 CC C9 CE 		.db 0C4h, 0CCh, 0C9h, 0CEh, 0C1h ; "фышэр"
0730+  FD6E C1 
0731+  FD6F 20          		.db ' '
0732+  FD70 8C          		.db 8Ch ; Єхьэ√щ Їюэ
0733+  FD71             #if NICE
0734+  FD71 B8          		.db 0B8h				; ╤хЁ√щ Їюэ
0735+  FD72             #endif
0736+  FD72 94 1A 08 1B a_rightEdge:	.db 94h, 1Ah, 8, BORDER_L, 93h, 0 ; тюёёЄрэютыхэшх ъєЁёюЁр ¤ъЁрэр, тэшч, тыхтю, |, чряюьшэрэшх ъєЁёюЁр ¤ъЁрэр
0736+  FD76 08 93 00 
0737+  FD79~            #if NO_MXDOS==0
0738+  FD79~            		sta	IO_FLOPPY_HEAD
0739+  FD79             #endif	
0740+  FD79             pushCursorLine2:; ╤юїЁрэшЄ№ ъєЁёюЁ ёЄЁюъш
0741+  FD79 3E 8D       		mvi	a, 8Dh
0742+  FD7B C3 0F C8    		jmp	j_printCharA
0743+  FD7E             
0744+  FD7E             ; ---------------------------------------------------------------------------
0745+  FD7E             
0746+  FD7E CD C2 FE    dlg_printSep:	call	printStringEx
0747+  FD81 8C 20 1B 19 		.db C_NORMAL, ' ', BORDER_H, 
0748+  FD85~            #if NICE==0
0749+  FD85~            		.db ' '
0750+  FD85             #endif
0751+  FD85 00          		.db 0
0752+  FD86 C9          		ret
0753+  FD87             
0754+  FD87             ; ---------------------------------------------------------------------------
0755+  FD87             
0756+  FD87             .include "pageReadBlock.inc"
0001++ FD87             ;+---------------------------------------------------------------------------
0002++ FD87             ; RAMFOS
0003++ FD87             ; ╫Єхэшх сыюър фрээ√ї шч ─╬╟╙/╧╟╙
0004++ FD87             ;
0005++ FD87             ; ═р тїюфх:
0006++ FD87             ;  hl - юЄъєфр, рфЁхё т ─╬╟╙/╧╟╙
0007++ FD87             ;  de - ъєфр, рфЁхё т ярь Єш
0008++ FD87             ;  bc - фышэр-1
0009++ FD87             ;
0010++ FD87             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0011++ FD87             ;----------------------------------------------------------------------------
0012++ FD87             
0013++ FD87             pageReadBlock:  ; ╧ЁюўшЄрЄ№ срщЄ 
0014++ FD87 C5          		push	b		  
0015++ FD88 CD C2 FF    		 call	pageRead
0016++ FD8B 23          		 inx	h
0017++ FD8C 79          		 mov	a, c
0018++ FD8D C1          		pop	b
0019++ FD8E             		; ╤юїЁрэшЄ№ срщЄ
0020++ FD8E 12          		stax	d
0021++ FD8F 13          		inx	d
0022++ FD90             		; if(bc == 0) break;
0023++ FD90 79          		mov	a, c
0024++ FD91 B0          		ora	b
0025++ FD92             		; bc--
0026++ FD92 0B          		dcx	b
0027++ FD93 C2 87 FD    		jnz	pageReadBlock
0028++ FD96 C9          		ret
0757+  FD97             
0758+  FD97             ; ---------------------------------------------------------------------------
0759+  FD97             
0760+  FD97             dlg_checkMsg:	; ┬√щЄш ё Їыруюь Z, хёыш т√сЁрэр яюёыхфэ   ёЄЁюър
0761+  FD97 D5          		push	d                
0762+  FD98 CD C2 FD    		call	dlg_isLastLine
0763+  FD9B D1          		pop	d
0764+  FD9C C8          		rz
0765+  FD9D             
0766+  FD9D             dlg_msg:	; ┬√тюф ёююс∙хэш 
0767+  FD9D F5          		push	psw
0768+  FD9E CD C2 FE    		 call	printStringEx
0769+  FDA1 94 08 8B 20 		 .db C_POPCURSORS, C_LEFT, C_INVERSE, ' ', ' ', ' ', 0C6h, 0C1h, 0CAh, 0CCh ; Їрщы Єшя
0769+  FDA5 20 20 C6 C1 
0769+  FDA9 CA CC 
0770+  FDAB 20 20 2E D4 		 .db ' ', ' ', 2Eh, 0D4h, 0C9h, 0D0h, ' ', 0Eh, ' ', 0
0770+  FDAF C9 D0 20 0E 
0770+  FDB3 20 00 
0771+  FDB5             		 
0772+  FDB5 EB          		 xchg
0773+  FDB6 CD 18 C8    		 call	j_printString
0774+  FDB9             
0775+  FDB9 CD C2 FE    		 call	printStringEx
0776+  FDBC 3A 3F       aa:		 .text ":?"
0777+  FDBE 08 00       		 .db C_LEFT, 0
0778+  FDC0 F1          		pop	psw
0779+  FDC1 C9          		ret
0780+  FDC2             
0781+  FDC2             ; ---------------------------------------------------------------------------
0782+  FDC2             
0783+  FDC2 2A 7C D2    dlg_isLastLine:	lhld	v_pageFreePtr
0784+  FDC5 EB          		xchg
0785+  FDC6 2A 70 D2    		lhld	v_curFile
0786+  FDC9 C3 54 C8    		jmp	j_cmp_hl_de
0787+  FDCC             
0788+  FDCC             ; ---------------------------------------------------------------------------
0789+  FDCC             
0790+  FDCC             .include "fileGetStartAndSize2.inc"	; fileGetStartAndSize2 яЁюфюыцрхЄё  эр sub_hl_de
0001++ FDCC             ;+---------------------------------------------------------------------------
0002++ FDCC             ; RAMFOS
0003++ FDCC             ; ╧юыєўшЄ№ ёьх∙хэшх ш фышэє Їрщыр шч v_header2
0004++ FDCC             ;
0005++ FDCC             ; ═р т√їюфх
0006++ FDCC             ;   DE - ёьх∙хэшх  (v_header2_start)
0007++ FDCC             ;   HL - фышэр - 1 (v_header2_size-1)
0008++ FDCC             ;
0009++ FDCC             ; 2013-11-01 vinxru
0010++ FDCC             ;----------------------------------------------------------------------------                   
0011++ FDCC             
0012++ FDCC             fileGetStartAndSize2:
0013++ FDCC 2A 0A D2    		lhld	v_header2_start
0014++ FDCF EB          		xchg
0015++ FDD0 2A 0C D2    		lhld	v_header2_end
0016++ FDD3             
0017++ FDD3             		; ╧Ёюфюыцхэшх эр sub_hl_de
0791+  FDD3             .include "sub_hl_de.inc"
0001++ FDD3             ;+---------------------------------------------------------------------------
0002++ FDD3             ; RAMFOS
0003++ FDD3             ; ┬√ўшЄрэшх шч HL DE
0004++ FDD3             ;
0005++ FDD3             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006++ FDD3             ;----------------------------------------------------------------------------
0007++ FDD3             
0008++ FDD3 7D          sub_hl_de:	mov	a, l
0009++ FDD4 93          		sub	e
0010++ FDD5 6F          		mov	l, a
0011++ FDD6 7C          		mov	a, h
0012++ FDD7 9A          		sbb	d
0013++ FDD8 67          		mov	h, a
0014++ FDD9 C9          		ret
0792+  FDDA             
0793+  FDDA             ; ---------------------------------------------------------------------------
0794+  FDDA             
0795+  FDDA             dlg_f2:		; ┬√тюф ЄхъёЄр "єфрышЄ№"
0796+  FDDA 11 9D FF    		lxi	d, a_delete
0797+  FDDD CD 97 FD    		call	dlg_checkMsg
0798+  FDE0 CA 1B F9    		jz	dlg_f2_alt
0799+  FDE3             
0800+  FDE3             		; ╧юы№чютрЄхы№ фюыцхэ эрцрЄ№ Enter
0801+  FDE3 CD 80 F9    		call	dlg_yesNo
0802+  FDE6             
0803+  FDE6             		; ╙фрышЄ№ Їрщы
0804+  FDE6 CD FA FD    		call	fileDelete
0805+  FDE9             
0806+  FDE9             		; ╤фтшэєЄ№ ¤ъЁрэ ттхЁї
0807+  FDE9~            #if NICE==0
0808+  FDE9~            		call	printStringEx
0809+  FDE9~            		.db C_NORMAL, C_POPCURSORL, 19h, C_SCROLLUPEX, 0
0810+  FDE9             #endif
0811+  FDE9             		; ╧хЁхЁшёютрЄ№ ¤ъЁрэ
0812+  FDE9 C9          		ret
0813+  FDEA             
0814+  FDEA             ; ---------------------------------------------------------------------------
0815+  FDEA             
0816+  FDEA             .include "compareFileName.inc"
0001++ FDEA             ;+---------------------------------------------------------------------------
0002++ FDEA             ; RAMFOS
0003++ FDEA             ; ╤ЁртэшЄ№ шь  Єхъє∙хую Їрщыр ё шьхэхь чрфрээ√ь яюы№чютрЄхыхь. 
0004++ FDEA             ; ╚ юяЎшюэры№эю, хёыш ёютярыю, Єю єфрышЄ№ Їрщы.
0005++ FDEA             ;
0006++ FDEA             ; ═р тїюфх
0007++ FDEA             ;  v_header  - ╘рщы 1, ъюЄюЁ√щ сєфхЄ єфрыхэ, хёыш b & 20h
0008++ FDEA             ;  v_header2 - ╘рщы 2
0009++ FDEA             ;
0010++ FDEA             ; ═р т√їюфх
0011++ FDEA             ;  jz        - Їрщы эрщфхэ. ═ю хёыш b & 20h, Єю Їыруш эхюяЁхфхыхэ√.
0012++ FDEA             ;
0013++ FDEA             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0014++ FDEA             ;----------------------------------------------------------------------------
0015++ FDEA             
0016++ FDEA             compareFileName:; ╤ЁртэшЄ№ шфхэЄшЇшърЄюЁ√ ш шьхэр Їрщыют 
0017++ FDEA 21 F2 D1    		lxi	h, v_header2
0018++ FDED 11 52 D2    		lxi	d, v_header
0019++ FDF0 0E 0F       		mvi	c, 15
0020++ FDF2 CD 7A FA    		call	memcmp_hl_de_c
0021++ FDF5 C0          		rnz
0022++ FDF6             
0023++ FDF6             		; ┼ёыш (b & 20h)==0 т√їюфшь (эх єфры хь)
0024++ FDF6 78          		mov	a, b
0025++ FDF7 E6 20       		ani	20h
0026++ FDF9 C8          		rz
0027++ FDFA             
0028++ FDFA             		; ╧хЁхїюфшь ъ ЇєэъЎшш fileDelete0817+  FDFA             .include "fileDelete.inc"
0001++ FDFA             ;+---------------------------------------------------------------------------
0002++ FDFA             ; RAMFOS
0003++ FDFA             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F851
0004++ FDFA             ; ╙фрыхэшх Їрщыр эрщфхээюую яЁюуЁрььющ F84B
0005++ FDFA             ;
0006++ FDFA             ; ╘рщы фюыцхэ с√Є№ юс чрЄхы№эю эрщфхэ ЇєэъЎшхщ fileFind (F84B), шэрўх
0007++ FDFA             ; сєфхЄ яютЁхцфхэр ёЄЁєъЄєЁр Їрщыют.
0008++ FDFA             ;
0009++ FDFA             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0010++ FDFA             ;----------------------------------------------------------------------------
0011++ FDFA             
0012++ FDFA             fileDelete:	; ╨рёўхЄ фышэ√ яюыхчэ√ї фрээ√ї яюёых эр°хую Їрщыр, ъюЄюЁ√х
0013++ FDFA             		; эрфю ёфтшэєЄ№.
0014++ FDFA             		; de = v_pageFreePtr - f_nextFile - 1 
0015++ FDFA 2A 74 D2    		lhld	f_nextFile
0016++ FDFD EB          		xchg
0017++ FDFE 2A 7C D2    		lhld	v_pageFreePtr
0018++ FE01 2B          		dcx	h		
0019++ FE02 CD D3 FD    		call	sub_hl_de
0020++ FE05 EB          		xchg
0021++ FE06             
0022++ FE06             		; ╧юьх∙рхь т ёЄхъ рфЁхё ёыхфє■∙хую Їрщыр
0023++ FE06 E5          		push	h
0024++ FE07             
0025++ FE07             		; ╧юьх∙рхь т HL рфЁхё эр°хую Їрщыр
0026++ FE07 2A 70 D2    		lhld	v_curFile
0027++ FE0A             
0028++ FE0A             		; └фЁхё ёыхфє■∙хую Їрщыр шчьхэшЄё  яюёых ёфтшур,
0029++ FE0A             		; р юэ шёяюы№чєхЄё  т ЇєэъЎшш compareFileName
0030++ FE0A 22 74 D2    		shld	f_nextFile
0031++ FE0D             
0032++ FE0D             		; ┼ёыш эр° Їрщы с√ы яюёыхэшь, эшўхую эх яхЁхьх∙рхь
0033++ FE0D DA 20 FE    		jc	fileDelete_1
0034++ FE10             
0035++ FE10             fileDelete_0:	 ; ╫Єхэшх ё фшёър
0036++ FE10 E3          		 xthl
0037++ FE11 CD C2 FF    		 call	pageRead
0038++ FE14 23          		 inx	h
0039++ FE15 E3          		 xthl
0040++ FE16             		 ; ╟ряшё№ эр фшёъ
0041++ FE16 CD D1 FF    		 call	pageWrite
0042++ FE19 23          		 inx	h
0043++ FE1A             		 ; if(de==0) break;
0044++ FE1A 7B          		 mov	a, e
0045++ FE1B B2          		 ora	d
0046++ FE1C             		 ; de--
0047++ FE1C 1B          		 dcx	d
0048++ FE1D C2 10 FE    		jnz	fileDelete_0
0049++ FE20             
0050++ FE20             fileDelete_1:	; ╬сэюты хь ёўхЄўшъ ётюсюфэюую ьхёЄр
0051++ FE20 E3          		xthl
0052++ FE21 E1          		pop	h
0053++ FE22 C3 DF F8    		jmp	fileChanged0818+  FE25             .include "fileFromTapeCom.inc"
0001++ FE25             ;+---------------------------------------------------------------------------
0002++ FE25             ; RAMFOS
0003++ FE25             ; ╫Єхэшх яхЁт√ї 15 срщЄ чруюыютър Їрщыр т v_header ш т√тюф хую эр ¤ъЁрэ
0004++ FE25             ; ╧юЄюь ўЄхэшх фышэ√ Єхыр (яхЁт√х 2 срщЄр) т DE
0005++ FE25             ;
0006++ FE25             ; ▌Єю юс∙хх эрўрыю ЇєэъЎшщ fileFromTape, fileVerify
0007++ FE25             ;
0008++ FE25             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0009++ FE25             ;----------------------------------------------------------------------------
0010++ FE25             
0011++ FE25             fileFromTapeCom:; ╞фхь яшыюЄ Єюэ
0012++ FE25             		; ╫шЄрхь фышэє т DE, эю шуэюЁшЁєхь х╕.
0013++ FE25 21 52 D2    		lxi	h, v_header
0014++ FE28 CD 39 FE    		call	fileFromT_1
0015++ FE2B             
0016++ FE2B             		; ╫шЄрхь 15 срщЄ ё ьруэшЄюЇюэр яю рфЁхёє hl
0017++ FE2B 1E 0F       		mvi	e, 15
0018++ FE2D CD 06 C8    fileFromT_0:	 call	j_tapeRead
0019++ FE30 77          		 mov	m, a
0020++ FE31 23          		 inx	h
0021++ FE32 1D          		 dcr	e
0022++ FE33 C2 2D FE    		jnz	fileFromT_0
0023++ FE36             
0024++ FE36             		; ╚уэюЁшЁєхь D3,D3,D3
0025++ FE36             
0026++ FE36             		; ┬√тюфшь шь  эр ¤ъЁрэ
0027++ FE36 CD EF FB    		call	printFileHeaderName
0028++ FE39             
0029++ FE39             fileFromT_1:	; ╞фхь яшыюЄ Єюэ
0030++ FE39 CD 24 C8    		call	j_tapeReadPilot
0031++ FE3C             
0032++ FE3C             		; ╫шЄрхь ёыютю т DE
0033++ FE3C D4 06 C8    		cnc	j_tapeRead
0034++ FE3F 5F          		mov	e, a
0035++ FE40 D4 06 C8    		cnc	j_tapeRead
0036++ FE43 57          		mov	d, a
0037++ FE44 C9          		ret0819+  FE45             
0820+  FE45             ; ---------------------------------------------------------------------------
0821+  FE45             
0822+  FE45             dlg_f3:		; ┬√тюфшь "ёЁртэшЄ№"
0823+  FE45 11 B3 FF    		lxi	d, a_verify
0824+  FE48 CD 97 FD    		call	dlg_checkMsg
0825+  FE4B             
0826+  FE4B             		; ┼ёыш Їрщы эх т√сЁрэ
0827+  FE4B CA 69 FE    		jz	dlg_f3_alt
0828+  FE4E             
0829+  FE4E             		; ?
0830+  FE4E CD 80 F9    		call	dlg_yesNo
0831+  FE51             
0832+  FE51             		; ╧Ёюфюыцхэшх т fileVerify
0833+  FE51             
0834+  FE51             ; ---------------------------------------------------------------------------
0835+  FE51             
0836+  FE51             .include "fileVerify.inc"
0001++ FE51             ;+---------------------------------------------------------------------------
0002++ FE51             ; RAMFOS
0003++ FE51             ; ╤ЁртэшЄ№ Єхъє∙шщ Їрщы ё ьруэшЄюЇюэюь
0004++ FE51             ;
0005++ FE51             ; ╘єэъЎш  т√ч√трхЄё  Єюы№ъю шч Їрщыютщ ярэхыш.
0006++ FE51             ;
0007++ FE51             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0008++ FE51             ;----------------------------------------------------------------------------
0009++ FE51             
0010++ FE51             		; ╫Єхэшх яхЁт√ї 15 срщЄ чруюыютър Їрщыр т v_header ш т√тюф хую эр ¤ъЁрэ
0011++ FE51             		; ╧юЄюь ўЄхэшх фышэ√ Єхыр (яхЁт√х 2 срщЄр) т DE
0012++ FE51 CD 25 FE    		call	fileFromTapeCom
0013++ FE54             
0014++ FE54             		; ▌Єю эх ъЁшЄшўэю, эю Їыру C эр т√їюфх ЇєэъЎшш эх яЁютхЁ хЄё .
0015++ FE54             
0016++ FE54             		; └фЁхё т√сЁрээюую Їрщыр эр фшёъх
0017++ FE54 2A 70 D2    		lhld	v_curFile		 
0018++ FE57             verifyLoop:	 ; ╫шЄрхь срщЄ ё фшёър
0019++ FE57 CD C2 FF    		 call	pageRead
0020++ FE5A             		 ; ╫шЄрхь срщЄ ё ьруэшЄюЇюэр
0021++ FE5A CD 06 C8    		 call	j_tapeRead
0022++ FE5D             		 ; ┼ёыш срщЄ√ эх Ёртэ√, т√тюфшь ю°шсъє
0023++ FE5D B9          		 cmp	c
0024++ FE5E C2 9E FE    		 jnz	dlg_error
0025++ FE61             		 ; ╙тхышўштрхь рфЁхё эр фшёъх
0026++ FE61 23          		 inx	h
0027++ FE62             		 ; ╓шъы (╥ръ ъръ яЁтюхЁър т ъюэЎх, Їрщы√ эєыхтющ фышэ√ эх ёьюуєЄ яЁютхЁшЄё )
0028++ FE62 1B          		 dcx	d
0029++ FE63 7B          		 mov	a, e
0030++ FE64 B2          		 ora	d
0031++ FE65 C2 57 FE    		jnz	verifyLoop
0032++ FE68 C9          		ret
0837+  FE69             
0838+  FE69             ; ---------------------------------------------------------------------------
0839+  FE69             
0840+  FE69             dlg_f3_alt:	; ┬√тюф эр ¤ъЁрэ ёЄЁюъш "╫Єхэшх"
0841+  FE69 11 A5 FF    		lxi	d, a_load
0842+  FE6C CD 7D F9    		call	dlg_msgYesNo
0843+  FE6F             
0844+  FE6F             .include "fileFromTape.inc"	; fileFromTape яЁюфюыцрхЄё 
0001++ FE6F             ;+---------------------------------------------------------------------------
0002++ FE6F             ; RAMFOS
0003++ FE6F             ; ╫Єхэшх Їрщыр ё ьруэшЄюЇюэр ш ёюїЁрэхэшх т т√сЁрээє■ ёЄЁрэшЎє
0004++ FE6F             ;
0005++ FE6F             ; ╘єэъЎш  т√ч√трхЄё  Єюы№ъю шч Їрщыютщ ярэхыш.
0006++ FE6F             ;
0007++ FE6F             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0008++ FE6F             ;----------------------------------------------------------------------------
0009++ FE6F             
0010++ FE6F             fileFromTape:	; ╫шЄрхь чруюыютюъ ё фшёър
0011++ FE6F CD 25 FE    		call	fileFromTapeCom
0012++ FE72             
0013++ FE72             		; ┬√тюфшь ЄхъёЄ "╬╪╚┴╩└" + чтєъютющ ёшуэры. 
0014++ FE72             		; ╞фхь эрцрЄш  ESC ш т√їюфшь ё єёЄрэютыхээ√ь Їыруюь C
0015++ FE72 DA 9E FE    		jc	fileFromTapeErr2
0016++ FE75             
0017++ FE75             		; ╒трЄшЄ ыш ьхёЄр эр фшёъх фы  ёюїЁрэхэш  Їрщыр?
0018++ FE75 2A 7A D2    		lhld	v_pageFreeTotal
0019++ FE78 2B          		dcx	h
0020++ FE79 2B          		dcx	h
0021++ FE7A 2B          		dcx	h
0022++ FE7B CD 54 C8    		call	j_cmp_hl_de
0023++ FE7E             
0024++ FE7E             		; ┬√тюфшь ЄхъёЄ "╠└╦ ─╚╤╩" + чтєъютющ ёшуэры. 
0025++ FE7E             		; ╞фхь эрцрЄш  ESC ш т√їюфшь ё єёЄрэютыхээ√ь Їыруюь C
0026++ FE7E DA B3 FE    		jc	outOfSpace
0027++ FE81             
0028++ FE81             		; ╙ърчрЄхы№ чряшёш эр фшёъ
0029++ FE81 2A 7C D2    		lhld	v_pageFreePtr
0030++ FE84             readLoop:	 ; ╫шЄрхь срщЄ ё ьруэшЄюЇюэр
0031++ FE84 CD 06 C8    		 call	j_tapeRead		
0032++ FE87 DA 98 FE    		 jc	fileFromTapeErr
0033++ FE8A             		 ; ╟ряшё√трхь срщЄ A эр фшёъ яю рфЁхёє HL
0034++ FE8A 4F          		 mov	c, a
0035++ FE8B CD D1 FF    		 call	pageWrite
0036++ FE8E 23          		 inx	h
0037++ FE8F             		 ; ╓шъы DE (╥ръ ъръ яЁтюхЁър т ъюэЎх, Їрщы√ эєыхтющ фышэ√ эх ёьюуєЄ чруЁєчшЄё )
0038++ FE8F 1B          		 dcx	d
0039++ FE90 7B          		 mov	a, e
0040++ FE91 B2          		 ora	d
0041++ FE92 C2 84 FE    		jnz	readLoop
0042++ FE95             
0043++ FE95             		; ╘рщы яЁюўшЄрэ
0044++ FE95 C3 DD F8    		jmp	fileChanged2
0045++ FE98             
0046++ FE98             ; ---------------------------------------------------------------------------
0047++ FE98             
0048++ FE98             fileFromTapeErr:
0049++ FE98             		; ╙ёЄрэрытшрхь ъюэхЎ фшёър т v_curFile
0050++ FE98 2A 70 D2    		lhld	v_curFile
0051++ FE9B CD DF F8    		call	fileChanged
0052++ FE9E             
0053++ FE9E             fileFromTapeErr2:
0054++ FE9E             		; ─рыхх dlg_error
0845+  FE9E             
0846+  FE9E             dlg_error:	; ┬√тюфшь ёююс∙хэшх "╬╪╚┴╩└" + чтєъютющ ёшуэры
0847+  FE9E CD C2 FE    		call	printStringEx
0848+  FEA1 CF DB C9 C2 		.db 0CFh, 0DBh,	0C9h, 0C2h, 0CBh, 0C1h,	C_BEEP, 0 ; ю°шсър
0848+  FEA5 CB C1 07 00 
0849+  FEA9             
0850+  FEA9             waitEsc:	; ╞фхь, яюър яюы№чютрЄхы№ эх эрцьхЄ ESC
0851+  FEA9 CD 6C FA    		 call	keyWaitNoCursor
0852+  FEAC             #if NICE
0853+  FEAC FE 20       		 cpi	' '
0854+  FEAE~            #else
0855+  FEAE~            		 cpi	1Fh
0856+  FEAE             #endif
0857+  FEAE C2 A9 FE    		jnz	waitEsc
0858+  FEB1             		; ┬√їюфшь ё єёЄрэютыхээ√ь Їыруюь C
0859+  FEB1 37          		stc
0860+  FEB2 C9          		ret
0861+  FEB3             
0862+  FEB3             ; ---------------------------------------------------------------------------
0863+  FEB3             ; ┬√тюф ёююс∙хэш  ╠└╦ ─╚╤╩
0864+  FEB3             
0865+  FEB3 CD C2 FE    outOfSpace:	call	printStringEx
0866+  FEB6 CD C1 CC 20 		.db 0CDh, 0C1h,	0CCh, 20h, 0C4h, 0C9h, 0D3h, 0CBh, 0 ; ьры фшёъ
0866+  FEBA C4 C9 D3 CB 
0866+  FEBE 00 
0867+  FEBF C3 A9 FE    		jmp	waitEsc
0868+  FEC2             
0869+  FEC2             ; ---------------------------------------------------------------------------
0870+  FEC2             
0871+  FEC2             .include "printStringEx.inc"
0001++ FEC2             ;+---------------------------------------------------------------------------
0002++ FEC2             ; RAMFOS
0003++ FEC2             ; ┬√тюф ёЄЁюъш эр ¤ъЁрэ
0004++ FEC2             ;
0005++ FEC2             ; ╤ЄЁюър Ёрчьх∙рхЄё  ёЁрчє цх яюёых ъюьрфэ√ т√чютр
0006++ FEC2             ;
0007++ FEC2             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0008++ FEC2             ;----------------------------------------------------------------------------
0009++ FEC2             
0010++ FEC2 E3          printStringEx:	xthl
0011++ FEC3 CD 18 C8    		call	j_printString
0012++ FEC6 E3          		xthl
0013++ FEC7 C9          		ret
0872+  FEC8             
0873+  FEC8             ; ---------------------------------------------------------------------------
0874+  FEC8             ; ╤юїрэшЄ№ Їрщы эр ьруэшЄюЇюэ
0875+  FEC8             
0876+  FEC8             dlg_f4:		; ┼ёыш Їрщы эх т√сЁрэ, т√їюфшь
0877+  FEC8 2A 74 D2    		lhld	f_nextFile
0878+  FECB CD 54 C8    		call	j_cmp_hl_de
0879+  FECE C8          		rz
0880+  FECF             
0881+  FECF             		; ┬√тюф "чряшё№"
0882+  FECF 11 AC FF    		lxi	d, a_save
0883+  FED2 CD 7D F9    		call	dlg_msgYesNo
0884+  FED5             
0885+  FED5 CD C2 FD    		call	dlg_isLastLine
0886+  FED8 2A 43 D2    		lhld	v_pageStart
0887+  FEDB CA F1 FE    		jz	fileToTape
0888+  FEDE             
0889+  FEDE 0E 8C       		mvi	c, C_NORMAL
0890+  FEE0             
0891+  FEE0 2A 70 D2    		lhld	v_curFile
0892+  FEE3 11 0F 00    		lxi	d, 0Fh
0893+  FEE6 19          		dad	d
0894+  FEE7 CD D1 FF    		call	pageWrite
0895+  FEEA             		
0896+  FEEA 2A 78 D2    		lhld	f_fileSize
0897+  FEED EB          		xchg
0898+  FEEE 2A 70 D2    		lhld	v_curFile
0899+  FEF1             
0900+  FEF1             .include "fileToTape.inc"
0001++ FEF1             ;+---------------------------------------------------------------------------
0002++ FEF1             ; RAMFOS
0003++ FEF1             ; ╤юїЁрэшЄ№ Їрщы эр ьруэшЄюЇюэ
0004++ FEF1             ;
0005++ FEF1             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0006++ FEF1             ;----------------------------------------------------------------------------
0007++ FEF1             
0008++ FEF1             fileToTape:	; ╤эрўрыр чряшё√трхь Єюы№ъю 15 срщЄ.
0009++ FEF1 E5          		push	h
0010++ FEF2 D5          		 push	d
0011++ FEF3 11 0F 00    		  lxi	d, 15
0012++ FEF6 CD FB FE    		  call	fileToTape_0
0013++ FEF9 D1          		 pop	d
0014++ FEFA E1          		pop	h
0015++ FEFB             
0016++ FEFB             		; ╧юЄюь ЄюЄ цх сыюъ фрээ√ї, эю Ўхышъюь
0017++ FEFB             
0018++ FEFB             fileToTape_0:	; ╧шыюЄ Єюэ
0019++ FEFB CD 27 C8    		call	j_tapeWritePilot
0020++ FEFE             
0021++ FEFE             		; ╟ряшё№ фышэ√
0022++ FEFE 4B          		mov	c, e
0023++ FEFF AF          		xra	a
0024++ FF00 CD 0C C8    		call	j_tapeWrite
0025++ FF03 4A          		mov	c, d
0026++ FF04 AF          		xra	a
0027++ FF05 CD 0C C8    		call	j_tapeWrite
0028++ FF08             
0029++ FF08             		; ╙ъюЁюўхэшх яхЁтюую шьяєы№ёр ьруэшюЇюэр *15 ЄръЄют
0030++ FF08 06 08       		mvi	b, 8		
0031++ FF0A             fileToTape_1:	 ; ┼ёыш чряшё√трЄ№ эхўхую, т√їюфшь
0032++ FF0A 7B          		 mov	a, e
0033++ FF0B B2          		 ora	d
0034++ FF0C C8          		 rz
0035++ FF0D             		 ; ╫шЄрхь срщЄ ё фшёър
0036++ FF0D CD C2 FF    		 call	pageRead
0037++ FF10 23          		 inx	h
0038++ FF11             		 ; ╙ьхэ№°рхь ёўхЄўшъ
0039++ FF11 1B          		 dcx	d
0040++ FF12             		 ; ╟ряшё√трхь эр ьруэшЄюЇюэ
0041++ FF12 78          		 mov	a, b
0042++ FF13 CD 0C C8    		 call	j_tapeWrite
0043++ FF16 C3 0A FF    		jmp	fileToTape_10901+  FF19             
0902+  FF19             ; ---------------------------------------------------------------------------
0903+  FF19             ; ╧хЁхшьхэютрЄ№ Їрщы
0904+  FF19             
0905+  FF19             dlg_f5:		; ┬√тхёЄш "шь :"
0906+  FF19 11 BC FF    		lxi	d, a_name
0907+  FF1C CD 97 FD    		call	dlg_checkMsg
0908+  FF1F             
0909+  FF1F             		; ┼ёыш Їрщы эх т√сЁрэ
0910+  FF1F CA 66 FA    		jz	startEditor
0911+  FF22             
0912+  FF22             dlg_f5_retry:	; ╙ёЄрэртыштрхь ъєЁёюЁ эр шь  Їрщыр
0913+  FF22 CD E3 FB    		call	popCursorLine2
0914+  FF25             
0915+  FF25             		; ╨хфръЄшЁютрэшх шьхэш Їрщыр
0916+  FF25 21 55 D2    		lxi	h, v_header_name
0917+  FF28 11 FF 0C    		lxi	d, 0CFFh
0918+  FF2B CD 36 C8    		call	j_input
0919+  FF2E             	
0920+  FF2E             		; ┴√ы эрцрЄ ESC	
0921+  FF2E CA 93 F9    		jz	loc_F9D0
0922+  FF31             
0923+  FF31             		; ┴√ыр эрцрЄр ёыєцхсэр  ъыртш°р
0924+  FF31 D2 22 FF    		jnc	dlg_f5_retry
0925+  FF34             
0926+  FF34             		; ╚ь  эх ттхфхэю, яхЁхЁшёютрЄ№
0927+  FF34 F0          		rp
0928+  FF35             
0929+  FF35             		; ╧Ёюфюыцхэшх т fileSaveHeader
0930+  FF35             
0931+  FF35             ; ---------------------------------------------------------------------------0362   FF35             #if RELOCATE_FILE_FUNCTIONS
0363   FF35 C3 46 D1    	jmp	fileSaveHeader
0364   FF38~            #else
0365   FF38~            .include "fileSaveHeader.inc"	; продолжение в pageWriteBlock
0366   FF38~            .include "pageWriteBlock.inc"
0367   FF38             #endif
0368   FF38             .include "fileSetGetName.inc"
0001+  FF38             ;+---------------------------------------------------------------------------
0002+  FF38             ; RAMFOS
0003+  FF38             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F845
0004+  FF38             ; ╧юыєўхэшх шьхэш яюёыхфэхую чруЁєцхээюую Їрщыр
0005+  FF38             ;
0006+  FF38             ; ═р тїюфх
0007+  FF38             ;  hl - шь  Їрщыр (12 срщЄ)
0008+  FF38             ;
0009+  FF38             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0010+  FF38             ;----------------------------------------------------------------------------
0011+  FF38             
0012+  FF38 E5          fileGetName:	push	h
0013+  FF39 D5          		push	d
0014+  FF3A C5          		push	b
0015+  FF3B 11 F5 D1    		lxi	d, v_header2_name
0016+  FF3E EB          		xchg
0017+  FF3F C3 48 FF    		jmp	fileSetName_0
0018+  FF42             
0019+  FF42             ;----------------------------------------------------------------------------
0020+  FF42             ; RAMFOS
0021+  FF42             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F848
0022+  FF42             ; ╙ёЄрэютър шь  фы  ЇєэъЎшщ ёюїрЁрэхэш /яюшёър
0023+  FF42             ;
0024+  FF42             ; ═р тїюфх
0025+  FF42             ;  hl - шь  Їрщыр (12 срщЄ)
0026+  FF42             ;
0027+  FF42             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0028+  FF42             ;----------------------------------------------------------------------------
0029+  FF42             
0030+  FF42 E5          fileSetName:	push	h
0031+  FF43 D5          		push	d
0032+  FF44 C5          		push	b
0033+  FF45 11 F5 D1    		lxi	d, v_header2_name
0034+  FF48 0E 0B       fileSetName_0:	mvi	c, 11
0035+  FF4A C3 55 FF    		jmp	memcpy_popa0369   FF4D             .include "fileSetType.inc"
0001+  FF4D             ;+---------------------------------------------------------------------------
0002+  FF4D             ; RAMFOS
0003+  FF4D             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F82D
0004+  FF4D             ; ╙ёЄрэютшЄ№ Ёрё°шЁхэшх ёюїЁрэ хьюую/чруЁєцрхьюую Їрщыр
0005+  FF4D             ;
0006+  FF4D             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0007+  FF4D             ;----------------------------------------------------------------------------
0008+  FF4D             
0009+  FF4D E5          fileSetType:	push	h
0010+  FF4E D5          		push	d
0011+  FF4F C5          		push	b
0012+  FF50 11 FE D1    		 lxi	d, v_header2_ext
0013+  FF53 0E 02       		 mvi	c, 2	; ╨рчьхЁ -1
0014+  FF55 F5          memcpy_popa:	 push	psw
0015+  FF56 CD AC FB    		  call	memcpy_de_hl_c
0016+  FF59 F1          		 pop	psw
0017+  FF5A C1          		pop	b
0018+  FF5B D1          		pop	d
0019+  FF5C E1          		pop	h
0020+  FF5D C9          		ret0370   FF5E             #if NO_ROM_ENTRY | RKS_LOADER
0371   FF5E             .include "exec.inc"
0001+  FF5E             ;+---------------------------------------------------------------------------
0002+  FF5E             ; RAMFOS
0003+  FF5E             ; ┬√яюыэшЄ№ яЁюуЁрььє
0004+  FF5E             ;
0005+  FF5E             ; ═р тїюфх
0006+  FF5E             ;  hl - шь  Їрщыр
0007+  FF5E             ;
0008+  FF5E             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0009+  FF5E             ;----------------------------------------------------------------------------
0010+  FF5E             
0011+  FF5E             exec:		; ═рщЄш Їрщы
0012+  FF5E CD 6C FF    		call	exec1
0013+  FF61             
0014+  FF61             		; ┼ёыш Їрщы эх эрщфхэ, яхЁхчряєёЄшЄ№ ╬╤
0015+  FF61 C2 E6 C8    		jnz	biosInit		
0016+  FF64             
0017+  FF64             exec2:		; ╧юьх∙рхь рфЁхё чруЁєчъш/чряєёър т de ш ёЄхъ.
0018+  FF64 2A 6A D2    		lhld	v_header_start
0019+  FF67 E5          		push	h
0020+  FF68 EB          		xchg
0021+  FF69             		; ╟руЁєцрхь Їрщы схч ъюэЄЁюы  CRC (яюЄюьє ўЄю т ёыєўрх чряєёър
0022+  FF69             		; RKS Їрщыр, яЁюуЁрьь√ ЁрёўхЄр CRC єцх эх сєфхЄ)
0023+  FF69 C3 25 FB                    jmp	fileLoadNoCheck
0024+  FF6C             
0025+  FF6C             ; ---------------------------------------------------------------------------
0026+  FF6C             
0027+  FF6C             exec1:		; ╙ёЄрэтюър шьхэш Їрщыр
0028+  FF6C CD 42 FF    		call	fileSetName
0029+  FF6F             		
0030+  FF6F             		; ╤эрўрыр шёърЄ№ Їрщы эр RAM-фшёъх
0031+  FF6F CD 5A F8    		call	fileFind
0032+  FF72             
0033+  FF72             		; ╧юЄюь эр ROM-фшёъх
0034+  FF72 06 80       		mvi	b, 80h
0035+  FF74 C4 5C F8    		cnz	fileFindEx
0036+  FF77 C9          		ret
0037+  FF78             
0372   FF78             #endif
0373   FF78             
0374   FF78             ; ===========================================================================
0375   FF78             ; ПЕРЕМЕННЫЕ
0376   FF78             
0377   FF78 D3 D3 D3    a_defHeader:	.db 0D3h, 0D3h,	0D3h	; маркер начала файла (за ним обязательно должено идти 12 пробелов)
0378   FF7B 20 20 20 20 a_12spaces:	.text "            "	; пустое имя
0378   FF7F 20 20 20 20 
0378   FF83 20 20 20 20 
0379   FF87 45 58 45    a_exe:		.text "EXE"
0380   FF8A 43 4F 4D    a_com:		.text "COM"
0381   FF8D CB CF D0 C9 a_copy:		.db 0CBh, 0CFh,	0D0h, 0C9h, 0D2h, 0CFh,	0D7h, 
0381   FF91 D2 CF D7 
0382   FF94 C1 D4 D8 00 		.db 0C1h, 0D4h, 0D8h, 0					; "копировать"
0383   FF98 C4 C1 D4 D5 a_deleteDate:	.db 0C4h, 0C1h,	0D4h, 0D5h, 20h				; "дату удалить"
0383   FF9C 20 
0384   FF9D D5 C4 C1 CC a_delete:	.db 0D5h, 0C4h,	0C1h, 0CCh, 0C9h, 0D4h,	0D8h, 0		; "удалить"
0384   FFA1 C9 D4 D8 00 
0385   FFA5 DE D4 C5 CE a_load:		.db 0DEh, 0D4h,	0C5h, 0CEh, 0C9h, 0C5h,	0		; "чтение"
0385   FFA9 C9 C5 00 
0386   FFAC DA C1 D0 C9 a_save:		.db 0DAh, 0C1h,	0D0h, 0C9h, 0D3h, 0D8h,	0		; "запись"
0386   FFB0 D3 D8 00 
0387   FFB3 D3 D2 C1 D7 a_verify:	.db 0D3h, 0D2h,	0C1h, 0D7h, 0CEh, 0C9h,	0D4h, 0D8h, 0	; "сравнить"
0387   FFB7 CE C9 D4 D8 
0387   FFBB 00 
0388   FFBC C9 CD D1 00 a_name:		.db 0C9h, 0CDh,	0D1h, 0					; имя
0389   FFC0             
0390   FFC0             ; ===========================================================================
0391   FFC0             ; ОКНО ПРОЦЕССОРА
0392   FFC0             
0393   FFC0             .include "window.inc"
0001+  FFC0             ;+---------------------------------------------------------------------------
0002+  FFC0             ; RAMFOS
0003+  FFC0             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0004+  FFC0             ;----------------------------------------------------------------------------
0005+  FFC0             
0006+  FFC0~            #if BIG_ROM != 1
0007+  FFC0~            		
0008+  FFC0~            #if $ > 0FFB6h
0009+  FFC0~            ╬°шсър_ўрёЄ№_F800_эх_тыхчыр
0010+  FFC0~            #endif
0011+  FFC0~            .org 0FFB6h
0012+  FFC0~            
0013+  FFC0~            pageWriteROM:	sta	IO_PAGE_ROM
0014+  FFC0~            		jmp	pageWriteCom
0015+  FFC0~            
0016+  FFC0~            pageReadROM:	sta	IO_PAGE_ROM
0017+  FFC0~            		jmp	pageReadCom
0018+  FFC0~            
0019+  FFC0             #endif
0020+  FFC0             
0021+  FFC0             ; ---------------------------------------------------------------------------
0022+  FFC0             
0023+  FFC0~            #if $ > 0FFC2h
0024+  FFC0~            ╬°шсър_ўрёЄ№_F800_эх_тыхчыр
0025+  FFC0             #endif
0026+  FFC2             .org 0FFC2h
0027+  FFC2             
0028+  FFC2 3A 45 D2    pageRead:	lda	v_page
0029+  FFC5             
0030+  FFC5             ;----------------------------------------------------------------------------
0031+  FFC5             ; RAMFOS
0032+  FFC5             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F836
0033+  FFC5             ; ╫Єхэшх срщЄр шч ─╬╟╙
0034+  FFC5             ;
0035+  FFC5             ; ═р тїюфх
0036+  FFC5             ;   a  - эюьхЁ ёЄЁрэшЎ√
0037+  FFC5             ;   hl - рфЁхё
0038+  FFC5             ;
0039+  FFC5             ; ═р т√їюфх
0040+  FFC5             ;   ё  - срщЄ
0041+  FFC5             ;
0042+  FFC5             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0043+  FFC5             ;----------------------------------------------------------------------------
0044+  FFC5             
0045+  FFC5 B7          pageReadAny:	ora	a
0046+  FFC6             #if BIG_ROM
0047+  FFC6 FA 1C D1    		jm	bigRom
0048+  FFC9~            #else
0049+  FFC9~            		jm	pageReadROM
0050+  FFC9             #endif
0051+  FFC9 32 FD FF    disableARAM1:	sta	IO_PAGE_ARAM		
0052+  FFCC 4E          pageReadCom:	mov	c, m
0053+  FFCD 32 FC FF    		sta	IO_PAGE_RAM
0054+  FFD0 C9          		ret
0055+  FFD1             
0056+  FFD1             ; ---------------------------------------------------------------------------
0057+  FFD1             
0058+  FFD1 3A 45 D2    pageWrite:	lda	v_page
0059+  FFD4             
0060+  FFD4             ;----------------------------------------------------------------------------
0061+  FFD4             ; RAMFOS
0062+  FFD4             ; ╤ЄрэфрЁЄэр  Єюўър тїюфр F839
0063+  FFD4             ; ╟ряшё№ срщЄр т ─╬╟╙
0064+  FFD4             ;
0065+  FFD4             ; ═р тїюфх
0066+  FFD4             ;   a  - эюьхЁ ёЄЁрэшЎ√
0067+  FFD4             ;   hl - рфЁхё
0068+  FFD4             ;   c  - срщЄ
0069+  FFD4             ;
0070+  FFD4             ; 2013-11-01 ─шчрёёхьсышЁютрэю vinxru
0071+  FFD4             ;----------------------------------------------------------------------------
0072+  FFD4             
0073+  FFD4 B7          pageWriteAny:	ora	a
0074+  FFD5             #if BIG_ROM
0075+  FFD5 FA DF FF    		jm	pageWriteRet
0076+  FFD8~            #else
0077+  FFD8~            		jm	pageWriteROM
0078+  FFD8             #endif
0079+  FFD8 32 FD FF    disableARAM2:	sta	IO_PAGE_ARAM
0080+  FFDB 71          pageWriteCom:	mov	m, c
0081+  FFDC 32 FC FF    		sta	IO_PAGE_RAM
0082+  FFDF C9          pageWriteRet:	ret0394   FFE0             
0395   FFE0             .end		tasm: Number of errors = 0
