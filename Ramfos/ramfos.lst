0001   0000             ; ===========================================================================
0002   0000             ; €‘’Ž‰Š€
0003   0000             
0004   0000             STD_RAMFOS = 0				; ‘ª®¬¯¨«¨à®¢ âì áâ ­¤ àâ­ë© RAMFOS
0005   0000             
0006   0000             #if STD_RAMFOS==0
0007   0000             
0008   0000             DATE_IN_RAM		= 1		; 0       §¬¥é âì ¤ âã ¢ ®á­®¢­®© ®¯¥à â¨¢­®© ¯ ¬ïâ¨ (¢®§¬®¦­  à ¡®â  ¡¥§ „Ž‡“)
0009   0000             NO_ROM_ENTRY		= 1		; 0      ‘â ­¤ àâ­ë¥ ¯à®£à ¬¬ë ¢ ¢¨¤¥ ä ©«®¢
0010   0000             NO_BACK_LINKS		= 0		; 0	 ¥ ¨á¯®«ì§®¢ âì ááë«ª¨ ­ § ¤ ¢ áâàãªâãà¥ ä ©«®¢
0011   0000             NO_PRINTER		= 1		; 0 	 Žâª«îç¨âì ¯à¨­â¥à
0012   0000             NO_MXDOS		= 1		; 0 	 Žâª«îç¨âì § £àã§ªã á ¤¨áª¥âë (¢ ç áâ­®câ¨ MXDOS)
0013   0000             SD_ENABLED		= 0		; 0      ‚ª«îç¥­  ¯®¤¤¥à¦ª  SD ª àâë
0014   0000             OPEN_ANY_FILE		= 1		; 0 	 Žâªàë¢ âì ä ©« á «î¡ë¬ à áè¨à¥­¨¥¬ (€ ­¥ â®«ìª® TXT ¢ à¥¤ ªâ®à¥)
0015   0000             ALL_CHARS		= 1		; 0	 ¥ç âì ¢á¥å á¨¬¢®«®¢ §­ ª®£¥­¥à â®à  ç¥à¥§ ESC
0016   0000             RKS_LOADER		= 1		; 0      ‡ ¯ãáª âì RKS ä ©«ë
0017   0000             BIG_ROM			= 1		; 0 	 ˆá¯®«ì§®¢ âì ¢á¥ 64 Š¡ ‡“ ‘¯¥æ¨ «¨áâ  Œ•2 ¯®¤ ROM-¤¨áª
0018   0000             WORK_WITHOUT_ARAM	= 1		; 0      …á«¨ „Ž‡“ ­¥ ­ ©¤¥­®, â® ¨á¯®«ì§®¢ âì ¡ãä¥à ¢ Ž‡“ à §¬¥à®¬ á í¬ã ¯¥à¥¬¥­­ãî
0019   0000             ROM_PAGE_START		= 01800h	; 04000h ¥à¢ë© ¡ ©â áâà ­¨æë ‡“
0020   0000             ROM_PAGE_END		= 0E7F5h	; 0C000h ®á«¥¤­¨© ¡ ©â áâà ­¨æë ‡“ + 1
0021   0000             CURSOR_BLINK_SPEED	= 767		; 767    ‡ ¤¥à¦ª  ¬¨£ ­¨ï ªãàá®à 
0022   0000             ARAM_MAX_PAGE           = 0Fh		; 6      Œ ªá¨¬ «ì­®¥ ª®«-¢® áâà ­¨æ à áè¨à¥­­®© ¯ ¬ïâ¨ (¬ ªá 0Fh)
0023   0000             ARAM_PAGE_END		= 0FFBBh        ; 0FFBBh Š®­¥æ áâà ­¨æë „Ž‡“ (36 ¡ ©â ­¥¨á¯®«ì§ã¥¬®£® Ž‡“ ¯®á«¥)
0024   0000             DLG_START_PAGE		= 80h		; 0      à¨ § ¯ãáª¥ ¯®ª § âì ¤¨áª
0025   0000             INIT_SCREEN_COLOR	= 0F1h		; 100h	 –¢¥â, ª®â®àë¬ § «¨¢ ¥âáï íªà ­ ¯à¨ ¨­¨æ¨ «¨§ æ¨¨. 100h - § «¨¢ ¥âáï â¥ªãé¨¬ æ¢¥â®¬, ª®â®àë© ¯à¨ â¥¯«®© ¯¥à¥§ £àã§ª¥ ¬®¦¥â ¡ëâì «î¡ë¬.
0026   0000             FAST_PRINT		= 1		;	 ëáâà ï äã­ªæ¨ï ¢ë¢®¤  â¥ªáâ . ’ ª ¦¥ ¢ë¢®¤¨â â¥ªáâ áâà®ª¨ ¡¥§ à §àë¢®¢. ˆ ­¥ ¯®àâ¨â æ¢¥â  á¨¬¢®«®¢ ¯à ¢¥¥.
0027   0000             TRUE_CHECK_ARAM		= 1		; 0      ˆá¯¯à ¢«¥­­ ï äã­ªæ¨ï ®¯à¥¤¥«¥­¨ï ®¡ì¥¬  „Ž‡“
0028   0000             NICE			= 1
0029   0000             COLOR_SUPPORT		= 1		; 0	“áâ ­®¢ª  æ¢¥â  ¯® ã¬®«ç ­¨î ¯à¨ ®ç¨áâª¥ á«ã¦¥¡­ëå áâà®ª ¨ íªà ­ 
0030   0000             NO_PRINT_STATUS_BUG	= 1
0031   0000             DLG_CURSOR_AT_TOP	= 0
0032   0000             NO_ROM_SWITCH_BUG	= 1		; 0	Œ®¦­® ¢ë¡à âì ­¥ ­ã«¥¢ãî áâà ­¨æã ‡“
0033   0000             RELOCATE_FILE_FUNCTIONS = 1		; 0     ¥à¥­¥áâ¨ ­¥ª®â®àë¥ äã­ªæ¨¨ ¨§ F800 ¢ C800
0034   0000             
0035   0000~            #else
0036   0000~            
0037   0000~            DATE_IN_RAM		= 0
0038   0000~            NO_ROM_ENTRY		= 0
0039   0000~            NO_BACK_LINKS		= 0
0040   0000~            NO_PRINTER		= 0
0041   0000~            NO_MXDOS		= 0
0042   0000~            OPEN_ANY_FILE		= 0
0043   0000~            ALL_CHARS		= 0
0044   0000~            RKS_LOADER		= 0
0045   0000~            BIG_ROM			= 0
0046   0000~            WORK_WITHOUT_ARAM	= 0
0047   0000~            ROM_PAGE_START		= 04000h
0048   0000~            ROM_PAGE_END		= 0C000h
0049   0000~            CURSOR_BLINK_SPEED	= 767
0050   0000~            ARAM_MAX_PAGE           = 6
0051   0000~            ARAM_PAGE_END		= 0FFBBh
0052   0000~            DLG_START_PAGE		= 0
0053   0000~            INIT_SCREEN_COLOR	= 100h
0054   0000~            FAST_PRINT		= 0
0055   0000~            TRUE_CHECK_ARAM		= 0
0056   0000~            NICE			= 0
0057   0000~            COLOR_SUPPORT		= 0
0058   0000~            NO_PRINT_STATUS_BUG	= 0
0059   0000~            DLG_CURSOR_AT_TOP	= 0
0060   0000~            RELOCATE_FILE_FUNCTIONS = 0
0061   0000~            NO_ROM_SWITCH_BUG	= 0
0062   0000~            
0063   0000             #endif
0064   0000             
0065   0000             ; ===========================================================================
0066   0000             ; Ž’› ‚‚Ž„€-‚›‚Ž„€
0067   0000             
0068   0000             IO_KEYB_A		= 0FFE0h
0069   0000             IO_KEYB_B		= 0FFE1h
0070   0000             IO_KEYB_C		= 0FFE2h
0071   0000             IO_KEYB_MODE		= 0FFE3h
0072   0000             IO_EXT_A		= 0FFE4h
0073   0000             IO_EXT_B		= 0FFE5h
0074   0000             IO_EXT_C		= 0FFE6h
0075   0000             IO_EXT_MODE		= 0FFE7h
0076   0000             IO_FLOPPY_CMD		= 0FFE8h
0077   0000             IO_FLOPPY_SECTOR	= 0FFEAh
0078   0000             IO_FLOPPY_DATA		= 0FFEBh
0079   0000             IO_TIMER		= 0FFECh
0080   0000             IO_FLOPPY_TRIG		= 0FFF0h
0081   0000             IO_FLOPPY_HEAD		= 0FFF2h
0082   0000             IO_COLOR		= 0FFF8h
0083   0000             IO_PAGE_RAM		= 0FFFCh
0084   0000             IO_PAGE_ARAM		= 0FFFDh
0085   0000             IO_PAGE_ROM		= 0FFFEh
0086   0000             IO_PAGE_STD		= 0FFFFh
0087   0000             
0088   0000             ; ===========================================================================
0089   0000             ; ‘…–ˆ€‹œ›… ŠŽ„› ‘ˆŒ‚Ž‹Ž‚
0090   0000             
0091   0000             C_BEEP		= 7
0092   0000             C_LEFT		= 8
0093   0000             C_CLEARSCREEN	= 1Fh
0094   0000             C_PUSHCOLOR	= 88h
0095   0000             C_POPCOLOR	= 89h
0096   0000             C_INVERSE	= 8Bh
0097   0000             C_NORMAL	= 8Ch
0098   0000             C_PUSHCURSORL	= 8Dh
0099   0000             C_TOPLINE	= 8Fh
0100   0000             C_POPCURSORL	= 8Eh
0101   0000             C_BOTTOMLINE	= 90h
0102   0000             C_PUSHCURSORS	= 93h
0103   0000             C_POPCURSORS	= 94h
0104   0000             C_SCROLLUPEX	= 9Ah
0105   0000             
0106   0000             ; ===========================================================================
0107   0000             ; ŠŽ‘’€’› …‹œ‡Ÿ Œ…Ÿ’œ
0108   0000             
0109   0000             CHAR_HEIGHT	  	= 8
0110   0000             LINE_HEIGHT	 	= 10
0111   0000             SCREEN_HEIGHT	 	= 250
0112   0000             FILE_HEADER_SIZE	= 30
0113   0000             STACK_TOP		= 0D2FFh
0114   0000             RAM_TOP			= 8FFFh
0115   0000             
0116   0000             ; ===========================================================================
0117   0000             ; ……Œ…›…
0118   0000             
0119   C000             .org 0C000h
0120   C000             
0121   C000             charGen:
0122   C000             
0123   C000             .include "chargen.inc"
0001+  C000             ; Íîâàÿ ôóíêöèÿ âûâîäà òåêñòà èñïîëüçóåò øðèôòû âûñîòîé â 10 ïèêñåëåé
0002+  C000             #if FAST_PRINT
0003+  C000             #define DY 80h
0004+  C000~            #else
0005+  C000~            #define DY 0
0006+  C000             #endif
0007+  C000             
0008+  C000 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 0
0008+  C004 00 00 00 00 
0009+  C008 B8 38 38 38 	.db DY|038h,038h,038h,038h,000h,000h,000h,DY|000h ; 1
0009+  C00C 00 00 00 80 
0010+  C010 87 07 07 07 	.db DY|007h,007h,007h,007h,000h,000h,000h,DY|000h ; 2
0010+  C014 00 00 00 80 
0011+  C018 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,000h,000h,000h,DY|000h ; 3
0011+  C01C 00 00 00 80 
0012+  C020 80 00 00 00 	.db DY|000h,000h,000h,000h,007h,007h,007h,DY|007h ; 4
0012+  C024 07 07 07 87 
0013+  C028 B8 38 38 38 	.db DY|038h,038h,038h,038h,007h,007h,007h,DY|007h ; 5
0013+  C02C 07 07 07 87 
0014+  C030 87 07 07 07 	.db DY|007h,007h,007h,007h,007h,007h,007h,DY|007h ; 6
0014+  C034 07 07 07 87 
0015+  C038 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,007h,007h,007h,DY|007h ; 7
0015+  C03C 07 07 07 87 
0016+  C040             #if ALL_CHARS
0017+  C040 B0 30 30 30 	.db DY|030h,030h,030h,030h,030h,030h,030h,DY|030h ; 8+
0017+  C044 30 30 30 B0 
0018+  C048~            #else
0019+  C048~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0020+  C048             #endif
0021+  C048 0C 0C 3F 2D 	.db 00Ch,00Ch,03Fh,02Dh,00Ch,00Ch,012h,021h ; 9
0021+  C04C 0C 0C 12 21 
0022+  C050             #if ALL_CHARS
0023+  C050 83 03 03 03 	.db DY|003h,003h,003h,003h,003h,003h,003h,DY|003h ; 10+
0023+  C054 03 03 03 83 
0024+  C058~            #else
0025+  C058~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0026+  C058             #endif
0027+  C058 0C 1E 3F 0C 	.db 00Ch,01Eh,03Fh,00Ch,00Ch,00Ch,00Ch,000h ; 11
0027+  C05C 0C 0C 0C 00 
0028+  C060             #if ALL_CHARS
0029+  C060 B0 30 30 30 	.db DY|030h,030h,030h,030h,030h,030h,030h,DY|03Fh ; 12+
0029+  C064 30 30 30 BF 
0030+  C068~            #else
0031+  C068~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0032+  C068             #endif
0033+  C068             #if ALL_CHARS
0034+  C068 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,DY|03Fh ; 13
0034+  C06C 00 00 00 BF 
0035+  C070~            #else
0036+  C070~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0037+  C070             #endif
0038+  C070 08 0C 3E 3F 	.db 008h,00Ch,03Eh,03Fh,03Eh,00Ch,008h,000h ; 14
0038+  C074 3E 0C 08 00 
0039+  C078 0C 0C 0C 0C 	.db 00Ch,00Ch,00Ch,00Ch,03Fh,01Eh,00Ch,000h ; 15
0039+  C07C 3F 1E 0C 00 
0040+  C080 80 00 00 00 	.db DY|000h,000h,000h,000h,038h,038h,038h,DY|038h ; 16
0040+  C084 38 38 38 B8 
0041+  C088 B8 38 38 38 	.db DY|038h,038h,038h,038h,038h,038h,038h,DY|038h ; 17
0041+  C08C 38 38 38 B8 
0042+  C090 87 07 07 07 	.db DY|007h,007h,007h,007h,038h,038h,038h,DY|038h ; 18
0042+  C094 38 38 38 B8 
0043+  C098 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,038h,038h,038h,DY|038h ; 19
0043+  C09C 38 38 38 B8 
0044+  C0A0 80 00 00 00 	.db DY|000h,000h,000h,000h,03Fh,03Fh,03Fh,DY|03Fh ; 20
0044+  C0A4 3F 3F 3F BF 
0045+  C0A8 B8 38 38 38 	.db DY|038h,038h,038h,038h,03Fh,03Fh,03Fh,DY|03Fh ; 21
0045+  C0AC 3F 3F 3F BF 
0046+  C0B0 87 07 07 07 	.db DY|007h,007h,007h,007h,03Fh,03Fh,03Fh,DY|03Fh ; 22
0046+  C0B4 3F 3F 3F BF 
0047+  C0B8 BF 3F 3F 3F 	.db DY|03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,DY|03Fh ; 23
0047+  C0BC 3F 3F 3F BF 
0048+  C0C0             #if ALL_CHARS
0049+  C0C0 83 03 03 03 	.db DY|003h,003h,003h,003h,003h,003h,003h,DY|03Fh ; 24+
0049+  C0C4 03 03 03 BF 
0050+  C0C8~            #else
0051+  C0C8~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0052+  C0C8             #endif
0053+  C0C8             #if ALL_CHARS
0054+  C0C8 A0 20 20 20 	.db DY|020h,020h,020h,020h,020h,020h,020h,DY|020h ; 25+
0054+  C0CC 20 20 20 A0 
0055+  C0D0~            #else
0056+  C0D0~            	.db 000h,000h,000h,000h,000h,000h,000h,000h
0057+  C0D0             #endif
0058+  C0D0 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 26
0058+  C0D4 00 00 00 00 
0059+  C0D8 0C 0C 0C 0C 	.db 00Ch,00Ch,00Ch,00Ch,00Ch,00Ch,00Ch,00Ch ; 27
0059+  C0DC 0C 0C 0C 0C 
0060+  C0E0 00 00 00 3F 	.db 000h,000h,000h,03Fh,03Fh,000h,000h,000h ; 28
0060+  C0E4 3F 00 00 00 
0061+  C0E8 04 0C 1F 3F 	.db 004h,00Ch,01Fh,03Fh,01Fh,00Ch,004h,000h ; 29
0061+  C0EC 1F 0C 04 00 
0062+  C0F0 00 3E 3C 3C 	.db 000h,03Eh,03Ch,03Ch,03Eh,027h,002h,000h ; 30
0062+  C0F4 3E 27 02 00 
0063+  C0F8 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 31
0063+  C0FC 00 00 00 00 
0064+  C100 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,000h,000h ; 32
0064+  C104 00 00 00 00 
0065+  C108 04 04 04 04 	.db 004h,004h,004h,004h,004h,000h,004h,000h ; 33
0065+  C10C 04 00 04 00 
0066+  C110 0A 0A 0A 00 	.db 00Ah,00Ah,00Ah,000h,000h,000h,000h,000h ; 34
0066+  C114 00 00 00 00 
0067+  C118 0A 0A 1F 0A 	.db 00Ah,00Ah,01Fh,00Ah,01Fh,00Ah,00Ah,000h ; 35
0067+  C11C 1F 0A 0A 00 
0068+  C120 00 11 0E 0A 	.db 000h,011h,00Eh,00Ah,00Eh,011h,000h,000h ; 36
0068+  C124 0E 11 00 00 
0069+  C128 18 19 02 04 	.db 018h,019h,002h,004h,008h,013h,003h,000h ; 37
0069+  C12C 08 13 03 00 
0070+  C130 04 0A 0A 0C 	.db 004h,00Ah,00Ah,00Ch,015h,012h,00Dh,000h ; 38
0070+  C134 15 12 0D 00 
0071+  C138 06 06 02 04 	.db 006h,006h,002h,004h,000h,000h,000h,000h ; 39
0071+  C13C 00 00 00 00 
0072+  C140 02 04 08 08 	.db 002h,004h,008h,008h,008h,004h,002h,000h ; 40
0072+  C144 08 04 02 00 
0073+  C148 08 04 02 02 	.db 008h,004h,002h,002h,002h,004h,008h,000h ; 41
0073+  C14C 02 04 08 00 
0074+  C150 00 04 15 0E 	.db 000h,004h,015h,00Eh,015h,004h,000h,000h ; 42
0074+  C154 15 04 00 00 
0075+  C158 00 04 04 1F 	.db 000h,004h,004h,01Fh,004h,004h,000h,000h ; 43
0075+  C15C 04 04 00 00 
0076+  C160 00 00 00 00 	.db 000h,000h,000h,000h,00Ch,00Ch,004h,008h ; 44
0076+  C164 0C 0C 04 08 
0077+  C168 00 00 00 1F 	.db 000h,000h,000h,01Fh,000h,000h,000h,000h ; 45
0077+  C16C 00 00 00 00 
0078+  C170 00 00 00 00 	.db 000h,000h,000h,000h,000h,00Ch,00Ch,000h ; 46
0078+  C174 00 0C 0C 00 
0079+  C178 00 01 02 04 	.db 000h,001h,002h,004h,008h,010h,000h,000h ; 47
0079+  C17C 08 10 00 00 
0080+  C180 0E 11 13 15 	.db 00Eh,011h,013h,015h,019h,011h,00Eh,000h ; 48
0080+  C184 19 11 0E 00 
0081+  C188 04 0C 04 04 	.db 004h,00Ch,004h,004h,004h,004h,00Eh,000h ; 49
0081+  C18C 04 04 0E 00 
0082+  C190 0E 11 01 06 	.db 00Eh,011h,001h,006h,008h,010h,01Fh,000h ; 50
0082+  C194 08 10 1F 00 
0083+  C198 1F 01 02 06 	.db 01Fh,001h,002h,006h,001h,011h,00Eh,000h ; 51
0083+  C19C 01 11 0E 00 
0084+  C1A0 02 06 0A 12 	.db 002h,006h,00Ah,012h,01Fh,002h,002h,000h ; 52
0084+  C1A4 1F 02 02 00 
0085+  C1A8 1F 10 1E 01 	.db 01Fh,010h,01Eh,001h,001h,011h,00Eh,000h ; 53
0085+  C1AC 01 11 0E 00 
0086+  C1B0 07 08 10 1E 	.db 007h,008h,010h,01Eh,011h,011h,00Eh,000h ; 54
0086+  C1B4 11 11 0E 00 
0087+  C1B8 1F 01 02 04 	.db 01Fh,001h,002h,004h,008h,008h,008h,000h ; 55
0087+  C1BC 08 08 08 00 
0088+  C1C0 0E 11 11 0E 	.db 00Eh,011h,011h,00Eh,011h,011h,00Eh,000h ; 56
0088+  C1C4 11 11 0E 00 
0089+  C1C8 0E 11 11 0F 	.db 00Eh,011h,011h,00Fh,001h,002h,01Ch,000h ; 57
0089+  C1CC 01 02 1C 00 
0090+  C1D0 00 0C 0C 00 	.db 000h,00Ch,00Ch,000h,000h,00Ch,00Ch,000h ; 58
0090+  C1D4 00 0C 0C 00 
0091+  C1D8 0C 0C 00 00 	.db 00Ch,00Ch,000h,000h,00Ch,00Ch,004h,008h ; 59
0091+  C1DC 0C 0C 04 08 
0092+  C1E0 02 04 08 10 	.db 002h,004h,008h,010h,008h,004h,002h,000h ; 60
0092+  C1E4 08 04 02 00 
0093+  C1E8 00 00 1F 00 	.db 000h,000h,01Fh,000h,01Fh,000h,000h,000h ; 61
0093+  C1EC 1F 00 00 00 
0094+  C1F0 08 04 02 01 	.db 008h,004h,002h,001h,002h,004h,008h,000h ; 62
0094+  C1F4 02 04 08 00 
0095+  C1F8 0E 11 01 02 	.db 00Eh,011h,001h,002h,004h,000h,004h,000h ; 63
0095+  C1FC 04 00 04 00 
0096+  C200 0E 11 13 15 	.db 00Eh,011h,013h,015h,017h,010h,00Eh,000h ; 64
0096+  C204 17 10 0E 00 
0097+  C208 04 0A 11 11 	.db 004h,00Ah,011h,011h,01Fh,011h,011h,000h ; 65
0097+  C20C 1F 11 11 00 
0098+  C210 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,011h,011h,01Eh,000h ; 66
0098+  C214 11 11 1E 00 
0099+  C218 0E 11 10 10 	.db 00Eh,011h,010h,010h,010h,011h,00Eh,000h ; 67
0099+  C21C 10 11 0E 00 
0100+  C220 1E 09 09 09 	.db 01Eh,009h,009h,009h,009h,009h,01Eh,000h ; 68
0100+  C224 09 09 1E 00 
0101+  C228 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,010h,010h,01Fh,000h ; 69
0101+  C22C 10 10 1F 00 
0102+  C230 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,010h,010h,010h,000h ; 70
0102+  C234 10 10 10 00 
0103+  C238 0E 11 10 10 	.db 00Eh,011h,010h,010h,013h,011h,00Fh,000h ; 71
0103+  C23C 13 11 0F 00 
0104+  C240 11 11 11 1F 	.db 011h,011h,011h,01Fh,011h,011h,011h,000h ; 72
0104+  C244 11 11 11 00 
0105+  C248 0E 04 04 04 	.db 00Eh,004h,004h,004h,004h,004h,00Eh,000h ; 73
0105+  C24C 04 04 0E 00 
0106+  C250 01 01 01 01 	.db 001h,001h,001h,001h,011h,011h,00Eh,000h ; 74
0106+  C254 11 11 0E 00 
0107+  C258 11 12 14 18 	.db 011h,012h,014h,018h,014h,012h,011h,000h ; 75
0107+  C25C 14 12 11 00 
0108+  C260 10 10 10 10 	.db 010h,010h,010h,010h,010h,011h,01Fh,000h ; 76
0108+  C264 10 11 1F 00 
0109+  C268 11 1B 15 15 	.db 011h,01Bh,015h,015h,011h,011h,011h,000h ; 77
0109+  C26C 11 11 11 00 
0110+  C270 11 11 19 15 	.db 011h,011h,019h,015h,013h,011h,011h,000h ; 78
0110+  C274 13 11 11 00 
0111+  C278 0E 11 11 11 	.db 00Eh,011h,011h,011h,011h,011h,00Eh,000h ; 79
0111+  C27C 11 11 0E 00 
0112+  C280 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,010h,010h,010h,000h ; 80
0112+  C284 10 10 10 00 
0113+  C288 0E 11 11 11 	.db 00Eh,011h,011h,011h,015h,012h,00Dh,000h ; 81
0113+  C28C 15 12 0D 00 
0114+  C290 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,014h,012h,011h,000h ; 82
0114+  C294 14 12 11 00 
0115+  C298 0E 11 10 0E 	.db 00Eh,011h,010h,00Eh,001h,011h,00Eh,000h ; 83
0115+  C29C 01 11 0E 00 
0116+  C2A0 1F 04 04 04 	.db 01Fh,004h,004h,004h,004h,004h,004h,000h ; 84
0116+  C2A4 04 04 04 00 
0117+  C2A8 11 11 11 11 	.db 011h,011h,011h,011h,011h,011h,00Eh,000h ; 85
0117+  C2AC 11 11 0E 00 
0118+  C2B0 11 11 11 0A 	.db 011h,011h,011h,00Ah,00Ah,004h,004h,000h ; 86
0118+  C2B4 0A 04 04 00 
0119+  C2B8 11 11 11 15 	.db 011h,011h,011h,015h,015h,015h,00Ah,000h ; 87
0119+  C2BC 15 15 0A 00 
0120+  C2C0 11 11 0A 04 	.db 011h,011h,00Ah,004h,00Ah,011h,011h,000h ; 88
0120+  C2C4 0A 11 11 00 
0121+  C2C8 11 11 0A 04 	.db 011h,011h,00Ah,004h,004h,004h,004h,000h ; 89
0121+  C2CC 04 04 04 00 
0122+  C2D0 1F 01 02 0E 	.db 01Fh,001h,002h,00Eh,008h,010h,01Fh,000h ; 90
0122+  C2D4 08 10 1F 00 
0123+  C2D8 0E 08 08 08 	.db 00Eh,008h,008h,008h,008h,008h,00Eh,000h ; 91
0123+  C2DC 08 08 0E 00 
0124+  C2E0 00 10 08 04 	.db 000h,010h,008h,004h,002h,001h,000h,000h ; 92
0124+  C2E4 02 01 00 00 
0125+  C2E8 0E 02 02 02 	.db 00Eh,002h,002h,002h,002h,002h,00Eh,000h ; 93
0125+  C2EC 02 02 0E 00 
0126+  C2F0 0E 11 00 00 	.db 00Eh,011h,000h,000h,000h,000h,000h,000h ; 94
0126+  C2F4 00 00 00 00 
0127+  C2F8 00 00 00 00 	.db 000h,000h,000h,000h,000h,000h,01Fh,000h ; 95
0127+  C2FC 00 00 1F 00 
0128+  C300 00 08 04 02 	.db 000h,008h,004h,002h,000h,000h,000h,000h ; 96
0128+  C304 00 00 00 00 
0129+  C308 00 00 0E 01 	.db 000h,000h,00Eh,001h,00Fh,011h,00Fh,000h ; 97
0129+  C30C 0F 11 0F 00 
0130+  C310 10 10 10 1E 	.db 010h,010h,010h,01Eh,011h,011h,01Eh,000h ; 98
0130+  C314 11 11 1E 00 
0131+  C318 00 00 0F 10 	.db 000h,000h,00Fh,010h,010h,010h,00Fh,000h ; 99
0131+  C31C 10 10 0F 00 
0132+  C320 01 01 01 0F 	.db 001h,001h,001h,00Fh,011h,011h,00Fh,000h ; 100
0132+  C324 11 11 0F 00 
0133+  C328 00 00 0E 11 	.db 000h,000h,00Eh,011h,01Fh,010h,00Fh,000h ; 101
0133+  C32C 1F 10 0F 00 
0134+  C330 03 04 04 1F 	.db 003h,004h,004h,01Fh,004h,004h,004h,000h ; 102
0134+  C334 04 04 04 00 
0135+  C338 00 00 0F 11 	.db 000h,000h,00Fh,011h,00Fh,001h,011h,00Eh ; 103
0135+  C33C 0F 01 11 0E 
0136+  C340 10 10 10 1E 	.db 010h,010h,010h,01Eh,011h,011h,011h,000h ; 104
0136+  C344 11 11 11 00 
0137+  C348 00 04 00 0C 	.db 000h,004h,000h,00Ch,004h,004h,00Eh,000h ; 105
0137+  C34C 04 04 0E 00 
0138+  C350 02 00 02 02 	.db 002h,000h,002h,002h,002h,012h,00Ch,000h ; 106
0138+  C354 02 12 0C 00 
0139+  C358 10 10 12 14 	.db 010h,010h,012h,014h,018h,014h,012h,000h ; 107
0139+  C35C 18 14 12 00 
0140+  C360 0C 04 04 04 	.db 00Ch,004h,004h,004h,004h,004h,00Eh,000h ; 108
0140+  C364 04 04 0E 00 
0141+  C368 00 00 15 1F 	.db 000h,000h,015h,01Fh,015h,015h,015h,000h ; 109
0141+  C36C 15 15 15 00 
0142+  C370 00 00 1E 11 	.db 000h,000h,01Eh,011h,011h,011h,011h,000h ; 110
0142+  C374 11 11 11 00 
0143+  C378 00 00 0E 11 	.db 000h,000h,00Eh,011h,011h,011h,00Eh,000h ; 111
0143+  C37C 11 11 0E 00 
0144+  C380 00 00 1E 11 	.db 000h,000h,01Eh,011h,011h,01Eh,010h,010h ; 112
0144+  C384 11 1E 10 10 
0145+  C388 00 00 0F 11 	.db 000h,000h,00Fh,011h,011h,00Fh,001h,001h ; 113
0145+  C38C 11 0F 01 01 
0146+  C390 00 00 17 18 	.db 000h,000h,017h,018h,010h,010h,010h,000h ; 114
0146+  C394 10 10 10 00 
0147+  C398 00 00 0F 10 	.db 000h,000h,00Fh,010h,00Eh,001h,01Eh,000h ; 115
0147+  C39C 0E 01 1E 00 
0148+  C3A0 08 08 1E 08 	.db 008h,008h,01Eh,008h,008h,008h,007h,000h ; 116
0148+  C3A4 08 08 07 00 
0149+  C3A8 00 00 11 11 	.db 000h,000h,011h,011h,011h,011h,00Fh,000h ; 117
0149+  C3AC 11 11 0F 00 
0150+  C3B0 00 00 11 11 	.db 000h,000h,011h,011h,00Ah,00Ah,004h,000h ; 118
0150+  C3B4 0A 0A 04 00 
0151+  C3B8 00 00 11 11 	.db 000h,000h,011h,011h,015h,015h,00Ah,000h ; 119
0151+  C3BC 15 15 0A 00 
0152+  C3C0 00 00 11 0A 	.db 000h,000h,011h,00Ah,004h,00Ah,011h,000h ; 120
0152+  C3C4 04 0A 11 00 
0153+  C3C8 00 00 11 0A 	.db 000h,000h,011h,00Ah,004h,004h,004h,000h ; 121
0153+  C3CC 04 04 04 00 
0154+  C3D0 00 00 1F 02 	.db 000h,000h,01Fh,002h,004h,008h,01Fh,000h ; 122
0154+  C3D4 04 08 1F 00 
0155+  C3D8 03 04 04 08 	.db 003h,004h,004h,008h,004h,004h,003h,000h ; 123
0155+  C3DC 04 04 03 00 
0156+  C3E0 04 04 04 04 	.db 004h,004h,004h,004h,004h,004h,004h,000h ; 124
0156+  C3E4 04 04 04 00 
0157+  C3E8 18 04 04 02 	.db 018h,004h,004h,002h,004h,004h,018h,000h ; 125
0157+  C3EC 04 04 18 00 
0158+  C3F0 1F 00 00 00 	.db 01Fh,000h,000h,000h,000h,000h,000h,000h ; 126
0158+  C3F4 00 00 00 00 
0159+  C3F8 1F 1F 1F 1F 	.db 01Fh,01Fh,01Fh,01Fh,01Fh,01Fh,01Fh,01Fh ; 127
0159+  C3FC 1F 1F 1F 1F 
0160+  C400 00 00 12 15 	.db 000h,000h,012h,015h,01Dh,015h,012h,000h ; 128
0160+  C404 1D 15 12 00 
0161+  C408 00 00 0C 02 	.db 000h,000h,00Ch,002h,00Eh,012h,00Fh,000h ; 129
0161+  C40C 0E 12 0F 00 
0162+  C410 01 0E 18 1E 	.db 001h,00Eh,018h,01Eh,011h,011h,00Eh,000h ; 130
0162+  C414 11 11 0E 00 
0163+  C418 00 00 12 12 	.db 000h,000h,012h,012h,012h,012h,01Fh,001h ; 131
0163+  C41C 12 12 1F 01 
0164+  C420 00 00 06 0A 	.db 000h,000h,006h,00Ah,00Ah,00Ah,01Fh,011h ; 132
0164+  C424 0A 0A 1F 11 
0165+  C428 00 00 0E 11 	.db 000h,000h,00Eh,011h,01Fh,010h,00Fh,000h ; 133
0165+  C42C 1F 10 0F 00 
0166+  C430 00 04 0E 15 	.db 000h,004h,00Eh,015h,015h,015h,00Eh,004h ; 134
0166+  C434 15 15 0E 04 
0167+  C438 00 00 1F 10 	.db 000h,000h,01Fh,010h,010h,010h,010h,000h ; 135
0167+  C43C 10 10 10 00 
0168+  C440 00 00 11 0A 	.db 000h,000h,011h,00Ah,004h,00Ah,011h,000h ; 136
0168+  C444 04 0A 11 00 
0169+  C448 00 00 11 13 	.db 000h,000h,011h,013h,015h,019h,011h,000h ; 137
0169+  C44C 15 19 11 00 
0170+  C450 00 04 11 13 	.db 000h,004h,011h,013h,015h,019h,011h,000h ; 138
0170+  C454 15 19 11 00 
0171+  C458 00 00 11 12 	.db 000h,000h,011h,012h,014h,01Ch,013h,000h ; 139
0171+  C45C 14 1C 13 00 
0172+  C460 00 00 07 09 	.db 000h,000h,007h,009h,009h,009h,019h,000h ; 140
0172+  C464 09 09 19 00 
0173+  C468 00 00 11 1B 	.db 000h,000h,011h,01Bh,015h,011h,011h,000h ; 141
0173+  C46C 15 11 11 00 
0174+  C470 00 00 11 11 	.db 000h,000h,011h,011h,01Fh,011h,011h,000h ; 142
0174+  C474 1F 11 11 00 
0175+  C478 00 00 0E 11 	.db 000h,000h,00Eh,011h,011h,011h,00Eh,000h ; 143
0175+  C47C 11 11 0E 00 
0176+  C480 00 00 1F 11 	.db 000h,000h,01Fh,011h,011h,011h,011h,000h ; 144
0176+  C484 11 11 11 00 
0177+  C488 00 00 0F 11 	.db 000h,000h,00Fh,011h,00Fh,009h,011h,000h ; 145
0177+  C48C 0F 09 11 00 
0178+  C490 00 00 1E 11 	.db 000h,000h,01Eh,011h,011h,01Eh,010h,010h ; 146
0178+  C494 11 1E 10 10 
0179+  C498 00 00 0E 11 	.db 000h,000h,00Eh,011h,010h,011h,00Eh,000h ; 147
0179+  C49C 10 11 0E 00 
0180+  C4A0 00 00 1F 04 	.db 000h,000h,01Fh,004h,004h,004h,004h,000h ; 148
0180+  C4A4 04 04 04 00 
0181+  C4A8 00 00 11 11 	.db 000h,000h,011h,011h,00Fh,001h,01Eh,000h ; 149
0181+  C4AC 0F 01 1E 00 
0182+  C4B0 00 00 15 15 	.db 000h,000h,015h,015h,00Eh,015h,015h,000h ; 150
0182+  C4B4 0E 15 15 00 
0183+  C4B8 00 00 1C 12 	.db 000h,000h,01Ch,012h,01Eh,011h,01Eh,000h ; 151
0183+  C4BC 1E 11 1E 00 
0184+  C4C0 00 00 10 10 	.db 000h,000h,010h,010h,01Eh,011h,01Eh,000h ; 152
0184+  C4C4 1E 11 1E 00 
0185+  C4C8 00 00 11 11 	.db 000h,000h,011h,011h,01Dh,015h,01Dh,000h ; 153
0185+  C4CC 1D 15 1D 00 
0186+  C4D0 00 00 0E 11 	.db 000h,000h,00Eh,011h,006h,011h,00Eh,000h ; 154
0186+  C4D4 06 11 0E 00 
0187+  C4D8 00 00 15 15 	.db 000h,000h,015h,015h,015h,015h,01Fh,000h ; 155
0187+  C4DC 15 15 1F 00 
0188+  C4E0 00 00 1E 01 	.db 000h,000h,01Eh,001h,00Fh,001h,01Eh,000h ; 156
0188+  C4E4 0F 01 1E 00 
0189+  C4E8 00 00 15 15 	.db 000h,000h,015h,015h,015h,015h,01Fh,001h ; 157
0189+  C4EC 15 15 1F 01 
0190+  C4F0 00 00 11 11 	.db 000h,000h,011h,011h,00Fh,001h,001h,000h ; 158
0190+  C4F4 0F 01 01 00 
0191+  C4F8 00 00 18 08 	.db 000h,000h,018h,008h,00Eh,009h,00Eh,000h ; 159
0191+  C4FC 0E 09 0E 00 
0192+  C500 12 15 15 1D 	.db 012h,015h,015h,01Dh,015h,015h,012h,000h ; 160
0192+  C504 15 15 12 00 
0193+  C508 04 0A 11 11 	.db 004h,00Ah,011h,011h,01Fh,011h,011h,000h ; 161
0193+  C50C 1F 11 11 00 
0194+  C510 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,011h,011h,01Eh,000h ; 162
0194+  C514 11 11 1E 00 
0195+  C518 12 12 12 12 	.db 012h,012h,012h,012h,012h,012h,01Fh,001h ; 163
0195+  C51C 12 12 1F 01 
0196+  C520 06 0A 0A 0A 	.db 006h,00Ah,00Ah,00Ah,00Ah,00Ah,01Fh,011h ; 164
0196+  C524 0A 0A 1F 11 
0197+  C528 1F 10 10 1E 	.db 01Fh,010h,010h,01Eh,010h,010h,01Fh,000h ; 165
0197+  C52C 10 10 1F 00 
0198+  C530 04 1F 15 15 	.db 004h,01Fh,015h,015h,01Fh,004h,004h,000h ; 166
0198+  C534 1F 04 04 00 
0199+  C538 1F 11 10 10 	.db 01Fh,011h,010h,010h,010h,010h,010h,000h ; 167
0199+  C53C 10 10 10 00 
0200+  C540 11 11 0A 04 	.db 011h,011h,00Ah,004h,00Ah,011h,011h,000h ; 168
0200+  C544 0A 11 11 00 
0201+  C548 11 11 13 15 	.db 011h,011h,013h,015h,019h,011h,011h,000h ; 169
0201+  C54C 19 11 11 00 
0202+  C550 15 11 13 15 	.db 015h,011h,013h,015h,019h,011h,011h,000h ; 170
0202+  C554 19 11 11 00 
0203+  C558 11 12 14 18 	.db 011h,012h,014h,018h,014h,012h,011h,000h ; 171
0203+  C55C 14 12 11 00 
0204+  C560 03 05 09 09 	.db 003h,005h,009h,009h,009h,009h,019h,000h ; 172
0204+  C564 09 09 19 00 
0205+  C568 11 1B 15 15 	.db 011h,01Bh,015h,015h,011h,011h,011h,000h ; 173
0205+  C56C 11 11 11 00 
0206+  C570 11 11 11 1F 	.db 011h,011h,011h,01Fh,011h,011h,011h,000h ; 174
0206+  C574 11 11 11 00 
0207+  C578 0E 11 11 11 	.db 00Eh,011h,011h,011h,011h,011h,00Eh,000h ; 175
0207+  C57C 11 11 0E 00 
0208+  C580 1F 11 11 11 	.db 01Fh,011h,011h,011h,011h,011h,011h,000h ; 176
0208+  C584 11 11 11 00 
0209+  C588 0F 11 11 0F 	.db 00Fh,011h,011h,00Fh,005h,009h,011h,000h ; 177
0209+  C58C 05 09 11 00 
0210+  C590 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,010h,010h,010h,000h ; 178
0210+  C594 10 10 10 00 
0211+  C598 0E 11 10 10 	.db 00Eh,011h,010h,010h,010h,011h,00Eh,000h ; 179
0211+  C59C 10 11 0E 00 
0212+  C5A0 1F 04 04 04 	.db 01Fh,004h,004h,004h,004h,004h,004h,000h ; 180
0212+  C5A4 04 04 04 00 
0213+  C5A8 11 11 11 0A 	.db 011h,011h,011h,00Ah,004h,008h,010h,000h ; 181
0213+  C5AC 04 08 10 00 
0214+  C5B0 11 15 15 0E 	.db 011h,015h,015h,00Eh,015h,015h,011h,000h ; 182
0214+  C5B4 15 15 11 00 
0215+  C5B8 1E 11 11 1E 	.db 01Eh,011h,011h,01Eh,011h,011h,01Eh,000h ; 183
0215+  C5BC 11 11 1E 00 
0216+  C5C0 10 10 10 1E 	.db 010h,010h,010h,01Eh,011h,011h,01Eh,000h ; 184
0216+  C5C4 11 11 1E 00 
0217+  C5C8 11 11 11 19 	.db 011h,011h,011h,019h,015h,015h,019h,000h ; 185
0217+  C5CC 15 15 19 00 
0218+  C5D0 0E 11 01 06 	.db 00Eh,011h,001h,006h,001h,011h,00Eh,000h ; 186
0218+  C5D4 01 11 0E 00 
0219+  C5D8 11 15 15 15 	.db 011h,015h,015h,015h,015h,015h,01Fh,000h ; 187
0219+  C5DC 15 15 1F 00 
0220+  C5E0 0E 11 01 07 	.db 00Eh,011h,001h,007h,001h,011h,00Eh,000h ; 188
0220+  C5E4 01 11 0E 00 
0221+  C5E8 15 15 15 15 	.db 015h,015h,015h,015h,015h,015h,01Fh,001h ; 189
0221+  C5EC 15 15 1F 01 
0222+  C5F0 11 11 11 1F 	.db 011h,011h,011h,01Fh,001h,001h,001h,000h ; 190
0222+  C5F4 01 01 01 00 
0223+  C5F8 3F 3F 3F 3F 	.db 03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,03Fh,03Fh
0223+  C5FC 3F 3F 3F 3F 
0224+  C600             
0225+  C600             #undef DY0124   C600             
0125   C600             keybMap:
0126   C600             
0127   C600 81 0C 19 1A 		.db 81h, 0ch, 19h, 1ah, 20h, 20h, 20h, 08h, 09h, 18h, 0ah, 0dh ; ¨¦­ïï áâà®ª  ª« ¢¨ âãàë
0127   C604 20 20 20 08 
0127   C608 09 18 0A 0D 
0128   C60C 00 C0       v_charGenPtr:	.dw charGen
0129   C60E 00 C6       v_keybMap:	.dw keybMap
0130   C610 51 5E 53 4D 		.db 51h, 5Eh, 53h, 4Dh,	49h, 54h, 58h, 42h, 40h, 2Ch, 2Fh, 5Fh ; Q^SMITXB@,/_
0130   C614 49 54 58 42 
0130   C618 40 2C 2F 5F 
0131   C61C BB FF       v_aramPageEnd:	.dw ARAM_PAGE_END
0132   C61E 00 00       v_aramPageStart:.dw 0
0133   C620 46 59 57 41 		.db 46h, 59h, 57h, 41h,	50h, 52h, 4Fh, 4Ch, 44h, 56h, 5Ch, 2Eh; FYWAPROLDV\.
0133   C624 50 52 4F 4C 
0133   C628 44 56 5C 2E 
0134   C62C 00          v_koi8:		.db 0	; ŠŽˆ-7=FF / ŠŽˆ-8=00
0135   C62D 00          v_rusLat:	.db 0	; “‘=FF / LAT=00
0136   C62E 00          v_capsLock:	.db 0	; BP=00 / HP=02
0137   C62F 00          v_printerEcho:	.db 0
0138   C630 4A 43 55 4B 		.db 4Ah, 43h, 55h, 4Bh, 45h, 4Eh, 47h, 5Bh, 5Dh, 5Ah, 48h, 3Ah ; JCUKENG[]ZH:
0138   C634 45 4E 47 5B 
0138   C638 5D 5A 48 3A 
0139   C63C B1          v_selColor:	.db 0B1h
0140   C63D 00          v_aramMaxPage:	.db 0			; ®¬¥à	¯®á«¥¤­¥© áâà ­¨æë RAM-¤¨áª 
0141   C63E 00 00       v_cursorPos:	.dw 0			; ®«®¦¥­¨¥ ªãàá®à  ¢ ¯¨ªá¥«ïå
0142   C640 3B 31 32 33 		.db 3Bh, 31h, 32h, 33h,	34h, 35h, 36h, 37h, 38h, 39h, 30h, 2Dh ; ;1234567890-
0142   C644 34 35 36 37 
0142   C648 38 39 30 2D 
0143   C64C 05 0A       v_beepConfig:	.dw 0A05h
0144   C64E 00 00       v_oldBeep:	.dw 0
0145   C650 1B 8A 00 01 		.db 1Bh, 8Ah, 0, 1, 2, 3, 4, 5,	6, 8Bh,	8Ch, 1Fh ; ‚¥àå­ïï áâà®ª  ª« ¢¨ âãàë
0145   C654 02 03 04 05 
0145   C658 06 8B 8C 1F 
0146   C65C 00          v_clearScreenByte:.db 0
0147   C65D 00          		.db 0
0148   C65E 0F          v_aramMaxPageI	.db ARAM_MAX_PAGE
0149   C65F 30          v_tapeMode:	.db '0'
0150   C660 2C 32       v_tapePulseB:	.dw 322Ch	; 1200 ®¤
0151   C662 12 18       v_tapePulseA:	.dw 1812h
0152   C664 1B 21       v_tapePulseB2:	.dw 211Bh	; 1800 ®¤
0153   C666 09 0F       v_tapePulseA2:	.dw 0F09h
0154   C668 12 18       v_tapePulseB3:	.dw 1812h	; 2400 ®¤
0155   C66A 05 0B       v_tapePulseA3:	.dw 0B05h
0156   C66C             v_tapePresets:
0157   C66C             
0158   C66C             ; ===========================================================================
0159   C66C             ; ŠŽ„
0160   C66C             
0161   C66C             .org 0C66Ch
0162   C66C             
0163   C66C             .include "tapeReadPilot.inc"
0001+  C66C             ;----------------------------------------------------------------------------
0002+  C66C             ; RAMFOS
0003+  C66C             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C824
0004+  C66C             ; ×òåíèå ïèëîò òîíà ñ ëåíòû
0005+  C66C             ;
0006+  C66C             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  C66C             ;----------------------------------------------------------------------------
0008+  C66C             
0009+  C66C E5          tapeReadPilot:	push	h
0010+  C66D D5          		push	d
0011+  C66E C5          		push	b
0012+  C66F             
0013+  C66F             		; Ïðîìåæóòî÷íûé àäðåñ âîçâðàòà
0014+  C66F 21 A3 CB    		lxi	h, popa_ret
0015+  C672 E5          		push	h
0016+  C673             
0017+  C673             		; Ïîðò ìàãíèòîôîíà
0018+  C673 21 E1 FF    		lxi	h, IO_KEYB_B
0019+  C676             
0020+  C676 1E 01       		mvi	e, 1		
0021+  C678 16 00       loc_C678:	 mvi	d, 0
0022+  C67A 41          loc_C67A:	 mov	b, c
0023+  C67B CD AB C6    		 call	tapeWaitC3
0024+  C67E 79          		 mov	a, c
0025+  C67F 90          		 sub	b
0026+  C680 D2 84 C6    		 jnc	loc_C684
0027+  C683 2F          		  cma
0028+  C684 FE 03       loc_C684:	 cpi	3
0029+  C686 D2 78 C6    		jnc	loc_C678
0030+  C689 15          		dcr	d
0031+  C68A C2 7A C6    		jnz	loc_C67A
0032+  C68D             
0033+  C68D CD AB C6    		call	tapeWaitC3
0034+  C690             
0035+  C690             		; Ïîâòîðèòü D ðàç
0036+  C690 01 00 01    		lxi	b, 100h		
0037+  C693 CD AD C6    loc_C693:	 call	tapeWait
0038+  C696 03          		 inx	b
0039+  C697 03          		 inx	b
0040+  C698 15          		 dcr	d
0041+  C699 C2 93 C6    		jnz	loc_C693
0042+  C69C             
0043+  C69C 69          		mov	l, c
0044+  C69D 60          		mov	h, b
0045+  C69E B7          		ora	a
0046+  C69F             
0047+  C69F             		; bc >>= 1
0048+  C69F 78          		mov	a, b
0049+  C6A0 1F          		rar
0050+  C6A1 47          		mov	b, a
0051+  C6A2 79          		mov	a, c
0052+  C6A3 1F          		rar
0053+  C6A4 4F          		mov	c, a
0054+  C6A5             
0055+  C6A5 09          		dad	b
0056+  C6A6 6B          		mov	l, e
0057+  C6A7 22 F0 D1    		shld	v_tape
0058+  C6AA C9          		ret
0164   C6AB             .include "tapeWait.inc"
0001+  C6AB             ;+---------------------------------------------------------------------------
0002+  C6AB             ; RAMFOS
0003+  C6AB             ; Îæèäàíèå èçìåíåíèÿ ïîðòà ìàãíèòîôîíà è çàìåð âðåìåíè â bñ
0004+  C6AB             ;
0005+  C6AB             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  C6AB             ;----------------------------------------------------------------------------
0007+  C6AB             
0008+  C6AB 0E 03       tapeWaitC3:	mvi	c, 3
0009+  C6AD 7B          tapeWait:	mov	a, e
0010+  C6AE EE 01       		xri	1
0011+  C6B0 5F          		mov	e, a		
0012+  C6B1 03          tapeWait_0:	 inx	b
0013+  C6B2 7E          		 mov	a, m
0014+  C6B3 AB          		 xra	e
0015+  C6B4 E2 B1 C6    		jpo	tapeWait_0
0016+  C6B7 0F          		rrc
0017+  C6B8 0F          		rrc
0018+  C6B9 D8          		rc
0019+  C6BA E1          		pop	h
0020+  C6BB C3 0B C7    		jmp	tapeError0165   C6BE             .include "tapeRead.inc"
0001+  C6BE             ;----------------------------------------------------------------------------
0002+  C6BE             ; RAMFOS
0003+  C6BE             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C806
0004+  C6BE             ; ×òåíèå áàéòà ñ ëåíòà
0005+  C6BE             ;
0006+  C6BE             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  C6BE             ;----------------------------------------------------------------------------
0008+  C6BE             
0009+  C6BE E5          tapeRead:	push	h
0010+  C6BF D5          		push	d
0011+  C6C0 C5          		push	b
0012+  C6C1             
0013+  C6C1             		; Ïðîìåæóòî÷íûé àäðåñ âîçâðàòà
0014+  C6C1 21 A3 CB    		lxi	h, popa_ret
0015+  C6C4 E5          		push	h
0016+  C6C5             
0017+  C6C5 2A F0 D1    		lhld	v_tape
0018+  C6C8 EB          		xchg
0019+  C6C9 21 E1 FF    		lxi	h, 0FFE1h
0020+  C6CC             
0021+  C6CC 06 08       		mvi	b, 8
0022+  C6CE CD AB C6    tapeRead_0:	 call	tapeWaitC3
0023+  C6D1 79          		 mov	a, c
0024+  C6D2 BA          		 cmp	d
0025+  C6D3 DA CE C6    		 jc	tapeRead_0
0026+  C6D6 CD AB C6    		 call	tapeWaitC3
0027+  C6D9 79          		 mov	a, c
0028+  C6DA BA          		 cmp	d
0029+  C6DB DA CE C6    		jc	tapeRead_0
0030+  C6DE             
0031+  C6DE CD AB C6    tapeRead_1:	 call	tapeWaitC3
0032+  C6E1 3A F1 D1    		 lda	v_tape+1
0033+  C6E4 B9          		 cmp	c
0034+  C6E5 3F          		 cmc
0035+  C6E6 7A          		 mov	a, d
0036+  C6E7 1F          		 rar
0037+  C6E8 57          		 mov	d, a
0038+  C6E9 CD AB C6    		 call	tapeWaitC3
0039+  C6EC 05          		 dcr	b
0040+  C6ED C2 DE C6    		jnz	tapeRead_1
0041+  C6F0             
0042+  C6F0 CD AB C6    		call	tapeWaitC3
0043+  C6F3 7B          		mov	a, e
0044+  C6F4 EE 01       		xri	1
0045+  C6F6 32 F0 D1    		sta	v_tape
0046+  C6F9 3A F1 D1    		lda	v_tape+1
0047+  C6FC B9          		cmp	c
0048+  C6FD 3F          		cmc
0049+  C6FE 17          		ral
0050+  C6FF 4F          		mov	c, a
0051+  C700 7A          		mov	a, d
0052+  C701 B7          		ora	a
0053+  C702 F5          		push	psw
0054+  C703 D1          		pop	d
0055+  C704 7B          		mov	a, e
0056+  C705 1F          		rar
0057+  C706 1F          		rar
0058+  C707 A9          		xra	c
0059+  C708 1F          		rar
0060+  C709 7A          		mov	a, d
0061+  C70A D0          		rnc
0062+  C70B             
0063+  C70B 3E 3F       tapeError:	mvi	a, 3Fh
0064+  C70D 37          		stc
0065+  C70E C9          		ret
0166   C70F             .include "tapeWritePilot.inc"
0001+  C70F             ;+---------------------------------------------------------------------------
0002+  C70F             ; RAMFOS
0003+  C70F             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C827
0004+  C70F             ; Çàïèñü ïèëîò òîíà íà ìàãíèòîôîí
0005+  C70F             ;
0006+  C70F             ; Ñîõðàíÿåò ðåãèñòðû BC,DE,HL
0007+  C70F             ;
0008+  C70F             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0009+  C70F             ;----------------------------------------------------------------------------
0010+  C70F             
0011+  C70F             tapeWritePilot:	; Ñîõðàíÿåì BC, HL
0012+  C70F E5          		push	h
0013+  C710 C5          		push	b		
0014+  C711             
0015+  C711             		; Äëèòåëüíîñòü ïèëîò-òîíà BC. Ñòðàííûé êóñîê êîäà.
0016+  C711             		; bc = (40 - v_tapePulseAL)*514
0017+  C711 2A 62 C6    		lhld	v_tapePulseA
0018+  C714 3E 28       		mvi	a, 40
0019+  C716 94          		sub	h
0020+  C717 87          		add	a
0021+  C718 47          		mov	b, a
0022+  C719 4F          		mov	c, a		
0023+  C71A             
0024+  C71A             tapeWritePilot_0:
0025+  C71A             		 ; Óìåíüøàåì BC 
0026+  C71A 0B          		 dcx	b
0027+  C71B             
0028+  C71B             		 ; Çàäåðæêà, ðåãèñòðû íè÷åãî ïîëåçíîãî íå ñîäåðæàò
0029+  C71B 29          		 dad	h
0030+  C71C 78          		 mov	a, b
0031+  C71D             
0032+  C71D             		 ; Èìïóëüñ À
0033+  C71D CD 66 C7    		 call	tapePulseA		 
0034+  C720             
0035+  C720             		 ; Ïîâòîðÿòü ïîêà BC íå íóëåâîå
0036+  C720 78          		 mov	a, b
0037+  C721 B1          		 ora	c
0038+  C722 C2 1A C7    		jnz	tapeWritePilot_0
0039+  C725             
0040+  C725             		; Âîññòàíàëèâàåì BC, HL
0041+  C725 C1          		pop	b
0042+  C726 E1          		pop	h
0043+  C727 C9          		ret
0167   C728             .include "tapeWrite.inc"
0001+  C728             ;+---------------------------------------------------------------------------
0002+  C728             ; RAMFOS
0003+  C728             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C80Ñ
0004+  C728             ; Çàïèñü áàéòà íà ìàãíèòîôîí
0005+  C728             ;
0006+  C728             ; Íà âõîäå
0007+  C728             ;  Ñ - áàéò
0008+  C728             ;  A - óêîðî÷åíèå ïåðâîãî èìïóëüñà *15 òàêòîâ
0009+  C728             ;
0010+  C728             ; Ñîõðàíÿåò ðåãèñòðû BC,DE,HL
0011+  C728             ;
0012+  C728             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0013+  C728             ;----------------------------------------------------------------------------
0014+  C728             
0015+  C728 E5          tapeWrite:	push	h
0016+  C729 C5          		push	b
0017+  C72A 2A 60 C6    		 lhld	v_tapePulseB
0018+  C72D C6 03       		 adi	3
0019+  C72F 2F          		 cma
0020+  C730 85          		 add	l
0021+  C731 6F          		 mov	l, a
0022+  C732 CD 6C C7    		 call	tapePulse
0023+  C735 B7          		 ora	a
0024+  C736 B7          		 ora	a
0025+  C737 06 08       		 mvi	b, 8				
0026+  C739 CD 4D C7    tapeWrite_0:	  call	tapePulseBit
0027+  C73C 05          		  dcr	b
0028+  C73D C2 39 C7    		 jnz	tapeWrite_0
0029+  C740 CD 59 C7    		 call	tapeWriteEnd
0030+  C743 E5          		 push	h
0031+  C744 E5          		 push	h
0032+  C745 CD 66 C7    		  call	tapePulseA
0033+  C748 E1          		 pop	h
0034+  C749 E1          		 pop	h
0035+  C74A C1          		pop	b
0036+  C74B E1          		pop	h
0037+  C74C C9          		ret
0038+  C74D             
0039+  C74D             ; ---------------------------------------------------------------------------
0040+  C74D             
0041+  C74D 79          tapePulseBit:	mov	a, c
0042+  C74E 0F          		rrc
0043+  C74F 4F          		mov	c, a
0044+  C750 DA 66 C7    		jc	tapePulseA
0045+  C753 2A 60 C6    tapePulseB:	lhld	v_tapePulseB
0046+  C756 C3 6C C7    		jmp	tapePulse
0047+  C759             
0048+  C759             ; ---------------------------------------------------------------------------
0049+  C759             
0050+  C759 79          tapeWriteEnd:	mov	a, c
0051+  C75A B7          		ora	a
0052+  C75B 4F          		mov	c, a
0053+  C75C E2 53 C7    		jpo	tapePulseB
0054+  C75F 2A 62 C6    		lhld	v_tapePulseA
0055+  C762 2D          		dcr	l
0056+  C763 CD 6C C7    		call	tapePulse
0057+  C766 2A 62 C6    tapePulseA:	lhld	v_tapePulseA
0058+  C769 C3 6C C7    		jmp	tapePulse
0168   C76C             .include "tapePulse.inc"
0001+  C76C             ;----------------------------------------------------------------------------
0002+  C76C             ; RAMFOS
0003+  C76C             ; Çàïèñü áèòà íà ìàãíèòîôîí
0004+  C76C             ;
0005+  C76C             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  C76C             ;----------------------------------------------------------------------------
0007+  C76C             
0008+  C76C             tapePulse:	; Çàäåðæêà íà L
0009+  C76C 2D          		dcr	l		
0010+  C76D F2 6C C7    		jp	tapePulse
0011+  C770             
0012+  C770             		; Âûñîêèé óðîâåíü
0013+  C770 3E 0F       		mvi	a, 0Fh		
0014+  C772 32 E3 FF    		sta	IO_KEYB_MODE	
0015+  C775             
0016+  C775             		; Çàäåðæêà íà H	
0017+  C775 25          tapePulse_0:	dcr	h		
0018+  C776 F2 75 C7    		jp	tapePulse_0
0019+  C779             
0020+  C779             		; Íèçêèé óðîâåíü
0021+  C779 3E 0E       		mvi	a, 0Eh		
0022+  C77B 32 E3 FF    		sta	IO_KEYB_MODE
0023+  C77E C9          		ret0169   C77F             .include "strToHex.inc"
0001+  C77F             ;+---------------------------------------------------------------------------
0002+  C77F             ; RAMFOS
0003+  C77F             ; Ïðåîáðàçâîíèå ñòðîêè â 16-ðè÷íîå ÷èñëî
0004+  C77F             ;
0005+  C77F             ; Íà âõîäå
0006+  C77F             ;  de - Ñòðîêà
0007+  C77F             ;
0008+  C77F             ; Íà âûõîäå
0009+  C77F             ;  bc       - Ñîõðàíÿåòñÿ
0010+  C77F             ;  de       - Ñëåäóþùèé ñèìâîë çà çàïÿòîé èëè êîíöîì ñòðîêè
0011+  C77F             ;  jz       - Îøèáêà
0012+  C77F             ;  jnz, jc  - Êîíåö ñòðîêè
0013+  C77F             ;  jnz, jnc - Ïðîáåë èëè çàïÿòàÿ
0014+  C77F             ;  hl       - ×èñëî
0015+  C77F             ;
0016+  C77F             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0017+  C77F             ;----------------------------------------------------------------------------
0018+  C77F             
0019+  C77F C5          strToHex:	push	b
0020+  C780 CD 85 C7    		 call	strToHex2
0021+  C783 C1          		pop	b
0022+  C784 C9          		ret
0023+  C785             
0024+  C785             ; ---------------------------------------------------------------------------
0025+  C785             
0026+  C785 21 00 00    strToHex2:	lxi	h, 0		
0027+  C788 06 00       		mvi	b, 0		
0028+  C78A             
0029+  C78A             strToHex2_loop:	; ×òåíèå ñèìâîëà
0030+  C78A 1A          		ldax	d
0031+  C78B 13          		inx	d
0032+  C78C             
0033+  C78C             		; Åñëè êîíåö ñòðîêè, âûõîäèì ñ ôëàãàìè NZ, C
0034+  C78C FE 0D       		cpi	0Dh
0035+  C78E CA B0 C8    		jz	ora_a_stc_ret
0036+  C791             
0037+  C791             		; Åñëè ïðîáåë èëè çàïÿòàÿ, âûõîäèì ñ ôëàãàìè NZ, NC
0038+  C791 FE 2C       		cpi	','
0039+  C793 CA F7 CE    		jz	ora_a_ret		
0040+  C796 FE 20       		cpi	' '
0041+  C798 CA F7 CE    		jz	ora_a_ret
0042+  C79B             
0043+  C79B             		; Åñëè íåêîððåêòíûé ñèìâîë, âûõîäèì ñ ôëàãàìè Ñ,Z
0044+  C79B D6 30       		sui	'0'
0045+  C79D FA AA C8    		jm	xra_a_stc_ret		
0046+  C7A0             
0047+  C7A0             		; Åñëè ýòî öèôðà
0048+  C7A0 FE 0A       		cpi	10
0049+  C7A2 FA B1 C7    		jm	strToHex2_0
0050+  C7A5             
0051+  C7A5             		; Åñëè íåêîððåêòíûé ñèìâîë, âûõîäèì ñ ôëàãàìè Ñ,Z
0052+  C7A5 FE 11       		cpi	11h
0053+  C7A7 FA AA C8    		jm	xra_a_stc_ret
0054+  C7AA FE 17       		cpi	17h
0055+  C7AC F2 AA C8    		jp	xra_a_stc_ret
0056+  C7AF             
0057+  C7AF             		; Ýòî áóêâû A..F
0058+  C7AF D6 07       		sui	'A'-'0'-10
0059+  C7B1             
0060+  C7B1 4F          strToHex2_0:	mov	c, a
0061+  C7B2             
0062+  C7B2             		; hl *=	16
0063+  C7B2 29          		dad	h
0064+  C7B3 29          		dad	h
0065+  C7B4 29          		dad	h
0066+  C7B5 29          		dad	h
0067+  C7B6             
0068+  C7B6             		; Åñëè ïåðåïîëíåíèå, òî	âûéòè c ôëàãàìè Ñ,Z
0069+  C7B6 DA AA C8    		jc	xra_a_stc_ret
0070+  C7B9             		
0071+  C7B9             		; hl += bc
0072+  C7B9 09          		dad	b
0073+  C7BA             
0074+  C7BA C3 8A C7    		jmp	strToHex2_loop0170   C7BD             .include "calcCrc.inc"
0001+  C7BD             ;+---------------------------------------------------------------------------
0002+  C7BD             ; RAMFOS
0003+  C7BD             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C82A
0004+  C7BD             ; Ðàñ÷åò êîíòðîëüíîé ñóììû
0005+  C7BD             ;
0006+  C7BD             ; Íà âõîäå
0007+  C7BD             ;  hl - íà÷àëüíûé àäðåñ
0008+  C7BD             ;  de - êîíå÷íûé àäðåñ
0009+  C7BD             ;
0010+  C7BD             ; Íà âûõîäå
0011+  C7BD             ;  bc - ñóììà
0012+  C7BD             ;
0013+  C7BD             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0014+  C7BD             ;----------------------------------------------------------------------------
0015+  C7BD             
0016+  C7BD 01 00 00    calcCrc:	lxi	b, 0
0017+  C7C0 7E          calcCrc_0:	 mov	a, m
0018+  C7C1 81          		 add	c
0019+  C7C2 4F          		 mov	c, a
0020+  C7C3 F5          		 push	psw
0021+  C7C4 CD 5D C8    		  call	cmp_hl_de
0022+  C7C7 CA 99 CB    		  jz	pop_psw_ret
0023+  C7CA F1          		 pop	psw
0024+  C7CB 78          		 mov	a, b
0025+  C7CC 8E          		 adc	m
0026+  C7CD 47          		 mov	b, a
0027+  C7CE CD 5D C8    		 call	cmp_hl_de
0028+  C7D1 C8          		 rz
0029+  C7D2 23          		 inx	h
0030+  C7D3 C3 C0 C7    		jmp	calcCrc_0
0171   C7D6             .include "pushPopCursor.inc"
0001+  C7D6             ;+---------------------------------------------------------------------------
0002+  C7D6             ; RAMFOS
0003+  C7D6             ; Çàïîìèíàíèå êóðñîðà ñòðîêè
0004+  C7D6             ; Âûçûâàåòñÿ ïðè âûâîäå êîäà 8Dh 
0005+  C7D6             ;
0006+  C7D6             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  C7D6             ;----------------------------------------------------------------------------
0008+  C7D6             
0009+  C7D6 2A 3E C6    pushCursorLine:	lhld	v_cursorPos
0010+  C7D9 22 20 D2    		shld	v_pushCursorLn
0011+  C7DC C9          		ret
0012+  C7DD              
0013+  C7DD             ;----------------------------------------------------------------------------
0014+  C7DD             ; RAMFOS
0015+  C7DD             ; Âîññòàíîâíèå êîäà öâåòà èç ñòåêà
0016+  C7DD             ; Âûçûâàåòñÿ ïðè âûâîäå êîäà 87h
0017+  C7DD             ;
0018+  C7DD             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0019+  C7DD             ;----------------------------------------------------------------------------
0020+  C7DD             
0021+  C7DD 2A 20 D2    popCursorLine:	lhld	v_pushCursorLn
0022+  C7E0 C3 ED C7    		jmp	setCursorPosPx
0023+  C7E3             		
0024+  C7E3             ;----------------------------------------------------------------------------
0025+  C7E3             ; RAMFOS
0026+  C7E3             ; Çàïîìèíàíèå êóðñîðà ýêðàíà
0027+  C7E3             ; Âûçûâàåòñÿ ïðè âûâîäå êîäà 93h
0028+  C7E3             ;
0029+  C7E3             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0030+  C7E3             ;----------------------------------------------------------------------------
0031+  C7E3             
0032+  C7E3 2A 3E C6    pushCursor:	lhld	v_cursorPos
0033+  C7E6 22 22 D2    		shld	v_pushCursor
0034+  C7E9 C9          		ret
0035+  C7EA             
0036+  C7EA             ;----------------------------------------------------------------------------
0037+  C7EA             ; RAMFOS
0038+  C7EA             ; Âîññòàíîâëåíèå êóðñîðà ýêðàíà
0039+  C7EA             ; Âûçûâàåòñÿ ïðè âûâîäå êîäà 94h 
0040+  C7EA             ;
0041+  C7EA             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0042+  C7EA             ;----------------------------------------------------------------------------
0043+  C7EA             
0044+  C7EA 2A 22 D2    popCursor:	lhld	v_pushCursor
0045+  C7ED 22 3E C6    setCursorPosPx:	shld	v_cursorPos
0046+  C7F0 C9          		ret
0047+  C7F1             
0172   C7F1             .include "setGetMemTop.inc"
0001+  C7F1             ;+---------------------------------------------------------------------------
0002+  C7F1             ; RAMFOS
0003+  C7F1             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C830
0004+  C7F1             ; Ïîëó÷åíèå âåðõíåé ãðàíèöû ÎÇÓ
0005+  C7F1             ;
0006+  C7F1             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  C7F1             ;----------------------------------------------------------------------------
0008+  C7F1             
0009+  C7F1 2A 27 D2    getMemTop:	lhld	v_memTop
0010+  C7F4 C9          		ret
0011+  C7F5             
0012+  C7F5             ;----------------------------------------------------------------------------
0013+  C7F5             ; RAMFOS
0014+  C7F5             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C833
0015+  C7F5             ; Óñòàíîêà âåðõíåé ãðàíèöû ÎÇÓ
0016+  C7F5             ;
0017+  C7F5             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0018+  C7F5             ;----------------------------------------------------------------------------
0019+  C7F5             
0020+  C7F5             
0021+  C7F5 22 27 D2    setMemTop:	shld	v_memTop
0022+  C7F8 C9          		ret
0023+  C7F9             
0173   C7F9             .include "pushColor.inc"
0001+  C7F9             ;+---------------------------------------------------------------------------
0002+  C7F9             ; RAMFOS
0003+  C7F9             ; Çàïîìèíàíèå êîäà öâåòà ïî ïðèíöèïó ñòåêà (ãëóáèíà 2 öâåòà)
0004+  C7F9             ; Âûçûâàåòñÿ ïðè âûâîäå êîäà 88h
0005+  C7F9             ;
0006+  C7F9             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  C7F9             ;----------------------------------------------------------------------------
0008+  C7F9             
0009+  C7F9 2A 35 D2    pushColor:	lhld	v_color
0010+  C7FC 22 36 D2    		shld	v_pushColor
0011+  C7FF C9          		ret0174   C800             
0175   C800~            #if $ > 0C800h
0176   C800~            Žè¨¡ª _ç áâì_C000_­¥_¢«¥§« 
0177   C800             #endif
0178   C800             .org 0C800h
0179   C800             
0180   C800             .include "c800.inc"
0001+  C800             ;+---------------------------------------------------------------------------
0002+  C800             ; RAMFOS
0003+  C800             ; Òî÷êè âõîäà
0004+  C800             ;
0005+  C800             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  C800             ;----------------------------------------------------------------------------
0007+  C800             
0008+  C800 C3 E7 C8    j_biosInit:		jmp	biosInit
0009+  C803 C3 E4 CE    j_keyWait:		jmp	keyWait
0010+  C806 C3 BE C6    j_tapeRead:		jmp	tapeRead
0011+  C809 C3 9B CB    j_printChar:		jmp     printChar
0012+  C80C C3 28 C7    j_tapeWrite:		jmp	tapeWrite
0013+  C80F C3 E0 C8    j_printCharA:		jmp	printCharA
0014+  C812 C3 31 CF    j_keyCheck:		jmp	keyCheck
0015+  C815 C3 81 CB    j_printHex:		jmp	printHex
0016+  C818 C3 4C C9    j_printString:		jmp	printString
0017+  C81B C3 75 CF    j_keyScan:		jmp	keyScan
0018+  C81E C3 99 CD    j_getCursorPos:		jmp	getCursorPos
0019+  C821 C3 FE CA    j_getCharFromScr:	jmp	getCharFromScreen
0020+  C824 C3 6C C6    j_tapeReadPilot:	jmp	tapeReadPilot
0021+  C827 C3 0F C7    j_tapeWritePilot:	jmp     tapeWritePilot
0022+  C82A C3 BD C7    j_calcCrc:		jmp     calcCrc
0023+  C82D C3 61 CA    j_setBottomLine:	jmp     setBottomLine
0024+  C830 C3 F1 C7    j_getMemTop:		jmp	getMemTop
0025+  C833 C3 F5 C7    j_setMemTop:		jmp     setMemTop
0026+  C836 C3 98 CA    j_input:		jmp     input
0027+  C839 C3 7F C7    j_strToHex:		jmp	strToHex
0028+  C83C C3 7C CD    j_setCursorPos:		jmp	setCursorPos
0029+  C83F C3 DA D0    			jmp	printer
0030+  C842 C3 DA D0    			jmp	printerHex
0031+  C845 C3 63 C8    j_inputFileName:	jmp     inputFileName
0032+  C848 C3 83 D0    			jmp	beep
0033+  C84B C3 FF D0    			jmp	setColor
0034+  C84E C3 78 CB    			jmp	fullClearScreen
0035+  C851 C3 5F D0    			jmp	oldBeep
0036+  C854 C3 5D C8    j_cmp_hl_de:		jmp     cmp_hl_de
0037+  C857 C3 DA D0    j_printerEchoMode:	jmp	printerEchoMode
0038+  C85A C3 B2 D0    j_tapeMode:		jmp	tapeMode
0181   C85D             .include "cmp_hl_de.inc"
0001+  C85D             ;+---------------------------------------------------------------------------
0002+  C85D             ; RAMFOS
0003+  C85D             ; Ñðàâíèòü ðåãèñòðû HL è DE
0004+  C85D             ;
0005+  C85D             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  C85D             ;----------------------------------------------------------------------------
0007+  C85D             
0008+  C85D 7C          cmp_hl_de:	mov	a, h
0009+  C85E BA          		cmp	d
0010+  C85F C0          		rnz
0011+  C860 7D          		mov	a, l
0012+  C861 BB          		cmp	e
0013+  C862 C9          		ret0182   C863             .include "inputFileName.inc"
0001+  C863             ;----------------------------------------------------------------------------
0002+  C863             ; RAMFOS
0003+  C863             ; Ââåâîä èìåíè ôàéëà ñ êëàâèàòóðû â v_header2_name
0004+  C863             ;
0005+  C863             ; 2013-11-01 vinxru
0006+  C863             ;----------------------------------------------------------------------------
0007+  C863             
0008+  C863 E5          inputFileName:	push	h
0009+  C864 D5          		push	d
0010+  C865 C5          		push	b
0011+  C866             
0012+  C866             		; Ïðîìåæóòî÷íûé àäðåñ âîçâðàòà
0013+  C866 21 A3 CB    		lxi	h, popa_ret
0014+  C869 E5          		push	h
0015+  C86A             
0016+  C86A              		; Âûâîäèì ñîîáùåíèå íà ýêðàí è ñîõðàíèì êóðñîð ñòðîêè
0017+  C86A 21 81 D1    		lxi	h, a_inputFileName
0018+  C86D CD 4C C9    		call	printString
0019+  C870             
0020+  C870             		; Óäàëèì èç èìåíè ôàéëà âñå ëåâûå ñèìâîëû
0021+  C870 CD B9 C8    		call	correctFileName
0022+  C873             
0023+  C873             loc_C873:	; Âîññòàíîâèòü êóðñîð ñòðîêè
0024+  C873 CD DD C7    		call	popCursorLine
0025+  C876             
0026+  C876             		; Ââîä èìåíè ôàéëà
0027+  C876 21 F5 D1    		lxi	h, v_header2_name
0028+  C879 11 FF 0C    		lxi	d, 0CFFh
0029+  C87C CD 98 CA    		call	input
0030+  C87F             
0031+  C87F             		; Íàæàò ESC
0032+  C87F C8          		rz
0033+  C880             
0034+  C880             		; Íàæàòà ëåâàÿ êëàâèøà, âûâåñòè çíàê âîïðîñà è âåðíóòüñÿ ê ââîäó
0035+  C880 21 73 C8    		lxi	h, loc_C873
0036+  C883 E5          		push	h
0037+  C884 D2 AA C8    		jnc	xra_a_stc_ret
0038+  C887             
0039+  C887             		; Ñäâèíóòü êóðñîð
0040+  C887 2A 20 D2    		lhld	v_pushCursorLn
0041+  C88A 7C          		mov	a, h
0042+  C88B C6 18       		adi	3*8
0043+  C88D 67          		mov	h, a
0044+  C88E 22 3E C6    		shld	v_cursorPos
0045+  C891             
0046+  C891             		; Ðàçäåëèòåëü ìåæäó èìåíåì è ðàñøèðåíèåì äîëæåí áûòü ïðîáåëîì
0047+  C891 21 FD D1    		lxi	h, v_header2_ext-1
0048+  C894 06 04       		mvi	b, 4
0049+  C896 7E          		mov	a, m
0050+  C897 FE 20       		cpi	20h
0051+  C899 C2 AA C8    		jnz	xra_a_stc_ret		
0052+  C89C             
0053+  C89C             		; Ðàñøèðåíèå
0054+  C89C 05          loc_C89C:	 dcr	b
0055+  C89D CD E0 C8    		 call	printCharA
0056+  C8A0 CA F6 CE    		 jz	loc_CE8A	; Ïåðåõîä íà pop h, ora a, ret
0057+  C8A3 23          		 inx	h
0058+  C8A4 7E          		 mov	a, m
0059+  C8A5 FE 20       		 cpi	20h
0060+  C8A7 C2 9C C8    		jnz	loc_C89C
0061+  C8AA             		
0062+  C8AA             xra_a_stc_ret:	; Âûâîä çíàêà âîïðîñà
0063+  C8AA 3E 3F       		mvi	a, '?'
0064+  C8AC CD E0 C8    		call	printCharA
0065+  C8AF AF          		xra	a
0066+  C8B0             
0067+  C8B0 B7          ora_a_stc_ret:	ora	a
0068+  C8B1 37          		stc
0069+  C8B2 C9          		ret
0183   C8B3             .include "correctFileName.inc"
0001+  C8B3             ;----------------------------------------------------------------------------
0002+  C8B3             ; RAMFOS
0003+  C8B3             ; Âûâåñòè èìÿ ôàéëà íà ýêðàí è óäàëèòü èç íåãî âñå íåäîïóñòèìûå ñèìâîëû
0004+  C8B3             ;
0005+  C8B3             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  C8B3             ;----------------------------------------------------------------------------
0007+  C8B3             
0008+  C8B3             printFileName:	; Ðàçäåëèòåëü
0009+  C8B3             #if NICE
0010+  C8B3 CD D9 FE    		call	printStringEx
0011+  C8B6 8B 20 00    		.db C_INVERSE, ' ', 0
0012+  C8B9~            #else
0013+  C8B9~            		mvi	c, 11h
0014+  C8B9~            		call	printChar
0015+  C8B9             #endif
0016+  C8B9             
0017+  C8B9 21 F5 D1    correctFileName:lxi	h, v_header2_name	; Èìÿ
0018+  C8BC 06 0C       		mvi	b, 12			; Äëèíà èìåíè
0019+  C8BE 7E          correctFileN_1:	 mov	a, m
0020+  C8BF             		 ; Ñèìâîëû ìåíüøå 0x20 çàìåíÿåì íà ïðîáåë
0021+  C8BF FE 20       		 cpi	20h
0022+  C8C1 DA CE C8    		 jc	correctFileN_2
0023+  C8C4             		 ; Ñèìâîëû îò 0x20 äî 0x7E äîïóñêàþòñÿ
0024+  C8C4 FE 7F       		 cpi	7Fh
0025+  C8C6 DA D1 C8    		 jc	correctFileN_3
0026+  C8C9             		 ; Ñèìâîëû îò 0xC0 äî 0xFF äîïóñêàþòñÿ
0027+  C8C9 FE C0       		 cpi	0C0h
0028+  C8CB D2 D1 C8    		 jnc	correctFileN_3		 
0029+  C8CE             correctFileN_2:	 ; Çàìåíÿåì íåäîïóñòèìûé ñèìâîë íà ïðîáåë
0030+  C8CE 36 20       		 mvi	m, 20h
0031+  C8D0 7E          		 mov	a, m
0032+  C8D1             correctFileN_3:	 ; Âûâîäèì ñèìâîë íà ýêðàí
0033+  C8D1 CD E0 C8    		 call	printCharA
0034+  C8D4             		 ; Ñëåäóþùèé ñèìâîë
0035+  C8D4 23          		 inx	h
0036+  C8D5 05          		 dcr	b
0037+  C8D6 C2 BE C8    		jnz	correctFileN_1		
0038+  C8D9             
0039+  C8D9             		; Ðàçäåëèòåëü
0040+  C8D9             #if NICE
0041+  C8D9 0E 20       		mvi	c, ' '
0042+  C8DB C3 9B CB    		jmp	printChar
0043+  C8DE             #endif
0044+  C8DE             		; Ïåðåõîä íà printChar60184   C8DE             .include "printCharA.inc"
0001+  C8DE             ;----------------------------------------------------------------------------
0002+  C8DE             ; RAMFOS
0003+  C8DE             ; Âûâîä ñèìâîëà ñ êîäîì 6 íà ýêðàí
0004+  C8DE             ;
0005+  C8DE             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  C8DE             ;----------------------------------------------------------------------------
0007+  C8DE             
0008+  C8DE 3E 06       printChar6:	mvi	a, 6
0009+  C8E0             
0010+  C8E0             ;----------------------------------------------------------------------------
0011+  C8E0             ; RAMFOS
0012+  C8E0             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C80F
0013+  C8E0             ; Âûâîä ñèìâîëà íà ýêðàí
0014+  C8E0             ;
0015+  C8E0             ; Íà âõîäå
0016+  C8E0             ;  A - ÷èñëî
0017+  C8E0             ;
0018+  C8E0             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0019+  C8E0             ;----------------------------------------------------------------------------
0020+  C8E0             
0021+  C8E0 C5          printCharA:	push	b
0022+  C8E1 4F          		 mov	c, a
0023+  C8E2 CD 9B CB    		 call	printChar
0024+  C8E5 C1          		pop	b
0025+  C8E6 C9          		ret0185   C8E7             .include "biosInit.inc"
0001+  C8E7             ;+---------------------------------------------------------------------------
0002+  C8E7             ; RAMFOS
0003+  C8E7             ; Èíèöèàëèçàöèÿ BIOS
0004+  C8E7             ; Âûçûâàåòñÿ òîëüêî ôóíêöèåé init
0005+  C8E7             ;
0006+  C8E7             ; 2013-11-01 Äèçàññåìáëèðîâàíî è äîðàáîòàíî vinxru
0007+  C8E7             ;----------------------------------------------------------------------------
0008+  C8E7             
0009+  C8E7             biosInit:	; Î÷èñòêà ïåðåìåííûõ íà÷èíàÿ ñ v_dblClear
0010+  C8E7 21 10 D2    		lxi	h, v_dblClear
0011+  C8EA 06 2F       		mvi	b, 47
0012+  C8EC AF          		xra	a
0013+  C8ED 32 5C C6    		sta	v_clearScreenByte
0014+  C8F0 77          loc_C8EA:	 mov	m, a
0015+  C8F1 23          		 inx	h
0016+  C8F2 05          		 dcr	b
0017+  C8F3 C2 F0 C8    		jnz	loc_C8EA
0018+  C8F6             
0019+  C8F6             		; Èíèöèàëèçàöèÿ	êîíòðîëëåðà öâåòà ÷åðíûì öâåòîì äëÿ î÷èñòêè ýêðàíà
0020+  C8F6~            #if INIT_SCREEN_COLOR==100h
0021+  C8F6~            		lda	v_selColor
0022+  C8F6             #else
0023+  C8F6 3E F1       		mvi	a, INIT_SCREEN_COLOR
0024+  C8F8             #endif
0025+  C8F8 CD FF D0    		call	setColor
0026+  C8FB             
0027+  C8FB             		; Èíèöèàëèçàöèÿ	êëàâèàòóðû
0028+  C8FB CD 7F CF    		call	keyMode82	
0029+  C8FE             
0030+  C8FE             		; Ñêðûâàåì íèæíþþ ñòðîêó
0031+  C8FE CD 8C CA    		call	bottomLineHide
0032+  C901             
0033+  C901             		; Î÷èùàåì ýêðàí
0034+  C901 CD 71 CE    		call	clearScreen
0035+  C904             		
0036+  C904             		; Íàñòðîéêà òàéìåðà
0037+  C904 21 EF FF    		lxi	h, IO_TIMER+3
0038+  C907 36 36       		mvi	m, 36h
0039+  C909 36 76       		mvi	m, 76h
0040+  C90B 36 90       		mvi	m, 90h
0041+  C90D 2B          		dcx	h
0042+  C90E 36 10       		mvi	m, 10h
0043+  C910 2B          		dcx	h
0044+  C911 36 20       		mvi	m, 20h
0045+  C913 36 4E       		mvi	m, 4Eh
0046+  C915 2B          		dcx	h
0047+  C916 36 10       		mvi	m, 10h
0048+  C918 36 15       		mvi	m, 15h
0049+  C91A             		
0050+  C91A             		; *** Îïðåäåëåíèå ðàçìåðà ÄÎÇÓ ***
0051+  C91A             
0052+  C91A             #if WORK_WITHOUT_ARAM
0053+  C91A             		; Íàäî âåðíóòü äîñòóï ê ÄÎÇÓ, èíà÷å ïðîâåðêà íå ðàáîòàåò
0054+  C91A 3E FD       		mvi	a, 0FDh		; Ïîðò âûáîðà ÄÎÇÓ		
0055+  C91C 32 CA FF    		sta	disableARAM1+1
0056+  C91F 32 D9 FF    		sta	disableARAM2+1
0057+  C922             #endif
0058+  C922             
0059+  C922             #if TRUE_CHECK_ARAM
0060+  C922 21 BB FF    		lxi	h, ARAM_PAGE_END
0061+  C925~            #else
0062+  C925~            		lhld	v_aramPageEnd	; Ýòî íå ñîâñåì ïðàâèëüíî, òàê êàê ïðè ïðîãðàììíîì ñáðîñå ïðîâåðêà áóäåò ðàáîòàòü íå òàê, êàê ïðè àïïàðàòíîì
0063+  C925             #endif
0064+  C925 3A 5E C6    		lda	v_aramMaxPageI
0065+  C928 CD 71 C9    		call	checkARAM
0066+  C92B             		
0067+  C92B             #if WORK_WITHOUT_ARAM
0068+  C92B 11 00 00    		lxi	d, 0		; Íà÷àëî ÄÎÇÓ
0069+  C92E             #endif
0070+  C92E             		; Åñëè ÄÎÇÓ íàéäåíî
0071+  C92E             #if TRUE_CHECK_ARAM
0072+  C92E C2 3F C9    		jnz	aramFounded	; Òàê êîðî÷å êîä èñïðâàëåííîé ôóíêöèè
0073+  C931~            #else
0074+  C931~            		jz	aramFounded		
0075+  C931             #endif
0076+  C931             
0077+  C931             		; ÄÎÇÓ íå íàéäåíî
0078+  C931             #if WORK_WITHOUT_ARAM
0079+  C931             		 ; Íàñòðàèâàåì íåáîëüøîé äèñê â îñíîâíîì ÎÇÓ
0080+  C931 11 57 D1    		 lxi	d, miniPage
0081+  C934 21 78 D1    		 lxi	h, miniPageEnd
0082+  C937 3E FC       		 mvi	a, 0FCh		; Ïîðò âûáîðà ÎÇÓ
0083+  C939 32 CA FF    		 sta	disableARAM1+1
0084+  C93C 32 D9 FF    		 sta	disableARAM2+1
0085+  C93F~            #else
0086+  C93F~            		 ; Ïûòàåìñÿ ðàáîòàòü ñ 48 Êá ÄÎÇÓ
0087+  C93F~            		 lxi	h, 0BFFBh
0088+  C93F             #endif
0089+  C93F             aramFounded:	
0090+  C93F 22 1C C6    		shld	v_aramPageEnd
0091+  C942 22 3C D2    		shld	v_aramPageEnd2
0092+  C945             #if WORK_WITHOUT_ARAM
0093+  C945 EB          		xchg
0094+  C946 22 1E C6    		shld	v_aramPageStart
0095+  C949             #endif
0096+  C949             		; *** Èíèöèàëèçàöèÿ ýêðàíà ***
0097+  C949 21 91 D1    		lxi	h, a_initScreen
0098+  C94C             		; Äàëåå printString
0099+  C94C             
0100+  C94C             
0101+  C94C             		; Ýòîò òåêñò áóäåò âñòðîåí â êîíåö êîäà
0102+  C94C             #if NICE
0103+  C94C             #define A_INITSCREEN a_initScreen: .db C_INVERSE, C_TOPLINE, ' ', 0F3h, 0D0h, 0C5h, 0C3h, 0C9h, 0C1h, 0CCh, 0C9h, 0D3h, 0D4h, ' ','M','X','2',' ','R','A','M','F','O','S',C_NORMAL,0
0104+  C94C~            #else                                                                                                                                                                  
0105+  C94C~            #define A_INITSCREEN a_initScreen: .db C_INVERSE, C_TOPLINE, ' ', 0F3h, 0D0h, 0C5h, 0C3h, 0C9h, 0C1h, 0CCh, 0C9h, 0D3h, 0D4h, '_','M','X',92,'R','A','M','F','O','S',92,C_NORMAL,0
0106+  C94C             #endif
0186   C94C             .include "printString.inc"
0001+  C94C             ;+---------------------------------------------------------------------------
0002+  C94C             ; RAMFOS
0003+  C94C             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C818
0004+  C94C             ; Âûâîä ñòðîêè íà ýêðàí
0005+  C94C             ;
0006+  C94C             ; Íà âõîäå
0007+  C94C             ;  hl - Ñòðîêà
0008+  C94C             ;
0009+  C94C             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0010+  C94C             ;----------------------------------------------------------------------------
0011+  C94C             
0012+  C94C 7E          printString:	mov	a, m
0013+  C94D A7          		ana	a
0014+  C94E C8          		rz
0015+  C94F CD E0 C8    		call	printCharA
0016+  C952 23          		inx	h
0017+  C953 C3 4C C9    		jmp	printString
0187   C956             .include "parseDate.inc"
0001+  C956             ;+---------------------------------------------------------------------------
0002+  C956             ; RAMFOS
0003+  C956             ; Ïðåîáðàçîâàòü ââåäåííóþ ñòðîêó ñ äàòîé â ÷èñëà
0004+  C956             ;
0005+  C956             ; Íà âõîäå:
0006+  C956             ;  de - ñòðîêà
0007+  C956             ;
0008+  C956             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0009+  C956             ;----------------------------------------------------------------------------
0010+  C956             
0011+  C956             parseDate:	; Äåíü
0012+  C956 CD 7F C7    		call	strToHex
0013+  C959 7D          		mov	a, l
0014+  C95A             #if DATE_IN_RAM
0015+  C95A 32 02 D2    		sta	v_header2_date+0
0016+  C95D~            #else
0017+  C95D~            		sta	parseDate_r1+1
0018+  C95D             #endif
0019+  C95D D8          		rc
0020+  C95E             		; Ìåñÿö
0021+  C95E CD 7F C7    		call	strToHex
0022+  C961 7D          		mov	a, l
0023+  C962             #if DATE_IN_RAM
0024+  C962 32 03 D2    		sta	v_header2_date+1
0025+  C965~            #else
0026+  C965~            		sta	parseDate_r2+1
0027+  C965             #endif
0028+  C965 D8          		rc
0029+  C966             		; Ãîä
0030+  C966 CD 7F C7    		call	strToHex
0031+  C969 7D          		mov	a, l
0032+  C96A             #if DATE_IN_RAM
0033+  C96A 32 04 D2    		sta	v_header2_date+2
0034+  C96D~            #else
0035+  C96D~            		sta	parseDate_r3+1
0036+  C96D             #endif
0037+  C96D D8          		rc
0038+  C96E             		; Ñëèøêîì ìíîãî ïàðàìåòðîâ
0039+  C96E C3 AA C8    		jmp	xra_a_stc_ret
0188   C971             #if TRUE_CHECK_ARAM
0189   C971             .include "checkARAM_v2.inc"
0001+  C971             ;+---------------------------------------------------------------------------
0002+  C971             ; RAMFOS
0003+  C971             ; Èñïðàâëåííàÿ ôóíêöèÿ îïðåäåëåíèÿ ðàçìåðà ÄÎÇÓ
0004+  C971             ;
0005+  C971             ; Íà âõîäå
0006+  C971             ;  à - ìàêñèìàëüíûé íîìåð ñòðàíèöû, êîíñòàíòà MAX_ARAM_PAGE
0007+  C971             ;
0008+  C971             ; Íà âûõîäå
0009+  C971             ;  NZ - ÄÎÇÓ íàéäåíî (íàîáîðîò îòíîâèòåëüíî ñòàíäðàòíîé ôóíêöèè)
0010+  C971             ;   Z - ÄÎÇÓ íå íàéäåíî
0011+  C971             ;
0012+  C971             ; 2013-11-01 Ðàçðàáîòàíî vinxru
0013+  C971             ;----------------------------------------------------------------------------
0014+  C971             
0015+  C971             checkARAM:	 ; Çàïèñûâàåì âî âñå ñòðàíèöû ïîðÿäêîâûå íîìåðà îò áîëüøåé ê ìåíüøåé
0016+  C971 4F          		 mov	c, a		
0017+  C972 0C          		 inr	c
0018+  C973 CD 39 F8    		 call	j_pageWriteAny
0019+  C976 3D          		 dcr	a
0020+  C977 F2 71 C9    		jp	checkARAM
0021+  C97A             
0022+  C97A             		; ×èòàåì íîìåðà. Åñëè íîìåð ïðî÷èòàí êîððåêòíî, çíà÷èò åñòü òàêàÿ ñòðàíèöà
0023+  C97A             		; a = -1
0024+  C97A             
0025+  C97A             checkARAM_1:	 ; ×èòàåì ñëåäóþùóþ ñòðàíèöó
0026+  C97A 3C          		 inr	a
0027+  C97B CD 36 F8    		 call	j_pageReadAny		
0028+  C97E             		 ; Äîëæåí áûòü çàïèñàí íîìåð ñòðàíèöû+1, åñëè íåò, òî âûõîäèì
0029+  C97E 0D          		 dcr	c
0030+  C97F B9          		 cmp	c		 
0031+  C980 C2 8B C9    		 jnz	checkARAM_2
0032+  C983                              ; Ñîõðàíÿåì íîìåð ïîñëåäíåé ñòðàíèöû RAM-äèñêà
0033+  C983 32 3D C6    		 sta	v_aramMaxPage
0034+  C986             		 ; Ýòî ìàêñèìóì, âûõîäèì
0035+  C986 FE 0F       		 cpi	ARAM_MAX_PAGE		; ARAM_MAX_PAGE íå ìîæåò áûòü íóëåì!
0036+  C988 C2 7A C9    		jnz	checkARAM_1
0037+  C98B             		 
0038+  C98B             checkARAM_2:	; Åñëè ÄÎÇÓ íàéäåíî, âûõîäèì â ôëàãîì NZ
0039+  C98B B7          		ora	a
0040+  C98C C0          		rnz		
0041+  C98D             
0042+  C98D             		; Â ñëó÷àå îøèáêè çàíîñèì â v_aramPages=0 è âûõîäèì ñ ôëàãîì Z
0043+  C98D 32 3D C6    		sta	v_aramMaxPage
0044+  C990 C9          		ret		0190   C991~            #else
0191   C991~            .include "checkARAM.inc"
0192   C991             #endif
0193   C991             .include "inputDate.inc"
0001+  C991             ;+---------------------------------------------------------------------------
0002+  C991             ; RAMFOS
0003+  C991             ; Ââîä òåêóùåé äàòû
0004+  C991             ;
0005+  C991             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  C991             ;----------------------------------------------------------------------------
0007+  C991             
0008+  C991             inputDate:	; Âûâîä ïðèãëàøåíèÿ "V3.1/äàòà:" èëè "äàòà:"
0009+  C991 21 8A D1    		lxi	h, a_inputDate
0010+  C994 CD 4C C9    		call	printString
0011+  C997             	
0012+  C997             		; Ââîä äàòû
0013+  C997 21 95 D2    		lxi	h, buffer
0014+  C99A 11 FF 09    		lxi	d, 9FFh ; Ìàêñèìóì 9 ñèìâîëîâ
0015+  C99D CD 98 CA    		call	input
0016+  C9A0             
0017+  C9A0             		; Åñëè áûëà îøèáêà
0018+  C9A0 D2 91 C9    		jnc	inputDate
0019+  C9A3 77          		mov	m, a
0020+  C9A4             
0021+  C9A4             		; Ïðåîáðàçîâàíèå ââåäåííîé ñòðîêè è ÷èñëà
0022+  C9A4 FC 56 C9    		cm	parseDate
0023+  C9A7             
0024+  C9A7             		; Åñëè ïðåîáðàçîâàíèå íå óäàëîñü ââîäèì ïîâòîðíî
0025+  C9A7 CA 91 C9    		jz	inputDate
0026+  C9AA             
0027+  C9AA             #if DATE_IN_RAM
0028+  C9AA             		; Ñîõðàíÿåì ïðèçíàê òîãî, ÷òî äàòà ââåäåíà
0029+  C9AA 3E 8B       		mvi	a, 8Bh 
0030+  C9AC 32 01 D2    		sta	v_header2_saved
0031+  C9AF             
0032+  C9AF C9          		ret
0033+  C9B0~            #else
0034+  C9B0~            		; Èçâëåêàåì èç ñòåêà àäðåñ íà äèñêå
0035+  C9B0~            		pop	h
0036+  C9B0~            
0037+  C9B0~            		; Ñîõðàíÿåì 08Bh
0038+  C9B0~            		mvi	c, 8Bh 
0039+  C9B0~            		call	inputDate_1
0040+  C9B0~            		
0041+  C9B0~            		; Ñîõðàíÿåì äåíü íà äèñê
0042+  C9B0~            parseDate_r1:	mvi	c, 22h
0043+  C9B0~            		call	inputDate_1
0044+  C9B0~            
0045+  C9B0~            		; Ñîõðàíÿåì ìåñÿö íà äèñê
0046+  C9B0~            parseDate_r2:	mvi	c, 09h
0047+  C9B0~            		call	inputDate_1
0048+  C9B0~            
0049+  C9B0~            		; Ñîõðàíÿåì ãîä íà äèñê
0050+  C9B0~            parseDate_r3:	mvi	c, 92h
0051+  C9B0~            inputDate_1:	xra	a
0052+  C9B0~            		call	j_pageWriteAny
0053+  C9B0~            		inx	h
0054+  C9B0~            		inr	a
0055+  C9B0~            		ret
0056+  C9B0             #endif
0057+  C9B0             
0058+  C9B0             #if NICE
0059+  C9B0             #define A_INPUTDATE a_inputDate: .db 0Dh, 0C4h, 0C1h, 0D4h, 0C1h, ':', 0 ; "äàòà:"
0060+  C9B0~            #else
0061+  C9B0~            #define A_INPUTDATE a_inputDate: .db 0Dh, 'V', '3', '.', '1', '/', 0C4h, 0C1h, 0D4h, 0C1h, ':', 0 ; "V3.1/äàòà:"
0062+  C9B0             #endif0194   C9B0             .include "topLine.inc"		; ¯à®¤®«¦ ¥âáï ¢ inverse
0001+  C9B0             ;+---------------------------------------------------------------------------
0002+  C9B0             ; RAMFOS
0003+  C9B0             ; Âûâîä èäíèêàòîðîâ â âåðõíþþ ñòðîêó
0004+  C9B0             ; Ýòà ôóíêöèÿ âûçûâàåòñÿ òîëüêî èç printIndicators è clearTopLine
0005+  C9B0             ;
0006+  C9B0             ; 2013-11-01 Äèçàññåìáëèðîâàíî è äîðàáîòàíî vinxru
0007+  C9B0             ;----------------------------------------------------------------------------
0008+  C9B0             
0009+  C9B0             #if FAST_PRINT
0010+  C9B0             INDCATORS_SEP = ' '
0011+  C9B0~            #else
0012+  C9B0~            INDCATORS_SEP = 11h
0013+  C9B0             #endif
0014+  C9B0             
0015+  C9B0             printIndicatorsInt:	
0016+  C9B0             		; Åñëè äàòà õðàíèòñÿ â ÎÇÓ, ïðîâåðÿåòñÿ, ââåäåíà ëè äàòà
0017+  C9B0             #if DATE_IN_RAM
0018+  C9B0 3A 01 D2    		lda	v_header2_saved
0019+  C9B3 FE 8B       		cpi	8Bh
0020+  C9B5 C4 91 C9    		cnz	inputDate
0021+  C9B8             #endif
0022+  C9B8             		; Óñòàíîâêà ïîëîæåíèÿ êóðñîðà (0 ñòîêà 45 ñòîëáåö)
0023+  C9B8 21 08 87    		lxi	h, 8708h	
0024+  C9BB 22 3E C6    		shld	v_cursorPos
0025+  C9BE             
0026+  C9BE             		; Åñëè äàòà õðàíèòñÿ â ÄÎÇÓ, ïðîâåðÿåòñÿ, ââåäåíà ëè äàòà
0027+  C9BE~            #if DATE_IN_RAM==0
0028+  C9BE~            		; ×èòàåì èç íóëåâîé ñòðàíèöû áàéò ïî àäðåñó v_aramPageEnd+1
0029+  C9BE~            		lhld	v_aramPageEnd
0030+  C9BE~            		inx	h
0031+  C9BE~            		xra	a
0032+  C9BE~            		call	j_pageReadAny
0033+  C9BE~            		
0034+  C9BE~            		; Åñëè òàì çàïèñàí íå 8B, òî ïåðåõîäèì ê ââîäó äàòû
0035+  C9BE~            		mov	a, c
0036+  C9BE~            		cpi	8Bh
0037+  C9BE~            		push	h		
0038+  C9BE~            		jnz	inputDate
0039+  C9BE             #endif
0040+  C9BE             
0041+  C9BE             		; Ðàçäåëèòåëü
0042+  C9BE 3E 20       		mvi	a, INDCATORS_SEP
0043+  C9C0 CD E0 C8    		call	printCharA
0044+  C9C3             
0045+  C9C3             		; Âûâîäèì ñêîðîñòü çàïèñè íà ëåíòó
0046+  C9C3 3A 5F C6    		lda	v_tapeMode
0047+  C9C6 CD E0 C8    		call	printCharA
0048+  C9C9             
0049+  C9C9             		; Âûâîäèì ðåæèì ýõîïå÷àòè
0050+  C9C9 3A 2F C6    		lda	v_printerEcho
0051+  C9CC CD E0 C8    		call	printCharA
0052+  C9CF             
0053+  C9CF             		; Âûâîäèì CAPS LOCK
0054+  C9CF 2A 2D C6    		lhld	v_rusLat
0055+  C9D2 25          		dcr	h
0056+  C9D3 3E 0B       		mvi	a, 0Bh
0057+  C9D5 FA DA C9    		jm	loc_C9D5
0058+  C9D8 3E 0F       		 mvi	a, 0Fh		 
0059+  C9DA CD E0 C8    loc_C9D5:	call	printCharA
0060+  C9DD             
0061+  C9DD             		; Âûâîäèì ÐÓÑ/LAT
0062+  C9DD 2C          		inr	l
0063+  C9DE 21 79 D1    		lxi	h, a_lat
0064+  C9E1 C2 E7 C9    		jnz	loc_C9E2
0065+  C9E4 21 7D D1    		  lxi	h, a_rus
0066+  C9E7 CD 4C C9    loc_C9E2:	call	printString
0067+  C9EA             
0068+  C9EA             		; Âûâîäèì KOI8/7
0069+  C9EA 3A 2C C6    		lda	v_koi8
0070+  C9ED B7          		ora	a
0071+  C9EE 3E 38       		mvi	a, '8'
0072+  C9F0 CA F4 C9    		jz	loc_C9EF
0073+  C9F3 3D          		  dcr	a		  
0074+  C9F4 CD E0 C8    loc_C9EF:	call	printCharA
0075+  C9F7             
0076+  C9F7             #if FAST_PRINT
0077+  C9F7 3E 20       		mvi	a, ' '
0078+  C9F9 CD E0 C8    		call	printCharA
0079+  C9FC~            #else
0080+  C9FC~            		call	printChar6
0081+  C9FC             #endif
0082+  C9FC             
0083+  C9FC             #if DATE_IN_RAM
0084+  C9FC             		; Ðàçäåëèòåëü
0085+  C9FC 3E 20       		mvi	a, INDCATORS_SEP
0086+  C9FE CD E0 C8    		call	printCharA
0087+  CA01             
0088+  CA01             		; Âûâîä íà ýêðàí äàòû
0089+  CA01 3A 02 D2    		lda v_header2_date
0090+  CA04 CD 81 CB    		call	printHex
0091+  CA07             
0092+  CA07             #if NICE
0093+  CA07 3E 2D       		mvi	a, '-'
0094+  CA09 CD E0 C8    		call	printCharA
0095+  CA0C             #endif
0096+  CA0C             		; Âûâîä íà ýêðàí äàòû
0097+  CA0C 3A 03 D2    		lda	v_header2_date+1
0098+  CA0F CD 81 CB    		call	printHex
0099+  CA12             #if NICE
0100+  CA12 3E 2D       		mvi	a, '-'
0101+  CA14 CD E0 C8    		call	printCharA
0102+  CA17             #endif
0103+  CA17             		; Âûâîä íà ýêðàí äàòû
0104+  CA17 3A 04 D2    		lda v_header2_date+2
0105+  CA1A CD 81 CB    		call	printHex
0106+  CA1D~            #else
0107+  CA1D~            		pop	h
0108+  CA1D~            
0109+  CA1D~            		; Àäðåñ äëÿ ñîõðàíåíèÿ äàòû
0110+  CA1D~            		lxi	d, v_header2_saved
0111+  CA1D~            
0112+  CA1D~            		; Ñîõðàíÿåì C â v_header2_saved <--- ????
0113+  CA1D~            		mov	a, c
0114+  CA1D~            		stax	d
0115+  CA1D~            
0116+  CA1D~            		; Ðàçäåëèòåëü
0117+  CA1D~            		mvi	a, INDCATORS_SEP
0118+  CA1D~            		call	printCharA
0119+  CA1D~            
0120+  CA1D~            		; Âûâîä íà ýêðàí äàòû
0121+  CA1D~            		mvi	b, 3		; 3 áàéòà
0122+  CA1D~            loc_CA02:	 inx	h
0123+  CA1D~            		 inx	d
0124+  CA1D~            		 ; ×èòàåì áàéò èç íóëåâîé ñòðàíèöû
0125+  CA1D~            		 xra	a
0126+  CA1D~            		 call	j_pageReadAny
0127+  CA1D~            		 ; Çàïèñü â ïàìÿòè
0128+  CA1D~            		 mov	a, c
0129+  CA1D~            		 stax	d
0130+  CA1D~            		 ; Âûâîä íà ýêðàí
0131+  CA1D~            		 call	printHex
0132+  CA1D~            		 ; Öèêë 3-1
0133+  CA1D~            		 dcr	b
0134+  CA1D~            		jnz	loc_CA02
0135+  CA1D             #endif
0136+  CA1D             
0137+  CA1D             #if FAST_PRINT
0138+  CA1D C9          		ret
0139+  CA1E~            #else
0140+  CA1E~            		jmp	printChar6
0141+  CA1E             #endif
0142+  CA1E             
0143+  CA1E             ;----------------------------------------------------------------------------
0144+  CA1E             ; RAMFOS
0145+  CA1E             ; Ëèøíèé êîä
0146+  CA1E             ;
0147+  CA1E             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0148+  CA1E             ;----------------------------------------------------------------------------
0149+  CA1E             
0150+  CA1E~            #if NO_PRINT_STATUS_BUG==0
0151+  CA1E~            printIndicatorsEnd:
0152+  CA1E~            		pop	psw
0153+  CA1E~            		cnz	changeInverse
0154+  CA1E             #endif
0155+  CA1E             
0156+  CA1E             ;----------------------------------------------------------------------------
0157+  CA1E             ; RAMFOS
0158+  CA1E             ; Î÷èñòêà âåðõíåé ñòðîêè è ïåðåìåùåíèå òóäà êóðñîðà
0159+  CA1E             ; Âûçûâàåòñÿ ïðè ïå÷àòè ñèìâîëà 08Fh
0160+  CA1E             ;
0161+  CA1E             ; 2013-11-01 Äèçàññåìáëèðîâàíî è äîðàáîòàíî vinxru
0162+  CA1E             ;----------------------------------------------------------------------------
0163+  CA1E             
0164+  CA1E             clearTopLine:	
0165+  CA1E             #if COLOR_SUPPORT
0166+  CA1E             		; Öâåò ïî óìîë÷àíèþ
0167+  CA1E 3E F1       		mvi	a, INIT_SCREEN_COLOR
0168+  CA20 CD FF D0    		call	setColor
0169+  CA23             #endif
0170+  CA23             
0171+  CA23             		; Ðåàëüíàÿ î÷èñòêà âåðõíåé ñòðîêè
0172+  CA23 CD C9 CE    		call	clearTopLine2
0173+  CA26             
0174+  CA26             		; Óñòàíàâëèâàåì êóðñîð â âåðõíþþ ñòðîêó
0175+  CA26 21 08 00    		lxi	h, 8
0176+  CA29 22 3E C6    		shld	v_cursorPos
0177+  CA2C             
0178+  CA2C             		; ?
0179+  CA2C 21 0A 14    		lxi	h, 140Ah
0180+  CA2F 22 30 D2    		shld	v_topLineHeight
0181+  CA32             
0182+  CA32             ;----------------------------------------------------------------------------
0183+  CA32             ; RAMFOS
0184+  CA32             ; Âûâîä èäíèêàòîðîâ â âåðõíþþ ñòðîêó ñ ñîõðàíåíèåì êóðñîðà, öâåòà è èíâåðñèè
0185+  CA32             ; Ýòà ôóíêöèÿ âûçûâàåòñÿ òîëüêî èç keyScan
0186+  CA32             ;
0187+  CA32             ; 2013-11-01 Äèçàññåìáëèðîâàíî è äîðàáîòàíî vinxru
0188+  CA32             ;----------------------------------------------------------------------------
0189+  CA32             
0190+  CA32             printIndicators:
0191+  CA32             		; Íå ðèñîâàòü èíäèêàòîðû
0192+  CA32 3A 30 D2    		lda	v_topLineHeight
0193+  CA35 B7          		ora	a
0194+  CA36 C8          		rz
0195+  CA37             
0196+  CA37             		; Çàïîìèíàåì ïîëîæåíèå êóðñîðà
0197+  CA37 2A 3E C6    		lhld	v_cursorPos
0198+  CA3A             
0199+  CA3A             		; Çàïîìèíàåì èíâåðñèþ â ñòåêå
0200+  CA3A 3A 5C C6    		lda	v_clearScreenByte
0201+  CA3D B7          		ora	a
0202+  CA3E F5          		push	psw
0203+  CA3F             #if FAST_PRINT
0204+  CA3F             		; Åñëè èíâåðñèÿ íå áûëà âêëþ÷åíà, âêëþ÷àåì å¸.
0205+  CA3F CC 59 CA    		cz	changeInverse
0206+  CA42~            #else
0207+  CA42~            		; Åñëè èíâåðñèÿ áûëà âêëþ÷åíà, âûêëþ÷àåì å¸.
0208+  CA42~            		cnz	changeInverse
0209+  CA42             #endif	
0210+  CA42             
0211+  CA42             		; Ñîõðàíåíèå öâåòà è óñòàíîâêà ñòàíäàðòíîãî öâåòà
0212+  CA42             #if COLOR_SUPPORT
0213+  CA42 3A 35 D2    		lda	v_color
0214+  CA45 F5          		push	psw
0215+  CA46 3E F0       		mvi	a, 0F0h
0216+  CA48 CD FF D0    		call	setColor
0217+  CA4B             #endif
0218+  CA4B             
0219+  CA4B             		; Âûâîä ñòàòóñíîé ñòðîêè
0220+  CA4B E5          		push	h
0221+  CA4C CD B0 C9    		 call	printIndicatorsInt
0222+  CA4F E1          		pop	h
0223+  CA50             
0224+  CA50             		; Âîññòàíîâëåíèå öâåòà
0225+  CA50             #if COLOR_SUPPORT
0226+  CA50 F1          		pop	psw
0227+  CA51 CD FF D0    		call	setColor
0228+  CA54             #endif
0229+  CA54             	
0230+  CA54             		;  Âîññòàíîâëåíèå ïîëîæåíèÿ êóðñîðà
0231+  CA54 22 3E C6    		shld	v_cursorPos
0232+  CA57             		 
0233+  CA57~            #if NO_PRINT_STATUS_BUG==0
0234+  CA57~            		jnz	printIndicatorsEnd
0235+  CA57             #endif
0236+  CA57             
0237+  CA57             		;  Âîññòàíîâëåíèå èíâåðñèè
0238+  CA57 F1          		pop	psw
0239+  CA58             #if FAST_PRINT
0240+  CA58 C0          		rnz
0241+  CA59~            #else
0242+  CA59~            		rz
0243+  CA59             #endif	
0244+  CA59             		; ïðîäîëæàåòñÿ â changeInverse0195   CA59             .include "inverse.inc"
0001+  CA59             ;+---------------------------------------------------------------------------
0002+  CA59             ; RAMFOS
0003+  CA59             ; Èíâåðñèÿ èíâåðñèè (Èíâåðñèÿ ôîíà ÷åðíîáåëîãî ýêðàíà)
0004+  CA59             ; Âûçûâàåòñÿ ïðè âûâîäå êîäà 8Ah è ïðîñòî òàê
0005+  CA59             ;
0006+  CA59             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  CA59             ;----------------------------------------------------------------------------
0008+  CA59             
0009+  CA59 3A 5C C6    changeInverse:	lda	v_clearScreenByte
0010+  CA5C             
0011+  CA5C             ;----------------------------------------------------------------------------
0012+  CA5C             ; RAMFOS
0013+  CA5C             ; Âêëþ÷åíèå/âûêëþ÷åíèå èíâåðñèè
0014+  CA5C             ;
0015+  CA5C             ; Íà âõîäå
0016+  CA5C             ;  A=0    - Âêëþ÷èòü. (Âûçûâàåòñÿ ïðè âûâîäå êîäà 8Bh)
0017+  CA5C             ;  A=0FFh - Âûêëþ÷èòü.
0018+  CA5C             ;
0019+  CA5C             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0020+  CA5C             ;----------------------------------------------------------------------------
0021+  CA5C             
0022+  CA5C 2F          setInverseNeg:	cma
0023+  CA5D             
0024+  CA5D             ;----------------------------------------------------------------------------
0025+  CA5D             ; RAMFOS
0026+  CA5D             ; Âêëþ÷åíèå/âûêëþ÷åíèå èíâåðñèè
0027+  CA5D             ;
0028+  CA5D             ; Íà âõîäå
0029+  CA5D             ;  A=0FFh - Âêëþ÷èòü. (Âûçûâàåòñÿ ïðè âûâîäå êîäà 8Ch)
0030+  CA5D             ;  A=0    - Âûêëþ÷èòü.
0031+  CA5D             ;
0032+  CA5D             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0033+  CA5D             ;----------------------------------------------------------------------------
0034+  CA5D             
0035+  CA5D 32 5C C6    setInverse:	sta	v_clearScreenByte
0036+  CA60 C9          		ret0196   CA61             .include "bottomLine.inc"
0001+  CA61             ;+---------------------------------------------------------------------------
0002+  CA61             ; RAMFOS
0003+  CA61             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C82D
0004+  CA61             ; Óñòàíîâêà òåêñòà â íèæíþþ ñòðîêó. 
0005+  CA61             ; Íåîáõîäèìî ïðåäâàðèòåëüíî âêëþ÷èòü ñòðîêó ñ ïîìîùüþ clearBottomLine
0006+  CA61             ;
0007+  CA61             ; Íà âõîäå
0008+  CA61             ;  hl - òåêñòîâàÿ ñòðîêà. Ïåðâûé áàéò ñòðîêè - èíäåðòèôèêàòîð. Åñëè ñòðîêà
0009+  CA61             ;  ñ òàêèì èä âûâîäèëàñü ïðîøëûé ðàç, òî â ýòîò ðàç îíà âûâîäèòñÿ íå áóäåò
0010+  CA61             ;
0011+  CA61             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0012+  CA61             ;----------------------------------------------------------------------------
0013+  CA61             
0014+  CA61             setBottomLine:	; Ïåðâûì áàéòîì ñòðîêè èäåò èäåíòèôèêàòîð. 
0015+  CA61             		; Åñëè ýòà ñòðîêà óæå óñòàíàëèâàëàñü, òî âûõîäèì
0016+  CA61 3A 34 D2    		lda	v_bottomLineId
0017+  CA64 BE          		cmp	m
0018+  CA65 C8          		rz
0019+  CA66 7E          		mov	a, m
0020+  CA67 23          		inx	h
0021+  CA68             
0022+  CA68             		; Äàëåå èäåò òåêñò, âûâîäèì åãî
0023+  CA68 F5          		push	psw
0024+  CA69 CD 4C C9    		 call	printString
0025+  CA6C F1          		pop	psw
0026+  CA6D             
0027+  CA6D             		; bottomLineId = a
0028+  CA6D C3 88 CA    		jmp	setBottomLineId
0029+  CA70             
0030+  CA70             ;----------------------------------------------------------------------------
0031+  CA70             ; RAMFOS
0032+  CA70             ; Âêëþ÷åíèå è î÷èñòêà íèæíåé ñòðîêè è ïåðåìåùåíèå òóäà êóðñîðà
0033+  CA70             ; Âûçûâàåòñÿ ïðè ïå÷àòè ñèìâîëà 090h
0034+  CA70             ;
0035+  CA70             ; 2013-11-01 Äèçàññåìáëèðîâàíî è äîðàáîòàíî vinxru
0036+  CA70             ;----------------------------------------------------------------------------
0037+  CA70             
0038+  CA70             clearBottomLine:
0039+  CA70             #if COLOR_SUPPORT
0040+  CA70             		; Öâåò ïî óìîë÷àíèþ
0041+  CA70 3E F1       		mvi	a, INIT_SCREEN_COLOR
0042+  CA72 CD FF D0    		call	setColor
0043+  CA75             #endif	
0044+  CA75             		; Î÷èñòèòü íèæíþþ ñòðîêó (ñòðîêà d=250, âûñîòà e=10)
0045+  CA75 11 0A FA    		lxi	d, 0FA0Ah
0046+  CA78 CD CC CE    		call	clearLine
0047+  CA7B             
0048+  CA7B             		; Ïîëîæåíèå êóðñîðà
0049+  CA7B 21 F8 00    		lxi	h, 248
0050+  CA7E 22 3E C6    		shld	v_cursorPos
0051+  CA81             
0052+  CA81             		; Ðàçìåð ýêðàíà (230-240)
0053+  CA81 21 F0 E6    		lxi	h, 0E6F0h
0054+  CA84             
0055+  CA84 22 32 D2    setScreenHeight:shld	v_screenHeight
0056+  CA87             
0057+  CA87 AF          		xra	a		
0058+  CA88 32 34 D2    setBottomLineId:sta	v_bottomLineId
0059+  CA8B C9          		ret
0060+  CA8C             
0061+  CA8C             ;----------------------------------------------------------------------------
0062+  CA8C             ; RAMFOS
0063+  CA8C             ; Îòêëþ÷åíèå íèæíåé ñòðîêè, ñòðîêà ïðè ýòîì íå ñòèðàåòñÿ ñàìà
0064+  CA8C             ; Âûçûâàåòñÿ ïðè âûâîäå 1Fh, 1Fh (ôóíêöèåé clearScreen)
0065+  CA8C             ;
0066+  CA8C             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0067+  CA8C             ;----------------------------------------------------------------------------
0068+  CA8C             
0069+  CA8C 21 00 0A    bottomLineHide:	lxi	h, 0A00h
0070+  CA8F 22 30 D2    		shld	v_topLineHeight
0071+  CA92             		
0072+  CA92             		; Ðàçìåð ýêðàíà (240-250)
0073+  CA92 21 FA F0    		lxi	h, 0F0FAh
0074+  CA95 C3 84 CA    		jmp	setScreenHeight
0197   CA98             .include "input.inc"
0001+  CA98             ;----------------------------------------------------------------------------
0002+  CA98             ; RAMFOS
0003+  CA98             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C836
0004+  CA98             ; Ââîä êîìàíäíîé ñòðîêè
0005+  CA98             ;
0006+  CA98             ; Íà âõîäå
0007+  CA98             ;  HL   - àäðåñ áóôåðà
0008+  CA98             ;  D    - äëèíà áóôåðà
0009+  CA98             ;  E=XX - ðåæèì áåç î÷èñòêè çíàêîìåñòà, ìîæíî äâèãàòüñÿ âïðàâî
0010+  CA98             ;  E=00 - ñ î÷èñòêîé çíàêîìåñòà, âïðàâî äâèãàòüñÿ íåëüçÿ
0011+  CA98             ;
0012+  CA98             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0013+  CA98             ;----------------------------------------------------------------------------
0014+  CA98             
0015+  CA98             
0016+  CA98             input:		; Ñîõðàíÿåì BC, HL
0017+  CA98 C5          		push	b
0018+  CA99 E5          		push	h
0019+  CA9A             
0020+  CA9A             		; Çà÷åì, íå ïîíÿë
0021+  CA9A 01 00 80    		lxi	b, 8000h
0022+  CA9D             
0023+  CA9D 0C          input_inrc:	inr	c		; Íèæå ìû óìåíüøèì C
0024+  CA9E 14          input_inrd:	inr	d		; Íèæå ìû óìåíüøèì D
0025+  CA9F CD E4 CE    input_ignore:	call	keyWait
0026+  CAA2 FE 7F       		cpi	7Fh
0027+  CAA4 CA 9F CA    		jz	input_ignore
0028+  CAA7 FE 08       		cpi	8
0029+  CAA9 CA E5 CA    		jz	input_del	; Ïðè ïåðåõîäå íà óäàëåíèå C è D áîëüøå íà åäèíèöó
0030+  CAAC FE 0D       		cpi	0Dh
0031+  CAAE CA D0 CA    		jz	input_enter	; Âûõîä ñ ôëàãàìè nz, c
0032+  CAB1 FE 1F       		cpi	1Fh
0033+  CAB3 CA D3 CA    		jz	input_esc	; Âûõîä ñ ôëàãàìè z, nc
0034+  CAB6             		; Åñëè íå ìåñòà äëÿ íîâûõ ñèìâîëîâ
0035+  CAB6 15          		dcr	d
0036+  CAB7 CA 9E CA    		jz	input_inrd
0037+  CABA             		; Âïðàâî
0038+  CABA FE 18       		cpi	18h
0039+  CABC CA D6 CA    		jz	input_right	; Íà âõîäå Ñ áîëüøå íà åäèíèöó
0040+  CABF             		; Îñòàëüíûå ñëóæåáíûå êëàâèøè - âûõîä
0041+  CABF FE 20       		cpi	20h
0042+  CAC1 14          		inr	d		; Óñòàíàâëèâàåì ôëàãè nz
0043+  CAC2 DA D2 CA    		jc	input_cmc	; Âûõîä ñ ôëàãàìè nz, nc
0044+  CAC5 15          		dcr	d
0045+  CAC6             		; Óâåëè÷èâàåì B
0046+  CAC6 04          		inr	b
0047+  CAC7             input_chr:	; Âûâîä ñèìâîëà íà ýêðàí
0048+  CAC7 CD E0 C8    		call	printCharA
0049+  CACA             		; Ñîõðàíåíèå ñèìâîëà â ïàìÿòè
0050+  CACA 77          		mov	m, a
0051+  CACB 23          		inx	h
0052+  CACC             		; Óìåíüøàåì ñ÷åò÷èê ñâîáîäíûõ áàéò
0053+  CACC 15          		dcr	d
0054+  CACD             		; Ñëåäóþùèé ñèìâîë
0055+  CACD C3 9D CA    		jmp	input_inrc
0056+  CAD0             
0057+  CAD0             ; ---------------------------------------------------------------------------
0058+  CAD0             
0059+  CAD0 B7          input_enter:	ora	a	; Óñòàíàâëèâàåì ôëàã - íå íóëü
0060+  CAD1 05          		dcr	b       ; Åñëè áûëè ââåäåíû ñèìâîëû, òî ôëàã ìèíóñ
0061+  CAD2 3F          input_cmc:	cmc		; Èíâåðòèðóåì CF
0062+  CAD3             input_esc:	; Âîññòàíàâëèâàåì DE, BC
0063+  CAD3 D1          		pop	d
0064+  CAD4 C1          		pop	b
0065+  CAD5 C9          		ret
0066+  CAD6             
0067+  CAD6             ; ---------------------------------------------------------------------------
0068+  CAD6             
0069+  CAD6             input_right:	; Åñëè ðåæèì 0, òî âïðàâî äâèãàòüñÿ íåëüçÿ
0070+  CAD6 1C          		inr	e
0071+  CAD7 1D          		dcr	e
0072+  CAD8 CA 9E CA    		jz	input_inrd
0073+  CADB             
0074+  CADB             		; Åñëè â áóôåðå ñëóæåáíûå ñèìâîëû, çìåíÿåì èõ íà ïðîáåë è âûâîäèì
0075+  CADB 3E 20       		mvi	a, ' ' 
0076+  CADD BE          		cmp	m
0077+  CADE D2 C7 CA    		jnc	input_chr
0078+  CAE1             
0079+  CAE1             		; Åñëè îáû÷íûå ñèìâîëû, âûâîäì
0080+  CAE1 7E          		mov	a, m
0081+  CAE2 C3 C7 CA    		jmp	input_chr
0082+  CAE5             
0083+  CAE5             ; ---------------------------------------------------------------------------
0084+  CAE5             
0085+  CAE5             input_del:	; Ïåðåä âûçîâîì D áûëà óâåëè÷åíà íà åäèíèöó, íàäî óìåíüøèòü
0086+  CAE5 15          		dcr	d
0087+  CAE6             
0088+  CAE6             		; Åñëè íè îäíîãî áàéòà íå ââåäåíî, âûõîäèì è óâåëè÷èâàåì Ñ îáðàòíî
0089+  CAE6 0D          		dcr	c
0090+  CAE7 CA 9D CA    		jz	input_inrc
0091+  CAEA             
0092+  CAEA                             ; Åñëè ðåæèì 0, òî âìåñòî óäàëåííîãî ñèìâîëà ñòàâèì ïðîáåë
0093+  CAEA 1D          		dcr	e
0094+  CAEB 1C          		inr	e
0095+  CAEC CC E0 C8    		cz	printCharA	; Íà âõîäå A=8
0096+  CAEF 3E 20       		mvi	a, ' '
0097+  CAF1 CC E0 C8    		cz	printCharA
0098+  CAF4             
0099+  CAF4             		; Êóðñîð âëåâî
0100+  CAF4 3E 08       		mvi	a, 8
0101+  CAF6 CD E0 C8    		call	printCharA
0102+  CAF9             
0103+  CAF9             		; Óìåíüøàåì óêàçàòåëü
0104+  CAF9 2B          		dcx	h
0105+  CAFA             
0106+  CAFA             		; Óâåëè÷èâàåì äëèíó
0107+  CAFA 14          		inr	d
0108+  CAFB C3 9E CA    		jmp	input_inrd
0109+  CAFE             
0110+  CAFE             ; ---------------------------------------------------------------------------
0198   CAFE             .include "getCharFromScreen.inc"
0001+  CAFE             ;----------------------------------------------------------------------------
0002+  CAFE             ; RAMFOS
0003+  CAFE             ; Ïîëó÷èòü êîä ñèìâîëà íà ýêðàíå
0004+  CAFE             ;
0005+  CAFE             ; 2013-11-01 vinxru
0006+  CAFE             ;----------------------------------------------------------------------------                   
0007+  CAFE             
0008+  CAFE             getCharFromScreen:
0009+  CAFE E5          		push	h
0010+  CAFF D5          		push	d
0011+  CB00 C5          		push	b
0012+  CB01             
0013+  CB01             		; Àäðåñ âîçâðàòà
0014+  CB01 21 A3 CB    		lxi	h, popa_ret
0015+  CB04 E5          		push	h
0016+  CB05             
0017+  CB05             		; Ïîëîæåíèå êóðñîðà â ïèêñåëÿõ
0018+  CB05 2A 3E C6    		lhld	v_cursorPos	
0019+  CB08             
0020+  CB08             		; Ðàñ÷åò àäðåñà
0021+  CB08 EB          		xchg
0022+  CB09 CD 6B CD    		call	calcCharAddr
0023+  CB0C EB          		xchg
0024+  CB0D             		
0025+  CB0D             		; ñ - ñìåùåíèå â áèòàõ
0026+  CB0D             		; hl - àäðåñ ñ âèäåîïàìÿòè
0027+  CB0D             
0028+  CB0D 06 08       		mvi	b, 8 ; Âûñîòà ñèìâîëà
0029+  CB0F 11 1A D2    		lxi	d, unk_D21A ; Ñþäà áóäåò ñêîïèðîâàí ñèìâîë ñ ýêðàíà
0030+  CB12 D5          		push	d		
0031+  CB13 E5          loc_CAF9:	 push	h
0032+  CB14             		  ; Çàãðóçèòü â HL èç ïàìÿòè ïî àäðåñó HL
0033+  CB14 7E          		  mov	a, m		
0034+  CB15 24          		  inr	h
0035+  CB16 6E          		  mov	l, m
0036+  CB17 67          		  mov	h, a
0037+  CB18             		  ; Ñäâèãàåì HL íà c*2 áèò
0038+  CB18 79          		  mov	a, c
0039+  CB19 F5          loc_CAFF:	   push	psw
0040+  CB1A CD 6F CB    		    call	hl_div_2
0041+  CB1D CD 6F CB    		    call	hl_div_2
0042+  CB20 F1          		   pop 	psw
0043+  CB21 3D          		   dcr	a
0044+  CB22 C2 19 CB    		  jnz	loc_CAFF
0045+  CB25             		  ; Ñîõðàíÿåì òîëüêî íèæíèå 6 áèò ïî àäðåñó de
0046+  CB25 7D          		  mov	a, l
0047+  CB26 E6 3F       		  ani	3Fh
0048+  CB28 12          		  stax	d
0049+  CB29 1B          		  dcx	d
0050+  CB2A E1          		 pop	h
0051+  CB2B 2D          		 dcr	l
0052+  CB2C 05          		 dcr	b
0053+  CB2D C2 13 CB    		jnz	loc_CAF9
0054+  CB30             
0055+  CB30             		; Åñëè v_clearScreenByte íå íîëü
0056+  CB30 3A 5C C6    		lda	v_clearScreenByte
0057+  CB33 B7          		ora	a
0058+  CB34 CA 43 CB    		jz	loc_CB29
0059+  CB37             		 ; Èíâåðòèðóåì áàéò ïî àäðåñó de
0060+  CB37 06 08       		 mvi	b, 8
0061+  CB39             loc_CB1F:	  ; de++
0062+  CB39 13          		  inx	d
0063+  CB3A             		  ; *de = (*de ^ 0xFF) & 0x3F;
0064+  CB3A 1A          		  ldax	d
0065+  CB3B 2F          		  cma
0066+  CB3C E6 3F       		  ani	3Fh
0067+  CB3E 12          		  stax	d
0068+  CB3F             		  ; Öèêë
0069+  CB3F 05          		  dcr	b
0070+  CB40 C2 39 CB    		 jnz	loc_CB1F
0071+  CB43 D1          loc_CB29:	pop	d
0072+  CB44             
0073+  CB44             		; de - àäðåñ íà ýêðàíå
0074+  CB44             
0075+  CB44             		; Ñðàâíèâàåì êàæäûé ñèìâîë èç çíàêîãåíåðàòîðà ñ ýêðàíîì
0076+  CB44             
0077+  CB44 3E FF       		mvi	a, -1
0078+  CB46 2A 0C C6    		lhld	v_charGenPtr	; Çíàêîãåíåðàòîð
0079+  CB49 01 08 00    		lxi	b, 8		; âûñîòà ñèìâîëà
0080+  CB4C             loc_CB32:	 ; Ñëåäóþùèé ñèìâîë
0081+  CB4C 09          		 dad	b		
0082+  CB4D C5          		 push	b
0083+  CB4E D5          		 push	d
0084+  CB4F E5          		 push	h
0085+  CB50 47          		  mov	b, a
0086+  CB51 CD 61 CB    		  call	compareChar
0087+  CB54 78          		  mov	a, b
0088+  CB55 E1          		 pop	h
0089+  CB56 D1          		 pop	d
0090+  CB57 C1          		 pop	b
0091+  CB58 C2 4C CB    		jnz	loc_CB32
0092+  CB5B             
0093+  CB5B             		; Çíàêîãåíåðàòîð íå ñîäåðæèò ñèìâîëîâ 80-BF
0094+  CB5B FE 80       		cpi	80h
0095+  CB5D D8          		rc
0096+  CB5E C6 40       		adi	40h		
0097+  CB60 C9          		ret
0098+  CB61             
0099+  CB61             ; ---------------------------------------------------------------------------
0100+  CB61             
0101+  CB61             compareChar:	; if(a == 0xBF) return true;
0102+  CB61 FE BF       		cpi	0BFh
0103+  CB63 C8          		rz
0104+  CB64             		; Óâåëè÷èâàå íîìåð ñèìâîëà
0105+  CB64 04          		inr	b
0106+  CB65             		; Äàëåå memcmp_hl1_de_c
0199   CB65             .include "memcmp_hl1_de_c.inc"
0001+  CB65             memcmp_hl1_de_c: ; if(*de-- != *--hl) return;
0002+  CB65 1A          		 ldax	d
0003+  CB66 1B          		 dcx	d
0004+  CB67 2B          		 dcx	h
0005+  CB68 BE          		 cmp	m
0006+  CB69 C0          		 rnz
0007+  CB6A             		 ; c--
0008+  CB6A 0D          		 dcr	c
0009+  CB6B C8          		 rz
0010+  CB6C C3 65 CB    		jmp	memcmp_hl1_de_c
0200   CB6F             .include "hl_div_2.inc"
0001+  CB6F             ;+---------------------------------------------------------------------------
0002+  CB6F             ; RAMFOS
0003+  CB6F             ; Äåëåíèå HL íà äâà
0004+  CB6F             ;
0005+  CB6F             ; 2013-11-01 vinxru
0006+  CB6F             ;----------------------------------------------------------------------------                   
0007+  CB6F             
0008+  CB6F             hl_div_2:	; Îáíóëÿåì ôëàã C
0009+  CB6F AF          		xra	a
0010+  CB70 0F          		rrc
0011+  CB71                             ; Ñäâèãàåì H		
0012+  CB71 7C          		mov	a, h
0013+  CB72 1F          		rar
0014+  CB73 67          		mov	h, a
0015+  CB74                             ; Ñäâèãàåì L
0016+  CB74 7D          		mov	a, l
0017+  CB75 1F          		rar
0018+  CB76 6F          		mov	l, a
0019+  CB77 C9          		ret0201   CB78             .include "fullClearScreen.inc"
0001+  CB78             ;+---------------------------------------------------------------------------
0002+  CB78             ; RAMFOS
0003+  CB78             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C84E
0004+  CB78             ; Î÷èñòêà âñåãî ýêðàíà ñ îòêëþ÷åíèåì ñëóæåáíûõ ñòðîê
0005+  CB78             ;
0006+  CB78             ; Ñîõðàíÿåò âñå ðåãèñòðû
0007+  CB78             ;
0008+  CB78             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0009+  CB78             ;----------------------------------------------------------------------------                   
0010+  CB78             
0011+  CB78             fullClearScreen:
0012+  CB78 F5          		push	psw
0013+  CB79             
0014+  CB79             		; Ýòà ïåðåìåííàÿ âêëþ÷àåò î÷èñòêó âñåãî ýêðàíà
0015+  CB79 3E 1F       		mvi	a, 1Fh
0016+  CB7B 32 10 D2    		sta	v_dblClear
0017+  CB7E             
0018+  CB7E             		; Ïå÷àòü ñèìâîëà 1Fh è îñâîáîæäåíèå ñòåêà
0019+  CB7E             		; call	printCharA
0020+  CB7E             		; pop	psw
0021+  CB7E             		; ret		
0022+  CB7E C3 96 CB    		jmp	printCharA_popret0202   CB81             .include "printHex.inc"
0001+  CB81             ;----------------------------------------------------------------------------
0002+  CB81             ; RAMFOS
0003+  CB81             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C815
0004+  CB81             ; Âûâîä 16-ðè÷íîãî ÷èñëà íà ýêðàíå
0005+  CB81             ;
0006+  CB81             ; Íà âõîäå
0007+  CB81             ;  A - ÷èñëî
0008+  CB81             ;
0009+  CB81             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0010+  CB81             ;----------------------------------------------------------------------------
0011+  CB81             
0012+  CB81 F5          printHex:	push	psw
0013+  CB82 0F          		rrc
0014+  CB83 0F          		rrc
0015+  CB84 0F          		rrc
0016+  CB85 0F          		rrc
0017+  CB86 CD 8A CB    		call	printHex_1
0018+  CB89 F1          		pop	psw
0019+  CB8A F5          printHex_1:	push	psw
0020+  CB8B E6 0F       		ani	0Fh
0021+  CB8D FE 0A       		cpi	0Ah
0022+  CB8F FA 94 CB    		jm	printHex_2
0023+  CB92 C6 07       		adi	7
0024+  CB94 C6 30       printHex_2:	adi	30h ; '0'
0025+  CB96             printCharA_popret:
0026+  CB96 CD E0 C8    		call	printCharA
0027+  CB99 F1          pop_psw_ret:	pop	psw
0028+  CB9A C9          		ret
0203   CB9B             #if FAST_PRINT
0204   CB9B             .include "printChar_fast.inc"
0001+  CB9B             ;----------------------------------------------------------------------------
0002+  CB9B             ; RAMFOS
0003+  CB9B             ; Óñêîðåííàÿ ôóíêöèÿ âûâîäå ñèìâîëà íà ýêðàí.
0004+  CB9B             ;
0005+  CB9B             ; Íà âõîäå:
0006+  CB9B             ;  ñ - ñèìâîë
0007+  CB9B             ;
0008+  CB9B             ; 2013-11-01 Ðàçðàáîòàíî vinxru
0009+  CB9B             ;----------------------------------------------------------------------------
0010+  CB9B             
0011+  CB9B E5          printChar:	push	h
0012+  CB9C D5          		push	d
0013+  CB9D C5          		push	b
0014+  CB9E F5          		push	psw
0015+  CB9F CD AD CB    printChar_pol:	 call	printChar_int
0016+  CBA2 F1          		pop	psw
0017+  CBA3 C1          popa_ret:	pop	b
0018+  CBA4 D1          		pop	d
0019+  CBA5 E1          		pop	h
0020+  CBA6 C9          		ret
0021+  CBA7             
0022+  CBA7             ; ---------------------------------------------------------------------------
0023+  CBA7             
0024+  CBA7 2A 3E C6    printCharAll:	lhld	v_cursorPos		
0025+  CBAA C3 0D CC    		jmp	printChar_0
0026+  CBAD             
0027+  CBAD             ; ---------------------------------------------------------------------------
0028+  CBAD             
0029+  CBAD             printChar_int:	
0030+  CBAD~            #if NO_PRINTER==0
0031+  CBAD~            		; Åñëè âêëþ÷åí ýõî ðåæèì íà ïðèíòåð
0032+  CBAD~            		lda	v_printerEcho
0033+  CBAD~            		cpi	0D2h
0034+  CBAD~            		cz	doPrinterEcho
0035+  CBAD             #endif
0036+  CBAD             		; hl - ïîëîæåíèå êóðñîðà â ïèêñåëÿõ		
0037+  CBAD 2A 3E C6    		lhld	v_cursorPos		
0038+  CBB0             
0039+  CBB0             		; Ñëóæåáíûå ñèìâîëû
0040+  CBB0 79          		mov	a, c		; Ñèìâîë		
0041+  CBB1 FE 1F       		cpi	1Fh
0042+  CBB3 CA 71 CE    		jz	clearScreen
0043+  CBB6             
0044+  CBB6             		; Åñëè ñèìâîë >0x1F, ïðîïóñêàåì ïðîâåðêè íèæå
0045+  CBB6 D2 E6 CB    		jnc	fast		
0046+  CBB9             
0047+  CBB9 FE 18       		cpi	18h
0048+  CBBB CA F0 CD    		jz	cursorRight
0049+  CBBE FE 08       		cpi	8
0050+  CBC0 CA 0C CE    		jz	cursorLeft
0051+  CBC3 FE 19       		cpi	19h
0052+  CBC5 CA 18 CE    		jz	cursorUp
0053+  CBC8 FE 1A       		cpi	1Ah
0054+  CBCA CA FE CD    		jz	cursorDown
0055+  CBCD FE 0C       		cpi	0Ch
0056+  CBCF CA B7 CE    		jz	loc_CE4B
0057+  CBD2 FE 0A       		cpi	0Ah
0058+  CBD4 CA FC CD    		jz	cursorCrLf
0059+  CBD7 FE 1B       		cpi	1Bh
0060+  CBD9 CA 24 CD    		jz	printChar_esc
0061+  CBDC FE 07       		cpi	7
0062+  CBDE CA 44 D0    		jz	keySound
0063+  CBE1 FE 0D       		cpi	0Dh
0064+  CBE3 CA DE CD    		jz	saveCursorPosX0
0065+  CBE6             				
0066+  CBE6             fast:		; Åñëè ìåíüøå 0x60, ïåðåõîäèì ê ïå÷àòè
0067+  CBE6 FE 60       		cpi	60h
0068+  CBE8 DA 0D CC    		jc	printChar_0
0069+  CBEB             
0070+  CBEB             		; Ñèìâîëû ìåíüøå 0x80 
0071+  CBEB FE 80       		cpi	80h
0072+  CBED DA 02 CC    		jc	printChar_koi
0073+  CBF0             
0074+  CBF0             		; Ïðîìåæóòîê C0-FF ïðåîáðàçîâàòü â 80-BF
0075+  CBF0 D6 40       		sui	40h
0076+  CBF2 FA 0C CC    		jm	loc_CBF1
0077+  CBF5             
0078+  CBF5             		; Ïðîìåæóòîê 80-BF ïðåîáðàçîâàòü â 1-40
0079+  CBF5 D6 3F       		sui	3Fh		
0080+  CBF7             
0081+  CBF7             		; Îáðàáàòûâàåì ïðîìåæóòîê 87-BF
0082+  CBF7 FE 08       		cpi	8
0083+  CBF9 D2 C4 CC    		jnc	printChar2
0084+  CBFC 4F          		mov	c, a
0085+  CBFD             
0086+  CBFD             		; Ïðîìåæóòîê 80-86 ïðåîáðàçîâàòü â ñèìâîëû 1-7
0087+  CBFD             		
0088+  CBFD             loc_CBE2:	; Åñëè ìåíüøå 0x60, ïåðåõîäèì ê ïå÷àòè
0089+  CBFD FE 60       		cpi	60h
0090+  CBFF DA 0D CC    		jc	printChar_0
0091+  CC02             
0092+  CC02             		; Òðàíñëÿöèÿ èç KOI-7 â KOI-8
0093+  CC02 3A 2C C6    printChar_koi:	lda	v_koi8
0094+  CC05 B7          		ora	a
0095+  CC06 CA 0D CC    		jz	printChar_0
0096+  CC09 79          		mov	a, c
0097+  CC0A C6 40       		adi	40h		
0098+  CC0C             
0099+  CC0C 4F          loc_CBF1:	mov	c, a
0100+  CC0D             
0101+  CC0D             printChar_0:	; Åñëè cursorX >= 190, òî ïåðåâîä ñòðîêè
0102+  CC0D 7C          		mov	a, h
0103+  CC0E FE BE       		cpi	190
0104+  CC10 D4 FC CD    		cnc	cursorCrLf
0105+  CC13             
0106+  CC13             		; Óâåëè÷èâàåì ïîëîæåíèå êóðñîðà
0107+  CC13 7C          		mov	a, h
0108+  CC14 C6 03       		adi	3
0109+  CC16 32 3F C6    		sta	v_cursorPos+1	; Ïîëîæåíèå êóðñîðà â ïèêñåëÿõ
0110+  CC19             
0111+  CC19             		; Ïîëîæåíèå êóðñîðà â DE
0112+  CC19 EB          		xchg
0113+  CC1A             
0114+  CC1A             		; Ðàñ÷åò àäðåñà ñèìâîëà è çíàêîìåñòà
0115+  CC1A CD 5B CD    		call	calcCharAddr3
0116+  CC1D             
0117+  CC1D             		; Êîñÿê â êîîðäèíàòàõ
0118+  CC1D 7B          		mov	a, e
0119+  CC1E DE 08       		sbi	8
0120+  CC20 5F          		mov	e, a
0121+  CC21             
0122+  CC21 06 09       		mvi	b, 9
0123+  CC23             
0124+  CC23             		; Äóáëèðîâàòü ñòðîêó?
0125+  CC23 AF          		XRA	A
0126+  CC24 B6          		ORA	M
0127+  CC25 3A 5C C6    		LDA	v_clearScreenByte
0128+  CC28 F2 2C CC    		JP	drawCharDbl		
0129+  CC2B AE          		 XRA	M
0130+  CC2C             drawCharDbl:
0131+  CC2C             		 		 
0132+  CC2C 2B          		dcx	h
0133+  CC2D 0D          		dcr c
0134+  CC2E 0D          		dcr c
0135+  CC2F 0D          		dcr c
0136+  CC30 CA 94 CC    		jz printCharS4
0137+  CC33 0D          		dcr c
0138+  CC34 CA 7C CC    		jz printCharS2
0139+  CC37 0D          		dcr c
0140+  CC38 CA 64 CC    		jz printCharS0
0141+  CC3B             
0142+  CC3B             ;----------------------------------------------------------------------------
0143+  CC3B             ; Ñäâèã íà 6
0144+  CC3B             
0145+  CC3B CD 3E CC    printCharS6:	CALL	printCharS6_0
0146+  CC3E 1F          printCharS6_0:	 RAR
0147+  CC3F 1F          		 RAR
0148+  CC40 1F          		 RAR
0149+  CC41 1F          		 RAR
0150+  CC42 F5          		 PUSH	PSW
0151+  CC43 E6 03       		  ANI	00000011b
0152+  CC45 4F          		  MOV	C, A
0153+  CC46 1A          		  LDAX	D
0154+  CC47 E6 FC       		  ANI	11111100b
0155+  CC49 A9          		  XRA	C
0156+  CC4A 12          		  STAX	D
0157+  CC4B 14          		  INR	D
0158+  CC4C F1          		 POP	PSW
0159+  CC4D 1F          		 RAR
0160+  CC4E E6 F0       		 ANI	11110000b
0161+  CC50 4F          		 MOV	C, A
0162+  CC51 1A          		 LDAX	D
0163+  CC52 E6 0F       		 ANI	00001111b
0164+  CC54 A9          		 XRA	C
0165+  CC55 12          		 STAX	D
0166+  CC56 15          		 DCR	D
0167+  CC57 13          		 INX	D
0168+  CC58 23          		 INX	H
0169+  CC59 3A 5C C6    		 LDA	v_clearScreenByte
0170+  CC5C AE          		 XRA	M
0171+  CC5D 05          		 DCR	B
0172+  CC5E C2 3E CC    		JNZ	printCharS6_0
0173+  CC61 C3 B8 CC    		JMP	drawChar_ll
0174+  CC64             
0175+  CC64             ;----------------------------------------------------------------------------
0176+  CC64             ; Ñäâèã íà 0
0177+  CC64             
0178+  CC64 CD 67 CC    printCharS0:    CALL	printCharS0_0
0179+  CC67             printCharS0_0:
0180+  CC67 87          		 ADD	A
0181+  CC68 87          		 ADD	A
0182+  CC69 4F          		 MOV	C, A
0183+  CC6A 1A          		 LDAX	D
0184+  CC6B E6 03       		 ANI	00000011b
0185+  CC6D A9          		 XRA	C
0186+  CC6E 12          		 STAX	D
0187+  CC6F 13          		 INX	D
0188+  CC70 23          		 INX	H
0189+  CC71 3A 5C C6    		 LDA	v_clearScreenByte
0190+  CC74 AE          		 XRA	M
0191+  CC75 05          		 DCR	B
0192+  CC76 C2 67 CC    		JNZ	printCharS0_0
0193+  CC79 C3 B8 CC    		JMP	drawChar_ll
0194+  CC7C             	
0195+  CC7C             ;----------------------------------------------------------------------------
0196+  CC7C             ; Ñäâèã íà 2
0197+  CC7C             
0198+  CC7C CD 7F CC    printCharS2:    CALL	printCharS2_0
0199+  CC7F E6 3F       printCharS2_0:	 ANI	03Fh
0200+  CC81 4F          		 MOV	C, A
0201+  CC82 1A          		 LDAX	D
0202+  CC83 E6 C0       		 ANI	11000000b
0203+  CC85 A9          		 XRA	C
0204+  CC86 12          		 STAX	D
0205+  CC87 13          		 INX	D
0206+  CC88 23          		 INX	H
0207+  CC89 3A 5C C6    		 LDA	v_clearScreenByte
0208+  CC8C AE          		 XRA	M
0209+  CC8D 05          		 DCR	B
0210+  CC8E C2 7F CC    		JNZ	printCharS2_0
0211+  CC91 C3 B8 CC    		JMP	drawChar_ll
0212+  CC94             
0213+  CC94             ;----------------------------------------------------------------------------
0214+  CC94             ; Ñäâèã íà 4
0215+  CC94             
0216+  CC94 CD 97 CC    printCharS4:	CALL	printCharS4_0
0217+  CC97 1F          printCharS4_0:	 RAR
0218+  CC98 1F          		 RAR
0219+  CC99 F5          		 PUSH	PSW
0220+  CC9A E6 0F       		  ANI	00001111b
0221+  CC9C 4F          		  MOV	C, A
0222+  CC9D 1A          		  LDAX	D
0223+  CC9E E6 F0       		  ANI	11110000b
0224+  CCA0 A9          		  XRA	C
0225+  CCA1 12          		  STAX	D
0226+  CCA2 14          		  INR	D
0227+  CCA3 F1          		 POP	PSW
0228+  CCA4 1F          		 RAR
0229+  CCA5 E6 C0       		 ANI	011000000b
0230+  CCA7 4F          		 MOV	C, A
0231+  CCA8 1A          		 LDAX	D
0232+  CCA9 E6 3F       		 ANI	000111111b
0233+  CCAB A9          		 XRA	C
0234+  CCAC 12          		 STAX	D
0235+  CCAD 15          		 DCR	D
0236+  CCAE 13          		 INX	D
0237+  CCAF 23          		 INX	H
0238+  CCB0 3A 5C C6    		 LDA	v_clearScreenByte
0239+  CCB3 AE          		 XRA	M
0240+  CCB4 05          		 DCR	B
0241+  CCB5 C2 97 CC    		JNZ	printCharS4_0
0242+  CCB8             
0243+  CCB8             ;----------------------------------------------------------------------------
0244+  CCB8             
0245+  CCB8 2B          drawChar_ll:	DCX	H
0246+  CCB9 AF          		XRA	A
0247+  CCBA B6          		ORA	M
0248+  CCBB 3A 5C C6    		LDA	v_clearScreenByte
0249+  CCBE F2 C2 CC    		JP	drawCharDbl2
0250+  CCC1 AE          		 XRA	M
0251+  CCC2 04          drawCharDbl2:	INR	B
0252+  CCC3 C9          		RET
0253+  CCC4             
0254+  CCC4             ;----------------------------------------------------------------------------
0255+  CCC4                 
0256+  CCC4 D6 21       printChar2:    sui	21h
0257+  CCC6 D2 DB D0    		jnc	setColorChar
0258+  CCC9 C6 19       		adi	19h
0259+  CCCB CA 06 D1    		jz	popColor	; 87h Âîññòàíîâíèå êîäà öâåòà èç ñòåêà
0260+  CCCE 3D          		dcr	a
0261+  CCCF CA F9 C7    		jz	pushColor	; 88h Çàïîìèíàíèå êîäà öâåòà ïî ïðèíöèïó ñòåêà (ãëóáèíà 2 öâåòà)
0262+  CCD2 3D          		dcr	a
0263+  CCD3 CA FB D0    		jz	inverseColor	; 89h Èíâåðñèÿ êîäà öâåòà
0264+  CCD6 3D          		dcr	a
0265+  CCD7 CA 59 CA    		jz	changeInverse	; 8Ah Èíâåðñèÿ ôîíà ÷åðíîáåëîãî ýêðàíà (èíâåðñèÿ èíâåðñèè)
0266+  CCDA 3D          		dcr	a
0267+  CCDB CA 5C CA    		jz	setInverseNeg	; 8Bh Óñòàíîâêà ñâåòëîãî ôîíà ÷åðíî-áåëîãî ýêðàíà (ïîòîìó ÷òî A=0 áóäåò èíâåðòèðîâàíî)
0268+  CCDE 3D          		dcr	a
0269+  CCDF CA 5D CA    		jz	setInverse	; 8Ñh Óñòàíîâêà òåìíîãî ôîíà ÷åðíî-áåëîãî ýêðàíà (ïîòîìó ÷òî A=0)
0270+  CCE2 3D          		dcr	a
0271+  CCE3 CA D6 C7    		jz	pushCursorLine	; 8Dh Çàïîìèíàíèå êóðñîðà ñòðîêè
0272+  CCE6 3D          		dcr	a
0273+  CCE7 CA DD C7    		jz	popCursorLine	; 8Eh Âîññòàíîâëåíèå êóðñîðà ñòðîêè
0274+  CCEA 3D          		dcr	a
0275+  CCEB CA 1E CA    		jz	clearTopLine	; 8Fh Î÷èñòêà âåðõíåé ñëóæåáíîé ñòðîêè
0276+  CCEE 3D          		dcr	a
0277+  CCEF CA 70 CA    		jz	clearBottomLine	; 90h Î÷èñòêà íèæíåé ñëóæåáíîé ñòðîêè
0278+  CCF2 3D          		dcr	a
0279+  CCF3 CA 28 CE    		jz	scrollDown	; 91h Ñäâèèã ýêðàíà âíèõ îò êóðñîðà
0280+  CCF6 3D          		dcr	a
0281+  CCF7 CA B1 CD    		jz	scrollUp	; 92h Ñäâèí ýêðàíà ââåðõ îò êóðñîðà
0282+  CCFA 3D          		dcr	a
0283+  CCFB CA E3 C7    		jz	pushCursor	; 93h Çàïîìèíàíèå êóðñîðà ýêðàíà
0284+  CCFE 3D          loc_CCC1: 	dcr	a
0285+  CCFF CA EA C7    		jz	popCursor	; 94h Âîññòàíîâëåíèå êóðñîðà ýêðàíà
0286+  CD02 3D          		dcr	a
0287+  CD03 CA B3 C8    		jz	printFileName	; 95h Âûâîä èìåíè ôàéëà çàãðóæåííîãî ñ äèñêà
0288+  CD06 3D          		dcr	a
0289+  CD07 EB          		xchg
0290+  CD08 2A 2C C6    		lhld	v_koi8
0291+  CD0B 3D          		dcr	a
0292+  CD0C CA 2A D0    		jz	c_koi7		; 97h Âêëþ÷åíèå ðåæèìå KOI-7
0293+  CD0F 3D          		dcr	a
0294+  CD10 CA 25 D0    		jz	c_koi8		; 98h Âêëþ÷åíèå ðåæèìå KOI-8
0295+  CD13 3D          		dcr	a
0296+  CD14 3D          		dcr	a
0297+  CD15 C0          		rnz			; Âûõîä, à äàëüøå 9Ah Ñäâèã ýêðàíà ââåðõ îò íèæíåé ñëóæåþíîé ñòðîêè äî òåêóùåé ñòðîêè êóðñîðà
0298+  CD16 EB          		xchg
0299+  CD17 E5          		push	h
0300+  CD18 2C          		inr	l
0301+  CD19 2C          		inr	l
0302+  CD1A 7D          		mov	a, l
0303+  CD1B C6 0A       		adi	0Ah
0304+  CD1D 5F          		mov	e, a
0305+  CD1E 3A 32 D2    		lda	v_screenHeight
0306+  CD21 C3 B9 CD    		jmp	c_scrolUpEx
0307+  CD24             
0308+  CD24             ; ---------------------------------------------------------------------------
0309+  CD24             
0310+  CD24 21 2A CD    printChar_esc:	lxi	h, printChar_esc1		
0311+  CD27 C3 3C CD    		jmp	setEscMode
0312+  CD2A             		
0313+  CD2A             ; ---------------------------------------------------------------------------
0314+  CD2A             
0315+  CD2A             printChar_esc1:	; Îáðàáîòêà ïåðâîãî ñèìâîëà ESC-ïîñëåäîâàòåëüíîñòè
0316+  CD2A             
0317+  CD2A             		; Åñëè ñèìâîë Y, ïåðåéòè ê îáðàáîòêå âòîðîãî ñèìâîëà
0318+  CD2A 79          		mov	a, c
0319+  CD2B FE 59       		cpi	'Y'
0320+  CD2D 21 40 CD    		lxi	h, printChar_esc2
0321+  CD30 CA 3C CD    		jz	setEscMode
0322+  CD33             
0323+  CD33 2A 3E C6    		lhld	v_cursorPos
0324+  CD36 CD 0D CC    		call	printChar_0
0325+  CD39             
0326+  CD39 21 AD CB    setEscMode0:	lxi	h, printChar_int
0327+  CD3C 22 A0 CB    setEscMode:	shld	printChar_pol+1
0328+  CD3F C9          		ret
0329+  CD40             
0330+  CD40             ; ---------------------------------------------------------------------------
0331+  CD40             
0332+  CD40             printChar_esc2:	; Âû÷åñòü èç áóêâû 20h
0333+  CD40 79          		mov	a, c
0334+  CD41 D6 20       		sui	20h
0335+  CD43 32 3E D2    		sta	v_escRow
0336+  CD46 21 4C CD    		lxi	h, printChar_esc3
0337+  CD49 C3 3C CD    		jmp	setEscMode		
0338+  CD4C             
0339+  CD4C             ; ---------------------------------------------------------------------------
0340+  CD4C             
0341+  CD4C             printChar_esc3:	; Âû÷åñòü èç áóêâû 20h
0342+  CD4C 79          		mov	a, c
0343+  CD4D D6 20       		sui	20h
0344+  CD4F 6F          		mov	l, a
0345+  CD50 3A 3E D2    		lda	v_escRow
0346+  CD53 67          		mov	h, a
0347+  CD54 CD 7C CD    		call	setCursorPos
0348+  CD57 C3 39 CD    		jmp	setEscMode0
0349+  CD5A             		0205   CD5A~            #else
0206   CD5A~            .include "printChar.inc"
0207   CD5A             #endif
0208   CD5A             .include "calcCharAddr.inc"
0001+  CD5A             ;----------------------------------------------------------------------------
0002+  CD5A             ; RAMFOS
0003+  CD5A             ; Ðàñ÷åò àðåñà ñèìâîëà â âèäåîïàìÿòè ïàìÿòè è çíàêîãåíåðàòîðå
0004+  CD5A             ;
0005+  CD5A             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  CD5A             ;----------------------------------------------------------------------------
0007+  CD5A             
0008+  CD5A             calcCharAddr2:	; Êàêàÿ òî õðåíü
0009+  CD5A 41          		mov	b, c
0010+  CD5B 32 10 D2    calcCharAddr3:	sta	v_dblClear
0011+  CD5E             
0012+  CD5E             		; hl = charGen + c * 8
0013+  CD5E D5          		push	d
0014+  CD5F 2A 0C C6    		 lhld	v_charGenPtr
0015+  CD62 EB          		 xchg
0016+  CD63 69          		 mov	l, c
0017+  CD64 26 00       		 mvi	h, 0
0018+  CD66 29          		 dad	h
0019+  CD67 29          		 dad	h
0020+  CD68 29          		 dad	h
0021+  CD69 19          		 dad	d
0022+  CD6A D1          		pop	d
0023+  CD6B             
0024+  CD6B             ; Ïîëó÷èòü àäðåñ è ñìåùåíèå ñèìâîëà íà ýêðàíå ïî êîîðäèíàòàì
0025+  CD6B             ; Âõîä: de - êîîðäèíàòû
0026+  CD6B             ; Âûõîä: de - àäðåñ, c - ñìåùåíèå
0027+  CD6B             		
0028+  CD6B             calcCharAddr:	; c = (d & 3)
0029+  CD6B 7A          		mov	a, d		
0030+  CD6C E6 03       		ani	3
0031+  CD6E 4F          		mov	c, a
0032+  CD6F 3E 05       		mvi	a, 5
0033+  CD71 91          		sub	c
0034+  CD72 4F          		mov	c, a
0035+  CD73             	
0036+  CD73             		; d = d / 4 + 0x90		
0037+  CD73 7A          		mov	a, d		
0038+  CD74 E6 FC       		ani	0FCh
0039+  CD76 0F          		rrc
0040+  CD77 0F          		rrc
0041+  CD78 C6 90       		adi	90h
0042+  CD7A 57          		mov	d, a
0043+  CD7B C9          		ret
0209   CD7C~            #if FAST_PRINT!=1
0210   CD7C~            .include "printChar2.inc"	; ¯à®¤®«¦ ¥âáï ¢ setCursorPos
0211   CD7C             #endif
0212   CD7C             .include "setCursorPos.inc"
0001+  CD7C             ;----------------------------------------------------------------------------
0002+  CD7C             ; RAMFOS
0003+  CD7C             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C83C
0004+  CD7C             ; Óñòàíâîêà/ïîëó÷åíèÿ ïîëîæåíèÿ êóðñîðà. Êîîðäèíàòû â ñèìâîëàõ.
0005+  CD7C             ;
0006+  CD7C             ; Íà âõîäå
0007+  CD7C             ;  H - íîìåð ñòðîêè
0008+  CD7C             ;  L - íîìåð êîëîíêè
0009+  CD7C             ;
0010+  CD7C             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0011+  CD7C             ;----------------------------------------------------------------------------
0012+  CD7C             
0013+  CD7C E5          setCursorPos:	push	h
0014+  CD7D F5          		push	psw
0015+  CD7E             
0016+  CD7E             		; Ïîìåíÿòü H L ìåñòàìè
0017+  CD7E 7D          		mov	a, l
0018+  CD7F 6C          		mov	l, h
0019+  CD80 67          		mov	h, a
0020+  CD81             
0021+  CD81             		; l = l * 10 - 2
0022+  CD81 3E FE       		mvi	a, -2
0023+  CD83 C6 0A       loc_CD1C:	 adi	10
0024+  CD85 2D          		 dcr	l
0025+  CD86 F2 83 CD    		jp	loc_CD1C
0026+  CD89 6F          		mov	l, a
0027+  CD8A             
0028+  CD8A             		; h *= 3
0029+  CD8A 3E FD       		mvi	a, -3
0030+  CD8C C6 03       loc_CD25:	 adi	3
0031+  CD8E 25          		 dcr	h
0032+  CD8F F2 8C CD    		jp	loc_CD25
0033+  CD92 67          		mov	h, a
0034+  CD93             
0035+  CD93             		; Ñîõðàíèòü ïîëîæåíèå êóðñîðà
0036+  CD93 22 3E C6    		shld	v_cursorPos
0037+  CD96             
0038+  CD96 F1          		pop	psw
0039+  CD97 E1          		pop	h
0040+  CD98 C9          		ret0213   CD99             .include "getCursorPos.inc"
0001+  CD99             ;+---------------------------------------------------------------------------
0002+  CD99             ; RAMFOS
0003+  CD99             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F81E	
0004+  CD99             ; Ïîëó÷èòü êîîðäèíàòû êóðñîðà â ñèìâîëàõ
0005+  CD99             ;
0006+  CD99             ; Íà âûõîäå
0007+  CD99             ;  h - ñòðîêà (Y)
0008+  CD99             ;  l - ñòîëáåö (X)
0009+  CD99             ;  Ñîõðàíÿåò îñòàëüíûå ðåãèñòðû
0010+  CD99             ;
0011+  CD99             ; 2013-11-01 vinxru
0012+  CD99             ;----------------------------------------------------------------------------                   
0013+  CD99             
0014+  CD99 F5          getCursorPos:	push	psw
0015+  CD9A 21 FF FF    		lxi	h, -1
0016+  CD9D             
0017+  CD9D             		; h = v_cursorPosY / 10
0018+  CD9D 3A 3E C6    		lda	v_cursorPos	
0019+  CDA0 24          getCursorPos_0:	 inr	h
0020+  CDA1 D6 0A       		 sui	0Ah
0021+  CDA3 D2 A0 CD    		jnc	getCursorPos_0
0022+  CDA6             
0023+  CDA6             		; l = v_cursorPosX / 3
0024+  CDA6 3A 3F C6    		lda	v_cursorPos+1			
0025+  CDA9 2C          getCursorPos_1:  inr	l
0026+  CDAA D6 03       		 sui	3
0027+  CDAC D2 A9 CD    		jnc	getCursorPos_1
0028+  CDAF             
0029+  CDAF F1          		pop	psw
0030+  CDB0 C9          		ret0214   CDB1             .include "scrollUp.inc"
0001+  CDB1             ;----------------------------------------------------------------------------
0002+  CDB1             ; RAMFOS
0003+  CDB1             ; Ñäâèã ýêðàíà ââåðõ
0004+  CDB1             ;
0005+  CDB1             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  CDB1             ;----------------------------------------------------------------------------
0007+  CDB1             
0008+  CDB1 E5          scrollUp:	push	h
0009+  CDB2 7D          		mov	a, l		; c =  (l + 2 -	word_D231)/2
0010+  CDB3             
0011+  CDB3 2A 30 D2    		lhld	v_topLineHeight
0012+  CDB6 5C          		mov	e, h		; e = word_D231
0013+  CDB7 3C          		inr	a
0014+  CDB8 3C          		inr	a
0015+  CDB9 93          c_scrolUpEx:	sub	e
0016+  CDBA 1F          		rar
0017+  CDBB 4F          		mov	c, a
0018+  CDBC             		; Àäðåñ âèäåî
0019+  CDBC 26 90       		mvi	h, 90h
0020+  CDBE 54          		mov	d, h
0021+  CDBF             		; Êîëîíêè		
0022+  CDBF 06 30       		mvi	b, 48
0023+  CDC1 E5          loc_CD5A:	 push	h
0024+  CDC2 D5          		 push	d
0025+  CDC3 C5          		 push	b
0026+  CDC4             		  ; Êîïèðóåì C áàéò
0027+  CDC4 0C          		  inr	c
0028+  CDC5 0D          		  dcr	c
0029+  CDC6 C4 E3 CD    		  cnz	memcpy_hl_de_c2
0030+  CDC9             		  ; Î÷èùàåì ïîñëåäíèå 10 áàéò
0031+  CDC9 3A 5C C6    		  lda	v_clearScreenByte
0032+  CDCC 0E 0A       		  mvi	c, 10
0033+  CDCE 77          loc_CD67:	   mov	m, a
0034+  CDCF 2C          		   inr	l
0035+  CDD0 0D          		   dcr	c
0036+  CDD1 C2 CE CD    		  jnz	loc_CD67
0037+  CDD4 C1          		 pop	b
0038+  CDD5 D1          		 pop	d
0039+  CDD6 E1          		 pop	h
0040+  CDD7             		 ; Ñëåäóþùàÿ êîëîíêà
0041+  CDD7 24          		 inr	h
0042+  CDD8 14          		 inr	d
0043+  CDD9 05          		 dcr	b
0044+  CDDA C2 C1 CD    		jnz	loc_CD5A
0045+  CDDD E1          		pop	h
0046+  CDDE             		; Óñòàíîâêà ïîëîæåíèÿ êóðñîðà	
0047+  CDDE 26 00       saveCursorPosX0:mvi	h, 0
0048+  CDE0 C3 BF CE    		jmp	saveCursorPos
0215   CDE3             .include "memcpy_hl_de_c2.inc"
0001+  CDE3 1A          memcpy_hl_de_c2:ldax	d
0002+  CDE4 77          		mov	m, a
0003+  CDE5 2C          		inr	l
0004+  CDE6 1C          		inr	e
0005+  CDE7 1A          		ldax	d
0006+  CDE8 77          		mov	m, a
0007+  CDE9 2C          		inr	l
0008+  CDEA 1C          		inr	e
0009+  CDEB 0D          		dcr	c
0010+  CDEC C2 E3 CD    		jnz	memcpy_hl_de_c2
0011+  CDEF C9          		ret
0216   CDF0             .include "cursor.inc"
0001+  CDF0             ;+---------------------------------------------------------------------------
0002+  CDF0             ; RAMFOS
0003+  CDF0             ; Ôóíêöèè ïåðåìåùåíèÿ êóðñîðà
0004+  CDF0             ;
0005+  CDF0             ; Íà âõîäå â êàæäóþ ôóíêöèþ HL äîëæåí ñîäåðæàòü v_cursorPos
0006+  CDF0             ;
0007+  CDF0             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0008+  CDF0             ;----------------------------------------------------------------------------
0009+  CDF0             
0010+  CDF0             cursorRight:	; Åñëè v_cursorX >= 190, òî ïåðåéòè íà íîâóþ ñòðîêó
0011+  CDF0 7C          		mov	a, h
0012+  CDF1 FE BE       		cpi	190
0013+  CDF3 D2 FC CD    		jnc	cursorCrLf
0014+  CDF6             
0015+  CDF6             		; v_cursorX += 3
0016+  CDF6 C6 03       		adi	3
0017+  CDF8 67          		mov	h, a
0018+  CDF9             
0019+  CDF9             		; Ñîõðàíèòü íîâîå ïîëîæåíèå êóðñîðà (shld v_cursorPos, ret)
0020+  CDF9 C3 BF CE    		jmp	saveCursorPos
0021+  CDFC             
0022+  CDFC             ; ---------------------------------------------------------------------------
0023+  CDFC             
0024+  CDFC             cursorCrLf:	; v_cursorX = 0
0025+  CDFC 26 00       		mvi	h, 0
0026+  CDFE             
0027+  CDFE             cursorDown:	; Åñëè v_cursorY > screenHeight+10, ñäâèíóòü ýêðàí ââåðõ
0028+  CDFE 3A 33 D2    		lda	v_screenHeight+1
0029+  CE01 BD          		cmp	l
0030+  CE02 DA B1 CD    		jc	scrollUp
0031+  CE05             
0032+  CE05             		; cursorY += 10
0033+  CE05 7D          		mov	a, l
0034+  CE06 C6 0A       		adi	10
0035+  CE08 6F          		mov	l, a
0036+  CE09             
0037+  CE09             		; Ñîõðàíèòü íîâîå ïîëîæåíèå êóðñîðà (shld v_cursorPos, ret)
0038+  CE09 C3 BF CE    		jmp	saveCursorPos
0039+  CE0C             
0040+  CE0C             ; ---------------------------------------------------------------------------
0041+  CE0C             
0042+  CE0C             cursorLeft:	; Åñëè êóðñîð ó ëåâîãî êðàÿ ýêðàíà, íè÷åãî íå äåëàòü
0043+  CE0C 7C          		mov	a, h
0044+  CE0D FE 02       		cpi	2
0045+  CE0F DA BF CE    		jc	saveCursorPos
0046+  CE12             
0047+  CE12             		; v_cursorX -= 3
0048+  CE12 D6 03       		sui	3
0049+  CE14 67          		mov	h, a
0050+  CE15             
0051+  CE15             		; Ñîõðàíèòü íîâîå ïîëîæåíèå êóðñîðà (shld v_cursorPos, ret)
0052+  CE15 C3 BF CE    		jmp	saveCursorPos
0053+  CE18             
0054+  CE18             ; ---------------------------------------------------------------------------
0055+  CE18             
0056+  CE18             cursorUp:	; Åñëè êóðñîð âûøå word_D231, òî ñäâèíóòü ýêðàí ââåðõ
0057+  CE18 3A 31 D2    		lda	v_topLineHeight+1
0058+  CE1B BD          		cmp	l
0059+  CE1C D2 26 CE    		jnc	scrollDownX0
0060+  CE1F             
0061+  CE1F             		; v_cursorY -= 10
0062+  CE1F 7D          		mov	a, l
0063+  CE20 D6 0A       		sui	10
0064+  CE22 6F          		mov	l, a
0065+  CE23             
0066+  CE23             		; Ñîõðàíèòü íîâîå ïîëîæåíèå êóðñîðà (shld v_cursorPos, ret)
0067+  CE23 C3 BF CE    		jmp	saveCursorPos0217   CE26             .include "scrollDown.inc"
0001+  CE26             ;----------------------------------------------------------------------------
0002+  CE26             ; RAMFOS
0003+  CE26             ; Ñäâèã ýêðàíà âíèç
0004+  CE26             ;
0005+  CE26             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  CE26             ;----------------------------------------------------------------------------
0007+  CE26             
0008+  CE26             scrollDownX0:	; x = 0
0009+  CE26 26 00       		mvi	h, 0	; Âëèÿåò íà ðàñ÷åò C, ñìîòðè íèæå
0010+  CE28             
0011+  CE28 E5          scrollDown:	push	h
0012+  CE29             		; c = cursorY - 8
0013+  CE29 7D          		mov	a, l
0014+  CE2A D6 08       		sui	8
0015+  CE2C             		; if(v_cursorX != 0) c += 10
0016+  CE2C 25          		dcr	h
0017+  CE2D 24          		inr	h
0018+  CE2E CA 33 CE    		jz	scrollDown_0
0019+  CE31 C6 0A       		  adi	10		  
0020+  CE33 4F          scrollDown_0:	mov	c, a
0021+  CE34             
0022+  CE34             		; l = v_screenHeight, e = h = v_screenHeight-10
0023+  CE34 2A 32 D2    		lhld	v_screenHeight
0024+  CE37 5C          		mov	e, h
0025+  CE38             
0026+  CE38             		; if(v_screenHeight < c) goto CDF9
0027+  CE38 7B          		mov	a, e
0028+  CE39 91          		sub	c
0029+  CE3A DA 60 CE    		jc	scrollDown_1
0030+  CE3D             
0031+  CE3D             		; ñ = (v_screenHeight - c) / 2
0032+  CE3D 1F          		rar
0033+  CE3E 4F          		mov	c, a
0034+  CE3F             
0035+  CE3F             		; Àäðåñ íà ýêðàíå. Äëÿ DE, HL èäåíòè÷íûé, ïîñêîëüêó áóäåò îòëè÷àòüñÿ E, L
0036+  CE3F 26 90       		mvi	h, 90h
0037+  CE41 54          		mov	d, h
0038+  CE42             
0039+  CE42             		; 48 ñòîëáöîâ
0040+  CE42 06 30       		mvi	b, 48
0041+  CE44 E5          scrollDown_2:	 push	h
0042+  CE45 D5          		 push	d
0043+  CE46 C5          		 push	b
0044+  CE47             		  ; Êîïèðóåì C ëèíèé
0045+  CE47 0C          		  inr	c
0046+  CE48 0D          		  dcr	c
0047+  CE49 C4 64 CE    		  cnz	memcpyb_hl_de_c2
0048+  CE4C             		  ; Âåðõíèå 10 ëèíèé î÷èùàåì
0049+  CE4C 3A 5C C6    		  lda	v_clearScreenByte
0050+  CE4F 0E 0A       		  mvi	c, 10		
0051+  CE51 2D          scrollDown_3:	   dcr	l
0052+  CE52 77          		   mov	m, a
0053+  CE53 0D          		   dcr	c
0054+  CE54 C2 51 CE    		  jnz	scrollDown_3
0055+  CE57 C1          		 pop	b
0056+  CE58 D1          		 pop	d
0057+  CE59 E1          		 pop	h
0058+  CE5A             		 ; Ñëåäóþùèé ñòîëáåö
0059+  CE5A 24          		 inr	h
0060+  CE5B 14          		 inr	d
0061+  CE5C 05          		 dcr	b
0062+  CE5D C2 44 CE    		jnz	scrollDown_2
0063+  CE60             
0064+  CE60             scrollDown_1:	; Âîññòàíàâëèâàì L, îí æå cursorY
0065+  CE60             		; cursorX, îí æå H áóäåò çàìåíåí 0 â ôóíêöèè saveCursorPosX0
0066+  CE60 E1          		pop	h
0067+  CE61 C3 DE CD    		jmp	saveCursorPosX0
0218   CE64             .include "memcpyb_hl_de_c2.inc"
0001+  CE64             memcpyb_hl_de_c2:
0002+  CE64 2D          		dcr	l
0003+  CE65 1D          		dcr	e
0004+  CE66 1A          		ldax	d
0005+  CE67 77          		mov	m, a
0006+  CE68             
0007+  CE68 2D          		dcr	l
0008+  CE69 1D          		dcr	e
0009+  CE6A 1A          		ldax	d
0010+  CE6B 77          		mov	m, a
0011+  CE6C             
0012+  CE6C 0D          		dcr	c
0013+  CE6D C2 64 CE    		jnz	memcpyb_hl_de_c2
0014+  CE70 C9          		ret
0219   CE71             .include "clearScreen.inc"
0001+  CE71             ;----------------------------------------------------------------------------
0002+  CE71             ; RAMFOS
0003+  CE71             ; Î÷èñòèòü ýêðàí
0004+  CE71             ;
0005+  CE71             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  CE71             ;----------------------------------------------------------------------------
0007+  CE71             
0008+  CE71             clearScreen:	
0009+  CE71             #if COLOR_SUPPORT
0010+  CE71             		; Öâåò ïî óìîë÷àíèþ
0011+  CE71 3E F1       		mvi	a, INIT_SCREEN_COLOR
0012+  CE73 CD FF D0    		call	setColor
0013+  CE76             #endif
0014+  CE76             clearScreen2:
0015+  CE76             		; Ñîõðàíÿåì SP
0016+  CE76 21 00 00    		lxi	h, 0
0017+  CE79 39          		dad	sp
0018+  CE7A 22 2D D2    		shld	v_oldSP
0019+  CE7D             
0020+  CE7D             		; Êîëîíêè
0021+  CE7D 06 30       		mvi	b, 48
0022+  CE7F             
0023+  CE7F             		; Áàéò äëÿ çàëèâêè ýêðàíà
0024+  CE7F 3A 5C C6    		lda	v_clearScreenByte
0025+  CE82 57          		mov	d, a
0026+  CE83 5F          		mov	e, a
0027+  CE84             
0028+  CE84             		; Çàëèâàåì ýêðàí. Íà÷èíàåì ñ 383,240.
0029+  CE84 21 F0 BF    		lxi	h, 0BFF0h
0030+  CE87 F9          loc_CE1B:	 sphl
0031+  CE88 0E 17       		 mvi	c, 17h		; 230 ñòðîê
0032+  CE8A D5          loc_CE1E:	  push	d
0033+  CE8B D5          		  push	d
0034+  CE8C D5          		  push	d
0035+  CE8D D5          		  push	d
0036+  CE8E D5          		  push	d
0037+  CE8F 0D          		  dcr	c
0038+  CE90 C2 8A CE    		 jnz	loc_CE1E
0039+  CE93 25          		dcr	h
0040+  CE94 05          		dcr	b
0041+  CE95 C2 87 CE    		jnz	loc_CE1B
0042+  CE98             
0043+  CE98             		; Âîññòàíàëèâàåì SP
0044+  CE98 2A 2D D2    		lhld	v_oldSP
0045+  CE9B F9          		sphl
0046+  CE9C             
0047+  CE9C             		; Äàëüøå ìàãèÿ ñ ïåðåìåííûìè è ñòðîêàìè ñîñòîÿíèÿ
0048+  CE9C             
0049+  CE9C             		; Ïðè ïå÷àòè äâîéíîãî ñèìâîëà 1F ñêðûâàåì íèæíþþ ñòðîêó
0050+  CE9C 21 10 D2    		lxi	h, v_dblClear
0051+  CE9F 3E 1F       		mvi	a, 1Fh
0052+  CEA1 BE          		cmp	m
0053+  CEA2 CC 8C CA    		cz	bottomLineHide	; Åñëè âûçâàíà, òî íà âûõîäå A=0		
0054+  CEA5 32 10 D2    		sta	v_dblClear
0055+  CEA8             
0056+  CEA8 3A 30 D2    		lda	v_topLineHeight
0057+  CEAB B7          		ora	a
0058+  CEAC CC C9 CE    		cz	clearTopLine2
0059+  CEAF             
0060+  CEAF 3A 32 D2    		lda	v_screenHeight
0061+  CEB2 FE FA       		cpi	250
0062+  CEB4 CC C3 CE    		cz	sub_CE57
0063+  CEB7             
0064+  CEB7             loc_CE4B:	; cursorX = 0
0065+  CEB7 26 00       		mvi	h, 0
0066+  CEB9             
0067+  CEB9             		; cursorY = byte_D231 - 2
0068+  CEB9 3A 31 D2    		lda	v_topLineHeight+1
0069+  CEBC 3D          		dcr	a
0070+  CEBD 3D          		dcr	a
0071+  CEBE 6F          		mov	l, a
0072+  CEBF             		
0073+  CEBF             saveCursorPos:	; Ñîõðàíèòü ïîëîæåíèå êóðñîðà
0074+  CEBF 22 3E C6    		shld	v_cursorPos
0075+  CEC2 C9          		ret
0076+  CEC3             
0077+  CEC3             ; ---------------------------------------------------------------------------
0078+  CEC3             
0079+  CEC3 11 10 00    sub_CE57:	lxi	d, 10h
0080+  CEC6 C3 CC CE    		jmp	clearLine	; d - ñòðîêà, e	- âûñîòà
0081+  CEC9             
0082+  CEC9             ; ---------------------------------------------------------------------------
0220   CEC9             .include "clearLine.inc"
0001+  CEC9             ;----------------------------------------------------------------------------
0002+  CEC9             ; RAMFOS
0003+  CEC9             ; Î÷èñòèòü âåðõíþþ ñòðîêó
0004+  CEC9             ;
0005+  CEC9             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  CEC9             ;----------------------------------------------------------------------------
0007+  CEC9             
0008+  CEC9 11 0A 0A    clearTopLine2:	lxi	d, 0A0Ah	; ñòðîêà 10, âûñîòà 10
0009+  CECC             
0010+  CECC             ;----------------------------------------------------------------------------
0011+  CECC             ; RAMFOS
0012+  CECC             ; Î÷èñòèòü ïðîèçâîëüíîå êîë-âî ñòðîê
0013+  CECC             ;
0014+  CECC             ; Íà âõîäå
0015+  CECC             ;  d - íîìåð ñòðîêè, âûøå êîòîðîé ñòðîêè áóäóò î÷èùåíû. Ñàìà ñòðîêà íå î÷èùàåòñÿ
0016+  CECC             ;  e - êîë-âî ñòðîê
0017+  CECC             ;
0018+  CECC             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0019+  CECC             ;----------------------------------------------------------------------------
0020+  CECC             
0021+  CECC 3A 5C C6    clearLine:	lda	v_clearScreenByte
0022+  CECF 26 90       		mvi	h, 90h			; Àäðåñ
0023+  CED1 06 30       		mvi	b, 48			; Êîë-âî ñòîëáöîâ
0024+  CED3 6A          clearRect_0:	 mov	l, d
0025+  CED4 4B          		 mov	c, e		
0026+  CED5 2D          clearRect_1:	  dcr	l
0027+  CED6 0D          		  dcr	c		
0028+  CED7 77          		  mov	m, a
0029+  CED8 2D          		  dcr	l
0030+  CED9 0D          		  dcr	c
0031+  CEDA 77          		  mov	m, a
0032+  CEDB C2 D5 CE    		 jnz	clearRect_1
0033+  CEDE 24          		 inr	h
0034+  CEDF 05          		 dcr	b
0035+  CEE0 C2 D3 CE    		jnz	clearRect_0
0036+  CEE3 C9          		ret		0221   CEE4             .include "keyWait.inc"
0001+  CEE4 E5          keyWait:	push	h
0002+  CEE5 D5          		push	d
0003+  CEE6 C5          		push	b
0004+  CEE7             		 ; Íàæàòà ëè êëàâèøà
0005+  CEE7 CD 31 CF    		 call	keyCheck
0006+  CEEA             		 ; Åñëè êëàâèøà íå íàæàòà, ìèãàåì êóðñîðîì, ïîêà íå íàæìóò
0007+  CEEA CC F9 CE    		 cz	keyCursor
0008+  CEED             		 ; Ñáðàñûàåì ôëàã v_key2
0009+  CEED AF          		 xra	a
0010+  CEEE 32 25 D2    		 sta	v_key2
0011+  CEF1             		 ; Íàæàòàÿ êëàâèøà â v_key1
0012+  CEF1 3A 2B D2    		 lda	v_key1
0013+  CEF4 C1          		pop	b		
0014+  CEF5 D1          popa_ora_a_ret:	pop	d
0015+  CEF6 E1          loc_CE8A:	pop	h
0016+  CEF7 B7          ora_a_ret:	ora	a
0017+  CEF8 C9          		ret
0222   CEF9             .include "keyCursor.inc"		
0001+  CEF9             ;----------------------------------------------------------------------------
0002+  CEF9             ; RAMFOS
0003+  CEF9             ; Îæèäàíèå íàæàòèÿ êëàâèøè è ðèñîâàíèå ìèãàþùåãî êóðñîðà
0004+  CEF9             ;
0005+  CEF9             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  CEF9             ;----------------------------------------------------------------------------
0007+  CEF9             
0008+  CEF9             keyCursor:	; Ðèñóåì êóðñîð XOR-îì
0009+  CEF9 CD 03 CF    		call	keyCursor1
0010+  CEFC             		; Ñòèðàåì êóðñîð XOR-îì
0011+  CEFC CD 03 CF    		call	keyCursor1
0012+  CEFF             		; Åñëè áûëà íàæàòà êëàâèàøà, âûõîäèì
0013+  CEFF C0          		rnz
0014+  CF00             		; Áåñêîíå÷íîå îæèäàíèå
0015+  CF00 C3 F9 CE    		jmp	keyCursor
0016+  CF03             
0017+  CF03             ;----------------------------------------------------------------------------
0018+  CF03             
0019+  CF03             keyCursor1:	
0020+  CF03~            #if FAST_PRINT != 1
0021+  CF03~            		; Êîä ñèìâîëà êóðñîðà
0022+  CF03~            		mvi	c, 17h
0023+  CF03~            
0024+  CF03~            		; Ïîëîæåíèå êóðñîðà â ïèêñåëÿõ 		
0025+  CF03~            		lhld	v_cursorPos
0026+  CF03~            		xchg
0027+  CF03~            
0028+  CF03~            		; Ïîëó÷åíèå èçîáðàæåíèÿ ñèìâîëà hl è àäðåñà â âèäåîïàìÿòè de
0029+  CF03~            		call	calcCharAddr2
0030+  CF03~            
0031+  CF03~            		; Êîððåêòèðîâêà àäðåñà
0032+  CF03~            		mov	a, e
0033+  CF03~            		sui	7
0034+  CF03~            		mov	e, a
0035+  CF03~            
0036+  CF03~            		; Ðèñîâàíèå êóðñîðà
0037+  CF03~            		call	drawChar
0038+  CF03             #else
0039+  CF03             		; Ïîëîæåíèå êóðñîðà â ïèêñåëÿõ 		
0040+  CF03 2A 3E C6    		lhld	v_cursorPos
0041+  CF06 EB          		xchg
0042+  CF07             
0043+  CF07             		; Ïîëó÷åíèå àäðåñà â âèäåîïàìÿòè de
0044+  CF07 CD 6B CD    		call calcCharAddr
0045+  CF0A             
0046+  CF0A             		; Èñõîäíûé ñèìâîë
0047+  CF0A 21 3F 00    		lxi	h, 3Fh		 
0048+  CF0D             
0049+  CF0D             		; Ñäâèãàåì
0050+  CF0D 79          		mov	a, c		
0051+  CF0E 29          drawCursor_0:	 dad	h
0052+  CF0F 29          		 dad	h
0053+  CF10 3D          		 dcr	a
0054+  CF11 C2 0E CF    		jnz	drawCursor_0
0055+  CF14             
0056+  CF14             		; Öèêë b
0057+  CF14 06 08       		mvi	b, 8
0058+  CF16             drawCursor_1:	 ; *de++ ^= hl
0059+  CF16 1A          		 ldax	d
0060+  CF17 AC          		 xra	h
0061+  CF18 12          		 stax	d		 
0062+  CF19 14          		 inr	d		 
0063+  CF1A 1A          		 ldax	d
0064+  CF1B AD          		 xra	l
0065+  CF1C 12          		 stax	d
0066+  CF1D 15          		 dcr	d
0067+  CF1E 1D          		 dcr	e		
0068+  CF1F             		 ; Öèêë
0069+  CF1F 05          		 dcr	b
0070+  CF20 C2 16 CF    		jnz	drawCursor_1
0071+  CF23             #endif
0072+  CF23             		; Æäåì íàæàòèÿ êëàâèøè
0073+  CF23 21 FF 02    		lxi	h, CURSOR_BLINK_SPEED
0074+  CF26 CD 31 CF    keyCursor1_0:	 call	keyCheck
0075+  CF29 C0          		 rnz
0076+  CF2A 2B          		 dcx	h
0077+  CF2B 7C          		 mov	a, h
0078+  CF2C B5          		 ora	l
0079+  CF2D C2 26 CF    		jnz	keyCursor1_0
0080+  CF30 C9          		ret0223   CF31             .include "keyCheck.inc"
0001+  CF31~            #if FAST_PRINT==0
0002+  CF31~            keyScanWhilePrint:
0003+  CF31~            		; Îáðàáîòêà êëàâèø âî âðåìÿ âûâîäà è ýõîïå÷àòü
0004+  CF31~            
0005+  CF31~            		; Åñëè v_cursorY=8 èëè 248, âûõîäèì 
0006+  CF31~            		mov	a, e
0007+  CF31~            		cpi	8
0008+  CF31~            		rz
0009+  CF31~            		cpi	248
0010+  CF31~            		rz
0011+  CF31~            
0012+  CF31~            		; Åñëè âêëþ÷åí ýõî ðåæèì íà ïðèíòåð
0013+  CF31~            		lda	v_printerEcho
0014+  CF31~            		cpi	0D2h
0015+  CF31~            		jz	doPrinterEcho
0016+  CF31             #endif
0017+  CF31             		
0018+  CF31             keyCheck:
0019+  CF31             		; Êàêîé òî ôëàã
0020+  CF31 3A 25 D2    		lda	v_key2
0021+  CF34 B7          		ora	a
0022+  CF35 C0          		rnz
0023+  CF36             
0024+  CF36             		; ×òî òî ñ÷èòàåì
0025+  CF36 E5          		push	h
0026+  CF37 D5          		push	d
0027+  CF38 2A 29 D2    		 lhld	v_key0
0028+  CF3B EB          		 xchg
0029+  CF3C 2A 2B D2    		 lhld	v_key1
0030+  CF3F CD 4F CF    		 call	sub_CEE2
0031+  CF42 22 2B D2    		 shld	v_key1	; Íàæàòàÿ êëàâèøà â L
0032+  CF45 EB          		 xchg
0033+  CF46 22 29 D2    		 shld	v_key0
0034+  CF49 32 25 D2    		 sta	v_key2
0035+  CF4C             
0036+  CF4C             		; pop d
0037+  CF4C             		; pop h
0038+  CF4C             		; ora a
0039+  CF4C             		; ret
0040+  CF4C C3 F5 CE    		jmp	popa_ora_a_ret
0041+  CF4F             
0042+  CF4F             ; ---------------------------------------------------------------------------
0043+  CF4F             
0044+  CF4F             sub_CEE2:	; Ïîëó÷èòü êîä íàæàòîé êëàâèøè
0045+  CF4F CD 75 CF    		call	keyScan
0046+  CF52             
0047+  CF52             		; Åñëè íàæàòàÿ êëàâèøà íå L
0048+  CF52 BD          		cmp	l
0049+  CF53 6F          		mov	l, a
0050+  CF54 C2 6E CF    		jnz	loc_CF01
0051+  CF57             
0052+  CF57             		; Åñëè êëàâèøà íå áûëà íàæàòà, âûõîäèì ñ êîäîì 0
0053+  CF57 3C          		inr	a
0054+  CF58 C8          		rz
0055+  CF59             
0056+  CF59             		; Óìåíüøàåì DE, è åñëè îí íå íóëåâîé, âûõîäèì ñ êîäîì 0
0057+  CF59 1B          		dcx	d
0058+  CF5A 7A          		mov	a, d
0059+  CF5B B3          		ora	e
0060+  CF5C 3E 00       		mvi	a, 0
0061+  CF5E C0          		rnz
0062+  CF5F             
0063+  CF5F             		; Çâóêîâîé ñèãíàë
0064+  CF5F CD 44 D0    		call	keySound
0065+  CF62             
0066+  CF62             		; Èíèöèàëèçèðóåì ñ÷åò÷èê
0067+  CF62 11 7C 01    		lxi	d, 17Ch
0068+  CF65             
0069+  CF65             		; Åñëè H=0, âûõîäèì ñ êîäîì 0FFh
0070+  CF65 25          		dcr	h
0071+  CF66 3E FF       		mvi	a, 0FFh
0072+  CF68 C8          		rz
0073+  CF69             
0074+  CF69             		; Âîçâðàùàåì H
0075+  CF69 24          		inr	h
0076+  CF6A             
0077+  CF6A             		; Èíèöèàëèçèðóåì ñ÷åò÷èê
0078+  CF6A 11 1C 00    		lxi	d, 1Ch
0079+  CF6D C9          		ret
0080+  CF6E             ; ---------------------------------------------------------------------------
0081+  CF6E             
0082+  CF6E             loc_CF01:	; Çàïèñûâàåì H=1
0083+  CF6E 26 01       		mvi	h, 1
0084+  CF70             
0085+  CF70             		; Âûõîäèì ñ êîäîì 0
0086+  CF70 AF          		xra	a        	
0087+  CF71             
0088+  CF71             		; Èíèöèàëèçèðóåì ñ÷åò÷èê
0089+  CF71 11 30 00    		lxi	d, 30h
0090+  CF74 C9          		ret
0091+  CF75             
0092+  CF75             ; ---------------------------------------------------------------------------
0224   CF75             .include "keyScan.inc"		; ¯à®¤®«¦ ¥âáï ¢ keySound
0001+  CF75             keyScan:		; Ñîõðàíÿåì ðåãèñòðû BC, DE, HL
0002+  CF75 E5          		push	h
0003+  CF76 D5          		push	d
0004+  CF77 C5          		push	b
0005+  CF78 CD 91 CF    		 call	keyScan_0
0006+  CF7B C1          		pop	b
0007+  CF7C D1          		pop	d
0008+  CF7D E1          		pop	h
0009+  CF7E             
0010+  CF7E             		; Ôëàã Z
0011+  CF7E B7          		ora	a
0012+  CF7F             		
0013+  CF7F             keyMode82:	; Âîññòàíàëèâàåì èíäèêàòîð ÐÓÑ/LAT
0014+  CF7F             		; Âûçûâàåòñÿ èç biosinit.inc
0015+  CF7F             
0016+  CF7F             		; Ñîõðàíÿåì ðåçóëüòàò
0017+  CF7F F5          		push	psw
0018+  CF80             		 ; Äàëåå óñòàíàëèâàåì ðåæèì êëàâèàòóðû 82h
0019+  CF80 3E 82       		 mvi	a, 82h
0020+  CF82 32 E3 FF    		 sta	IO_KEYB_MODE
0021+  CF85             		 ; Óñòàíàëèâàåì ñâåòîäèîä ÐÓÑ/ËÀÒ
0022+  CF85 3A 2D C6    		 lda	v_rusLat
0023+  CF88 E6 01       		 ani	1
0024+  CF8A F6 0C       		 ori	0Ch
0025+  CF8C 32 E3 FF    		 sta	IO_KEYB_MODE
0026+  CF8F F1          		pop	psw
0027+  CF90             
0028+  CF90 C9          		ret
0029+  CF91             
0030+  CF91             ; ---------------------------------------------------------------------------
0031+  CF91             
0032+  CF91             keyScan_0:	; Ïîëó÷àåì íîìåð ðÿäà íàæàòîé êëàâèøè â B
0033+  CF91 CD 7F CF    		call	keyMode82
0034+  CF94 3A E1 FF    		lda	IO_KEYB_B
0035+  CF97 47          		mov	b, a
0036+  CF98             
0037+  CF98             		; Åñëè íè îäíà êëàâèøà íå íàæàòà, âûõîäèì
0038+  CF98 F6 03       		ori	3
0039+  CF9A FE FF       		cpi	0FFh
0040+  CF9C C8          		rz
0041+  CF9D             
0042+  CF9D             		; Ïîëó÷àåì íîìåð êîëîíêè íàæàòîé êëàâèøè â HL
0043+  CF9D 3E 91       		mvi	a, 91h
0044+  CF9F 32 E3 FF    		sta	IO_KEYB_MODE
0045+  CFA2 3A E0 FF    		lda	IO_KEYB_A
0046+  CFA5 6F          		mov	l, a		
0047+  CFA6 3A E2 FF    		lda	IO_KEYB_C
0048+  CFA9 F6 F0       		ori	0F0h
0049+  CFAB 67          		mov	h, a
0050+  CFAC             
0051+  CFAC             		; Åñëè êîëîíêà íå íàæàòà èëè íàæàòà îñîáàÿ êîìáèíàöèÿ, âûõîäèì.
0052+  CFAC             		; Ïðè ýòîì ìîæåò áûòü âîçâðàùåíà åðóíäà!
0053+  CFAC BD          		cmp	l
0054+  CFAD C8          		rz
0055+  CFAE             		
0056+  CFAE             		; Ïîìåùàåì â L íîìåð ïåðâîãî íóëåâîãî áèòà èç HL
0057+  CFAE 3E FB       		mvi	a, 0FBh
0058+  CFB0 3C          keyScan_1:	 inr	a
0059+  CFB1 29          		 dad	h
0060+  CFB2 DA B0 CF    		 jc	keyScan_1
0061+  CFB5 6F          		mov	l, a
0062+  CFB6             
0063+  CFB6             		; Ïîìåùàåì â Ñ íîìåð ïåðâîãî íóëåâîãî áèòà èç B
0064+  CFB6 78          		mov	a, b
0065+  CFB7 F6 03       		ori	3
0066+  CFB9 37          		stc
0067+  CFBA 0E FD       		mvi	c, 0FDh
0068+  CFBC 0C          keyScan_2:	 inr	c
0069+  CFBD 1F          		 rar
0070+  CFBE DA BC CF    		jc	keyScan_2
0071+  CFC1             
0072+  CFC1             		; Åñëè íàæàòî áîëåå îäíîé êíîïêè
0073+  CFC1 3C          		inr	a
0074+  CFC2 C2 33 D0    		jnz	specialKeysRet
0075+  CFC5             
0076+  CFC5             		; b = !b & 2
0077+  CFC5 78          		mov	a, b
0078+  CFC6 2F          		cma
0079+  CFC7 E6 02       		ani	2
0080+  CFC9 47          		mov	b, a
0081+  CFCA             
0082+  CFCA 79          		mov	a, c
0083+  CFCB 07          		rlc
0084+  CFCC 07          		rlc
0085+  CFCD 07          		rlc
0086+  CFCE 07          		rlc
0087+  CFCF B5          		ora	l
0088+  CFD0             
0089+  CFD0             		; a = keybMap[a]
0090+  CFD0 5F          		mov	e, a		
0091+  CFD1 16 00       		mvi	d, 0
0092+  CFD3 2A 0E C6    		lhld	v_keybMap
0093+  CFD6 19          		dad	d
0094+  CFD7 7E          		mov	a, m
0095+  CFD8             
0096+  CFD8             		; Ñîõðàíÿåì íà áóäóùåå
0097+  CFD8 4F          		mov	c, a		; c = a
0098+  CFD9             
0099+  CFD9             		; if(a < 0x21) return;
0100+  CFD9 FE 21       		cpi	21h
0101+  CFDB D8          		rc
0102+  CFDC             
0103+  CFDC             		; Ñïåöèàëüíûå êëàâèøè
0104+  CFDC FE 8B       		cpi	8Bh
0105+  CFDE CA 5A C8    		jz	j_tapeMode
0106+  CFE1 FE 8C       		cpi	8Ch
0107+  CFE3 CA 57 C8    		jz	j_printerEchoMode
0108+  CFE6             
0109+  CFE6 2A 2C C6    		lhld	v_koi8
0110+  CFE9             
0111+  CFE9 FE 81       		cpi	81h
0112+  CFEB CA 9D D0    		jz	capsLock
0113+  CFEE FE 8A       		cpi	8Ah
0114+  CFF0 CA 2D D0    		jz	inverseVideo
0115+  CFF3 FE 40       		cpi	40h
0116+  CFF5 DA 1B D0    		jc	pressed40
0117+  CFF8             
0118+  CFF8 3A 2E C6    		lda	v_capsLock
0119+  CFFB A8          		xra	b
0120+  CFFC 47          		mov	b, a
0121+  CFFD 79          		mov	a, c
0122+  CFFE 24          		inr	h
0123+  CFFF CA 10 D0    		jz	loc_CFA3
0124+  D002 05          		dcr	b
0125+  D003 F8          		rm
0126+  D004 C6 20       		adi	20h ; ' '
0127+  D006 2C          		inr	l
0128+  D007 C0          		rnz
0129+  D008 C6 A0       		adi	0A0h ; 'à'
0130+  D00A FE 08       		cpi	8
0131+  D00C D0          		rnc
0132+  D00D C6 7F       		adi	7Fh ; ''
0133+  D00F C9          		ret
0134+  D010             
0135+  D010             ; ---------------------------------------------------------------------------
0136+  D010             
0137+  D010 C6 20       loc_CFA3:	adi	20h ; ' '
0138+  D012 2C          		inr	l
0139+  D013 C8          		rz
0140+  D014 C6 60       		adi	60h ; '`'
0141+  D016 05          		dcr	b
0142+  D017 F0          		rp
0143+  D018 C6 20       		adi	20h ; ' '
0144+  D01A C9          		ret
0145+  D01B             
0146+  D01B             ; ---------------------------------------------------------------------------
0147+  D01B             
0148+  D01B 05          pressed40:	dcr	b
0149+  D01C F8          		rm
0150+  D01D D6 10       		sui	10h
0151+  D01F FE 20       		cpi	20h ; ' '
0152+  D021 D0          		rnc
0153+  D022 C6 20       		adi	20h ; ' '
0154+  D024 C9          		ret
0155+  D025             
0156+  D025             ; ---------------------------------------------------------------------------
0157+  D025             
0158+  D025             c_koi8:					; CODE XREF: ROM:CCD3j
0159+  D025 7D          		mov	a, l
0160+  D026 2F          		cma
0161+  D027 C3 2B D0    		jmp	loc_CFBE
0162+  D02A             ; ---------------------------------------------------------------------------
0163+  D02A             
0164+  D02A             c_koi7:					; CODE XREF: ROM:CCCFj
0165+  D02A 7D          		mov	a, l
0166+  D02B             
0167+  D02B B7          loc_CFBE:	ora	a
0168+  D02C C0          		rnz
0169+  D02D             
0170+  D02D 7D          inverseVideo:	mov	a, l		; l = ~l;
0171+  D02E 2F          		cma
0172+  D02F 6F          		mov	l, a
0173+  D030             
0174+  D030 22 2C C6    capsLockRet:    shld	v_koi8
0175+  D033             
0176+  D033             specialKeysRet:	; Åñëè íå íå âûâîäèì â ñòðêîó ñòàòóñà, îáíîâèòü å¸
0177+  D033 3A 3E C6    		lda	v_cursorPos
0178+  D036 FE 08       		cpi	8
0179+  D038 C4 32 CA    		cnz	printIndicators
0180+  D03B             
0181+  D03B             		; Çàäåæêà
0182+  D03B 21 00 40    		lxi	h, 4000h	
0183+  D03E 2B          keyScan_delay:	 dcx	h
0184+  D03F 7C          		 mov	a, h
0185+  D040 B5          		 ora	l
0186+  D041 C2 3E D0    		jnz	keyScan_delay
0187+  D044             
0188+  D044             		; Ïåðåõîä íà keySound
0225   D044             .include "keySound.inc"
0001+  D044             ;----------------------------------------------------------------------------
0002+  D044             ; RAMFOS
0003+  D044             ; Çâóêîâîé ñèãíàë ïðè íàæàòèè êëàâèøè
0004+  D044             ;
0005+  D044             ; 2013-11-01 vinxru
0006+  D044             ;----------------------------------------------------------------------------
0007+  D044             
0008+  D044 C5          keySound:	push	b
0009+  D045 EB          		 xchg
0010+  D046 2A 4C C6    		 lhld	v_beepConfig
0011+  D049 EB          		 xchg
0012+  D04A             
0013+  D04A 3A 2D C6    		 lda	v_rusLat
0014+  D04D E6 01       		 ani	1
0015+  D04F 7A          		 mov	a, d
0016+  D050 C2 54 D0    		 jnz	keySound_0
0017+  D053 0F          		  rrc
0018+  D054 57          keySound_0:	 mov	d, a
0019+  D055             
0020+  D055 43          		 mov	b, e
0021+  D056 4B          		 mov	c, e
0022+  D057 B7          		 ora	a
0023+  D058 CD 86 D0    		 call	setTimer
0024+  D05B C1          		pop	b
0025+  D05C             
0026+  D05C 3E FF       		mvi	a, 0FFh
0027+  D05E C9          		ret
0226   D05F             .include "oldbeep.inc"
0001+  D05F             ;+---------------------------------------------------------------------------
0002+  D05F             ; RAMFOS
0003+  D05F             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C851
0004+  D05F             ; Âîñïðîèçâåñòè çâóêîâîé ñèãíàë ÷åðåç ÂÂ55
0005+  D05F             ;
0006+  D05F             ; ×àñòîòà çàäàåòñÿ â v_oldBeep
0007+  D05F             ;
0008+  D05F             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0009+  D05F             ;----------------------------------------------------------------------------
0010+  D05F             
0011+  D05F F5          oldBeep:	push	psw
0012+  D060 C5          		push	b
0013+  D061 E5          		push	h
0014+  D062 2A 4E C6    		 lhld	v_oldBeep
0015+  D065 3E 0B       oldBeep_0:	 mvi	a, 0Bh
0016+  D067 32 E3 FF    		  sta	IO_KEYB_MODE
0017+  D06A CD 7D D0    		  call	delay_l
0018+  D06D 3E 0A       		  mvi	a, 0Ah
0019+  D06F 32 E3 FF    		  sta	IO_KEYB_MODE
0020+  D072 CD 7D D0    		  call	delay_l
0021+  D075 25          		  dcr	h
0022+  D076 C2 65 D0    		 jnz	oldBeep_0
0023+  D079 E1          		pop	h
0024+  D07A C1          		pop	b
0025+  D07B F1          		pop	psw
0026+  D07C C9          		ret
0227   D07D             .include "delay_l.inc"
0001+  D07D             ;+---------------------------------------------------------------------------
0002+  D07D             ; RAMFOS
0003+  D07D             ; Çàäåðæêà
0004+  D07D             ;
0005+  D07D             ; Íà âõîäå
0006+  D07D             ;  L - äëèòåëüíîñòü
0007+  D07D             ;
0008+  D07D             ; Íà âûõîäå
0009+  D07D             ;  B - 0
0010+  D07D             ;
0011+  D07D             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0012+  D07D             ;----------------------------------------------------------------------------
0013+  D07D             
0014+  D07D 45          delay_l:	mov	b, l
0015+  D07E 05          delay_l_0:	dcr	b
0016+  D07F C2 7E D0    		jnz	delay_l_0
0017+  D082 C9          		ret
0228   D083             .include "beep.inc"
0001+  D083             ;+---------------------------------------------------------------------------
0002+  D083             ; RAMFOS
0003+  D083             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C848
0004+  D083             ; Âîñïðîèçâåñòè çâóêîâîé ñèãíàë ÷åðåç ÂÈ53
0005+  D083             ;
0006+  D083             ; Íà âõîäå:
0007+  D083             ;  de - ÷àñòîòà
0008+  D083             ;  bñ - äëèòåëüíîñòü
0009+  D083             ;  ñ  - æäàòü çàâåðøåíèÿ ïðåäûäóùåãî çâóêîâîãî ñèãíàëà
0010+  D083             ;  z  - æäàòü çàâåðøåíèÿ ýòîãî çâóêîâîãî ñèãíàëà
0011+  D083             ;
0012+  D083             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0013+  D083             ;----------------------------------------------------------------------------
0014+  D083             
0015+  D083             beep:		; Îæèäàíèå çàâåðåíèÿ ïðîøëîãî çâóêîâîãî ñèãíàëà, åñëè C
0016+  D083 DC 92 D0    		cc	waitBeep		
0017+  D086             
0018+  D086             		; de-÷àñòîòà, bñ-äëèòåëüíîñòü, z-æäàòü
0019+  D086 E5          setTimer:	push	h
0020+  D087 21 EC FF    		 lxi	h, IO_TIMER
0021+  D08A 73          		 mov	m, e
0022+  D08B 72          		 mov	m, d
0023+  D08C 23          		 inx	h
0024+  D08D 23          		 inx	h
0025+  D08E 71          		 mov	m, c
0026+  D08F 70          		 mov	m, b
0027+  D090 E1          		pop	h
0028+  D091             
0029+  D091             		; Îæèäàíèå çàâåðåíèÿ ýòîãî çâóêîâîãî ñèãíàëà, åñëè Z
0030+  D091 C0          		rnz
0031+  D092             
0032+  D092             waitBeep:	; Îæèäàíèå çàâåðåíèÿ çâóêîâîãî ñèãíàëà
0033+  D092 F5          		push	psw		
0034+  D093 3A E4 FF    waitBeep_0:	 lda	IO_EXT_A
0035+  D096 E6 01       		 ani	1
0036+  D098 CA 93 D0    		jz	waitBeep_0
0037+  D09B F1          		pop	psw
0038+  D09C C9          		ret0229   D09D             .include "capsLock.inc"
0001+  D09D             ;+---------------------------------------------------------------------------
0002+  D09D             ; RAMFOS
0003+  D09D             ; Íàæàòèå íà êëàâèøó CAPS LOCK
0004+  D09D             ;
0005+  D09D             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  D09D             ;----------------------------------------------------------------------------
0007+  D09D             
0008+  D09D 05          capsLock:	dcr	b
0009+  D09E F2 A7 D0    		jp	capsLock1
0010+  D0A1 7C          		 mov	a, h
0011+  D0A2 2F          		 cma
0012+  D0A3 67          		 mov	h, a
0013+  D0A4 C3 30 D0    		jmp	capsLockRet
0014+  D0A7             
0015+  D0A7             ; ---------------------------------------------------------------------------
0016+  D0A7             
0017+  D0A7 3A 2E C6    capsLock1:	lda	v_capsLock
0018+  D0AA EE 02       		xri	2
0019+  D0AC 32 2E C6    		sta	v_capsLock
0020+  D0AF C3 33 D0    		jmp	specialKeysRet
0230   D0B2             .include "tapeMode.inc"
0001+  D0B2             ;+---------------------------------------------------------------------------
0002+  D0B2             ; RAMFOS
0003+  D0B2             ; Ïåðåêëþ÷åíèå ñêîðîñòè çàïèñè íà ìàãíèòîôîí è ðåæèìà ïðèíòåðà
0004+  D0B2             ; Âûçûâàåòñÿ ïðè íàæàòèè íà ñîîòâåòñòâóþùóþ êëàâèøó
0005+  D0B2             ;
0006+  D0B2             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  D0B2             ;----------------------------------------------------------------------------
0008+  D0B2             
0009+  D0B2             tapeMode:	; Ýòà õèòðàÿ ïðîãðàììà ïðîñòî îáìåíèâàåò ìåñòàìè
0010+  D0B2             		; v_tapePulseB,A -> v_tapePulseB1,A1 -> v_tapePulseB2,A2
0011+  D0B2 16 04       		mvi	d, 4			; Íàäî ñäâèíóòü 4 áàéòà
0012+  D0B4 1E 0B       tapeMode_0:	 mvi	e, 11			; Äëèíà âñåãî ìàññèâà 12 áàéò
0013+  D0B6 21 6B C6    		 lxi	h, v_tapePresets-1	; Êîíåö ìàññèâà
0014+  D0B9 3A 60 C6    		 lda	v_tapePulseB		; Çàãðóæàåì ïåðâîå çíà÷åíèå, êîòîðîå ñðàçó æå ïîìåñòèì â êîíåö
0015+  D0BC 4F          tapeMode_1:	  mov	c, a			; Ñäâèãàåì 11 áàéò
0016+  D0BD 7E          		  mov	a, m
0017+  D0BE 71          		  mov	m, c
0018+  D0BF 2B          		  dcx	h
0019+  D0C0 1D          		  dcr	e
0020+  D0C1 C2 BC D0    		 jnz	tapeMode_1
0021+  D0C4 77          		 mov	m, a			; È ñîõðàíÿåì 12 áàéò. Ïðîøëîå çíà÷åíèå ìû óæå ïîìåñòèëè â íà÷àëî ìàññèâà
0022+  D0C5 15          		 dcr	d			; Ïîâòîðÿåì ýòî 4 ðàçà
0023+  D0C6 C2 B4 D0    		jnz	tapeMode_0
0024+  D0C9             
0025+  D0C9             		; Ìåíÿåì ïåðåìåííóþ v_tapeMode '0'->'1'->'2'->'0'
0026+  D0C9 3A 5F C6    		lda	v_tapeMode
0027+  D0CC 3C          		inr	a
0028+  D0CD FE 33       		cpi	'3'
0029+  D0CF C2 D4 D0    		jnz	tapeMode_2
0030+  D0D2 3E 30       		 mvi	a, '0'
0031+  D0D4 32 5F C6    tapeMode_2:	sta	v_tapeMode
0032+  D0D7             
0033+  D0D7             		; Âîçâðàùàåìñÿ â ôóíêöèþ îïðîñà êëàâèàòóðû
0034+  D0D7 C3 33 D0    		jmp	specialKeysRet
0231   D0DA             .include "printerEchoMode.inc"
0001+  D0DA             ;----------------------------------------------------------------------------
0002+  D0DA             ; RAMFOS
0003+  D0DA             ; Âêëþ÷åíèå/âûêëþ÷åíèå ýõîïå÷àòè íà ïðèíòåð
0004+  D0DA             ; Âûçûâàåòñÿ ïðè íàæàòèè íà ñîîòâåòñòâóþùóþ êëàâèøó
0005+  D0DA             ;
0006+  D0DA             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  D0DA             ;----------------------------------------------------------------------------
0008+  D0DA             
0009+  D0DA~            #if NO_PRINTER==0
0010+  D0DA~            
0011+  D0DA~            printerEchoMode:lxi	h, v_printerEcho
0012+  D0DA~            		mvi	a, 0D2h
0013+  D0DA~            		cmp	m
0014+  D0DA~            		jnz	printerEchoMode_0
0015+  D0DA~            		 xra	a
0016+  D0DA~            printerEchoMode_0:
0017+  D0DA~            		mov	m, a
0018+  D0DA~            		jmp	specialKeysRet
0019+  D0DA             #endif0232   D0DA             .include "printerHex.inc"
0001+  D0DA             ;+---------------------------------------------------------------------------
0002+  D0DA             ; RAMFOS
0003+  D0DA             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C842
0004+  D0DA             ; Ïå÷àòü 16-ðè÷íîãî ÷èñëà íà ïðèíòåðå
0005+  D0DA             ;
0006+  D0DA             ; Íà âõîäå
0007+  D0DA             ;  A - ÷èñëî
0008+  D0DA             ;
0009+  D0DA             ; Âñå ðåãèñòðû ñîõðàíÿþòñÿ
0010+  D0DA             ;
0011+  D0DA             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0012+  D0DA             ;----------------------------------------------------------------------------
0013+  D0DA             
0014+  D0DA~            #if NO_PRINTER==0
0015+  D0DA~            
0016+  D0DA~            printerHex:	push	psw
0017+  D0DA~            		 rrc
0018+  D0DA~            		 rrc
0019+  D0DA~            		 rrc
0020+  D0DA~            		 rrc
0021+  D0DA~            		 call	printerHex_1
0022+  D0DA~            		pop	psw
0023+  D0DA~            printerHex_1:	push	psw
0024+  D0DA~            		 ani	0Fh
0025+  D0DA~            		 cpi	10
0026+  D0DA~            		 jm	printerHex_2
0027+  D0DA~            		  adi	'A'-'0'-10		  
0028+  D0DA~            printerHex_2:	 adi	'0'
0029+  D0DA~            		 push	b
0030+  D0DA~            		  mov	c, a
0031+  D0DA~            		  call	printer
0032+  D0DA~            		 pop	b
0033+  D0DA~            		pop	psw
0034+  D0DA~            		ret
0035+  D0DA~            
0036+  D0DA             #endif0233   D0DA             .include "printerEcho.inc"
0001+  D0DA             ;----------------------------------------------------------------------------
0002+  D0DA             ; RAMFOS
0003+  D0DA             ; Ýõîïå÷àòü íà ïðèíòåðå
0004+  D0DA             ;
0005+  D0DA             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  D0DA             ;----------------------------------------------------------------------------
0007+  D0DA             
0008+  D0DA~            #if NO_PRINTER==0
0009+  D0DA~            
0010+  D0DA~            printerEcho_crLf:
0011+  D0DA~            		; Â ñóììå êîä íèæå çàìåíÿåò 0A èëè 0D íà ïàðó 0A, 0D. 
0012+  D0DA~            		; Íî â ñëó÷àå "0A ëþáûå ñèìâîëû 0D", ïîñëåíèé íå äóáëèðóåòñÿ
0013+  D0DA~            
0014+  D0DA~            		; Âìåñòî 0A, òî ïå÷àòàåì ïàðó ñèìâîëîâ 0A, 0D.
0015+  D0DA~            		lxi	h, v_printerCrLf
0016+  D0DA~            		cpi	0Ah
0017+  D0DA~            		jz	printerEcho_0
0018+  D0DA~            
0019+  D0DA~            		; Âìåñòî 0D, òî ïå÷àòàåì ïàðó ñèìâîëîâ 0A, 0D, òîëüêî åñëè ïðîøëûé ïåðåíîñ áûë 0D.
0020+  D0DA~            		; Èíà÷å âûâîäèì 0D êàê åñòü, áåç âòîðîãî ñèâîëà.
0021+  D0DA~            		cpi	0Dh
0022+  D0DA~            		jnz	printerEcho_spc
0023+  D0DA~            		cmp	m
0024+  D0DA~            
0025+  D0DA~            printerEcho_0:	mvi	c, 0Ah
0026+  D0DA~            		cz	printer
0027+  D0DA~            		mvi	c, 0Dh
0028+  D0DA~            		mov	m, a
0029+  D0DA~            		jmp	printer
0030+  D0DA~            
0031+  D0DA~            ; ---------------------------------------------------------------------------
0032+  D0DA~            
0033+  D0DA~            loc_D0B1:	; Åñëè ñèìâîë >= 0x87
0034+  D0DA~            		cpi	87h ; 'Ç'
0035+  D0DA~            		jnc	printerEcho_1
0036+  D0DA~            
0037+  D0DA~            printerEcho_spc:; Çàìåíÿåì ñèìâîë íà ïðîáåë
0038+  D0DA~            		mvi	c, ' '
0039+  D0DA~            
0040+  D0DA~            doPrinterEcho:	; Åñëè ýòî óäàëåíèå, âûõîäèì
0041+  D0DA~            		mov	a, c
0042+  D0DA~            		cpi	8
0043+  D0DA~            		rz
0044+  D0DA~            		; Ïåðåâîä êóðñîðà â íà÷àëî ýêðàíà - âûõîäèì
0045+  D0DA~            		cpi	0Ch
0046+  D0DA~            		rz
0047+  D0DA~            		; Åñëè <= 0x18
0048+  D0DA~            		cpi	18h
0049+  D0DA~            		jc	printerEcho_crLf
0050+  D0DA~            		; Åñëè <= 0x1C âûõîäèì
0051+  D0DA~            		cpi	1Ch
0052+  D0DA~            		rc
0053+  D0DA~            		; Åñëè î÷èñòêà ýêðàíà - âûõîäèì
0054+  D0DA~            		cpi	1Fh
0055+  D0DA~            		rz
0056+  D0DA~            		; Îñòàëüíûå ñëóæåáíûå êîäû çàìåíÿåì íà ïðîáåë
0057+  D0DA~            		jc	printerEcho_spc
0058+  D0DA~            		; Åñëè <= 0x60, ïå÷àòàåì
0059+  D0DA~            		cpi	60h
0060+  D0DA~            		jc	printer
0061+  D0DA~            		; ?
0062+  D0DA~            		lhld	v_koi8
0063+  D0DA~            		cpi	7Fh
0064+  D0DA~            		jnc	 loc_D0B1 ;+
0065+  D0DA~            		inr	l
0066+  D0DA~            		jnz	printer
0067+  D0DA~            		ori	80h
0068+  D0DA~            		mov	c, a
0069+  D0DA~            
0070+  D0DA~            printerEcho_1:  ; Åñëè ñèìâîë ìåíüøå 0xC0, âûõîäèì
0071+  D0DA~            		cpi	0C0h
0072+  D0DA~            		rc
0073+  D0DA~            
0074+  D0DA~            		; Åñëè v_tapeMode = '0', âûâîäèì ñèìâîë áåç èçìåíåíèé
0075+  D0DA~            		lda	v_tapeMode
0076+  D0DA~            		sui	'0'
0077+  D0DA~            		jz	printer
0078+  D0DA~            
0079+  D0DA~            		; Åñëè v_tapeMode = '1', âûâîäèì ñ ïðåîáðàçîâàíèì
0080+  D0DA~            		dcr	a
0081+  D0DA~            		jnz	printerXlat
0082+  D0DA~            
0083+  D0DA~            		; Èíà÷å ïåðåä âûâîäîì êàæäîãî ñèìîâîëà âûâîäèì 27, 82, 1
0084+  D0DA~            		; Èç äîêóìåíòàöèèè ê ïðèíòåðàì Epson
0085+  D0DA~            		; Select International character set France
0086+  D0DA~            		lxi	h, 1B52h
0087+  D0DA~            		mvi	a, 1
0088+  D0DA~            		call	printerEsc
0089+  D0DA~            
0090+  D0DA~            		; Âûâîä C íà ïðèíòåð
0091+  D0DA~            		call	printer		; Âûâîä	áàéòà íà ïðèíòåð
0092+  D0DA~            
0093+  D0DA~            		; Âûâîäèì 27, 82, 0
0094+  D0DA~            		; Select International character set USA
0095+  D0DA~            		xra	a
0096+  D0DA~            
0097+  D0DA~            printerEsc:	push	b
0098+  D0DA~            		 mov	c, h
0099+  D0DA~            		 call	printer		; Âûâîä	áàéòà íà ïðèíòåð
0100+  D0DA~            		 mov	c, l
0101+  D0DA~            		 call	printer		; Âûâîä	áàéòà íà ïðèíòåð
0102+  D0DA~            		 mov	c, a
0103+  D0DA~            		 call	printer		; Âûâîä	áàéòà íà ïðèíòåð
0104+  D0DA~            		pop	b
0105+  D0DA~            		ret
0106+  D0DA~            
0107+  D0DA             #endif0234   D0DA             .include "printer.inc"
0001+  D0DA             ;----------------------------------------------------------------------------
0002+  D0DA             ; RAMFOS
0003+  D0DA             ; Ïå÷àòü íà ïðèíòåðå
0004+  D0DA             ;
0005+  D0DA             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  D0DA             ;----------------------------------------------------------------------------
0007+  D0DA             
0008+  D0DA~            #if NO_PRINTER==0
0009+  D0DA~            
0010+  D0DA~            printerXlat:	; c = v_printerXlat[c % 64];
0011+  D0DA~            		mov	a, c		
0012+  D0DA~            		ani	63
0013+  D0DA~            		lxi	h, v_printerXlat
0014+  D0DA~            		mov	c, a
0015+  D0DA~            		mvi	b, 0
0016+  D0DA~            		dad	b
0017+  D0DA~            		mov	c, m
0018+  D0DA~            
0019+  D0DA~            printer:	push	psw
0020+  D0DA~            
0021+  D0DA~            		; Ðåæèì ÊÐ580ÂÂ55
0022+  D0DA~            		mvi	a, 90h
0023+  D0DA~            		sta	IO_EXT_MODE
0024+  D0DA~            
0025+  D0DA~            		; Èíâåðòèðóåì è çàïèñûâàåì äàííûå
0026+  D0DA~            		mov	a, c
0027+  D0DA~            		cma
0028+  D0DA~            		sta	IO_EXT_B
0029+  D0DA~            
0030+  D0DA~            printer_0:	 ; Ïîëüçîâàòåëü ìîæåò ïðåðâàòü îæèäàíèå
0031+  D0DA~            		 lda	IO_KEYB_B		
0032+  D0DA~            		 ani	2
0033+  D0DA~            		 jz	printer_break
0034+  D0DA~            
0035+  D0DA~            		 ; Æäåì ïîêà 6-îé áèò íå íóëåâîé
0036+  D0DA~            		 lda	IO_EXT_A
0037+  D0DA~            		 ani	40h
0038+  D0DA~            		jnz	printer_0
0039+  D0DA~            
0040+  D0DA~            		; Ñòðîá
0041+  D0DA~            		mvi	a, 3
0042+  D0DA~            		sta	IO_EXT_C
0043+  D0DA~            
0044+  D0DA~            		; Ïàóçà
0045+  D0DA~            		nop
0046+  D0DA~            		nop
0047+  D0DA~            		nop
0048+  D0DA~            		nop
0049+  D0DA~            		nop
0050+  D0DA~            		nop
0051+  D0DA~            		nop
0052+  D0DA~            
0053+  D0DA~            		; Ñòðîá
0054+  D0DA~            		xra	a
0055+  D0DA~            		sta	IO_EXT_C
0056+  D0DA~            
0057+  D0DA~            printer_break:	pop	psw
0058+  D0DA~            		ret
0059+  D0DA~            
0060+  D0DA~            		.db    0
0061+  D0DA             #else
0062+  D0DA             
0063+  D0DA             printer:
0064+  D0DA             printerHex:
0065+  D0DA             printerEchoMode: 
0066+  D0DA             doPrinterEcho:
0067+  D0DA C9          		ret
0068+  D0DB             #endif0235   D0DB             .include "setColorChar.inc"
0001+  D0DB             ;+---------------------------------------------------------------------------
0002+  D0DB             ; RAMFOS
0003+  D0DB             ; Óñòàíâîêà öâåòà ôîíà èëè ñèìâîëîâ
0004+  D0DB             ; Âûçûâàåòñÿ ïðè âûâîäå êîäîâ A0-BFh
0005+  D0DB             ;
0006+  D0DB             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  D0DB             ;----------------------------------------------------------------------------
0008+  D0DB             
0009+  D0DB             setColorChar:   ; Ïåðåõîäèì, åñëè ýòî ñèìâîëû B0-BFh
0010+  D0DB FE 10       		cpi	10h
0011+  D0DD D2 EF D0    		jnc	setColorChar_1
0012+  D0E0             
0013+  D0E0             		; Ýòî ñèìâîëû À0-ÀFh
0014+  D0E0             
0015+  D0E0             		; Ìëàäøèå 4 áèòà áóäóò öâåòîì ñèìâîëîâ (B = A << 4)
0016+  D0E0 E6 0F       		ani	0Fh
0017+  D0E2 07          		rlc
0018+  D0E3 07          		rlc
0019+  D0E4 07          		rlc
0020+  D0E5 07          		rlc
0021+  D0E6 47          		mov	b, a
0022+  D0E7             
0023+  D0E7             		; Îñòàâëÿåì öâåò ôîíà (A = v_color & 0xF)
0024+  D0E7 3A 35 D2    		lda	v_color
0025+  D0EA E6 0F       		ani	0Fh
0026+  D0EC             
0027+  D0EC             		; Óñòàíàëâèàåì öâåò (A | B)
0028+  D0EC C3 F7 D0    		jmp	setColorChar_2
0029+  D0EF             
0030+  D0EF             ; ---------------------------------------------------------------------------
0031+  D0EF             
0032+  D0EF             setColorChar_1:	; Ìëàäøèå 4 áèòà áóäóò öâåòîì ôîíà (B = A & 0x0F)
0033+  D0EF E6 0F       		ani	0Fh
0034+  D0F1 47          		mov	b, a
0035+  D0F2             
0036+  D0F2             		; Îñòàâëÿåì öâåò ñèìâîëîâ (A = v_color & 0xF0)
0037+  D0F2 3A 35 D2    		lda	v_color
0038+  D0F5 E6 F0       		ani	0F0h
0039+  D0F7             
0040+  D0F7             setColorChar_2:	; Óñòàíàëâèàåì öâåò (A | B)
0041+  D0F7 B0          		ora	b
0042+  D0F8 C3 FF D0    		jmp	setColor		0236   D0FB             .include "setColor.inc"
0001+  D0FB             ;+---------------------------------------------------------------------------
0002+  D0FB             ; RAMFOS
0003+  D0FB             ; Èíâåðñèÿ êîäà öâåòà
0004+  D0FB             ; Âûçûâàåòñÿ ïðè âûâîäå êîäà 89
0005+  D0FB             ;
0006+  D0FB             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  D0FB             ;----------------------------------------------------------------------------
0008+  D0FB             
0009+  D0FB 3A 35 D2    inverseColor:	lda	v_color
0010+  D0FE 2F          		cma
0011+  D0FF             
0012+  D0FF             ;+---------------------------------------------------------------------------
0013+  D0FF             ; RAMFOS
0014+  D0FF             ; Ñòàíäàðòíàÿ òî÷êà âõîäà C84B
0015+  D0FF             ; Óñòàíîâêà öâåòà ôîíà è áóêâ
0016+  D0FF             ;
0017+  D0FF             ; Íà âõîäå
0018+  D0FF             ;  Ìëàäøèå áèòû A - öâåòà ôîíà
0019+  D0FF             ;  Ñòàðøèå áèòû A - öâåò áóêâ
0020+  D0FF             ;
0021+  D0FF             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0022+  D0FF             ;----------------------------------------------------------------------------
0023+  D0FF             
0024+  D0FF 32 35 D2    setColor:	sta	v_color
0025+  D102 32 F8 FF    		sta	IO_COLOR
0026+  D105 C9          		ret0237   D106             .include "popColor.inc"
0001+  D106 2A 36 D2    popColor:	lhld	v_pushColor
0002+  D109 22 35 D2    		shld	v_color
0003+  D10C 7D          		mov	a, l
0004+  D10D C3 FF D0    		jmp	setColor0238   D110             .include "bigRom.inc"
0001+  D110             ;----------------------------------------------------------------------------
0002+  D110             ; RAMFOS
0003+  D110             ; ×òåíèå ÏÇÓ Ñïåöèàëèñòà MX
0004+  D110             ;
0005+  D110             ; 2013-11-01 Ðàçðàáîòàíî vinxru
0006+  D110             ;----------------------------------------------------------------------------
0007+  D110             
0008+  D110             #if BIG_ROM
0009+  D110 F5          bigRom:		push	psw
0010+  D111             
0011+  D111             		; Åñëè â HL áûëî ÷èñëî < 8000h, òî ïåðåõîäèì ê ÷òåíèþ ÏÇÓ MX
0012+  D111 7C          		mov	a, h
0013+  D112 EE 80       		xri	80h
0014+  D114 FA 30 D1    		jm	bigRom_0
0015+  D117             
0016+  D117             		; Ñîõðàíÿåì HL è âû÷èòàåì èç íåãî 8000h
0017+  D117 E5          		push	h
0018+  D118 67          		 mov	h, a		 
0019+  D119             		 ; Ïåðâûå òðè áàéòà ñ ÏÇÓ ÑÒÄ ýòî ïðîãðàììà èíèöèàèçàöèè
0020+  D119 23          		 inx	h
0021+  D11A 23          		 inx	h
0022+  D11B 23          		 inx	h
0023+  D11C             		 ; Âêëþ÷àåì ÏÇÓ ÑÒÄ
0024+  D11C 32 FF FF    		 sta	IO_PAGE_STD
0025+  D11F AF          		 xra	a
0026+  D120 32 F8 F7    		 sta	IO_COLOR-800h
0027+  D123             		 ; ×òåíèå áàéòà
0028+  D123 4E          		 mov	c, m
0029+  D124             		 ; Âêëþ÷åíèå ÎÇÓ MX è âîññòàíîâëåíèå öâåòà
0030+  D124 32 FC F7    		 sta	IO_PAGE_RAM-800h
0031+  D127 3A 35 D2    		 lda	v_color
0032+  D12A 32 F8 FF    		 sta	IO_COLOR
0033+  D12D E1          		pop	h
0034+  D12E             		; Âîññòàíàâëèâàåì â A çíà÷åíèå
0035+  D12E F1          		pop	psw
0036+  D12F C9          		ret
0037+  D130             		
0038+  D130             bigRom_0:	; Âêëþ÷åíèå ÏÇÓ MX
0039+  D130 32 FE FF    		sta	IO_PAGE_ROM
0040+  D133             		; ×òåíèå áàéòà
0041+  D133 4E          		mov	c, m
0042+  D134             		; Âêëþ÷åíèå ÎÇÓ MX
0043+  D134 32 FC FF    		sta	IO_PAGE_RAM
0044+  D137             		; Âîññòàíàâëèâàåì â A çíà÷åíèå
0045+  D137 F1          		pop	psw
0046+  D138 C9          		ret      
0047+  D139             #endif0239   D139             #if RELOCATE_FILE_FUNCTIONS
0240   D139             .include "fileSaveHeader.inc"	; ¯à®¤®«¦¥­¨¥ ¢ pageWriteBlock
0001+  D139             ;+---------------------------------------------------------------------------
0002+  D139             ; RAMFOS
0003+  D139             ; Çàïèñàòü çàãîâëîê òåêóùåãî ôàéëà íà äèñê
0004+  D139             ;
0005+  D139             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  D139             ;----------------------------------------------------------------------------
0007+  D139             
0008+  D139             fileSaveHeader:
0009+  D139             		; Óñòàíàâëèâàåì ôëàã "ôàéë íå áûë ñîõðàíåí"
0010+  D139 3E 8B       		mvi	a, 8Bh
0011+  D13B 32 61 D2    		sta	v_header_saved
0012+  D13E             
0013+  D13E             		; Ñîõðàíåíèå çàãîëîâêà íà äèñê
0014+  D13E 01 52 D2    		lxi	b, v_header
0015+  D141             		
0016+  D141             ;----------------------------------------------------------------------------
0017+  D141             ; RAMFOS
0018+  D141             ; Çàïèñàòü àëüòåðíàòèâíûé çàãîâëîê ôàéëà íà äèñê
0019+  D141             ; Èñïîëüçóåòñÿ äëÿ çàïèñè çàãîâëîêà v_header2 ïðè ñîçäàíèè íîâîãî ôàéëà
0020+  D141             ;
0021+  D141             ; Íà âõîäå
0022+  D141             ;  b - çàãîëîâîê
0023+  D141             ;
0024+  D141             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0025+  D141             ;----------------------------------------------------------------------------
0026+  D141             
0027+  D141             fileSaveHeaderAny:
0028+  D141 11 1D 00    		lxi	d, FILE_HEADER_SIZE-1
0029+  D144 2A 70 D2    		lhld	v_curFile
0030+  D147             
0031+  D147             		; Ïðîäîëæåíèå íà pageWriteBlock
0032+  D147             		0241   D147             .include "pageWriteBlock.inc"
0001+  D147             ;+---------------------------------------------------------------------------
0002+  D147             ; RAMFOS
0003+  D147             ; Çàïèñü áëîêà äàííûõ â ÄÎÇÓ/ÏÇÓ
0004+  D147             ;
0005+  D147             ; Íà âõîäå:
0006+  D147             ;  bc - îòêóäà, àäðåñ â ïàìÿòè
0007+  D147             ;  hl - êóäà, àäðåñ â ÄÎÇÓ/ÏÇÓ
0008+  D147             ;  de - äëèíà-1
0009+  D147             ;
0010+  D147             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0011+  D147             ;----------------------------------------------------------------------------
0012+  D147             
0013+  D147             pageWriteBlock:	; ×òåíèå áàéòà
0014+  D147 0A          		ldax	b
0015+  D148             		; Çàïèñü áàéòà
0016+  D148 C5          		push	b
0017+  D149 4F          		 mov	c, a
0018+  D14A CD D1 FF    		 call	pageWrite
0019+  D14D C1          		pop	b
0020+  D14E             		; Óâåëè÷åíèå àäðåñîâ
0021+  D14E 23          		inx	h
0022+  D14F 03          		inx	b
0023+  D150             		; if(de == 0) break;
0024+  D150 7B          		mov	a, e
0025+  D151 B2          		ora	d
0026+  D152             		; de--
0027+  D152 1B          		dcx	d
0028+  D153 C2 47 D1    		jnz	pageWriteBlock
0029+  D156 C9          		ret
0242   D157             #endif
0243   D157             
0244   D157             .include "v_printerXlat.inc"
0001+  D157             ;+---------------------------------------------------------------------------
0002+  D157             ; RAMFOS
0003+  D157             ; Òàáëèöà ïðåîáðàçîâàíèÿ êîäèðîâêè ñèìâîëîâ äëÿ ïðèíòåðà
0004+  D157             ;
0005+  D157             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  D157             ;----------------------------------------------------------------------------
0007+  D157             
0008+  D157~            #if NO_PRINTER==0
0009+  D157~            
0010+  D157~            v_printerXlat:	.db 0EEh, 0D0h, 0D1h, 0E6h, 0D4h, 0D5h, 0E4h, 0D3h 
0011+  D157~            		.db 0E5h, 0D8h, 0D9h, 0DAh, 0DBh, 0DCh, 0DDh, 0DEh
0012+  D157~            		.db 0DFh, 0EFh, 0E0h, 0E1h, 0E2h, 0E3h, 0D6h, 0D2h
0013+  D157~            		.db 0ECh, 0EBh, 0D7h, 0E8h, 0EDh, 0E9h, 0E7h, 0EAh
0014+  D157~            		.db 0CEh, 0B0h, 0B1h, 0C6h, 0B4h, 0B5h, 0C4h, 0B3h 
0015+  D157~            		.db 0C5h, 0B8h, 0B9h, 0BAh, 0BBh, 0BCh, 0BDh, 0BEh
0016+  D157~            		.db 0BFh, 0CFh, 0C0h, 0C1h, 0C2h, 0C3h, 0B6h, 0B2h
0017+  D157~            		.db 0CCh, 0CBh, 0B7h, 0C8h, 0CDh, 0C9h, 0C7h, 0CAh
0018+  D157~            
0019+  D157             #endif0245   D157             
0246   D157             ; …á«¨ ­¥â „Ž‡“, â® ¨á¯®«ì§ã¥âáï íâ®â ­¥¡®«ìè®© ¡ãä¥à, çâ® ¡ë å®âì çâ® â®
0247   D157             ; à ¡®â «®.
0248   D157             
0249   D157             #if WORK_WITHOUT_ARAM != 0
0250   D157             miniPage:
0251   D178             .org $ + FILE_HEADER_SIZE + WORK_WITHOUT_ARAM + 2	; ‘®åà ­¥­¨¥ ä ©«  ¢ WORK_WITHOUT_ARAM ¡ ©â
0252   D178             miniPageEnd:
0253   D178 08          .db 8							; ‘î¤  § ¯¨áë¢ ¥âáï ¡ ©â â¥à¬¨­ â®à.
0254   D179             #endif
0255   D179             
0256   D179 4C 41 54 00 a_lat:		.db 04Ch, 041h, 054h, 0 ; "LAT"
0257   D17D F2 F5 F3 00 a_rus:		.db 0F2h, 0F5h,	0F3h, 0	; "“‘"
0258   D181 11 C6 C1 CA a_inputFileName:.db 11h, 0C6h, 0C1h, 0CAh, 0CCh, 3Ah, 8Dh, 7, 0 ; "ä ©«" + § ¯®¬¨­ ­¨¥ ªãàá®à  áâà®ª¨
0258   D185 CC 3A 8D 07 
0258   D189 00 
0259   D18A             
0260   D18A 0D C4 C1 D4 A_INPUTDATE
0260   D18E C1 3A 00 
0261   D191 8B 8F 20 F3 A_INITSCREEN
0261   D195 D0 C5 C3 C9 
0261   D199 C1 CC C9 D3 
0261   D19D D4 20 4D 58 
0261   D1A1 32 20 52 41 
0261   D1A5 4D 46 4F 53 
0261   D1A9 8C 00 
0262   D1AB             
0263   D1AB             ; ===========================================================================
0264   D1AB             ; ……Œ…›…
0265   D1AB             
0266   D1AB~            #if $ > 0D1F0h
0267   D1AB~            Žè¨¡ª _ç áâì_C800_­¥_¢«¥§« 
0268   D1AB             #endif
0269   D1F0             .org 0D1F0h
0270   D1F0             
0271   D1F0 00 00       v_tape:		.dw 0
0272   D1F2             
0273   D1F2             ; ‡ £®«®¢®ª ä ©«  2
0274   D1F2             
0275   D1F2 D3 D3 D3    v_header2:	.db 0D3h, 0D3h, 0D3h		; âãâ ¤®«¦­® ¡ëâì 0D3h, 0D3h, 0D3h, ¨­ ç¥ äã­ªæ¨ï § £àã§ª¨ ä ©«  ­¥ à ¡® â¥â. ¨ªâ® ­¥ ¨­¨æ¨ «¨§é¨àã¥â íâ¨ ¯¥à¥¬¥­­ë¥!
0276   D1F5 20 20 20 20 v_header2_name:	.db ' ',' ',' ',' ',' ',' ',' ',' ',' '
0276   D1F9 20 20 20 20 
0276   D1FD 20 
0277   D1FE 20 20 20    v_header2_ext:	.db ' ',' ',' '
0278   D201 8B          v_header2_saved:.db 8Bh			; à¨§­ ª ­¥ á®åà ­¥­­®áâ¨ 8B, 8C
0279   D202 01 11 13    v_header2_date:	.db 01h, 11h, 13h	; „ â 
0280   D205 00 00 00 00 		.db 0, 0, 0, 0, 0	; ¥§¥à¢ MXDOS
0280   D209 00 
0281   D20A 00 00       v_header2_start:.dw 0
0282   D20C 00 00       v_header2_end:	.dw 0
0283   D20E 00 00       v_header2_crc:	.dw 0
0284   D210             
0285   D210             ; Š®­¥æ § £®«®¢ª  ä ©« 
0286   D210             
0287   D210 00          v_dblClear:	.db 0
0288   D211 00 00 00 00 		.db 0,0,0,0,0,0,0,0,0
0288   D215 00 00 00 00 
0288   D219 00 
0289   D21A 00 00 00 00 unk_D21A:	.db 0,0,0,0,0,0
0289   D21E 00 00 
0290   D220 00 00       v_pushCursorLn:	.dw 0
0291   D222 00 00       v_pushCursor:	.dw 0
0292   D224 00          v_escMode:	.db 0
0293   D225 00          v_key2:		.db 0
0294   D226 00          v_printerCrLf:	.db 0		
0295   D227 00 00       v_memTop:	.dw 0
0296   D229 00 00       v_key0:		.dw 0
0297   D22B 00 00       v_key1:		.dw 0
0298   D22D 00 00       v_oldSP:	.dw 0
0299   D22F 00          		.db 0
0300   D230 00 00       v_topLineHeight:.dw 0
0301   D232 00          v_screenHeight:	.db 0		; ‚ëá®â  íªà ­ 
0302   D233 00          v_screenHeight1:.db 0		; ‚ëá®â  íªà ­  - 10
0303   D234 00          v_bottomLineId:	.db 0
0304   D235 00          v_color:	.db 0		; ’¥ªãé¨© æ¢¥â ä®­  ¨ ¡ãª¢
0305   D236 00 00       v_pushColor:	.dw 0
0306   D238 00 00 00 00 		.db 0,0,0,0
0307   D23C 00 00       v_aramPageEnd2:	.dw 0
0308   D23E 00          v_escRow:	.db 0
0309   D23F 00          		.db 0
0310   D240 00          v_lastKey:	.db 0
0311   D241 00          		.db 0
0312   D242 00          		.db 0
0313   D243 00 00       v_pageStart:	.dw 0		;  ç «® â¥ªãé¥© áâà ­¨æë
0314   D245 00          v_page:		.db 0		; ’¥ªãé ï áâà ­¨æ 
0315   D246             
0316   D246 00 00 00 00 		.db 0,0,0,0, 0,0,0,0, 0,0,0,0
0316   D24A 00 00 00 00 
0316   D24E 00 00 00 00 
0317   D252             
0318   D252             ; ‡ £®«®¢®ª ä ©« 
0319   D252             ; ¥à¢ë¥ 15 ¡ ©â (v_header, v_header_name, v_header_ext) ç¨â ¥âáï äã­ªæ¨¥© tapeReadHeader
0320   D252             ; ¥à¢ë¥ 30 ¡ ©â ç¨â îâáï äã­ªæ¨¥© fileLoadHeader
0321   D252             
0322   D252             
0323   D252 D3 D3 D3    v_header:	.db 0D3h, 0D3h, 0D3h	; ˆ¤¥­â¨ä¨ª â®à, ¤®«¦¥­ ¡ëâì 0D3h, 0D3h, 0D3h
0324   D255 20 20 20 20 v_header_name:	.db ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '
0324   D259 20 20 20 20 
0325   D25D 20          v_header_spc:	.db ' '
0326   D25E 20 20 20    v_header_ext:	.db ' ', ' ', ' '
0327   D261 00          v_header_saved:	.db 0
0328   D262 00 00 00    v_header_date:	.db 0, 0, 0
0329   D265 00 00 00 00 v_header_unused:.db 0, 0, 0, 0, 0
0329   D269 00 
0330   D26A 00 00       v_header_start:	.dw 0
0331   D26C 00 00       v_header_stop:	.dw 0
0332   D26E 00 00       v_header_crc:	.dw 0
0333   D270             
0334   D270             ; Š®­¥æ § £®«®¢ª  ä ©« 
0335   D270             
0336   D270 00 00       v_curFile:	.dw 0
0337   D272 00 00       v_printedFile:	.dw 0
0338   D274 00 00       f_nextFile:	.dw 0
0339   D276 00 00       f_fileBodySize:	.dw 0
0340   D278 00 00       f_fileSize:	.dw 0
0341   D27A 00 00       v_pageFreeTotal:.dw 0
0342   D27C 00 00       v_pageFreePtr:	.dw 0
0343   D27E             
0344   D27E F0 77 23 1B 		.db 0F0h, 77h, 23h, 1Bh, 7Ah, 0B3h, 0CAh, 95h, 0D2h, 0Ch, 0C2h, 78h, 0D2h, 22h, 0, 8Fh, 0EBh, 22h, 2, 8Fh, 0C3h, 52h, 0D2h
0344   D282 7A B3 CA 95 
0344   D286 D2 0C C2 78 
0344   D28A D2 22 00 8F 
0344   D28E EB 22 02 8F 
0344   D292 C3 52 D2 
0345   D295             
0346   D295 00 00 00 00 buffer:		.db 0,0,0,0,0,0,0,0,0	; ˆá¯®«ì§ã¥âáï ¬ ªá¨¬ã¬ 9 á¨¬¢®«®¢ ¤«ï ¢¢®¤  ¤ âë. ®á«¥¤­¨© ¡ ©â ¤«ï ª®­âà®«ï ¯¥à¥¯®«­¥­¨ï
0346   D299 00 00 00 00 
0346   D29D 00 
0347   D29E             
0348   D29E             ; ===========================================================================
0349   D29E             ; ŠŽ„
0350   D29E             
0351   F800             .org 0F800h
0352   F800             
0353   F800             .include "f800.inc"
0001+  F800             ;+---------------------------------------------------------------------------
0002+  F800             ; RAMFOS
0003+  F800             ; Òî÷êè âõîäà
0004+  F800             ;
0005+  F800             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  F800             ;----------------------------------------------------------------------------
0007+  F800             
0008+  F800 C3 2A F9    			jmp	init
0009+  F803 C3 03 C8    			jmp	j_keyWait
0010+  F806 C3 06 C8    			jmp	j_tapeRead
0011+  F809 C3 09 C8    			jmp	j_printChar
0012+  F80C C3 0C C8    			jmp	j_tapeWrite
0013+  F80F C3 0F C8    			jmp	j_printCharA
0014+  F812 C3 12 C8    			jmp	j_keyCheck
0015+  F815 C3 15 C8    			jmp	j_printHex
0016+  F818 C3 18 C8    			jmp	j_printString
0017+  F81B C3 1B C8    			jmp	j_keyScan
0018+  F81E C3 1E C8    			jmp	j_getCursorPos
0019+  F821 C3 21 C8    			jmp	j_getCharFromScr
0020+  F824 C3 95 F8    			jmp	dlg_loadFile
0021+  F827 C3 B0 F8    			jmp	fileSaveDlg
0022+  F82A C3 2A C8    			jmp	j_calcCrc
0023+  F82D C3 64 FF    			jmp	fileSetType
0024+  F830 C3 30 C8    			jmp	j_getMemTop
0025+  F833 C3 33 C8    			jmp	j_setMemTop
0026+  F836 C3 C5 FF    j_pageReadAny:		jmp	pageReadAny
0027+  F839 C3 D4 FF    j_pageWriteAny:		jmp	pageWriteAny
0028+  F83C C3 3C C8    			jmp	j_setCursorPos
0029+  F83F C3 A9 F8    			jmp	fileSave
0030+  F842 C3 A0 F8    			jmp	fileSetAddr
0031+  F845 C3 4F FF    			jmp	fileGetName
0032+  F848 C3 59 FF    			jmp	fileSetName
0033+  F84B C3 5A F8    			jmp	fileFind
0034+  F84E C3 36 FB    			jmp	fileLoad
0035+  F851 C3 11 FE    			jmp	fileDelete
0036+  F854             #if NO_ROM_ENTRY
0037+  F854             #if NO_MXDOS
0038+  F854 C3 2A F9    			jmp	init
0039+  F857~            #else
0040+  F857~            			jmp	loadMxDos
0041+  F857             #endif
0042+  F857 C3 4B FA    			jmp	exec
0043+  F85A             #endif0354   F85A             .include "loadMXDOS.inc"
0001+  F85A             ;+---------------------------------------------------------------------------
0002+  F85A             ; RAMFOS
0003+  F85A             ; Çàãðóçêà è çàïóñê MXDOS ñ äèñêåòû
0004+  F85A             ; Âûçûâàåòñÿ ïðè íàæàòèè íà F6 èç ôàéëîâîé ïàíåëè
0005+  F85A             ;
0006+  F85A             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  F85A             ;----------------------------------------------------------------------------
0008+  F85A             
0009+  F85A~            #if NO_MXDOS==0
0010+  F85A~            
0011+  F85A~            MXDOS_ADDR = 0E400h
0012+  F85A~            
0013+  F85A~            loadMxDos:	mov	b, a
0014+  F85A~            
0015+  F85A~            		; Óñòàíîâêà ãîëîâêè è ñåêòîðà
0016+  F85A~            		mvi	a, 1
0017+  F85A~            		sta	IO_FLOPPY_HEAD
0018+  F85A~            		sta	IO_FLOPPY_SECTOR
0019+  F85A~            
0020+  F85A~            		; Ïàóçà
0021+  F85A~            		mvi	h, 13h
0022+  F85A~            loadMxDos_0:	 dcx	h
0023+  F85A~            		 mov	a, l
0024+  F85A~            		 ora	h
0025+  F85A~            		jnz	loadMxDos_0
0026+  F85A~            
0027+  F85A~            		; Óñòàíàâëèâàåì ãîëîâêó
0028+  F85A~            		sta	IO_FLOPPY_HEAD
0029+  F85A~            
0030+  F85A~            		; Àäðåñ çàãðóçêè
0031+  F85A~            		lxi	h, MXDOS_ADDR
0032+  F85A~            
0033+  F85A~            		; ×òåíèÿ ñåêòîðà
0034+  F85A~            		mvi	a, 90h
0035+  F85A~            		sta	IO_FLOPPY_CMD
0036+  F85A~            
0037+  F85A~            		; Îæèäàíèå ãîòîâíîñòè
0038+  F85A~            loadMxDos_1:	 lda	IO_FLOPPY_CMD
0039+  F85A~            		 ral
0040+  F85A~            		 rc
0041+  F85A~            		 rar
0042+  F85A~            		 rar
0043+  F85A~            		jnc	loadMxDos_1
0044+  F85A~            
0045+  F85A~            		; Ïîëó÷åíèå äàííûõ
0046+  F85A~            		mvi	c, 13h 
0047+  F85A~            loadMxDos_2:	  sta	IO_FLOPPY_TRIG
0048+  F85A~            		  lda	IO_FLOPPY_DATA
0049+  F85A~            		  mov	m, a
0050+  F85A~            		  inr	l
0051+  F85A~            		 jnz	loadMxDos_2
0052+  F85A~            		 inr	h
0053+  F85A~            		 dcr	c
0054+  F85A~            		jp	loadMxDos_2
0055+  F85A~            
0056+  F85A~            		; Ïðîâåðêà
0057+  F85A~            		lda	IO_FLOPPY_CMD
0058+  F85A~            		xri	1
0059+  F85A~            		ora	a
0060+  F85A~            		mvi	a, 0D0h
0061+  F85A~            		sta	IO_FLOPPY_CMD
0062+  F85A~            		jnz	dlg_error
0063+  F85A~            
0064+  F85A~            		; Ïðîâåðêà
0065+  F85A~            		dcx	h
0066+  F85A~            		mov	a, m
0067+  F85A~            		dcx	h
0068+  F85A~            		inr	m
0069+  F85A~            		cmp	m
0070+  F85A~            		jnz	dlg_error
0071+  F85A~            
0072+  F85A~            		; Çàïóñê MXDOS
0073+  F85A~            		.db 078h
0074+  F85A~            		call	MXDOS_ADDR
0075+  F85A~            
0076+  F85A~            		; Ïðè âûõîäå èç MXDOS âûáèðàåì ROM-äèñê
0077+  F85A~            		mvi	b, 80h
0078+  F85A~            		ret
0079+  F85A             #endif0355   F85A             .include "fileFind.inc"
0001+  F85A             ;+---------------------------------------------------------------------------
0002+  F85A             ; RAMFOS
0003+  F85A             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F84B
0004+  F85A             ; Ïîèñê ôàéëà èìÿ êîòîðîãî çàäàíî ôóíêöèåé fileSetName (F848)
0005+  F85A             ;
0006+  F85A             ; Íà âõîäå
0007+  F85A             ;   v_header2_name  - Èìÿ ôàéëà äëÿ ïîèñêà
0008+  F85A             ;
0009+  F85A             ; Íà âûõîäå
0010+  F85A             ;   v_curFile       - Àäðåñ òåêóùåãî ôàéëà â ÄÎÇÓ
0011+  F85A             ;   v_header        - Çàãîëîâîê ôàéëà
0012+  F85A             ;   f_fileBodySize  - Äëèíà ôàéëà áåç çàãîëîâêà -1
0013+  F85A             ;   f_fileSize      - Äëèíà ôàéëà ñ çàãîëîâêîì
0014+  F85A             ;   f_nextFile      - Àäðåñ ñëåäóþùåãî ôàéëà â ÄÎÇÓ
0015+  F85A             ;   Â ÄÎÇÓ ïî àäðåñó v_curFile + f_fileSize çàïèñûâàåòñÿ v_curFile
0016+  F85A             ;
0017+  F85A             ; Èçìåíÿåò ïåðåìåííûå â ñëó÷àå îøèáêè â ÄÎÇÓ. ÄÎÇÓ íå èçìåíÿåòñÿ.
0018+  F85A             ;   v_pageFreePtr   - Óêàçàòåëü íà ïåðâûé ñâîáîäíûé áàéò
0019+  F85A             ;   v_pageFreeTotal - Ñâîáîäíî áàéò
0020+  F85A             ;
0021+  F85A             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0022+  F85A             ;----------------------------------------------------------------------------
0023+  F85A             
0024+  F85A             fileFind:	; Íà÷àëüíàÿ ñòðàíèöà
0025+  F85A 06 00       		mvi	b, 0
0026+  F85C             fileFindEx:	 ; Èùåì ôàéë â ñòðàíèöå èç ðåãèñòðà B
0027+  F85C CD 78 F8    		 call	fileFind1
0028+  F85F             
0029+  F85F             		 ; ?
0030+  F85F CA CC FB    		 jz	fileLoadHeader2
0031+  F862             
0032+  F862             		 ; Ñëåäóþùàÿ ñòðàíèöà (ðåãèñòð B), åñëè åñòü
0033+  F862 CD 69 F8    		 call	pageNext
0034+  F865 D2 5C F8    		jnc	fileFindEx
0035+  F868 C9          		ret0356   F869             .include "pageNext.inc"
0001+  F869             ;+---------------------------------------------------------------------------
0002+  F869             ; RAMFOS
0003+  F869             ; Ñëåäóþùàÿ ñòðàíèöà
0004+  F869             ;
0005+  F869             ; Íà âõîäå
0006+  F869             ;  b - ñòðàíèöà
0007+  F869             ;
0008+  F869             ; Íà âûõîäå
0009+  F869             ;  jc - îøèáêà
0010+  F869             ;  b  - ñòðàíèöà
0011+  F869             ;
0012+  F869             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0013+  F869             ;----------------------------------------------------------------------------
0014+  F869             
0015+  F869             pageNext:	; Ó ROM-äèñêà (êîä 0x80) ìîæåò áûòü òîëüêî îäíà ñòðàíèöà
0016+  F869 78          		mov	a, b
0017+  F86A 17          		ral
0018+  F86B D8          		rc
0019+  F86C 1F          		rar
0020+  F86D             
0021+  F86D             		; Îòôèëüòðîâûâàåì ôëàãè
0022+  F86D~            #if ARAM_MAX_PAGE <= 7
0023+  F86D~            		ani	7
0024+  F86D             #else
0025+  F86D E6 0F       		ani	0Fh
0026+  F86F             #endif
0027+  F86F             		; Ìàêñèìóì ñòðàíèö
0028+  F86F 4F          		mov	c, a
0029+  F870 0C          		inr	c
0030+  F871 3A 3D C6    		lda	v_aramMaxPage
0031+  F874 B9          		cmp	c
0032+  F875 D8          		rc
0033+  F876             
0034+  F876             		; Óâåëè÷èâàåì ñòðàíèöó
0035+  F876 04          		inr	b
0036+  F877 C9          		ret0357   F878             .include "fileFind1.inc"
0001+  F878             ;----------------------------------------------------------------------------
0002+  F878             ; RAMFOS
0003+  F878             ; Ïîèñê ôàéëà â ñòðàíèöå èìÿ êîòîðîãî çàäàíî ôóíêöèåé F848
0004+  F878             ;
0005+  F878             ; Íà âõîäå
0006+  F878             ;   v_header2_name  - Èìÿ ôàéëà äëÿ ïîèñêà
0007+  F878             ;   b, v_page       - Íîìåð òåêóùåé ñòðàíèöû
0008+  F878             ;
0009+  F878             ; Íà âûõîäå
0010+  F878             ;   v_curFile       - Àäðåñ òåêóùåãî ôàéëà â ÄÎÇÓ
0011+  F878             ;   v_header        - Çàãîëîâîê ôàéëà
0012+  F878             ;   f_fileBodySize  - Äëèíà ôàéëà áåç çàãîëîâêà - 1
0013+  F878             ;   f_fileSize      - Äëèíà ôàéëà ñ çàãîëîâêîì
0014+  F878             ;   f_nextFile      - Àäðåñ ñëåäóþùåãî ôàéëà â ÄÎÇÓ
0015+  F878             ;   Â ÄÎÇÓ ïî àäðåñó v_curFile + f_fileSize çàïèñûâàåòñÿ v_curFile
0016+  F878             ;   v_pageFreePtr   - Óêàçàòåëü íà ïåðâûé ñâîáîäíûé áàéò
0017+  F878             ;   v_pageFreeTotal - Ñâîáîäíî áàéò
0018+  F878             ;
0019+  F878             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0020+  F878             ;----------------------------------------------------------------------------
0021+  F878             
0022+  F878             fileFind1:      ; Ïîèñê ïðîèñõîäèò â äâà ýòàïà
0023+  F878             		; Ñíà÷àëà ìû ðàñ÷èòûâàåì v_pageFreePtr, v_pageFreeTotal
0024+  F878 C5          		push	b
0025+  F879 78          		 mov	a, b
0026+  F87A F6 10       		 ori	10h
0027+  F87C 47          		 mov	b, a
0028+  F87D CD 81 F8    		 call	fileFind1_0
0029+  F880 C1          		pop	b
0030+  F881             
0031+  F881             		; À ïðè âòîðîì ïðîõîäå ñðàâíèâàåì èìÿ ôàéëà
0032+  F881             
0033+  F881             fileFind1_0:	; Ïîëó÷àåì B - òåêóùàÿ ñòðàíèöà, HL - íà÷àëî ñòðàíèöû
0034+  F881 CD CA FC    		call	fileSetPage
0035+  F884             fileFind2_1:	 ; Çàãðóæàåì ñëåäóþùèé çàãîëîâîê ôàéëà
0036+  F884 CD 7A FB    		 call	fileLoadHeader
0037+  F887             		 ; Íåò ôàéëîâ, âûõîäèì ñ ôëàãîì NZ
0038+  F887 C0          		 rnz
0039+  F888             		 ; Âî âòîðîì ïðîõîäå (b & 0x10 == 0) ñðàâíèâàåì èìÿ ôàéëà
0040+  F888 78          		 mov	a, b
0041+  F889 E6 10       		 ani	10h
0042+  F88B CC 01 FE    		 cz	compareFileName
0043+  F88E             		 ; Åñëè ôàéë íàéäåí, âûõîäèì ñ ôëàãîì Z
0044+  F88E C8          		 rz
0045+  F88F             		 ; Ïðîäîëæàåì ïîèñê ñî ñëåäóþùåãî ôàéëà
0046+  F88F 2A 74 D2    		 lhld	f_nextFile
0047+  F892 C3 84 F8    		jmp	fileFind2_1
0358   F895             .include "dialog.inc"		; ¯à®¤®«¦¥­¨¥ ¢ fileSaveHeader
0001+  F895             ;----------------------------------------------------------------------------
0002+  F895             ; RAMFOS
0003+  F895             ; Ôàéëîâàÿ ïàíåëü
0004+  F895             ;
0005+  F895             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006+  F895             ;----------------------------------------------------------------------------
0007+  F895             
0008+  F895             #if ALL_CHARS
0009+  F895             #define BORDER_BL  27,12
0010+  F895             #define BORDER_BL1 12
0011+  F895             #define BORDER_B   27,13
0012+  F895             #define BORDER_B1  13
0013+  F895             #define BORDER_BR  27,24
0014+  F895             #define BORDER_BR1 24
0015+  F895             #define BORDER_L   27, 8
0016+  F895             #define BORDER_L1  8
0017+  F895             #define BORDER_R   27, 10
0018+  F895             #define BORDER_R1  10
0019+  F895             #define BORDER_H   27, 25
0020+  F895             #define BORDER_H1  25
0021+  F895~            #else
0022+  F895~            BORDER_BL  = 15h
0023+  F895~            BORDER_BL1 = 15h
0024+  F895~            BORDER_B   = 14h
0025+  F895~            BORDER_B1  = 14h
0026+  F895~            BORDER_BR  = 16h
0027+  F895~            BORDER_BR1 = 16h
0028+  F895~            BORDER_L   = 11h
0029+  F895~            BORDER_L1  = 11h
0030+  F895~            BORDER_R   = 6
0031+  F895~            BORDER_R1  = 6
0032+  F895~            BORDER_H   = 6
0033+  F895~            BORDER_H1  = 6
0034+  F895             #endif
0035+  F895             
0036+  F895             dlg_loadFile:	; Àêòèâíàÿ ñòðàíèöà
0037+  F895 3A 45 D2    		lda	v_page
0038+  F898 E6 0F       		ani	0Fh
0039+  F89A             		; Ðåæèì âûáîðà ôàéëà (6 îé áèò)
0040+  F89A F6 40       		ori	40h
0041+  F89C 47          		mov	b, a
0042+  F89D C3 41 F9    		jmp	dlg_main
0043+  F8A0             
0044+  F8A0             ; ---------------------------------------------------------------------------
0045+  F8A0             
0046+  F8A0             .include "fileSetAddr.inc"
0001++ F8A0             ;+---------------------------------------------------------------------------
0002++ F8A0             ; RAMFOS
0003++ F8A0             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F842
0004++ F8A0             ; Óñòàíîâêà àäðåñà çàãðóçêè â ïàìÿòü òåêóùåãî ôàéëà
0005++ F8A0             ;
0006++ F8A0             ; Íà âõîäå
0007++ F8A0             ;   v_header2_name - èìÿ ôàéëà
0008++ F8A0             ;   hl             - íîâûé àäðåñ
0009++ F8A0             ;
0010++ F8A0             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0011++ F8A0             ;----------------------------------------------------------------------------
0012++ F8A0             
0013++ F8A0             fileSetAddr:	; Èùåì ôàéë
0014++ F8A0 E5          		push	h
0015++ F8A1 CD 5A F8    		 call	fileFind
0016++ F8A4 E1          		pop	h
0017++ F8A5             
0018++ F8A5             		; Ôàéë íå íàéäåí
0019++ F8A5 C0          		rnz
0020++ F8A6             
0021++ F8A6             		; Óñòàíàëèâàåì àäðåñ çàãðóçêè
0022++ F8A6 C3 0A FB    		jmp	fileLoadSetAddr
0047+  F8A9             .include "fileSave.inc"	; Ïðîäîëæåíèå
0001++ F8A9             ;----------------------------------------------------------------------------
0002++ F8A9             ; RAMFOS
0003++ F8A9             ; Ñîõðàíèòü ôàéë
0004++ F8A9             ;
0005++ F8A9             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006++ F8A9             ;----------------------------------------------------------------------------
0007++ F8A9             
0008++ F8A9             fileSave:	; Íàéòè ñâîáîäíóþ ñòðàíèöó è ðàññ÷èòàòü êîíòðîëüíóþ ñóììó
0009++ F8A9 CD EB F8    		call	fileFindFree
0010++ F8AC D8          		rc
0011++ F8AD             
0012++ F8AD             		; Îáùàÿ ôóíêöèÿ
0013++ F8AD C3 CC F8    		jmp	fileSaveCom		
0014++ F8B0             
0015++ F8B0             ;----------------------------------------------------------------------------
0016++ F8B0             ; RAMFOS
0017++ F8B0             ; Ñîõðàíèòü ôàéë ñ ââîäîì èìåíè ñ êëàâèàòóðû
0018++ F8B0             ;
0019++ F8B0             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0020++ F8B0             ; ---------------------------------------------------------------------------
0021++ F8B0             
0022++ F8B0             fileSaveDlg:	; Âûâîä òåêñòà "Ñîõðàíèòü?"
0023++ F8B0 CD D9 FE    		call	printStringEx
0024++ F8B3 8B 90 20 F3 		.db C_INVERSE, C_BOTTOMLINE, ' ', 0F3h, 0CFh, 0C8h, 0D2h, 0C1h, 0CEh, 0C9h, 0D4h, 0D8h, 3Fh, C_NORMAL, 0
0024++ F8B7 CF C8 D2 C1 
0024++ F8BB CE C9 D4 D8 
0024++ F8BF 3F 8C 00 
0025++ F8C2             
0026++ F8C2             		; Ââîä èìåíè ôàéëà
0027++ F8C2 CD 45 C8    		call	j_inputFileName
0028++ F8C5 C8          		rz
0029++ F8C6             
0030++ F8C6             		; Ïîèñê ïîäõîäÿùåé ñòðàíèöû
0031++ F8C6 CD EB F8    		call	fileFindFree
0032++ F8C9             
0033++ F8C9             		; Â ñëó÷àå îøèáêè âûâåñòè "ìàë äèñê" è æäàòü íàæàíèÿ ESC
0034++ F8C9 DA CA FE    		jc	outOfSpace
0035++ F8CC             
0036++ F8CC             fileSaveCom:	; Çàïèñü çàãîëîâêà ôàéëà íà äèñê ïî àäðåñó v_curFile
0037++ F8CC 01 F2 D1    		lxi	b, v_header2
0038++ F8CF CD 41 D1    		call	fileSaveHeaderAny
0039++ F8D2             
0040++ F8D2             		; BC = íà÷àëî ôàéëà, DE = äëèíà ôàéëà - 1
0041++ F8D2 E5          		push	h
0042++ F8D3             		 ; DE = íà÷àëî ôàéëà, HL = äëèíà ôàéëà - 1
0043++ F8D3 CD E3 FD    		 call	fileGetStartAndSize
0044++ F8D6 EB          		 xchg
0045++ F8D7 4D          		 mov	c, l
0046++ F8D8 44          		 mov	b, h
0047++ F8D9 E1          		pop	h
0048++ F8DA             
0049++ F8DA             		; Çàïèñü òåëà ôàéëà (çàïèñü íà äèñê ïî àäðåñó HL èç ïàìÿòè BC äëèíîé DE+1)
0050++ F8DA CD 47 D1    		call	pageWriteBlock 
0051++ F8DD             
0052++ F8DD             		; Ïðîäîëæåíèå â fileChanged		0048+  F8DD             .include "fileChanged.inc"
0001++ F8DD             ;+---------------------------------------------------------------------------
0002++ F8DD             ; RAMFOS
0003++ F8DD             ; Âûçûâàåòñÿ ïîñëå ñîçäàíèÿ/óäàëåíèÿ ôàéëà
0004++ F8DD             ;
0005++ F8DD             ; Âõîä
0006++ F8DD             ;  hl - Ïåðâûé áàéò ïîñëå òåëà ôàéëà. Ó âòîðîé ôóíêöèè ñîîòâåòñòâåííî +2.
0007++ F8DD             ;
0008++ F8DD             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0009++ F8DD             ;----------------------------------------------------------------------------                   
0010++ F8DD             
0011++ F8DD             fileChanged2: 	; Ïðîïóñêàåì äâà áàéòà, îíè áóäóò çàïîëíåíû ïðè ïðîñìîòðå.
0012++ F8DD 23          		inx	h
0013++ F8DE 23          		inx	h
0014++ F8DF             
0015++ F8DF             fileChanged:    ; Îáíîâëÿåì óêàçàòåëü ñâîáîäíîãî ìåñòà
0016++ F8DF 22 7C D2    		shld	v_pageFreePtr
0017++ F8E2             
0018++ F8E2             		; Çàïèñûâàåì çíà÷åíèå 8 ïî ýòîìó àäðåñó, ÷òî áû òàì íè 
0019++ F8E2             		; â êîåì ñëó÷àå íå áûëî D3, D3, D3
0020++ F8E2 0E 08       		mvi	c, 8
0021++ F8E4 CD D1 FF    		call	pageWrite
0022++ F8E7             
0023++ F8E7             		; Çâóêîâîé ñèãíàë
0024++ F8E7 0D          		dcr	c
0025++ F8E8 C3 09 C8    		jmp	j_printChar
0049+  F8EB             .include "fileFindFree.inc"
0001++ F8EB             ;+---------------------------------------------------------------------------
0002++ F8EB             ; RAMFOS
0003++ F8EB             ; Ðàñ÷åò êîíòðîëüíîé ñóììû ñîõðàíÿåìîãî ôàéëà, ïîèñê ñòðàíèöû
0004++ F8EB             ; ñ ïîäõîäÿùèì câîáîäíûì îáúåìîì, óäàëåíèå ôàéëà ñ èìåíåì v_header2_name
0005++ F8EB             ;
0006++ F8EB             ; Íà âõîäå
0007++ F8EB             ;  v_header2_name  - Èìÿ ôàéëà äëÿ óäàëåíèÿ
0008++ F8EB             ;  f_header2_start - Àäðåñ íà÷àëà ôàéëà
0009++ F8EB             ;  f_header2_stop  - Àäðåñ êîíöà ôàéëà
0010++ F8EB             ;
0011++ F8EB             ; Íà âûõîäå
0012++ F8EB             ;  jnc             - Ñòðàíèöà íàéäåíà
0013++ F8EB             ;  f_header2_crc   - Êîíòðîëüíàÿ ñóììà
0014++ F8EB             ;  v_page, b       - Ñòðàíèöà
0015++ F8EB             ;
0016++ F8EB             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0017++ F8EB             ;----------------------------------------------------------------------------
0018++ F8EB             
0019++ F8EB             fileFindFree:	; Ðàñ÷èòûâàåì êîíòðîëüíóþ ñóììó â v_header2_crc
0020++ F8EB 22 0A D2    		shld	v_header2_start	
0021++ F8EE EB          		xchg
0022++ F8EF 22 0C D2    		shld	v_header2_end		
0023++ F8F2 EB          		xchg
0024++ F8F3 CD 2A C8    		call	j_calcCrc
0025++ F8F6 60          		mov	h, b
0026++ F8F7 69          		mov	l, c
0027++ F8F8 22 0E D2    		shld	v_header2_crc
0028++ F8FB             
0029++ F8FB             		; Ïîèñê ïî âñåì ñòðàíèöàì è óäàëåíèå ôàéëà
0030++ F8FB 06 20       		mvi	b, 20h
0031++ F8FD CD 5C F8    		call	fileFindEx
0032++ F900             
0033++ F900             		; Ïîèñê ôàéëà íà÷èíàÿ ñ íóëåâîé ñòðàíèöû
0034++ F900 06 20       		mvi	b, 20h
0035++ F902             fileFindFree_0:	 ; Îïðåäåëÿåì ñâîáîäíîå ìåñòî íà ñòðàíèöå
0036++ F902 CD 78 F8    		 call	fileFind1
0037++ F905             		 
0038++ F905             		 ; de = ðàñ÷èòûâàåì òðåáóåìûé ðàçìåð ôàéëà, ïî÷åìó òî â öèêëå.
0039++ F905 CD E3 FD    		 call	fileGetStartAndSize
0040++ F908 11 21 00    		 lxi	d, FILE_HEADER_SIZE + 3
0041++ F90B 19          		 dad	d
0042++ F90C EB          		 xchg		
0043++ F90D             
0044++ F90D             		 ; Âûõîäèì ñ ôëàãîì NC, åñëè ìåñòà äîñòàòî÷íî
0045++ F90D 2A 7A D2    		 lhld	v_pageFreeTotal
0046++ F910 D4 54 C8    		 cnc	j_cmp_hl_de
0047++ F913 D0          		 rnc		
0048++ F914             
0049++ F914             		 ; Ñëåäóþùàÿ ñòðàíèöà
0050++ F914 CD 69 F8    		 call	pageNext
0051++ F917 D2 02 F9    		jnc	fileFindFree_0
0052++ F91A C9          		ret0050+  F91B             
0051+  F91B             ; ---------------------------------------------------------------------------
0052+  F91B             ; ÓÄÀËÅÍÈÅ ÄÀÒÛ
0053+  F91B             
0054+  F91B             dlg_f2_alt:	; Åñëè ðåæèì âûáîðà ôàéëà, òî âûõîäèì
0055+  F91B 78          		mov	a, b
0056+  F91C 17          		ral
0057+  F91D 17          		ral
0058+  F91E D8          		rc
0059+  F91F             
0060+  F91F             		; Âûâîä ñîîáùåíèÿ "äàòó óäàëèòü"
0061+  F91F 11 95 FF    		lxi	d, a_deleteDate
0062+  F922 CD 7D F9    		call	dlg_msgYesNo
0063+  F925             
0064+  F925             .include "deleteDate.inc"
0001++ F925             ;+---------------------------------------------------------------------------
0002++ F925             ; RAMFOS
0003++ F925             ; Óäàëåíèå òåêóùåé äàòû
0004++ F925             ; Ïîñëåäóþùàÿ ïåðåðèñîâêà âåðõíåé ñòðîêè â init ïðèâåäåò â âûçîâó ôóíêöèè 
0005++ F925             ; ââîäà äàòû
0006++ F925             ;
0007++ F925             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0008++ F925             ;----------------------------------------------------------------------------
0009++ F925             
0010++ F925             #if DATE_IN_RAM
0011++ F925             		; Ñîõðàíÿåì ïðèçíàê òîãî, ÷òî äàòà íå ââåäåíà
0012++ F925 3E 8C       		mvi	a, 8Ch 
0013++ F927 32 01 D2    		sta	v_header2_saved
0014++ F92A~            #else
0015++ F92A~            		; Ñîõðàíÿåì ïðèçíàê òîãî, ÷òî äàòà íå ââåäåíà â ÄÎÇÓ
0016++ F92A~            		; Íà âõîäå A != 8Bh
0017++ F92A~            		lhld	v_aramPageEnd
0018++ F92A~            		inx	h
0019++ F92A~            		call	pageWrite
0020++ F92A             #endif
0021++ F92A             		; Ôóíêöèÿ ïðîäîëæàåòñÿ â init0065+  F92A             
0066+  F92A             		; Äàëåå init
0067+  F92A             
0068+  F92A             ; ---------------------------------------------------------------------------
0069+  F92A             
0070+  F92A             .include "init.inc"	; Ïðîäîëæåíèå â dlg_main
0001++ F92A             ;+---------------------------------------------------------------------------
0002++ F92A             ; RAMFOS
0003++ F92A             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F800
0004++ F92A             ; Èíèöèàëèçàöèÿ
0005++ F92A             ;
0006++ F92A             ; 2013-11-01 vinxru
0007++ F92A             ;----------------------------------------------------------------------------
0008++ F92A             
0009++ F92A             init:		; Âêëþ÷åíèå ÎÇÓ
0010++ F92A 32 FC FF    		sta	IO_PAGE_RAM
0011++ F92D             	
0012++ F92D             		; Èíèöèàëèçàöèÿ	ñòåêà
0013++ F92D 31 FF D2    		lxi	sp, STACK_TOP
0014++ F930             
0015++ F930             		; Èíèöèàëèçàöèÿ BIOS
0016++ F930 CD 00 C8    		call	j_biosInit
0017++ F933             
0018++ F933             		; Âåðõóøêà ïàìÿòè
0019++ F933 21 FF 8F    		lxi	h, RAM_TOP
0020++ F936 CD 33 C8    		call	j_setMemTop
0021++ F939             
0022++ F939             		; Ôèëüòð
0023++ F939 21 81 FF    		lxi	h, a_12spaces + 9
0024++ F93C CD 64 FF    		call	fileSetType
0025++ F93F             
0026++ F93F             		; Äèñê
0027++ F93F 06 80       		mvi	b, DLG_START_PAGE
0028++ F941             
0029++ F941             		; Ïðîäîëæàåòñÿ â dlg_main0071+  F941             
0072+  F941             ; ---------------------------------------------------------------------------
0073+  F941             
0074+  F941             dlg_main:	
0075+  F941             		; Î÷èùàåì ýêðàí, ïåðåðèñîâûâàåì çàãîëîâîê è íèæíþþ ñòðîêó
0076+  F941 CD EF FC    		call	dlg_pageChanged
0077+  F944             	
0078+  F944             dlg_main_0:
0079+  F944             		; Ñîõðàíÿåì òåêóùèé ôàéë è ïîëîæåíèå êóðñîðà
0080+  F944~            #if DLG_CURSOR_AT_TOP
0081+  F944~            		xchg
0082+  F944~            		lhld	v_curFile
0083+  F944~            		push	h
0084+  F944~            		lhld	v_cursorPos
0085+  F944~            		push	h
0086+  F944~            		xchg
0087+  F944             #endif	
0088+  F944             		; Âûâîäèì âñå ôàéëû íà ýêðàí
0089+  F944 CD 7A FB    dlg_main_1:	 call	fileLoadHeader
0090+  F947 F5          		 push	psw
0091+  F948 CD 19 FC    		  call	dlg_printFile
0092+  F94B F1          		 pop	psw
0093+  F94C 2A 74 D2    		 lhld	f_nextFile
0094+  F94F CA 44 F9    		jz	dlg_main_1
0095+  F952             
0096+  F952             #if NICE
0097+  F952             dlg_z1:
0098+  F952 CD 99 CD    		call	getCursorPos
0099+  F955 7C          		mov	a, h
0100+  F956 D6 16       		sui	16h
0101+  F958 D2 67 F9    		jnc	dlg_z0
0102+  F95B             		; 46 ïðîáåëîâ
0103+  F95B 01 20 2E    		lxi	b, (46 << 8) + ' '
0104+  F95E CD B3 FC    		call	printChars	
0105+  F961             		; Ïðàâàÿ ãðàíèöà
0106+  F961 CD 76 FC    		call	dlg_rightEdge
0107+  F964 C3 52 F9    		jmp	dlg_z1
0108+  F967             dlg_z0:		
0109+  F967             #endif		
0110+  F967             
0111+  F967             		; Ðèñóåì íèæíþþ ãðàíèöó
0112+  F967 CD 9C F9    		call	dlg_bottomEdge
0113+  F96A             		; Âîññòàíàâëèâàåì ïîëîæåíèå êóðñîðà
0114+  F96A~            #if DLG_CURSOR_AT_TOP
0115+  F96A~            		pop	h
0116+  F96A~            		shld	v_cursorPos
0117+  F96A~            		pop	h
0118+  F96A~            		shld	v_curFile
0119+  F96A             #else
0120+  F96A 2A 72 D2    		lhld    v_printedFile
0121+  F96D             #endif	
0122+  F96D CD FF F9    		call    dlg_reloadItem
0123+  F970             
0124+  F970 CD D9 FE    		call    printStringEx
0125+  F973~            #if NICE==0
0126+  F973~            		.db C_BEEP
0127+  F973             #endif
0128+  F973 8E 93 8C 00 		.db C_POPCURSORL, C_PUSHCURSORS, C_NORMAL, 0
0129+  F977             
0130+  F977 2A 70 D2    		lhld	v_curFile
0131+  F97A C3 44 F9    		jmp	dlg_main_0
0132+  F97D             
0133+  F97D             ; ---------------------------------------------------------------------------
0134+  F97D             
0135+  F97D             dlg_msgYesNo:	; Âûâîä ñîîáùåíèÿ
0136+  F97D CD B4 FD    		call	dlg_msg
0137+  F980             
0138+  F980             dlg_yesNo:	; Ââîä ñòðîêè èç 4-õ ñèâîëîâ
0139+  F980 21 95 D2    		lxi	h, buffer
0140+  F983 11 FF 04    		lxi	d, 4FFh
0141+  F986 CD 36 C8    		call	j_input
0142+  F989 77          		mov	m, a
0143+  F98A             
0144+  F98A             		; Åñëè íàæàò ENTER, ïå÷àòàåì ñèìâîë 0E è âûõîäèì
0145+  F98A 3E 0E       		mvi	a, 0Eh
0146+  F98C DA 0F C8    		jc	j_printCharA	; Âûõîä
0147+  F98F             
0148+  F98F             		; Åñëè íàæàò íå ESC, ïîâòîðÿåì
0149+  F98F C2 80 F9    		jnz	dlg_yesNo
0150+  F992             
0151+  F992             		; Âûêèäûâàåì àäðåñ âîçðàòà
0152+  F992 E1          		pop	h
0153+  F993             		
0154+  F993             loc_F9D0:	; Ñòèðàåì òî, ÷òî íàðèñîâàëè
0155+  F993 CD 9C F9    		call	dlg_bottomEdge
0156+  F996             
0157+  F996             		; Ïåðåçàãðóçèòü è ïåðåðèñîâàòü âûáðàííûé ôàéë
0158+  F996 2A 70 D2    		lhld    v_curFile
0159+  F999 C3 FF F9    		jmp     dlg_reloadItem
0160+  F99C             
0161+  F99C             ; ---------------------------------------------------------------------------
0162+  F99C             ; Ðèñîâàíèå íèæíåé ãðàíèöû
0163+  F99C             
0164+  F99C             dlg_bottomEdge:
0165+  F99C             		; Òåìíûé ôîí, âîññòàíîâëåíèå êóðñîðà ýêðàíà, óäàëåíèå, êàêîé òî ñèìâîë
0166+  F99C CD D9 FE    		call	printStringEx
0167+  F99F 8C 94 08 1B 		.db 8Ch, 94h, 8, BORDER_BL, 0
0167+  F9A3 0C 00 
0168+  F9A5             	
0169+  F9A5             		; 46 ñèìâîëîâ 0x14
0170+  F9A5 01 0D 2E    		lxi	b, 2E00h | BORDER_B1
0171+  F9A8             
0172+  F9A8 CD B3 FC    		call	printChars
0173+  F9AB             
0174+  F9AB             		; Ñèìâîë 16, âîññòàíîâëåíèå êóðñîðà ñòðîêè
0175+  F9AB CD D9 FE    		call	printStringEx
0176+  F9AE 1B 18 8E 00 		.db BORDER_BR, 8Eh, 0
0177+  F9B2             
0178+  F9B2 C9          		ret
0179+  F9B3             
0180+  F9B3             ; ---------------------------------------------------------------------------
0181+  F9B3             ; Êëàâèøà âíèç.
0182+  F9B3             
0183+  F9B3             dlg_down:	; Åñëè ýòî ïîñëåäíèé ôàéë, ïåðåõîäèì íà ñëåäóþùóþ ñòðàíèöó
0184+  F9B3 CD D9 FD    		call	dlg_isLastLine
0185+  F9B6 D2 CB F9    		jnc	dlg_nextPage
0186+  F9B9             
0187+  F9B9             		; Åñëè ýòî ïîñëåäíÿÿ ñòðîêà íà ýêðàíå, ïåðåðèñîâûâàåì ýêðàí
0188+  F9B9             		; òàê ÷òî íàøà ñòðîêà îêàçûâàåòñÿ ñâåðõó.
0189+  F9B9 3A 1F FC    		lda	v_dlgOffset+1
0190+  F9BC 3D          		dcr	a
0191+  F9BD B9          		cmp	c
0192+  F9BE CA F2 FC    		jz	dlg_drawItems
0193+  F9C1             
0194+  F9C1             		; Ïîìåùàåì â ñòåê àäðåñ ñëåäóþùåãî ôàéëà
0195+  F9C1 2A 74 D2    		lhld	f_nextFile
0196+  F9C4 E5          		push	h
0197+  F9C5             
0198+  F9C5             		; Ñòèðàåì êóðñîð
0199+  F9C5 CD F7 FB    		call	printFileHeaderDark
0200+  F9C8             		
0201+  F9C8 C3 F5 F9    		jmp	dlg_upDownInt
0202+  F9CB             		
0203+  F9CB             ; ---------------------------------------------------------------------------
0204+  F9CB             
0205+  F9CB             dlg_nextPage:	; Ñëåäóþùàÿ ñòðàíèöà (â ðåãèñòðå b)
0206+  F9CB CD 69 F8    		call	pageNext
0207+  F9CE             
0208+  F9CE             		; Ýòî áûëà ïîñëåäíÿÿ ñòðàíèöà
0209+  F9CE D8          		rc
0210+  F9CF             
0211+  F9CF             		; Ñòðàíèöà áûëà èçìåíåíà
0212+  F9CF C3 EF FC    		jmp	dlg_pageChanged
0213+  F9D2             
0214+  F9D2             ; ---------------------------------------------------------------------------
0215+  F9D2             
0216+  F9D2             dlg_prevPage:	; Åñëè ýòî íóëåâàÿ ñòðàíèöà, âûõîäèì
0217+  F9D2 78          		mov	a, b
0218+  F9D3~            #if ARAM_MAX_PAGE <= 7
0219+  F9D3~            		ani	7
0220+  F9D3             #else
0221+  F9D3 E6 0F       		ani	0Fh	; Ñòàðøèå áèòû âûïîëíÿþò ñïåö ôóíêöèè
0222+  F9D5             #endif
0223+  F9D5 CA 02 FA    		jz	dlg_drawItem
0224+  F9D8             
0225+  F9D8             		; Óìåíüøàåì ñòðàíèöó
0226+  F9D8 05          		dcr	b
0227+  F9D9 C3 EF FC    		jmp	dlg_pageChanged
0228+  F9DC             
0229+  F9DC             ; ---------------------------------------------------------------------------
0230+  F9DC             
0231+  F9DC             dlg_up:		; Åñëè ýòî ïåðâàÿ ñòðîêà, òî ïåðåéòè íà ïðåäûäóùóþ ñòðàíèöó
0232+  F9DC 2A 70 D2    		lhld	v_curFile
0233+  F9DF CD 54 C8    		call	j_cmp_hl_de
0234+  F9E2 CA D2 F9    		jz	dlg_prevPage
0235+  F9E5             
0236+  F9E5             		; Íåïîíÿòíî ÷òî â ñ
0237+  F9E5 79          		mov	a, c
0238+  F9E6 FE 03       		cpi	3
0239+  F9E8 CA EF FC    		jz	dlg_pageChanged
0240+  F9EB             
0241+  F9EB~            #if NO_BACK_LINKS
0242+  F9EB~            		; filePrev2 îæèäàåò çíà÷åíèå â ñòåêå
0243+  F9EB~            		push	h
0244+  F9EB~            		; Ñòèðàåì êóðñîð, òàê êàê filePrev2 ïåðåçàãðóçèò çàãîëîâîê
0245+  F9EB~            		call	printFileHeaderDark
0246+  F9EB~            .include	"filePrev2.inc"
0247+  F9EB~            		; Óíè÷òîæàåì çíà÷åíèå â ñòåêå
0248+  F9EB~            		pop	d
0249+  F9EB~            		; Ñîõðàíÿåì àäðåñ ôàéëà
0250+  F9EB~            		push	h
0251+  F9EB~            		; Ïðîïóñêàåì ñòèðàíèå êóðñîðà
0252+  F9EB~            		jmp	dlg_upDownInt2
0253+  F9EB             #else	
0254+  F9EB             .include	"filePrev.inc"
0001++ F9EB             ;+---------------------------------------------------------------------------
0002++ F9EB             ; RAMFOS
0003++ F9EB             ; Ïîëó÷èòü àäðåñ ïðåäûäóùåãî ôàéëà
0004++ F9EB             ;
0005++ F9EB             ; Íà âõîäå
0006++ F9EB             ;  hl - àäðåñ ôàéëà
0007++ F9EB             ;
0008++ F9EB             ; Íà âûõîäå
0009++ F9EB             ;  bc - àäðåñ ïðåäûäóùåãî ôàéëà
0010++ F9EB             ;
0011++ F9EB             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0012++ F9EB             ;----------------------------------------------------------------------------
0013++ F9EB             
0014++ F9EB             		; Ïîñëåäíèå äâà áàéòà ôàéëà ýòî óêàçàòåëü íà íà÷àëî.
0015++ F9EB 2B          		dcx	h
0016++ F9EC CD C2 FF    		call	pageRead
0017++ F9EF 41          		mov	b, c
0018++ F9F0 2B          		dcx	h
0019++ F9F1 CD C2 FF    		call	pageRead
0255+  F9F4             		; Ñîõðàíÿåì àäðåñ ôàéëà
0256+  F9F4 C5          		push	b
0257+  F9F5             #endif
0258+  F9F5             
0259+  F9F5             dlg_upDownInt:	; Ñòèðàåì êóðñîð
0260+  F9F5 CD F7 FB    		call	printFileHeaderDark
0261+  F9F8             
0262+  F9F8             dlg_upDownInt2:
0263+  F9F8             		; Ïåðåìåùàåì êóðñîð ââåðõ èëè âíèç
0264+  F9F8 3A 40 D2    		lda	v_lastKey
0265+  F9FB CD 0F C8    		call	j_printCharA
0266+  F9FE             
0267+  F9FE             		; Âîññòàíàëâàåì HL
0268+  F9FE E1          		pop	h
0269+  F9FF             
0270+  F9FF             dlg_reloadItem:	; Çàãðóçèòü çàãîëîâîê ôàéëà
0271+  F9FF CD 7A FB    		call	fileLoadHeader
0272+  FA02             
0273+  FA02             dlg_drawItem:	; Âûâåñòè íàçâàíèå ôàéëà
0274+  FA02 CD F2 FB    		call	printFileHeaderLight
0275+  FA05 4A          		mov	c, d
0276+  FA06             
0277+  FA06             		; Æäåì ñèìâîë ñ êîäîì <0x20
0278+  FA06 CD 72 FA    dlg_0:		call	keyWaitNoCursor
0279+  FA09 FE 20       		cpi	20h
0280+  FA0B D2 06 FA    		jnc	dlg_0
0281+  FA0E             
0282+  FA0E 32 40 D2    		sta	v_lastKey
0283+  FA11             
0284+  FA11             		; de - íà÷àëî äèñêà
0285+  FA11 2A 43 D2    		lhld	v_pageStart
0286+  FA14 EB          		xchg
0287+  FA15             
0288+  FA15 FE 19       		cpi	19h
0289+  FA17 CA DC F9    		jz	dlg_up
0290+  FA1A FE 1A       		cpi	1Ah
0291+  FA1C CA B3 F9    		jz	dlg_down
0292+  FA1F FE 0D       		cpi	0Dh
0293+  FA21 CA 8A FA    		jz	dlg_enter
0294+  FA24 FE 1B       		cpi	1Bh
0295+  FA26 CA 73 FB    		jz	dlg_esc		; ESC
0296+  FA29 B7          		ora	a
0297+  FA2A CA F7 FA    		jz	dlg_f1		; F1
0298+  FA2D 3D          		dcr	a
0299+  FA2E CA F1 FD    		jz	dlg_f2		; F2
0300+  FA31 3D          		dcr	a
0301+  FA32 CA 5C FE    		jz	dlg_f3		; F3
0302+  FA35 3D          		dcr	a
0303+  FA36 CA DF FE    		jz	dlg_f4		; F4
0304+  FA39 3D          		dcr	a
0305+  FA3A CA 30 FF    		jz	dlg_f5		; F5
0306+  FA3D 3D          		dcr	a
0307+  FA3E CA E9 FC    		jz	dlg_f6		; F6
0308+  FA41 3D          		dcr	a
0309+  FA42 C2 02 FA    		jnz	dlg_drawItem
0310+  FA45             		; Ïðîäîëæåíèå â startDebuger
0311+  FA45             
0312+  FA45             ; ---------------------------------------------------------------------------
0313+  FA45             
0314+  FA45             .include "startEditorDebuger.inc"
0001++ FA45             ;----------------------------------------------------------------------------
0002++ FA45             ; RAMFOS
0003++ FA45             ; Çàïóñê ðåäàòîðà è îòëàä÷èêà
0004++ FA45             ;
0005++ FA45             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006++ FA45             ;----------------------------------------------------------------------------
0007++ FA45             
0008++ FA45             #if NO_ROM_ENTRY
0009++ FA45             		; Àäðåñ ïîäïðîãðàììû â ÏÇÓ
0010++ FA45 21 60 FA    		lxi	h, a_debuger
0011++ FA48             
0012++ FA48             editorDebuger:	; Â ðåæèìå âûáîðà ôàéëà çàïóñêàòü íåëüçÿ
0013++ FA48 78          		mov	a, b
0014++ FA49 87          		add	a
0015++ FA4A F8          		rm
0016++ FA4B             
0017++ FA4B             		; Çàïóñê		
0018++ FA4B CD CB FA    exec:		call	exec1
0019++ FA4E C2 E7 C8    		jnz	biosInit
0020++ FA51 C3 B4 FA    		jmp	exec2
0021++ FA54             		
0022++ FA54 45 64 69 74 a_editor:	.db "Editor   EXE"
0022++ FA58 6F 72 20 20 
0022++ FA5C 20 45 58 45 
0023++ FA60 44 65 62 75 a_debuger:	.db "Debuger  EXE"
0023++ FA64 67 65 72 20 
0023++ FA68 20 45 58 45 
0024++ FA6C             
0025++ FA6C             ; ---------------------------------------------------------------------------
0026++ FA6C             
0027++ FA6C             startEditor:	; Àäðåñ ïîäïðîãðàììû â ÏÇÓ
0028++ FA6C 21 54 FA    		lxi	h, a_editor
0029++ FA6F C3 48 FA    		jmp	editorDebuger
0030++ FA72             
0031++ FA72~            #else ; ---------------------------------------------------------------------
0032++ FA72~            
0033++ FA72~            		; Àäðåñ ïîäïðîãðàììû â ÏÇÓ
0034++ FA72~            		lxi	h, 3
0035++ FA72~            
0036++ FA72~            editorDebuger:	; if(b & 0x40) return;
0037++ FA72~            		mov	a, b
0038++ FA72~            		ral
0039++ FA72~            		ral
0040++ FA72~            		rc
0041++ FA72~            
0042++ FA72~            		; Ïîìåùàåì â ñòåê àäðåñ âîçâðàòà
0043++ FA72~            		xthl
0044++ FA72~            
0045++ FA72~            		; Ñîõðàíÿåì âûáðàííûé ôàéë
0046++ FA72~            		call	memcpy_fd_fd2
0047++ FA72~            
0048++ FA72~            		; Àäðåñ çàãðóçêè
0049++ FA72~            		lxi	h, 0E800h
0050++ FA72~            
0051++ FA72~            		; Âêëþ÷àåì ÏÇÓ
0052++ FA72~            		sta	IO_PAGE_ROM
0053++ FA72~            		ret
0054++ FA72~            
0055++ FA72~            ; ---------------------------------------------------------------------------
0056++ FA72~            
0057++ FA72~            startEditor:	; Àäðåñ ïîäïðîãðàììû â ÏÇÓ
0058++ FA72~            		lxi	h, 6
0059++ FA72~            		jmp	editorDebuger
0060++ FA72~            
0061++ FA72             #endif0315+  FA72             .include "keyWaitNoCursor.inc"
0001++ FA72             ; Òóò îøèáêà, êóðñîð âñ¸òàêè ìîæåò ïðîìåëüêíóòü
0002++ FA72             
0003++ FA72 CD 12 C8    keyWaitNoCursor:call	j_keyCheck
0004++ FA75 C2 03 C8    		jnz	j_keyWait
0005++ FA78 C3 72 FA    		jmp	keyWaitNoCursor0316+  FA7B             .include "memcmp_hl_de_c.inc"
0001++ FA7B 11 5E D2    memcmp_ext:	lxi	d, v_header_ext
0002++ FA7E             
0003++ FA7E 0E 03       memcmp_hl_de_3:	mvi	c, 3
0004++ FA80             
0005++ FA80             memcmp_hl_de_c:	 ; if(*de-- != *hl--) return;
0006++ FA80 1A          		 ldax	d
0007++ FA81 BE          		 cmp	m
0008++ FA82 23          		 inx	h
0009++ FA83 C0          		 rnz
0010++ FA84 13          		 inx	d
0011++ FA85 0D          		 dcr	c
0012++ FA86 C2 80 FA    		jnz	memcmp_hl_de_c
0013++ FA89 C9          		ret
0317+  FA8A             
0318+  FA8A             ; ---------------------------------------------------------------------------
0319+  FA8A             
0320+  FA8A CD D9 FD    dlg_enter:	call	dlg_isLastLine
0321+  FA8D CA 02 FA    		jz	dlg_drawItem
0322+  FA90             
0323+  FA90~            #if OPEN_ANY_FILE==0
0324+  FA90~            		; Ñðàâíèòü ðàñøèðåíèå âûáðàííîãî ôàéëà ñ óñòàíîâëåííûì ðàñøèðåíèåì
0325+  FA90~            		lxi	h, v_header2_ext
0326+  FA90~            		call	memcmp_ext
0327+  FA90             #endif
0328+  FA90             		; Åñëè ýòî ðåæèì âûáîðà ôàéëà
0329+  FA90 78          		mov	a, b
0330+  FA91 17          		ral
0331+  FA92 17          		ral
0332+  FA93             #if OPEN_ANY_FILE
0333+  FA93 DA E6 FA    		jc	dlg_enter_1
0334+  FA96~            #else
0335+  FA96~            		jc	dlg_enter_0
0336+  FA96             #endif	
0337+  FA96             
0338+  FA96             .include "exec.inc"
0001++ FA96             ;----------------------------------------------------------------------------
0002++ FA96             ; RAMFOS
0003++ FA96             ; Çàïóñê RKS ôàéëà
0004++ FA96             ;
0005++ FA96             ; 2013-11-01 Ðàçðàáîòàíî vinxru
0006++ FA96             ;----------------------------------------------------------------------------
0007++ FA96             
0008++ FA96             #if RKS_LOADER
0009++ FA96             		; Ýòî RKS ôàéë
0010++ FA96 21 BC FA    		lxi	h, a_rks
0011++ FA99 CD 7B FA    		call	memcmp_ext
0012++ FA9C C2 D7 FA    		jnz	defExec2
0013++ FA9F             		
0014++ FA9F             		; Çàãðóçèòü åãî â ïàìÿòü
0015++ FA9F CD 4B FB    		call	fileLoad2
0016++ FAA2 C2 B5 FE    		jnz	dlg_error
0017++ FAA5             
0018++ FAA5             		; Íàéòè ôàéë Monitor2.sys â ÏÇÓ
0019++ FAA5 E5          		push	h
0020++ FAA6 21 BF FA    		 lxi	h, a_monitor2_sys
0021++ FAA9 CD CB FA    		 call	exec1
0022++ FAAC E1          		pop	h
0023++ FAAD             
0024++ FAAD C2 B5 FE    		jnz	dlg_error
0025++ FAB0             		
0026++ FAB0             		; ×òî áû íå èñïîðòèòü ñòåê
0027++ FAB0 31 FF 8F    		lxi	sp, 8FFFh
0028++ FAB3             
0029++ FAB3             		; Àäðåñ ïðîãðàììû
0030++ FAB3 E5          		push	h
0031++ FAB4             
0032++ FAB4             exec2:		; Àäðåñ çàïóñêà ìîíèòîðà
0033++ FAB4 2A 6A D2    		lhld	v_header_start
0034++ FAB7 E5          		push	h
0035++ FAB8 EB          		xchg
0036++ FAB9 C3 3C FB                    jmp	fileLoadNoCheck
0037++ FABC             
0038++ FABC 52 4B 53    a_rks:		.db "RKS"
0039++ FABF 4D 6F 6E 69 a_monitor2_sys:	.db "Monitor2 SYS"
0039++ FAC3 74 6F 72 32 
0039++ FAC7 20 53 59 53 
0040++ FACB             		
0041++ FACB CD 59 FF    exec1:		call	fileSetName		
0042++ FACE CD 5A F8    		call	fileFind
0043++ FAD1 06 80       		mvi	b, 80h
0044++ FAD3 C4 5C F8    		cnz	fileFindEx
0045++ FAD6 C9          		ret
0046++ FAD7             
0047++ FAD7             defExec2:
0048++ FAD7             #endif0339+  FAD7             
0340+  FAD7             		; Äîïóñêàþòñÿ òîëüêî ðàñøèðåíèÿ EXE è COM
0341+  FAD7 21 84 FF    		lxi	h, a_exe		; "EXE"
0342+  FADA CD 7B FA    		call	memcmp_ext
0343+  FADD 21 87 FF    		lxi	h, a_com		; "COM"
0344+  FAE0 C4 7B FA    		cnz	memcmp_ext
0345+  FAE3             
0346+  FAE3             		; Íåäîïóñòèìîå ðàñøèðåíèå, ïåðåõîäèì â îñíîâíîé öèêë
0347+  FAE3 C2 02 FA    dlg_enter_0:	jnz	dlg_drawItem
0348+  FAE6             
0349+  FAE6 2A 6A D2    dlg_enter_1:	lhld	v_header_start
0350+  FAE9 EB          		xchg
0351+  FAEA             
0352+  FAEA             		; Ðåæèì âûáîðà
0353+  FAEA DA 13 FB    		jc	dlg_select
0354+  FAED             
0355+  FAED CD 4F FB    		call	fileLoadComEx
0356+  FAF0 C2 B5 FE    		jnz	dlg_error
0357+  FAF3             
0358+  FAF3             		;
0359+  FAF3 E3          		xthl
0360+  FAF4 C3 1A FB    		jmp	loc_FB05
0361+  FAF7             
0362+  FAF7             ; ---------------------------------------------------------------------------
0363+  FAF7             
0364+  FAF7             dlg_f1:		; Âûâîäèì ñîîáùåíèå
0365+  FAF7 11 8A FF    		lxi	d, a_copy
0366+  FAFA CD AE FD    		call	dlg_checkMsg
0367+  FAFD C8          		rz
0368+  FAFE             
0369+  FAFE             		; Ââîä ÷èñëà â v_header_start
0370+  FAFE CD 80 F9    		call	dlg_yesNo
0371+  FB01 2A 6A D2    		lhld	v_header_start	; Çà÷åì?
0372+  FB04 FC 39 C8    		cm	j_strToHex	; Ïðåîáðàçîâàòü ñòðîêó DE â ÷èñëî HL
0373+  FB07 CA B5 FE    		jz	dlg_error
0374+  FB0A             
0375+  FB0A             fileLoadSetAddr:; Óñòàíîâèòü íîâûé àäðåñ çàãðóçêè
0376+  FB0A             		; de = v_header_start = hl; 
0377+  FB0A             		; hl = v_header_stop  = f_fileBodySize + hl;
0378+  FB0A CD 2A FB    		call	fileChangeAddr
0379+  FB0D             
0380+  FB0D             		; Åñëè ðåæèì âûáîðà ôàéëà, òî ñîõðàíÿåì çàãîëîâîê ôàéëà.
0381+  FB0D             		; Â çàãîëîâêå ìû òîëüêî ÷òî èçìåíèëè àäðåñ çàãðóçêè
0382+  FB0D 78          		mov	a, b
0383+  FB0E 17          		ral
0384+  FB0F 17          		ral
0385+  FB10 D2 39 D1    		jnc	fileSaveHeader
0386+  FB13             		
0387+  FB13             dlg_select:	; Çàãðóçèòü ôàéë â ïàìÿòü
0388+  FB13 CD 4F FB    		call	fileLoadComEx
0389+  FB16 C2 B5 FE    		jnz	dlg_error
0390+  FB19 E1          		pop	h
0391+  FB1A             
0392+  FB1A C5          loc_FB05:	push	b
0393+  FB1B             		 ; Âûâåñòè èìÿ ôàéëà
0394+  FB1B CD 06 FC    		 call	printFileHeaderName
0395+  FB1E             		 ; Ñîõðàíèòü èíôîðìàöèþ î çàãðóæåííîì ôàéëå
0396+  FB1E CD BB FB    		 call	memcpy_fd_fd2
0397+  FB21 C1          		pop	b
0398+  FB22             
0399+  FB22             loadDStartDStop:; de=v_header_stop, hl=v_header_start
0400+  FB22 2A 6C D2    		lhld	v_header_stop
0401+  FB25 EB          		xchg
0402+  FB26 2A 6A D2    		lhld	v_header_start
0403+  FB29 C9          		ret
0404+  FB2A             
0405+  FB2A             ; ---------------------------------------------------------------------------
0406+  FB2A             
0407+  FB2A             ; de = v_header_start = hl; v_header_stop = f_fileBodySize+hl;
0408+  FB2A             
0409+  FB2A 22 6A D2    fileChangeAddr: shld	v_header_start
0410+  FB2D EB          		xchg
0411+  FB2E 2A 76 D2    		lhld	f_fileBodySize
0412+  FB31 19          		dad	d
0413+  FB32 22 6C D2    		shld	v_header_stop
0414+  FB35 C9          		ret
0415+  FB36             
0416+  FB36             ; ---------------------------------------------------------------------------
0417+  FB36             
0418+  FB36             .include "fileLoad.inc"
0001++ FB36             fileLoad:	; Ïîäìåíÿåì àäðåñ çàãðóçêè â çàãîëîâêå ôàéëà
0002++ FB36             		; de = v_header_start = hl; v_header_stop = f_fileBodySize + hl;
0003++ FB36 CD 2A FB    		call	fileChangeAddr
0004++ FB39             
0005++ FB39 C3 5E FB    		jmp	fileLoadCom
0006++ FB3C             
0007++ FB3C             ; ---------------------------------------------------------------------------
0008++ FB3C             
0009++ FB3C             #if RKS_LOADER
0010++ FB3C             fileLoadNoCheck:; bc - äëèíà ôàéëà
0011++ FB3C             		; hl - àäðåñ òåëà ôàéëà â ÄÎÇÓ
0012++ FB3C 2A 76 D2    		lhld	f_fileBodySize
0013++ FB3F E5          		push	h
0014++ FB40 2A 70 D2    		 lhld	v_curFile ; óêàçàòåëü íà çàãîëîâîê
0015++ FB43 01 1E 00    		 lxi	b, 30	; äëèíà çàãîëîâêà
0016++ FB46 09          		 dad	b
0017++ FB47 C1          		pop	b
0018++ FB48             
0019++ FB48             		; ×èòàåì bc áàéò èç ÄÎÇÓ ïî àäðåñó hl â ÎÇÓ ïî àäðåñó de
0020++ FB48 C3 9E FD    		jmp	pageReadBlock ; hl-äèñê,de-ïàìÿòü,bc-äëèíà-1
0021++ FB4B             
0022++ FB4B             ; ---------------------------------------------------------------------------
0023++ FB4B             		
0024++ FB4B 2A 6A D2    fileLoad2:	lhld	v_header_start
0025++ FB4E EB          		xchg
0026++ FB4F             #endif
0027++ FB4F             
0028++ FB4F             ; Äîëæåí áûòü çàãðóæåí çàãîëîâîê
0029++ FB4F             ; Íà âûõîäå äîëæíî áûòü de = v_header_start
0030++ FB4F             
0031++ FB4F             fileLoadComEx:	; Âûâîä ñîîáùåíèÿ "Æäèòå!"
0032++ FB4F CD D9 FE    		call	printStringEx
0033++ FB52 8E 8B 20 D6 		.db 8Eh, 8Bh, 20h, 0D6h, 0C4h, 0C9h, 0D4h, 0C5h, 21h, 20h, 8Eh, 0
0033++ FB56 C4 C9 D4 C5 
0033++ FB5A 21 20 8E 00 
0034++ FB5E             
0035++ FB5E             fileLoadCom:
0036++ FB5E             #if RKS_LOADER
0037++ FB5E CD 3C FB    		call	fileLoadNoCheck
0038++ FB61~            #else
0039++ FB61~            		; bc - äëèíà ôàéëà
0040++ FB61~            		; hl - àäðåñ òåëà ôàéëà â ÄÎÇÓ
0041++ FB61~            		lhld	f_fileBodySize
0042++ FB61~            		push	h
0043++ FB61~            		 lhld	v_curFile ; óêàçàòåëü íà çàãîëîâîê
0044++ FB61~            		 lxi	b, 30	; äëèíà çàãîëîâêà
0045++ FB61~            		 dad	b
0046++ FB61~            		pop	b
0047++ FB61~            
0048++ FB61~            		; ×èòàåì bc áàéò èç ÄÎÇÓ ïî àäðåñó hl â ÎÇÓ ïî àäðåñó de
0049++ FB61~            		call	pageReadBlock ; hl-äèñê,de-ïàìÿòü,bc-äëèíà-1#endif
0050++ FB61             #endif
0051++ FB61             		; Ðàñ÷èòûâàåì êîíòðîëüíóþ ñóììó îò v_header_start äî v_header_stop
0052++ FB61 1B          		dcx	d
0053++ FB62 2A 6A D2    		lhld	v_header_start
0054++ FB65 CD 2A C8    		call	j_calcCrc
0055++ FB68             
0056++ FB68             		; Ñðàâíèòü bc è v_header_crc
0057++ FB68 C5          		push	b
0058++ FB69 D1          		pop	d		
0059++ FB6A 2A 6E D2    		lhld	v_header_crc
0060++ FB6D CD 54 C8    		call	j_cmp_hl_de
0061++ FB70             
0062++ FB70             		; de=v_header_stop, hl=v_header_start
0063++ FB70 C3 22 FB    		jmp	loadDStartDStop
0419+  FB73             
0420+  FB73             ; ---------------------------------------------------------------------------
0421+  FB73             
0422+  FB73             dlg_esc:	; Åñëè ýòî íå ðåæèì âûáîðà ôàéëà, íè÷åãî íå äåëàåì
0423+  FB73 78          		mov	a, b
0424+  FB74 17          		ral
0425+  FB75 17          		ral
0426+  FB76 D0          		rnc
0427+  FB77             
0428+  FB77             		; Âîçâðàùàåìñÿ â ïðîãðàììó		
0429+  FB77 E1          		pop	h
0430+  FB78 3F          		cmc
0431+  FB79 C9          		ret
0432+  FB7A             
0433+  FB7A             ; ---------------------------------------------------------------------------
0434+  FB7A             
0435+  FB7A             .include "fileLoadHeader.inc"
0001++ FB7A             ;----------------------------------------------------------------------------
0002++ FB7A             ; RAMFOS
0003++ FB7A             ; Çàãðóçèòü çàãîëîâîê ôàéëà
0004++ FB7A             ;
0005++ FB7A             ; Íà âõîäå
0006++ FB7A             ;   v_page          - Íîìåð òåêóùåé ñòðàíèöû
0007++ FB7A             ;   hl              - Àäðåñ òåêóùåãî ôàéëà â ÄÎÇÓ
0008++ FB7A             ;
0009++ FB7A             ; Íà âûõîäå, åñëè ôàéë íàéäåí
0010++ FB7A             ;   b               - Òåêóùàÿ ñòðàíèöà ÄÎÇÓ
0011++ FB7A             ;   v_curFile       - Àäðåñ òåêóùåãî ôàéëà â ÄÎÇÓ
0012++ FB7A             ;   v_header        - Çàãîëîâîê ôàéëà
0013++ FB7A             ;   f_fileBodySize  - Äëèíà ôàéëà áåç çàãîëîâêà - 1
0014++ FB7A             ;   f_fileSize      - Äëèíà ôàéëà ñ çàãîëîâêîì
0015++ FB7A             ;   f_nextFile      - Àäðåñ ñëåäóþùåãî ôàéëà â ÄÎÇÓ
0016++ FB7A             ;
0017++ FB7A             ;   Åñëè íå âêëþ÷åíî NO_BACK_LINKS, â ÄÎÇÓ ïî àäðåñó v_curFile + f_fileSize 
0018++ FB7A             ;   çàïèñûâàåòñÿ v_curFile
0019++ FB7A             ;
0020++ FB7A             ; Íà âûõîäå, åñëè ôàéë íå íàéäåí
0021++ FB7A             ;   v_pageFreePtr, v_curFile - Àäðåñ ïåðâîãî ñâîáîäíîãî áàéòà
0022++ FB7A             ;   v_pageFreeTotal      - Ñâîáîäíî áàéò
0023++ FB7A             ;
0024++ FB7A             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0025++ FB7A             ;----------------------------------------------------------------------------
0026++ FB7A             
0027++ FB7A             fileLoadHeader:	; Ñîõðàíÿåì ñìåùåíèå òåêóùåãî ôàéëà â v_curFile
0028++ FB7A 22 70 D2    		shld	v_curFile
0029++ FB7D             
0030++ FB7D             		; ×èòàåì çàãîëîâîê ôàéëà ñ äèñêà â v_header
0031++ FB7D 11 52 D2    		lxi	d, v_header
0032++ FB80 D5          		push	d
0033++ FB81 01 1D 00    		 lxi	b, FILE_HEADER_SIZE-1
0034++ FB84 CD 9E FD    		 call	pageReadBlock
0035++ FB87 D1          		pop	d
0036++ FB88             
0037++ FB88             		; Ïîìåùàåì â Â òåêóùóþ ñòðàíèöó
0038++ FB88 3A 45 D2    		lda	v_page
0039++ FB8B 47          		mov	b, a
0040++ FB8C             
0041++ FB8C             		; Â íà÷àëå ôàéëà äîëæíî áûòü D3,D3,D3
0042++ FB8C 21 75 FF    		lxi	h, a_defHeader
0043++ FB8F CD 7E FA    		call	memcmp_hl_de_3	; b íå èçìåíÿåò
0044++ FB92             
0045++ FB92             		; Åñëè ìàðêåð íàéäåí, òî ïåðåõîäèì ê fileLoadHeader2
0046++ FB92 CA CC FB    		jz	fileLoadHeader2
0047++ FB95             
0048++ FB95             		; Íå íàéäåí ìàðêåð íà÷àëà ôàéëà!
0049++ FB95             
0050++ FB95             		; Âîññòàíàëèâàåì çàãîëîâîê â ïàìÿòè
0051++ FB95 21 75 FF    		lxi	h, a_defHeader
0052++ FB98 11 52 D2    		lxi	d, v_header
0053++ FB9B CD C1 FB    		call	memcpy_de_hl_15
0054++ FB9E             
0055++ FB9E             		; Óñòàíàëèâàåì êîíåö ñòðàíèöû
0056++ FB9E 2A 74 D2    		lhld	f_nextFile	
0057++ FBA1 22 7C D2    		shld	v_pageFreePtr
0058++ FBA4 EB          		xchg
0059++ FBA5             
0060++ FBA5             		; Ïîëó÷àåì â HL ðàçìåð ñòðàíèöû
0061++ FBA5 2A 1C C6    		lhld	v_aramPageEnd
0062++ FBA8 3A 59 FD    		lda	a_panelOA
0063++ FBAB FE 4F       		cpi	'O'
0064++ FBAD C2 B3 FB    		jnz	fileLoadHeader_0
0065++ FBB0 21 F5 E7    		 lxi	h, ROM_PAGE_END
0066++ FBB3             fileLoadHeader_0:	
0067++ FBB3                             ; Ðàññ÷èòûâàåì ñâîáîäíîå ìåñòî íà äèñêå
0068++ FBB3 CD EA FD    		call	sub_hl_de
0069++ FBB6 22 7A D2    		shld	v_pageFreeTotal
0070++ FBB9             
0071++ FBB9             		; ?
0072++ FBB9 0D          		dcr	c
0073++ FBBA C9          		ret0436+  FBBB             
0437+  FBBB             ; ---------------------------------------------------------------------------
0438+  FBBB             ; Ñêîïèðîâàòü èìÿ âûáðàííîãî ôàéëà ñ v_header2_name
0439+  FBBB             
0440+  FBBB 21 52 D2    memcpy_fd_fd2:	lxi	h, v_header
0441+  FBBE 11 F2 D1    		lxi	d, v_header2
0442+  FBC1 0E 0E       memcpy_de_hl_15:mvi	c, 14
0443+  FBC3             
0444+  FBC3             .include "memcpy_de_hl_c.inc"
0001++ FBC3 7E          memcpy_de_hl_c: mov	a, m
0002++ FBC4 12          		stax	d
0003++ FBC5 23          		inx	h
0004++ FBC6 13          		inx	d
0005++ FBC7 0D          		dcr	c
0006++ FBC8 F2 C3 FB    		jp	memcpy_de_hl_c
0007++ FBCB C9          		ret
0445+  FBCC             .include "fileLoadHeader2.inc"
0001++ FBCC             ;----------------------------------------------------------------------------
0002++ FBCC             ; RAMFOS
0003++ FBCC             ; Ðàñ÷èòàòü äîï ïåðåìåííûå çàãðóæåííîãî çàãîëîâêà ôàéëà
0004++ FBCC             ;
0005++ FBCC             ; Íà âõîäå
0006++ FBCC             ;   v_curFile      - Àäðåñ òåêóùåãî ôàéëà â ÄÎÇÓ
0007++ FBCC             ;   f_header       - Çàãîëîâîê ôàéëà
0008++ FBCC             ;
0009++ FBCC             ; Íà âûõîäå
0010++ FBCC             ;   f_fileBodySize - Äëèíà ôàéëà áåç çàãîëîâêà - 1
0011++ FBCC             ;   f_fileSize     - Äëèíà ôàéëà ñ çàãîëîâêîì
0012++ FBCC             ;   f_nextFile     - Àäðåñ ñëåäóþùåãî ôàéëà â ÄÎÇÓ
0013++ FBCC             ;
0014++ FBCC             ;   Åñëè íå âêëþ÷åíî NO_BACK_LINKS, â ÄÎÇÓ ïî àäðåñó v_curFile + f_fileSize 
0015++ FBCC             ;   çàïèñûâàåòñÿ v_curFile
0016++ FBCC             ;
0017++ FBCC             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0018++ FBCC             ;----------------------------------------------------------------------------
0019++ FBCC             
0020++ FBCC             fileLoadHeader2:; Äëèíà ôàéëà áåç çàãîëîâêà
0021++ FBCC             		; f_fileBodySize = v_header_stop - v_header_start
0022++ FBCC CD 22 FB    		call	loadDStartDStop	
0023++ FBCF EB          		xchg
0024++ FBD0 CD EA FD    		call	sub_hl_de
0025++ FBD3 22 76 D2    		shld	f_fileBodySize
0026++ FBD6             
0027++ FBD6             		; Äëèíà ôàéëà ñ çàãîëîâîì
0028++ FBD6             		; f_fileSize = f_fileBodySize+1
0029++ FBD6 11 1F 00    		lxi	d, FILE_HEADER_SIZE+1
0030++ FBD9 19          		dad	d
0031++ FBDA 22 78 D2    		shld	f_fileSize
0032++ FBDD             
0033++ FBDD             		; Êîíåö ôàéëà
0034++ FBDD             		; de = v_curFile + f_fileSize
0035++ FBDD EB          		xchg
0036++ FBDE 2A 70 D2    		lhld	v_curFile
0037++ FBE1 EB          		xchg
0038++ FBE2 19          		dad	d
0039++ FBE3             
0040++ FBE3~            #if NO_BACK_LINKS
0041++ FBE3~            		inx	h
0042++ FBE3~            		inx	h
0043++ FBE3             #else
0044++ FBE3             		; Îáíîâëÿåì â ÄÎÇÓ óêàçàòåëü íà íàø ôàéë, êîòîðûé íàõîäèòñÿ
0045++ FBE3             		; ïåðåä ñëåäóþùèì ôàéëîì.
0046++ FBE3 4B          		mov	c, e
0047++ FBE4 CD D1 FF    		call	pageWrite
0048++ FBE7 23          		inx	h
0049++ FBE8 4A          		mov	c, d
0050++ FBE9 CD D1 FF    		call	pageWrite
0051++ FBEC 23          		inx	h
0052++ FBED             #endif
0053++ FBED             		; Àäðåñ ñëåäóþùåãî ôàéëà
0054++ FBED             		; f_nextFile =  v_curFile + f_fileSize + 2
0055++ FBED 22 74 D2    		shld	f_nextFile
0056++ FBF0             
0057++ FBF0             		; Âîçâðàùàåì íîëü è Z
0058++ FBF0 AF          		xra	a
0059++ FBF1 C9          		ret0446+  FBF2             .include "printFileHeaderName.inc"
0001++ FBF2             printFileHeaderLight:
0002++ FBF2             		; Åñëè ñäåëàòü êóðñîð öâåòíûì, òî öâåò áóäåò çàäåâàòü ðàìêó. 
0003++ FBF2             
0004++ FBF2             		; Èíâåðñèÿ
0005++ FBF2 3E 8B       		mvi	a, C_INVERSE
0006++ FBF4 CD 0F C8    		call	j_printCharA
0007++ FBF7             
0008++ FBF7             printFileHeaderDark:
0009++ FBF7             		; Ôóíêöèÿ ñîõðàíèò ïîëîæåíèå êóðñîðà ñòðîêè, íî íå âîññòàíîâèò åãî
0010++ FBF7             		; Âûâåäåò íà ýêðàí èìÿ ôàéëà
0011++ FBF7             		; Ïîñëå âûâîäà èìåíè ôóíêöèÿ óñòàíîâèò òåìíûé ôîí
0012++ FBF7 CD FF FB    		call	printFileHeaderName2
0013++ FBFA             
0014++ FBFA             popCursorLine2:	; Âîññòàíîâèòü êóðñîð ñòðîêè
0015++ FBFA 3E 8E       		mvi	a, C_POPCURSORL
0016++ FBFC C3 0F C8    		jmp	j_printCharA
0017++ FBFF             
0018++ FBFF             ; ---------------------------------------------------------------------------
0019++ FBFF             ; Ôóíêöèÿ ñîõðàíèò ïîëîæåíèå êóðñîðà ñòðîêè, íî íå âîññòàíîâèò åãî
0020++ FBFF             ; Âûâåäåò íà ýêðàí èìÿ ôàéëà
0021++ FBFF             ; Ïîñëå âûâîäà èìåíè ôóíêöèÿ óñòàíîâèò òåìíûé ôîí
0022++ FBFF             
0023++ FBFF             printFileHeaderName2:
0024++ FBFF CD 90 FD    		call	pushCursorLine2
0025++ FC02 CD 1E C8    		call	j_getCursorPos
0026++ FC05 EB          		xchg
0027++ FC06             
0028++ FC06             printFileHeaderName:
0029++ FC06 0E 0C       		mvi	c, 12
0030++ FC08 21 55 D2    		lxi	h, v_header_name
0031++ FC0B             printFileHeaderName_0:
0032++ FC0B 7E          		 mov	a, m
0033++ FC0C 23          		 inx	h
0034++ FC0D CD 0F C8    		 call	j_printCharA
0035++ FC10 0D          		 dcr	c
0036++ FC11 C2 0B FC    		jnz	printFileHeaderName_0
0037++ FC14             
0038++ FC14             		; Óñòàíîâêà òåìíîãî ôîíà
0039++ FC14 3E 8C       		mvi	a, C_NORMAL
0040++ FC16 C3 0F C8    		jmp	j_printCharA0447+  FC19             
0448+  FC19             ; ---------------------------------------------------------------------------
0449+  FC19             
0450+  FC19 F5          dlg_printFile:	push	psw
0451+  FC1A CD 1E C8    		 call	j_getCursorPos
0452+  FC1D 7C          		 mov	a, h
0453+  FC1E D6 16       v_dlgOffset:	 sui	16h
0454+  FC20 E1          		pop	h
0455+  FC21             
0456+  FC21             		; if(a >= 0x16)	return;
0457+  FC21 D0          		rnc			
0458+  FC22             		
0459+  FC22             		; D272 = v_curFile
0460+  FC22 E5          		push	h
0461+  FC23             #if DLG_CURSOR_AT_TOP==0
0462+  FC23 2A 70 D2    		 lhld	v_curFile
0463+  FC26 22 72 D2    		 shld	v_printedFile
0464+  FC29             #endif		
0465+  FC29 F1          		pop	psw
0466+  FC2A             
0467+  FC2A             		; Åñëè íà âõîäå â ôóíêöèþ áûë NZ
0468+  FC2A C2 A4 FC    		jnz	loc_FC7A
0469+  FC2D             
0470+  FC2D             		; Âûâåñòè èìÿ ôàéëà
0471+  FC2D CD FF FB    		call	printFileHeaderName2
0472+  FC30             
0473+  FC30             		; Ðàçäåëèòåëü
0474+  FC30 CD 95 FD    		call	dlg_printSep
0475+  FC33             
0476+  FC33             		; Åñëè ôàéë èçìåíåí
0477+  FC33 7E          		mov	a, m
0478+  FC34 CD 0F C8    		call	j_printCharA
0479+  FC37 23          		inx	h
0480+  FC38             
0481+  FC38             		; Äàòà
0482+  FC38 0E 03       		mvi	c, 3
0483+  FC3A 7E          loc_FC1E:        mov	a, m
0484+  FC3B 23          		 inx	h
0485+  FC3C CD 15 C8    		 call	j_printHex
0486+  FC3F 0D          		 dcr	c
0487+  FC40             #if NICE
0488+  FC40 CA 4B FC    		 jz	loc_FC1E_
0489+  FC43 3E 2D       		 mvi	a, '-'
0490+  FC45 CD 0F C8    		 call	j_printCharA
0491+  FC48 C3 3A FC    		jmp	loc_FC1E
0492+  FC4B             loc_FC1E_:
0493+  FC4B~            #else
0494+  FC4B~            		jnz	loc_FC1E
0495+  FC4B             #endif
0496+  FC4B             		
0497+  FC4B             		; Ðàçäåëèòåëü
0498+  FC4B CD 95 FD    		call	dlg_printSep
0499+  FC4E             
0500+  FC4E             		; Èíôîðìàöèÿ î ôàéëå
0501+  FC4E CD 81 FC    		call	dlg_printFileInfo
0502+  FC51             
0503+  FC51             		; Âûâîäèì äëèíó
0504+  FC51 2A 76 D2    		lhld	f_fileBodySize
0505+  FC54 23          		inx	h
0506+  FC55             
0507+  FC55             printNumber:			
0508+  FC55             		; Ðàçäåëèòåëü
0509+  FC55 CD 95 FD    		call	dlg_printSep
0510+  FC58             
0511+  FC58             		; Âûâîä	HL íà ýêðàí â 10÷íîì âèäå
0512+  FC58 11 10 27    		lxi	d, 10000	
0513+  FC5B CD BD FC    		call	divAndPrint
0514+  FC5E 11 E8 03    		lxi	d, 1000
0515+  FC61 CD BD FC    		call	divAndPrint
0516+  FC64 11 64 00    		lxi	d, 100
0517+  FC67 CD BD FC    		call	divAndPrint
0518+  FC6A 11 0A 00    		lxi	d, 10
0519+  FC6D CD BD FC    		call	divAndPrint
0520+  FC70 7D          		mov	a, l
0521+  FC71 C6 30       		adi	'0'
0522+  FC73 CD 0F C8    		call	j_printCharA
0523+  FC76             		
0524+  FC76             		; Ïðàâàÿ ãðàíèöà
0525+  FC76             dlg_rightEdge:
0526+  FC76             #if ALL_CHARS
0527+  FC76 0E 0A       		mvi	c, BORDER_R1
0528+  FC78 CD A7 CB    		call	printCharAll
0529+  FC7B~            #else
0530+  FC7B~            		mvi	a, BORDER_R1
0531+  FC7B~            		call	j_printCharA
0532+  FC7B             #endif	
0533+  FC7B             		; Ïðàâûé êðàé
0534+  FC7B 21 89 FD    		lxi	h, a_rightEdge
0535+  FC7E C3 18 C8    		jmp	j_printString
0536+  FC81             
0537+  FC81             ; ---------------------------------------------------------------------------
0538+  FC81             
0539+  FC81             dlg_printFileInfo:		
0540+  FC81 CD 22 FB    		call	loadDStartDStop	; de=v_header_stop, hl=v_header_start
0541+  FC84             #if NICE
0542+  FC84 0E 2D       		mvi	c, '-'
0543+  FC86~            #else
0544+  FC86~            		mvi	c, ','
0545+  FC86             #endif
0546+  FC86 CD 99 FC    		call	printHexWord	; printHexWord(v_header_start)
0547+  FC89 EB          		xchg
0548+  FC8A             #if NICE
0549+  FC8A 0E 20       		mvi	c, ' '
0550+  FC8C~            #else
0551+  FC8C~            		inr	c		; c = '-'
0552+  FC8C             #endif
0553+  FC8C CD 99 FC    		call	printHexWord	; printHexWord(v_header_stop)
0554+  FC8F             #if NICE
0555+  FC8F 0E 19       		mvi	c, BORDER_H1
0556+  FC91 CD A7 CB    		call	printCharAll
0557+  FC94             #endif
0558+  FC94 2A 6E D2    		lhld	v_header_crc	; c = ?
0559+  FC97 0E 8C       		mvi	c, C_NORMAL
0560+  FC99             		; Ïðîäîëæåíèå íà printHexWord
0561+  FC99             
0562+  FC99             ; ---------------------------------------------------------------------------
0563+  FC99             
0564+  FC99             .include "printHexWord.inc"
0001++ FC99 7C          printHexWord:	mov	a, h
0002++ FC9A CD 15 C8    		call	j_printHex
0003++ FC9D 7D          		mov	a, l
0004++ FC9E CD 15 C8    		call	j_printHex
0005++ FCA1 C3 09 C8    		jmp	j_printChar0565+  FCA4             
0566+  FCA4             ; ---------------------------------------------------------------------------
0567+  FCA4             
0568+  FCA4             loc_FC7A:	; Ôóíêöèÿ ñîõðàíèò ïîëîæåíèå êóðñîðà ñòðîêè, íî íå âîññòàíîâèò åãî
0569+  FCA4             		; Âûâåäåò íà ýêðàí èìÿ ôàéëà
0570+  FCA4             		; Ïîñëå âûâîäà èìåíè ôóíêöèÿ óñòàíîâèò òåìíûé ôîí
0571+  FCA4 CD FF FB    		call	printFileHeaderName2
0572+  FCA7             
0573+  FCA7             #if NICE
0574+  FCA7             		; 27 ïðîáåëîâ
0575+  FCA7 01 20 1B    		lxi	b, 1B20h	; b-êîëâî, ñ-ñèìâîë
0576+  FCAA~            #else
0577+  FCAA~            		; 26 ïðîáåëîâ
0578+  FCAA~            		lxi	b, 1A20h	; b-êîëâî, ñ-ñèìâîë
0579+  FCAA             #endif
0580+  FCAA CD B3 FC    		call	printChars	
0581+  FCAD             		
0582+  FCAD             		; Ñâîáîäíîå ìåñòî
0583+  FCAD 2A 7A D2    		lhld	v_pageFreeTotal
0584+  FCB0 C3 55 FC    		jmp	printNumber
0585+  FCB3             
0586+  FCB3             ; ---------------------------------------------------------------------------
0587+  FCB3             
0588+  FCB3             .include "printChars.inc"
0001++ FCB3             ;----------------------------------------------------------------------------
0002++ FCB3             ; RAMFOS
0003++ FCB3             ; Âûâîä íà ýêðàí íåñêîëüêèõ ñèìâîëîâ
0004++ FCB3             ;
0005++ FCB3             ; Íà âõîäå:
0006++ FCB3             ;  b - êîë-âî
0007++ FCB3             ;  ñ - ñèìâîë
0008++ FCB3             ;
0009++ FCB3             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0010++ FCB3             ;----------------------------------------------------------------------------
0011++ FCB3             
0012++ FCB3             #if ALL_CHARS
0013++ FCB3                              
0014++ FCB3 C5          printChars:	 push	b
0015++ FCB4 CD A7 CB    		  call	printCharAll
0016++ FCB7 C1          		 pop	b
0017++ FCB8 05          		 dcr	b
0018++ FCB9 C2 B3 FC    		jnz	printChars
0019++ FCBC C9          		ret
0020++ FCBD             
0021++ FCBD~            #else
0022++ FCBD~            
0023++ FCBD~            printChars:	 call	j_printChar
0024++ FCBD~            		 dcr	b
0025++ FCBD~            		 rz
0026++ FCBD~            		jmp	printChars
0027++ FCBD~            
0028++ FCBD             #endif
0589+  FCBD             
0590+  FCBD             ; ---------------------------------------------------------------------------
0591+  FCBD             
0592+  FCBD 0E 2F       divAndPrint:	mvi	c, '0'-1
0593+  FCBF 0C          loc_FC93:	 inr	c
0594+  FCC0 CD EA FD    		 call	sub_hl_de
0595+  FCC3 D2 BF FC    		jnc	loc_FC93
0596+  FCC6 19          		dad	d
0597+  FCC7 C3 09 C8    		jmp	j_printChar
0598+  FCCA             		
0599+  FCCA             ; ---------------------------------------------------------------------------
0600+  FCCA             
0601+  FCCA             .include "filesetpage.inc"
0001++ FCCA             ;+---------------------------------------------------------------------------
0002++ FCCA             ; RAMFOS
0003++ FCCA             ; Óñòàíîâèòü àêòèâíóþ ñòðàíèöó
0004++ FCCA             ;
0005++ FCCA             ; Íà âõîäå
0006++ FCCA             ;  b - äèñê
0007++ FCCA             ;
0008++ FCCA             ; Íà âûõîäå
0009++ FCCA             ;  v_pageStart = v_curFile = f_nextFile = íà÷àëî ñòðàíèöû, çàãîëîâîê ïåðâîãî ôàéëà
0010++ FCCA             ;  hl - íà÷àëî ñòðàíèöû
0011++ FCCA             ;
0012++ FCCA             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0013++ FCCA             ;----------------------------------------------------------------------------
0014++ FCCA             
0015++ FCCA             fileSetPage:	; Íà÷àëî RAM-äèñêà
0016++ FCCA 2A 1E C6    		lhld	v_aramPageStart
0017++ FCCD             
0018++ FCCD             		; Äèñê
0019++ FCCD 78          		mov	a, b
0020++ FCCE 32 45 D2    		sta	v_page
0021++ FCD1             
0022++ FCD1             		; Ó ROM-äèñêà äðóãîå íà÷àëî
0023++ FCD1             		; Îáíîâëÿåì íàäïèñü RAM/ROM â çàãîëîâêå ôàéëîâîé ïàíåëè
0024++ FCD1 B7          		ora	a
0025++ FCD2 3E 41       		mvi	a, 'A'
0026++ FCD4 F2 DC FC    		jp	fileSetPage_1
0027++ FCD7 3E 4F       		 mvi	a, 'O'
0028++ FCD9             		 ; Íà÷àëî ROM-äèñêà
0029++ FCD9 21 00 18    		 lxi	h, ROM_PAGE_START
0030++ FCDC 32 59 FD    fileSetPage_1:	sta	a_panelOA
0031++ FCDF             
0032++ FCDF                             ; Ïàðàìåòðû äèñêà
0033++ FCDF 22 43 D2    		shld	v_pageStart
0034++ FCE2 22 70 D2    		shld	v_curFile
0035++ FCE5 22 74 D2    		shld	f_nextFile
0036++ FCE8 C9          		ret		0602+  FCE9             
0603+  FCE9             ; ---------------------------------------------------------------------------
0604+  FCE9             
0605+  FCE9             dlg_f6:		
0606+  FCE9~            #if NO_MXDOS==0
0607+  FCE9~            		; Åñëè â íîìåðå äèñêà 7, 6 áèòû íå óñòàíîâëåíû, çàïóñêàåì MXDOS
0608+  FCE9~            		mov	a, b
0609+  FCE9~            		ani	0C0h
0610+  FCE9~            		cz	loadMxDos
0611+  FCE9             #endif
0612+  FCE9             		; Çàïóñòèòü íå óäàëîñü, ìåíÿåì íà ïðîòèâîïîëîæíûé 7 áèò
0613+  FCE9 78          		mov	a, b
0614+  FCEA             #if NO_ROM_SWITCH_BUG
0615+  FCEA E6 F0       		ani	0F0h
0616+  FCEC             #endif
0617+  FCEC EE 80       		xri	80h
0618+  FCEE 47          		mov	b, a
0619+  FCEF             
0620+  FCEF             dlg_pageChanged:; Óñòàíàëèâàåì àêòèâíóþ ñòðàíèöó
0621+  FCEF CD CA FC    		call	fileSetPage
0622+  FCF2             
0623+  FCF2             dlg_drawItems:				; CODE XREF: dlg_down+Bj
0624+  FCF2 E5          		push	h
0625+  FCF3             		 ; Êîïèðóåì â çàãîëîâîê óñòàíîâëåííûé ôèëüòð
0626+  FCF3 21 FE D1    		 lxi	h, v_header2_ext
0627+  FCF6 11 5E FD    		 lxi	d, a_panelFilter
0628+  FCF9 0E 02       		 mvi	c, 2
0629+  FCFB CD C3 FB    		 call	memcpy_de_hl_c	; memcpy(de, hl, c+1)
0630+  FCFE             
0631+  FCFE             		 ; Êîïèðóåì òóäà æå àêòèâíóþ ñòðàíèöó
0632+  FCFE 78          		 mov	a, b
0633+  FCFF~            #if ARAM_MAX_PAGE <= 7
0634+  FCFF~            		 ani	7
0635+  FCFF             #else
0636+  FCFF E6 0F       		 ani	0Fh	; Ñòàðøèå áèòû âûïîëíÿþò ñïåö ôóíêöèè
0637+  FD01 FE 09       		 cpi	9
0638+  FD03 DA 08 FD    		 jc	correct
0639+  FD06 C6 07       		  adi	'A'-9-'1'
0640+  FD08             correct:
0641+  FD08             #endif
0642+  FD08 C6 31       		 adi	'1'
0643+  FD0A             #if NICE
0644+  FD0A 32 5C FD    		 sta	p_pageNum
0645+  FD0D~            #else
0646+  FD0D~            		 inx	d
0647+  FD0D~            		 stax	d
0648+  FD0D             #endif
0649+  FD0D E1          		pop	h
0650+  FD0E             
0651+  FD0E             dlg_redraw:
0652+  FD0E             	        ; Âûâîäèì ïàíåëü
0653+  FD0E CD D9 FE    		call	printStringEx
0654+  FD11             
0655+  FD11 8B 90       		.db C_INVERSE, C_BOTTOMLINE
0656+  FD13 20 46 31 2D 		.text " F1-COPY F2-DELETE F3-MLOAD F4-MSAVE F5-EDIT F6-DOS F7-DEBUG"
0656+  FD17 43 4F 50 59 
0656+  FD1B 20 46 32 2D 
0656+  FD1F 44 45 4C 45 
0656+  FD23 54 45 20 46 
0656+  FD27 33 2D 4D 4C 
0656+  FD2B 4F 41 44 20 
0656+  FD2F 46 34 2D 4D 
0656+  FD33 53 41 56 45 
0656+  FD37 20 46 35 2D 
0656+  FD3B 45 44 49 54 
0656+  FD3F 20 46 36 2D 
0656+  FD43 44 4F 53 20 
0656+  FD47 46 37 2D 44 
0656+  FD4B 45 42 55 47 
0657+  FD4F 8C          		.db C_NORMAL
0658+  FD50             #if NICE
0659+  FD50 B0          		.db 0B0h				; Êîíòðàñòíî
0660+  FD51~            #else
0661+  FD51~            		.db C_CLEARSCREEN			; î÷èñòêà ýêðàíà
0662+  FD51             #endif
0663+  FD51             #if NICE
0664+  FD51 1B 59 22 28 		.db 1Bh, 'Y', 20h+2, 20h+8		; ïîëîæåíèå ïàíåëè
0665+  FD55~            #else
0666+  FD55~            		.db 1Bh, 'Y', 20h+2, 20h+7		; ïîëîæåíèå ïàíåëè
0667+  FD55             #endif
0668+  FD55 17 93 8B    		.db 17h, 93h, 8Bh
0669+  FD58 52          		.db 'R'
0670+  FD59 41 4D       a_panelOA:	.db "AM"
0671+  FD5B             #if NICE
0672+  FD5B 5C          		.db '\'
0673+  FD5C 30 20       p_pageNum	.text "0 "
0674+  FD5E 20 20 20 20 a_panelFilter:	.text "          "
0674+  FD62 20 20 20 20 
0674+  FD66 20 20 
0675+  FD68~            #else
0676+  FD68~            		.text "_V6.0"
0677+  FD68~            		.db 92
0678+  FD68~            a_panelFilter:	.db 92,92,92
0679+  FD68~            		.db '\'
0680+  FD68~            p_pageNum	.db "0  "
0681+  FD68             #endif
0682+  FD68 C4 C1 D4 C1 		.db 0C4h, 0C1h,	0D4h, 0C1h ; äàòà
0683+  FD6C 20 20 20 20 		.db  ' ', ' ', ' ', ' '
0684+  FD70 C1 C4 CE    		.db 0C1h, 0C4h, 0CEh ; "àäí"
0685+  FD73 20          		.db ' '
0686+  FD74             #if NICE
0687+  FD74 20          		.db ' '
0688+  FD75 C1 C4 CB    		.db 0C1h, 0C4h, 0CBh ; "àäê"
0689+  FD78 20 20 20    		.db ' ', ' ', ' '
0690+  FD7B D3 D5 CD CD 		.db 0D3h, 0D5h, 0CDh, 0CDh, 0C1h ; "ñóììà"
0690+  FD7F C1 
0691+  FD80 20          		.db ' '
0692+  FD81~            #else
0693+  FD81~            		.db 2Ch
0694+  FD81~            		.db 0C1h, 0C4h, 0CBh ; "àäê"
0695+  FD81~            		.db ' '
0696+  FD81~            		.db 2Dh
0697+  FD81~            		.db 0D3h, 0D5h, 0CDh, 0CDh, 0C1h ; "ñóììà"
0698+  FD81~            		.db ' '
0699+  FD81~            		.db ' '
0700+  FD81             #endif
0701+  FD81 C4 CC C9 CE 		.db 0C4h, 0CCh, 0C9h, 0CEh, 0C1h ; "äëèíà"
0701+  FD85 C1 
0702+  FD86 20          		.db ' '
0703+  FD87 8C          		.db 8Ch ; òåìíûé ôîí
0704+  FD88             #if NICE
0705+  FD88 B8          		.db 0B8h				; Ñåðûé ôîí
0706+  FD89             #endif
0707+  FD89 94 1A 08 1B a_rightEdge:	.db 94h, 1Ah, 8, BORDER_L, 93h, 0 ; âîññòàíîâëåíèå êóðñîðà ýêðàíà, âíèç, âëåâî, |, çàïîìèíàíèå êóðñîðà ýêðàíà
0707+  FD8D 08 93 00 
0708+  FD90~            #if NO_MXDOS==0
0709+  FD90~            		sta	IO_FLOPPY_HEAD
0710+  FD90             #endif	
0711+  FD90             pushCursorLine2:; Ñîõðàíèòü êóðñîð ñòðîêè
0712+  FD90 3E 8D       		mvi	a, 8Dh
0713+  FD92 C3 0F C8    		jmp	j_printCharA
0714+  FD95             
0715+  FD95             ; ---------------------------------------------------------------------------
0716+  FD95             
0717+  FD95 CD D9 FE    dlg_printSep:	call	printStringEx
0718+  FD98 8C 20 1B 19 		.db C_NORMAL, ' ', BORDER_H, 
0719+  FD9C~            #if NICE==0
0720+  FD9C~            		.db ' '
0721+  FD9C             #endif
0722+  FD9C 00          		.db 0
0723+  FD9D C9          		ret
0724+  FD9E             
0725+  FD9E             ; ---------------------------------------------------------------------------
0726+  FD9E             
0727+  FD9E             .include "pageReadBlock.inc"
0001++ FD9E             ;+---------------------------------------------------------------------------
0002++ FD9E             ; RAMFOS
0003++ FD9E             ; ×òåíèå áëîêà äàííûõ èç ÄÎÇÓ/ÏÇÓ
0004++ FD9E             ;
0005++ FD9E             ; Íà âõîäå:
0006++ FD9E             ;  hl - îòêóäà, àäðåñ â ÄÎÇÓ/ÏÇÓ
0007++ FD9E             ;  de - êóäà, àäðåñ â ïàìÿòè
0008++ FD9E             ;  bc - äëèíà-1
0009++ FD9E             ;
0010++ FD9E             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0011++ FD9E             ;----------------------------------------------------------------------------
0012++ FD9E             
0013++ FD9E             pageReadBlock:  ; Ïðî÷èòàòü áàéò 
0014++ FD9E C5          		push	b		  
0015++ FD9F CD C2 FF    		 call	pageRead
0016++ FDA2 23          		 inx	h
0017++ FDA3 79          		 mov	a, c
0018++ FDA4 C1          		pop	b
0019++ FDA5             		; Ñîõðàíèòü áàéò
0020++ FDA5 12          		stax	d
0021++ FDA6 13          		inx	d
0022++ FDA7             		; if(bc == 0) break;
0023++ FDA7 79          		mov	a, c
0024++ FDA8 B0          		ora	b
0025++ FDA9             		; bc--
0026++ FDA9 0B          		dcx	b
0027++ FDAA C2 9E FD    		jnz	pageReadBlock
0028++ FDAD C9          		ret
0728+  FDAE             
0729+  FDAE             ; ---------------------------------------------------------------------------
0730+  FDAE             
0731+  FDAE             dlg_checkMsg:	; Âûéòè ñ ôëàãîì Z, åñëè âûáðàíà ïîñëåäíÿÿ ñòðîêà
0732+  FDAE D5          		push	d                
0733+  FDAF CD D9 FD    		call	dlg_isLastLine
0734+  FDB2 D1          		pop	d
0735+  FDB3 C8          		rz
0736+  FDB4             
0737+  FDB4             dlg_msg:	; Âûâîä ñîîáùåíèÿ
0738+  FDB4 F5          		push	psw
0739+  FDB5 CD D9 FE    		 call	printStringEx
0740+  FDB8 94 08 8B 20 		 .db C_POPCURSORS, C_LEFT, C_INVERSE, ' ', ' ', ' ', 0C6h, 0C1h, 0CAh, 0CCh ; ôàéë òèï
0740+  FDBC 20 20 C6 C1 
0740+  FDC0 CA CC 
0741+  FDC2 20 20 2E D4 		 .db ' ', ' ', 2Eh, 0D4h, 0C9h, 0D0h, ' ', 0Eh, ' ', 0
0741+  FDC6 C9 D0 20 0E 
0741+  FDCA 20 00 
0742+  FDCC             		 
0743+  FDCC EB          		 xchg
0744+  FDCD CD 18 C8    		 call	j_printString
0745+  FDD0             
0746+  FDD0 CD D9 FE    		 call	printStringEx
0747+  FDD3 3A 3F       aa:		 .text ":?"
0748+  FDD5 08 00       		 .db C_LEFT, 0
0749+  FDD7 F1          		pop	psw
0750+  FDD8 C9          		ret
0751+  FDD9             
0752+  FDD9             ; ---------------------------------------------------------------------------
0753+  FDD9             
0754+  FDD9 2A 7C D2    dlg_isLastLine:	lhld	v_pageFreePtr
0755+  FDDC EB          		xchg
0756+  FDDD 2A 70 D2    		lhld	v_curFile
0757+  FDE0 C3 54 C8    		jmp	j_cmp_hl_de
0758+  FDE3             
0759+  FDE3             ; ---------------------------------------------------------------------------
0760+  FDE3             
0761+  FDE3             .include "fileGetStartAndSize.inc"	; fileGetStartAndSize ïðîäîëæàåòñÿ íà sub_hl_de
0001++ FDE3             ;----------------------------------------------------------------------------
0002++ FDE3             ; RAMFOS
0003++ FDE3             ;
0004++ FDE3             ; 2013-11-01 vinxru
0005++ FDE3             ;----------------------------------------------------------------------------                   
0006++ FDE3             
0007++ FDE3             ; DE = v_header2_start
0008++ FDE3             ; HL = v_header2_size-1
0009++ FDE3             
0010++ FDE3             fileGetStartAndSize:
0011++ FDE3 2A 0A D2    		lhld	v_header2_start
0012++ FDE6 EB          		xchg
0013++ FDE7 2A 0C D2    		lhld	v_header2_end
0014++ FDEA             		; Ïðîäîëæåíèå íà subHlDe
0762+  FDEA             .include "sub_hl_de.inc"
0001++ FDEA             ;+---------------------------------------------------------------------------
0002++ FDEA             ; RAMFOS
0003++ FDEA             ; Âû÷èòàíèå èç HL DE
0004++ FDEA             ;
0005++ FDEA             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006++ FDEA             ;----------------------------------------------------------------------------
0007++ FDEA             
0008++ FDEA 7D          sub_hl_de:	mov	a, l
0009++ FDEB 93          		sub	e
0010++ FDEC 6F          		mov	l, a
0011++ FDED 7C          		mov	a, h
0012++ FDEE 9A          		sbb	d
0013++ FDEF 67          		mov	h, a
0014++ FDF0 C9          		ret
0763+  FDF1             
0764+  FDF1             ; ---------------------------------------------------------------------------
0765+  FDF1             
0766+  FDF1             dlg_f2:		; Âûâîä òåêñòà "óäàëèòü"
0767+  FDF1 11 9A FF    		lxi	d, a_delete
0768+  FDF4 CD AE FD    		call	dlg_checkMsg
0769+  FDF7 CA 1B F9    		jz	dlg_f2_alt
0770+  FDFA             
0771+  FDFA             		; Ïîëüçîâàòåëü äîëæåí íàæàòü Enter
0772+  FDFA CD 80 F9    		call	dlg_yesNo
0773+  FDFD             
0774+  FDFD             		; Óäàëèòü ôàéë
0775+  FDFD CD 11 FE    		call	fileDelete
0776+  FE00             
0777+  FE00             		; Òåìíûé ôîí, âîññòàíîâèòü êóðñîð ñòðîêè, êóðñîð ââåðõ, ñêðîëë ââåðõ
0778+  FE00~            #if NICE==0
0779+  FE00~            		call	printStringEx
0780+  FE00~            		.db C_NORMAL, C_POPCURSORL, 19h, C_SCROLLUPEX, 0
0781+  FE00             #endif
0782+  FE00             		; Ïåðåðèñîâàòü ýêðàí
0783+  FE00 C9          		ret
0784+  FE01             
0785+  FE01             ; ---------------------------------------------------------------------------
0786+  FE01             
0787+  FE01             .include "compareFileName.inc"
0001++ FE01             ;+---------------------------------------------------------------------------
0002++ FE01             ; RAMFOS
0003++ FE01             ; Ñðàâíèòü èìÿ òåêóùåãî ôàéëà ñ èìåíåì çàäàííûì ïîëüçîâàòåëåì. 
0004++ FE01             ; È îïöèîíàëüíî, åñëè ñîâïàëî, òî óäàëèòü ôàéë.
0005++ FE01             ;
0006++ FE01             ; Íà âõîäå
0007++ FE01             ;  v_header  - Ôàéë 1, êîòîðûé áóäåò óäàëåí, åñëè b & 20h
0008++ FE01             ;  v_header2 - Ôàéë 2
0009++ FE01             ;
0010++ FE01             ; Íà âûõîäå
0011++ FE01             ;  jz        - ôàéë íàéäåí. Íî åñëè b & 20h, òî ôëàãè íåîïðåäåëåíû.
0012++ FE01             ;
0013++ FE01             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0014++ FE01             ;----------------------------------------------------------------------------
0015++ FE01             
0016++ FE01             compareFileName:; Ñðàâíèòü èäåíòèôèêàòîðû è èìåíà ôàéëîâ 
0017++ FE01 21 F2 D1    		lxi	h, v_header2
0018++ FE04 11 52 D2    		lxi	d, v_header
0019++ FE07 0E 0F       		mvi	c, 15
0020++ FE09 CD 80 FA    		call	memcmp_hl_de_c
0021++ FE0C C0          		rnz
0022++ FE0D             
0023++ FE0D             		; Åñëè (b & 20h)==0 âûõîäèì (íå óäàëÿåì)
0024++ FE0D 78          		mov	a, b
0025++ FE0E E6 20       		ani	20h
0026++ FE10 C8          		rz
0027++ FE11             
0028++ FE11             		; Ïåðåõîäèì ê ôóíêöèè fileDelete0788+  FE11             
0789+  FE11             
0790+  FE11             ; ---------------------------------------------------------------------------
0791+  FE11             
0792+  FE11             .include "fileDelete.inc"
0001++ FE11             ;+---------------------------------------------------------------------------
0002++ FE11             ; RAMFOS
0003++ FE11             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F851
0004++ FE11             ; Óäàëåíèå ôàéëà íàéäåííîãî ïðîãðàììîé F84B
0005++ FE11             ;
0006++ FE11             ; Ôàéë äîëæåí áûòü îáÿçàòåëüíî íàéäåí ôóíêöèåé fileFind (F84B), èíà÷å
0007++ FE11             ; áóäåò ïîâðåæäåíà ñòðóêòóðà ôàéëîâ.
0008++ FE11             ;
0009++ FE11             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0010++ FE11             ;----------------------------------------------------------------------------
0011++ FE11             
0012++ FE11             fileDelete:	; Ðàñ÷åò äëèíû ïîëåçíûõ äàííûõ ïîñëå íàøåãî ôàéëà, êîòîðûå
0013++ FE11             		; íàäî ñäâèíóòü.
0014++ FE11             		; de = v_pageFreePtr - f_nextFile - 1 
0015++ FE11 2A 74 D2    		lhld	f_nextFile
0016++ FE14 EB          		xchg
0017++ FE15 2A 7C D2    		lhld	v_pageFreePtr
0018++ FE18 2B          		dcx	h		
0019++ FE19 CD EA FD    		call	sub_hl_de
0020++ FE1C EB          		xchg
0021++ FE1D             
0022++ FE1D             		; Ïîìåùàåì â ñòåê àäðåñ ñëåäóþùåãî ôàéëà
0023++ FE1D E5          		push	h
0024++ FE1E             
0025++ FE1E             		; Ïîìåùàåì â HL àäðåñ íàøåãî ôàéëà
0026++ FE1E 2A 70 D2    		lhld	v_curFile
0027++ FE21             
0028++ FE21             		; Àäðåñ ñëåäóþùåãî ôàéëà èçìåíèòñÿ ïîñëå ñäâèãà,
0029++ FE21             		; à îí èñïîëüçóåòñÿ â ôóíêöèè compareFileName
0030++ FE21 22 74 D2    		shld	f_nextFile
0031++ FE24             
0032++ FE24             		; Åñëè íàø ôàéë áûë ïîñëåíèì, íè÷åãî íå ïåðåìåùàåì
0033++ FE24 DA 37 FE    		jc	fileDelete_1
0034++ FE27             
0035++ FE27             fileDelete_0:	 ; ×òåíèå ñ äèñêà
0036++ FE27 E3          		 xthl
0037++ FE28 CD C2 FF    		 call	pageRead
0038++ FE2B 23          		 inx	h
0039++ FE2C E3          		 xthl
0040++ FE2D             		 ; Çàïèñü íà äèñê
0041++ FE2D CD D1 FF    		 call	pageWrite
0042++ FE30 23          		 inx	h
0043++ FE31             		 ; if(de==0) break;
0044++ FE31 7B          		 mov	a, e
0045++ FE32 B2          		 ora	d
0046++ FE33             		 ; de--
0047++ FE33 1B          		 dcx	d
0048++ FE34 C2 27 FE    		jnz	fileDelete_0
0049++ FE37             
0050++ FE37             fileDelete_1:	; Îáíîâëÿåì ñ÷åò÷èê ñâîáîäíîãî ìåñòà
0051++ FE37 E3          		xthl
0052++ FE38 E1          		pop	h
0053++ FE39 C3 DF F8    		jmp	fileChanged0793+  FE3C             .include "tapeReadHeader.inc"
0001++ FE3C             ;----------------------------------------------------------------------------
0002++ FE3C             ; RAMFOS
0003++ FE3C             ; ×òåíèå ïåðâûõ 15 áàéò çàãîëîâêà ôàéëà â v_header è âûâîä åãî íà ýêðàí
0004++ FE3C             ; Ïîòîì ÷òåíèå äëèíû òåëà (ïåðâûå 2 áàéòà) â DE
0005++ FE3C             ;
0006++ FE3C             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007++ FE3C             ;----------------------------------------------------------------------------
0008++ FE3C             
0009++ FE3C 21 52 D2    tapeReadHeader:	lxi	h, v_header
0010++ FE3F CD 50 FE    		call	tapeReadH_1
0011++ FE42             
0012++ FE42             		; Äëèíà íå êîíòðîëëèðóåòñÿ!
0013++ FE42             
0014++ FE42             		; ×èòàåì 15 áàéò ñ ìàãíèòîôîíà ïî àäðåñó hl
0015++ FE42 1E 0F       		mvi	e, 15
0016++ FE44 CD 06 C8    tapeReadH_0:	 call	j_tapeRead
0017++ FE47 77          		 mov	m, a
0018++ FE48 23          		 inx	h
0019++ FE49 1D          		 dcr	e
0020++ FE4A C2 44 FE    		jnz	tapeReadH_0
0021++ FE4D             
0022++ FE4D             		; Âûâîäèì èìÿ íà ýêðàí
0023++ FE4D CD 06 FC    		call	printFileHeaderName
0024++ FE50             
0025++ FE50             tapeReadH_1:	; Æäåì ïèëîò òîí
0026++ FE50 CD 24 C8    		call	j_tapeReadPilot
0027++ FE53             
0028++ FE53             		; ×èòàåì ñëîâî â DE
0029++ FE53 D4 06 C8    		cnc	j_tapeRead
0030++ FE56 5F          		mov	e, a
0031++ FE57 D4 06 C8    		cnc	j_tapeRead
0032++ FE5A 57          		mov	d, a
0033++ FE5B C9          		ret
0794+  FE5C             
0795+  FE5C             ; ---------------------------------------------------------------------------
0796+  FE5C             
0797+  FE5C             dlg_f3:		; Âûâîäèì "ñðàâíèòü"
0798+  FE5C 11 B0 FF    		lxi	d, a_verify
0799+  FE5F CD AE FD    		call	dlg_checkMsg
0800+  FE62             
0801+  FE62             		; Åñëè ôàéë íå âûáðàí
0802+  FE62 CA 80 FE    		jz	dlg_f3_alt
0803+  FE65             
0804+  FE65             		; ?
0805+  FE65 CD 80 F9    		call	dlg_yesNo
0806+  FE68             
0807+  FE68             		; Ïðîäîëæåíèå â fileVerify
0808+  FE68             
0809+  FE68             ; ---------------------------------------------------------------------------
0810+  FE68             
0811+  FE68             .include "fileVerify.inc"
0001++ FE68             ;----------------------------------------------------------------------------
0002++ FE68             ; RAMFOS
0003++ FE68             ; Ñðàâíèòü òåêóùèé ôàéë ñ ìàãíèòîôîíîì
0004++ FE68             ;
0005++ FE68             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006++ FE68             ;----------------------------------------------------------------------------
0007++ FE68             
0008++ FE68             		; ×òåíèå ïåðâûõ 15 áàéò çàãîëîâêà ôàéëà â v_header è âûâîä åãî íà ýêðàí
0009++ FE68             		; Ïîòîì ÷òåíèå äëèíû òåëà (ïåðâûå 2 áàéòà) â DE
0010++ FE68 CD 3C FE    		call	tapeReadHeader
0011++ FE6B             
0012++ FE6B             		;! Äëèíà íå êîíòðîëëèðóåòñÿ
0013++ FE6B             
0014++ FE6B             		; Àäðåñ âûáðàííîãî ôàéëà íà äèñêå
0015++ FE6B 2A 70 D2    		lhld	v_curFile		 
0016++ FE6E             verifyLoop:	 ; ×èòàåì áàéò ñ äèñêà
0017++ FE6E CD C2 FF    		 call	pageRead
0018++ FE71             		 ; ×èòàåì áàéò ñ ìàãíèòîôîíà
0019++ FE71 CD 06 C8    		 call	j_tapeRead
0020++ FE74             		 ; Åñëè áàéòû íå ðàâíû, âûâîäèì îøèáêó
0021++ FE74 B9          		 cmp	c
0022++ FE75 C2 B5 FE    		 jnz	dlg_error
0023++ FE78             		 ; Óâåëè÷èâàåì àäðåñ íà äèñêå
0024++ FE78 23          		 inx	h
0025++ FE79             		 ; Öèêë. 
0026++ FE79             		 ;! Íàäî ïîñòàâèòü â íà÷àëî
0027++ FE79 1B          		 dcx	d
0028++ FE7A 7B          		 mov	a, e
0029++ FE7B B2          		 ora	d
0030++ FE7C C2 6E FE    		jnz	verifyLoop
0031++ FE7F C9          		ret
0812+  FE80             
0813+  FE80             ; ---------------------------------------------------------------------------
0814+  FE80             
0815+  FE80             dlg_f3_alt:	; Âûâîä íà ýêðàí ñòðîêè "×òåíèå"
0816+  FE80 11 A2 FF    		lxi	d, a_load
0817+  FE83 CD 7D F9    		call	dlg_msgYesNo
0818+  FE86             
0819+  FE86             .include "fileFromTape.inc"	; fileFromTape ïðîäîëæàåòñÿ
0001++ FE86             ;----------------------------------------------------------------------------
0002++ FE86             ; RAMFOS
0003++ FE86             ; ×òåíèå ôàéëà ñ ìàãíèòîôîíà è ñîõðàíåíèå â âûáðàííóþ ñòðàíèöó
0004++ FE86             ;
0005++ FE86             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006++ FE86             ;----------------------------------------------------------------------------
0007++ FE86             
0008++ FE86             fileFromTape:	; ×èòàåì çàãîëîâîê ñ äèñêà
0009++ FE86 CD 3C FE    		call	tapeReadHeader
0010++ FE89             
0011++ FE89             		; Âûâîäèì òåêñò "ÎØÈÁÊÀ" + çâóêîâîé ñèãíàë. 
0012++ FE89             		; Æäåì íàæàòèÿ ESC è âûõîäèì ñ óñòàíîâëåííûì ôëàãîì C
0013++ FE89 DA B5 FE    		jc	fileFromTapeErr2
0014++ FE8C             
0015++ FE8C             		; Õâàòèò ëè ìåñòà íà äèñêå äëÿ ñîõðàíåíèÿ ôàéëà?
0016++ FE8C 2A 7A D2    		lhld	v_pageFreeTotal
0017++ FE8F 2B          		dcx	h
0018++ FE90 2B          		dcx	h
0019++ FE91 2B          		dcx	h
0020++ FE92 CD 54 C8    		call	j_cmp_hl_de
0021++ FE95             
0022++ FE95             		; Âûâîäèì òåêñò "ÌÀË ÄÈÑÊ" + çâóêîâîé ñèãíàë. 
0023++ FE95             		; Æäåì íàæàòèÿ ESC è âûõîäèì ñ óñòàíîâëåííûì ôëàãîì C
0024++ FE95 DA CA FE    		jc	outOfSpace
0025++ FE98             
0026++ FE98             		; Óêàçàòåëü çàïèñè íà äèñê
0027++ FE98 2A 7C D2    		lhld	v_pageFreePtr
0028++ FE9B             readLoop:	 ; ×èòàåì áàéò ñ ìàãíèòîôîíà
0029++ FE9B CD 06 C8    		 call	j_tapeRead		
0030++ FE9E DA AF FE    		 jc	fileFromTapeErr
0031++ FEA1             		 ; Çàïèñûâàåì áàéò A íà äèñê ïî àäðåñó HL
0032++ FEA1 4F          		 mov	c, a
0033++ FEA2 CD D1 FF    		 call	pageWrite
0034++ FEA5 23          		 inx	h
0035++ FEA6             		 ; Öèêë DE
0036++ FEA6 1B          		 dcx	d
0037++ FEA7 7B          		 mov	a, e
0038++ FEA8 B2          		 ora	d
0039++ FEA9 C2 9B FE    		jnz	readLoop
0040++ FEAC             
0041++ FEAC             		; Ôàéë ïðî÷èòàí
0042++ FEAC C3 DD F8    		jmp	fileChanged2
0043++ FEAF             
0044++ FEAF             ; ---------------------------------------------------------------------------
0045++ FEAF             
0046++ FEAF             fileFromTapeErr:
0047++ FEAF             		; Óñòàíàëâèàåì êîíåö äèñêà â v_curFile
0048++ FEAF 2A 70 D2    		lhld	v_curFile
0049++ FEB2 CD DF F8    		call	fileChanged
0050++ FEB5             
0051++ FEB5             fileFromTapeErr2:0820+  FEB5             
0821+  FEB5             dlg_error:	; Âûâîäèì ñîîáùåíèå "ÎØÈÁÊÀ" + çâóêîâîé ñèãíàë
0822+  FEB5 CD D9 FE    		call	printStringEx
0823+  FEB8 CF DB C9 C2 		.db 0CFh, 0DBh,	0C9h, 0C2h, 0CBh, 0C1h,	C_BEEP, 0 ; îøèáêà
0823+  FEBC CB C1 07 00 
0824+  FEC0             
0825+  FEC0             waitEsc:	; Æäåì, ïîêà ïîëüçîâàòåëü íå íàæìåò ESC
0826+  FEC0 CD 72 FA    		 call	keyWaitNoCursor
0827+  FEC3             #if NICE
0828+  FEC3 FE 20       		 cpi	' '
0829+  FEC5~            #else
0830+  FEC5~            		 cpi	1Fh
0831+  FEC5             #endif
0832+  FEC5 C2 C0 FE    		jnz	waitEsc
0833+  FEC8             		; Âûõîäèì ñ óñòàíîâëåííûì ôëàãîì C
0834+  FEC8 37          		stc
0835+  FEC9 C9          		ret
0836+  FECA             
0837+  FECA             ; ---------------------------------------------------------------------------
0838+  FECA             
0839+  FECA CD D9 FE    outOfSpace:	call	printStringEx
0840+  FECD CD C1 CC 20 		.db 0CDh, 0C1h,	0CCh, 20h, 0C4h, 0C9h, 0D3h, 0CBh, 0 ; ìàë äèñê
0840+  FED1 C4 C9 D3 CB 
0840+  FED5 00 
0841+  FED6 C3 C0 FE    		jmp	waitEsc
0842+  FED9             
0843+  FED9             ; ---------------------------------------------------------------------------
0844+  FED9             
0845+  FED9             .include "printStringEx.inc"
0001++ FED9             ;+---------------------------------------------------------------------------
0002++ FED9             ; RAMFOS
0003++ FED9             ; Âûâîä ñòðîêè íà ýêðàí
0004++ FED9             ;
0005++ FED9             ; Ñòðîêà ðàçìåùàåòñÿ ñðàçó æå ïîñëå êîìàäíû âûçîâà
0006++ FED9             ;
0007++ FED9             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0008++ FED9             ;----------------------------------------------------------------------------
0009++ FED9             
0010++ FED9 E3          printStringEx:	xthl
0011++ FEDA CD 18 C8    		call	j_printString
0012++ FEDD E3          		xthl
0013++ FEDE C9          		ret
0846+  FEDF             
0847+  FEDF             ; ---------------------------------------------------------------------------
0848+  FEDF             ; Ñîõàíèòü ôàéë íà ìàãíèòîôîí
0849+  FEDF             
0850+  FEDF             dlg_f4:		; Åñëè ôàéë íå âûáðàí, âûõîäèì
0851+  FEDF 2A 74 D2    		lhld	f_nextFile
0852+  FEE2 CD 54 C8    		call	j_cmp_hl_de
0853+  FEE5 C8          		rz
0854+  FEE6             
0855+  FEE6             		; Âûâîä "çàïèñü"
0856+  FEE6 11 A9 FF    		lxi	d, a_save
0857+  FEE9 CD 7D F9    		call	dlg_msgYesNo
0858+  FEEC             
0859+  FEEC CD D9 FD    		call	dlg_isLastLine
0860+  FEEF 2A 43 D2    		lhld	v_pageStart
0861+  FEF2 CA 08 FF    		jz	fileToTape
0862+  FEF5             
0863+  FEF5 0E 8C       		mvi	c, C_NORMAL
0864+  FEF7             
0865+  FEF7 2A 70 D2    		lhld	v_curFile
0866+  FEFA 11 0F 00    		lxi	d, 0Fh
0867+  FEFD 19          		dad	d
0868+  FEFE CD D1 FF    		call	pageWrite
0869+  FF01             		
0870+  FF01 2A 78 D2    		lhld	f_fileSize
0871+  FF04 EB          		xchg
0872+  FF05 2A 70 D2    		lhld	v_curFile
0873+  FF08             
0874+  FF08             .include "fileToTape.inc"
0001++ FF08             ;----------------------------------------------------------------------------
0002++ FF08             ; RAMFOS
0003++ FF08             ; Ñîõðàíèòü ôàéë íà ìàãíèòîôîí
0004++ FF08             ;
0005++ FF08             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0006++ FF08             ;----------------------------------------------------------------------------
0007++ FF08             
0008++ FF08             fileToTape:	; Ñíà÷àëà çàïèñûâàåì òîëüêî 15 áàéò.
0009++ FF08 E5          		push	h
0010++ FF09 D5          		 push	d
0011++ FF0A 11 0F 00    		  lxi	d, 15
0012++ FF0D CD 12 FF    		  call	fileToTape_0
0013++ FF10 D1          		 pop	d
0014++ FF11 E1          		pop	h
0015++ FF12             
0016++ FF12             		; Ïîòîì òîò æå áëîê äàííûõ, íî öåëèêîì
0017++ FF12             
0018++ FF12             fileToTape_0:	; Ïèëîò òîí
0019++ FF12 CD 27 C8    		call	j_tapeWritePilot
0020++ FF15             
0021++ FF15             		; Çàïèñü äëèíû
0022++ FF15 4B          		mov	c, e
0023++ FF16 AF          		xra	a
0024++ FF17 CD 0C C8    		call	j_tapeWrite
0025++ FF1A 4A          		mov	c, d
0026++ FF1B AF          		xra	a
0027++ FF1C CD 0C C8    		call	j_tapeWrite
0028++ FF1F             
0029++ FF1F             		; Çà÷åì ýòî?
0030++ FF1F 06 08       		mvi	b, 8		
0031++ FF21             fileToTape_1:	 ; Åñëè çàïèñûâàòü íå÷åãî, âûõîäèì
0032++ FF21 7B          		 mov	a, e
0033++ FF22 B2          		 ora	d
0034++ FF23 C8          		 rz
0035++ FF24             		 ; ×èòàåì áàéò ñ äèñêà
0036++ FF24 CD C2 FF    		 call	pageRead
0037++ FF27 23          		 inx	h
0038++ FF28             		 ; Óìåíüøàåì ñ÷åò÷èê
0039++ FF28 1B          		 dcx	d
0040++ FF29             		 ; Çàïèñûâàåì íà ìàãíèòîôîí
0041++ FF29 78          		 mov	a, b
0042++ FF2A CD 0C C8    		 call	j_tapeWrite
0043++ FF2D C3 21 FF    		jmp	fileToTape_10875+  FF30             
0876+  FF30             ; ---------------------------------------------------------------------------
0877+  FF30             ; Ïåðåèìåíîâàòü ôàéë
0878+  FF30             
0879+  FF30             dlg_f5:		; Âûâåñòè "èìÿ:"
0880+  FF30 11 B9 FF    		lxi	d, a_name
0881+  FF33 CD AE FD    		call	dlg_checkMsg
0882+  FF36             
0883+  FF36             		; Åñëè ôàéë íå âûáðàí
0884+  FF36 CA 6C FA    		jz	startEditor
0885+  FF39             
0886+  FF39             dlg_f5_retry:	; Óñòàíàâëèâàåì êóðñîð íà èìÿ ôàéëà
0887+  FF39 CD FA FB    		call	popCursorLine2
0888+  FF3C             
0889+  FF3C             		; Ðåäàêòèðîâàíèå èìåíè ôàéëà
0890+  FF3C 21 55 D2    		lxi	h, v_header_name
0891+  FF3F 11 FF 0C    		lxi	d, 0CFFh
0892+  FF42 CD 36 C8    		call	j_input
0893+  FF45             	
0894+  FF45             		; Áûë íàæàò ESC	
0895+  FF45 CA 93 F9    		jz	loc_F9D0
0896+  FF48             
0897+  FF48             		; Áûëà íàæàòà ñëóæåáíàÿ êëàâèøà
0898+  FF48 D2 39 FF    		jnc	dlg_f5_retry
0899+  FF4B             
0900+  FF4B             		; Èìÿ íå ââåäåíî, ïåðåðèñîâàòü
0901+  FF4B F0          		rp
0902+  FF4C             
0903+  FF4C             		; Ïðîäîëæåíèå â fileSaveHeader
0904+  FF4C             
0905+  FF4C             ; ---------------------------------------------------------------------------0359   FF4C             #if RELOCATE_FILE_FUNCTIONS
0360   FF4C C3 39 D1    	jmp	fileSaveHeader
0361   FF4F~            #else
0362   FF4F~            .include "fileSaveHeader.inc"	; ¯à®¤®«¦¥­¨¥ ¢ pageWriteBlock
0363   FF4F~            .include "pageWriteBlock.inc"
0364   FF4F             #endif
0365   FF4F             .include "fileSetGetName.inc"
0001+  FF4F             ;+---------------------------------------------------------------------------
0002+  FF4F             ; RAMFOS
0003+  FF4F             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F845
0004+  FF4F             ; Ïîëó÷åíèå èìåíè ïîñëåäíåãî çàãðóæåííîãî ôàéëà
0005+  FF4F             ;
0006+  FF4F             ; Íà âõîäå
0007+  FF4F             ;  hl - èìÿ ôàéëà (12 áàéò)
0008+  FF4F             ;
0009+  FF4F             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0010+  FF4F             ;----------------------------------------------------------------------------
0011+  FF4F             
0012+  FF4F E5          fileGetName:	push	h
0013+  FF50 D5          		push	d
0014+  FF51 C5          		push	b
0015+  FF52 11 F5 D1    		lxi	d, v_header2_name
0016+  FF55 EB          		xchg
0017+  FF56 C3 5F FF    		jmp	fileSetName_0
0018+  FF59             
0019+  FF59             ;----------------------------------------------------------------------------
0020+  FF59             ; RAMFOS
0021+  FF59             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F848
0022+  FF59             ; Óñòàíîâêà èìÿ äëÿ ôóíêöèé ñîõàðàíåíèÿ/ïîèñêà
0023+  FF59             ;
0024+  FF59             ; Íà âõîäå
0025+  FF59             ;  hl - èìÿ ôàéëà (12 áàéò)
0026+  FF59             ;
0027+  FF59             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0028+  FF59             ;----------------------------------------------------------------------------
0029+  FF59             
0030+  FF59 E5          fileSetName:	push	h
0031+  FF5A D5          		push	d
0032+  FF5B C5          		push	b
0033+  FF5C 11 F5 D1    		lxi	d, v_header2_name
0034+  FF5F 0E 0B       fileSetName_0:	mvi	c, 11
0035+  FF61 C3 6C FF    		jmp	memcpy_popa0366   FF64             .include "fileSetType.inc"
0001+  FF64             ;+---------------------------------------------------------------------------
0002+  FF64             ; RAMFOS
0003+  FF64             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F82D
0004+  FF64             ; Óñòàíîâèòü ðàñøèðåíèå ñîõðàíÿåìîãî/çàãðóæàåìîãî ôàéëà
0005+  FF64             ;
0006+  FF64             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0007+  FF64             ;----------------------------------------------------------------------------
0008+  FF64             
0009+  FF64 E5          fileSetType:	push	h
0010+  FF65 D5          		push	d
0011+  FF66 C5          		push	b
0012+  FF67 11 FE D1    		 lxi	d, v_header2_ext
0013+  FF6A 0E 02       		 mvi	c, 2	; Ðàçìåð -1
0014+  FF6C F5          memcpy_popa:	 push	psw
0015+  FF6D CD C3 FB    		  call	memcpy_de_hl_c
0016+  FF70 F1          		 pop	psw
0017+  FF71 C1          		pop	b
0018+  FF72 D1          		pop	d
0019+  FF73 E1          		pop	h
0020+  FF74 C9          		ret0367   FF75             
0368   FF75             ; ===========================================================================
0369   FF75             ; ……Œ…›…
0370   FF75             
0371   FF75 D3 D3 D3    a_defHeader:	.db 0D3h, 0D3h,	0D3h	; ¬ àª¥à ­ ç «  ä ©«  (§  ­¨¬ ®¡ï§ â¥«ì­® ¤®«¦¥­® ¨¤â¨ 12 ¯à®¡¥«®¢)
0372   FF78 20 20 20 20 a_12spaces:	.text "            "	; ¯ãáâ®¥ ¨¬ï
0372   FF7C 20 20 20 20 
0372   FF80 20 20 20 20 
0373   FF84 45 58 45    a_exe:		.text "EXE"
0374   FF87 43 4F 4D    a_com:		.text "COM"
0375   FF8A CB CF D0 C9 a_copy:		.db 0CBh, 0CFh,	0D0h, 0C9h, 0D2h, 0CFh,	0D7h, 
0375   FF8E D2 CF D7 
0376   FF91 C1 D4 D8 00 		.db 0C1h, 0D4h, 0D8h, 0					; "ª®¯¨à®¢ âì"
0377   FF95 C4 C1 D4 D5 a_deleteDate:	.db 0C4h, 0C1h,	0D4h, 0D5h, 20h				; "¤ âã ã¤ «¨âì"
0377   FF99 20 
0378   FF9A D5 C4 C1 CC a_delete:	.db 0D5h, 0C4h,	0C1h, 0CCh, 0C9h, 0D4h,	0D8h, 0		; "ã¤ «¨âì"
0378   FF9E C9 D4 D8 00 
0379   FFA2 DE D4 C5 CE a_load:		.db 0DEh, 0D4h,	0C5h, 0CEh, 0C9h, 0C5h,	0		; "çâ¥­¨¥"
0379   FFA6 C9 C5 00 
0380   FFA9 DA C1 D0 C9 a_save:		.db 0DAh, 0C1h,	0D0h, 0C9h, 0D3h, 0D8h,	0		; "§ ¯¨áì"
0380   FFAD D3 D8 00 
0381   FFB0 D3 D2 C1 D7 a_verify:	.db 0D3h, 0D2h,	0C1h, 0D7h, 0CEh, 0C9h,	0D4h, 0D8h, 0	; "áà ¢­¨âì"
0381   FFB4 CE C9 D4 D8 
0381   FFB8 00 
0382   FFB9 C9 CD D1 00 a_name:		.db 0C9h, 0CDh,	0D1h, 0	; ¨¬ï
0383   FFBD             
0384   FFBD             ; ===========================================================================
0385   FFBD             ; ŽŠŽ Ž–…‘‘Ž€
0386   FFBD             
0387   FFBD             .include "window.inc"
0001+  FFBD             ;+---------------------------------------------------------------------------
0002+  FFBD             ; RAMFOS
0003+  FFBD             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0004+  FFBD             ;----------------------------------------------------------------------------
0005+  FFBD             
0006+  FFBD~            #if BIG_ROM != 1
0007+  FFBD~            		
0008+  FFBD~            #if $ > 0FFB6h
0009+  FFBD~            Îøèáêà_÷àñòü_F800_íå_âëåçëà
0010+  FFBD~            #endif
0011+  FFBD~            .org 0FFB6h
0012+  FFBD~            
0013+  FFBD~            pageWriteROM:	sta	IO_PAGE_ROM
0014+  FFBD~            		jmp	pageWriteCom
0015+  FFBD~            
0016+  FFBD~            pageReadROM:	sta	IO_PAGE_ROM
0017+  FFBD~            		jmp	pageReadCom
0018+  FFBD~            
0019+  FFBD             #endif
0020+  FFBD             
0021+  FFBD             ; ---------------------------------------------------------------------------
0022+  FFBD             
0023+  FFBD~            #if $ > 0FFC2h
0024+  FFBD~            Îøèáêà_÷àñòü_F800_íå_âëåçëà
0025+  FFBD             #endif
0026+  FFC2             .org 0FFC2h
0027+  FFC2             
0028+  FFC2 3A 45 D2    pageRead:	lda	v_page
0029+  FFC5             
0030+  FFC5             ;----------------------------------------------------------------------------
0031+  FFC5             ; RAMFOS
0032+  FFC5             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F836
0033+  FFC5             ; ×òåíèå áàéòà èç ÄÎÇÓ
0034+  FFC5             ;
0035+  FFC5             ; Íà âõîäå
0036+  FFC5             ;   a  - íîìåð ñòðàíèöû
0037+  FFC5             ;   hl - àäðåñ
0038+  FFC5             ;
0039+  FFC5             ; Íà âûõîäå
0040+  FFC5             ;   ñ  - áàéò
0041+  FFC5             ;
0042+  FFC5             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0043+  FFC5             ;----------------------------------------------------------------------------
0044+  FFC5             
0045+  FFC5 B7          pageReadAny:	ora	a
0046+  FFC6             #if BIG_ROM
0047+  FFC6 FA 10 D1    		jm	bigRom
0048+  FFC9~            #else
0049+  FFC9~            		jm	pageReadROM
0050+  FFC9             #endif
0051+  FFC9 32 FD FF    disableARAM1:	sta	IO_PAGE_ARAM		
0052+  FFCC 4E          pageReadCom:	mov	c, m
0053+  FFCD 32 FC FF    		sta	IO_PAGE_RAM
0054+  FFD0 C9          		ret
0055+  FFD1             
0056+  FFD1             ; ---------------------------------------------------------------------------
0057+  FFD1             
0058+  FFD1 3A 45 D2    pageWrite:	lda	v_page
0059+  FFD4             
0060+  FFD4             ;----------------------------------------------------------------------------
0061+  FFD4             ; RAMFOS
0062+  FFD4             ; Ñòàíäàðòíàÿ òî÷êà âõîäà F839
0063+  FFD4             ; Çàïèñü áàéòà â ÄÎÇÓ
0064+  FFD4             ;
0065+  FFD4             ; Íà âõîäå
0066+  FFD4             ;   a  - íîìåð ñòðàíèöû
0067+  FFD4             ;   hl - àäðåñ
0068+  FFD4             ;   c  - áàéò
0069+  FFD4             ;
0070+  FFD4             ; 2013-11-01 Äèçàññåìáëèðîâàíî vinxru
0071+  FFD4             ;----------------------------------------------------------------------------
0072+  FFD4             
0073+  FFD4 B7          pageWriteAny:	ora	a
0074+  FFD5             #if BIG_ROM
0075+  FFD5 FA DF FF    		jm	pageWriteRet
0076+  FFD8~            #else
0077+  FFD8~            		jm	pageWriteROM
0078+  FFD8             #endif
0079+  FFD8 32 FD FF    disableARAM2:	sta	IO_PAGE_ARAM
0080+  FFDB 71          pageWriteCom:	mov	m, c
0081+  FFDC 32 FC FF    		sta	IO_PAGE_RAM
0082+  FFDF C9          pageWriteRet:	ret0388   FFE0             
0389   FFE0             .end		tasm: Number of errors = 0
